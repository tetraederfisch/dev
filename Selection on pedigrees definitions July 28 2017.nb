(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 11.1' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[    632826,      15213]
NotebookOptionsPosition[    569469,      14103]
NotebookOutlinePosition[    569854,      14120]
CellTagsIndexPosition[    569811,      14117]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[TextData[{
 StyleBox["28/7/17 Note: ",
  FontWeight->"Bold"],
 " These definitions were extracted from the bloated \
\[OpenCurlyDoubleQuote]Selection on pedigrees\[CloseCurlyDoubleQuote] \
notebook, and should be used as the reference for simulating continuous \
chromosomes.  I moved nKidsByFamily to the Longshanks definitions file"
}], "Text",
 CellChangeTimes->{{3.710219075547447*^9, 3.7102191071780148`*^9}, {
  3.710219288964061*^9, 3.7102193586751833`*^9}, {3.710329918514496*^9, 
  3.710329934591626*^9}},ExpressionUUID->"8a7ca42e-511d-4d3c-ade9-\
778608795b4c"],

Cell[TextData[{
 StyleBox["14.5.18 Note: ",
  FontWeight->"Bold"],
 " I changed throwP and intSNP to include ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    SuperscriptBox["t", "*"], " "}], TraditionalForm]],
  FormatType->"TraditionalForm",ExpressionUUID->
  "492a560a-f882-4e34-8f70-f8f194bc1881"],
 "as well as ",
 Cell[BoxData[
  FormBox[
   SuperscriptBox["r", "*"], TraditionalForm]],
  FormatType->"TraditionalForm",ExpressionUUID->
  "5d967297-59a6-478f-a1df-9f3ec2dd2064"],
 ", for consistency. I also now include intSNP in clearGlobalVariables"
}], "Text",
 CellChangeTimes->{{3.735287380810131*^9, 3.735287404806795*^9}, {
  3.7352874896976*^9, 3.73528750015172*^9}, {3.735373003501173*^9, 
  3.735373016705832*^9}},ExpressionUUID->"b47abb51-279c-4800-a6c6-\
3802cf6762b5"],

Cell[CellGroupData[{

Cell["Definitions", "Section",
 CellChangeTimes->{{3.6674552062154818`*^9, 
  3.667455207486349*^9}},ExpressionUUID->"8fb88e3f-f138-42a0-8515-\
d28fba859f49"],

Cell[CellGroupData[{

Cell["Oldest definitions", "Subsection",
 CellChangeTimes->{{3.709808722506011*^9, 
  3.709808724702271*^9}},ExpressionUUID->"636c662a-1f2d-4596-bf76-\
95167ae48c43"],

Cell[CellGroupData[{

Cell[" To do 27.12.16", "Subsubsection",
 CellChangeTimes->{{3.691838108878496*^9, 
  3.691838126744533*^9}},ExpressionUUID->"96fcd260-2722-4550-b6cb-\
28bbd585e406"],

Cell[TextData[{
 "\t- extract data on the actual pedigree, and the actual ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    SubscriptBox["p", "0"], ",", 
    SubscriptBox["p", "17"]}], TraditionalForm]],ExpressionUUID->
  "78c6230a-8c8b-45c9-8799-9bcf5e0af4bd"],
 "\n\t- use the TM approach to get a rough estimate of \[Phi](Ns)\n\t\t- drop \
genes down the true pedigree to find the neutral TM, and then estimate ",
 Cell[BoxData[
  FormBox[
   RowBox[{"\[Phi]", "[", 
    RowBox[{"N", "\[VeryThinSpace]", "s"}], "]"}], TraditionalForm]],
  ExpressionUUID->"05cff850-132a-4cf0-a8d1-d1cf0fda28ae"],
 "\n\t- code simulation conditional on the true pedigree, with within-family \
selection\n\t- use this to compare estimates of \[Phi](Ns), made using the \
TM, but checking the reliability of estimates (??) "
}], "Text",
 CellChangeTimes->{{3.691837393449119*^9, 3.691837561694036*^9}, {
   3.691837792903364*^9, 3.691837820307288*^9}, {3.6918378735410147`*^9, 
   3.691837883325172*^9}, 
   3.691838117272458*^9},ExpressionUUID->"9742648d-3c67-4cb8-9480-\
4945d8e23807"],

Cell["\<\
The idea is that the TM gives an unbiased estimate of the joint allele \
frequency distribution;  simulations with linkage are needed primarily to \
check reliability\
\>", "Text",
 CellChangeTimes->{{3.6918378899133453`*^9, 
  3.69183794371614*^9}},ExpressionUUID->"a51af8c5-7d03-4428-a09a-\
fae140cba70b"],

Cell[TextData[{
 "However, it may not be so easy to interpret ",
 Cell[BoxData[
  FormBox[
   RowBox[{"\[Phi]", "[", "s", "]"}], TraditionalForm]],ExpressionUUID->
  "6b8f9a57-f319-479d-beff-3c4dd220477f"],
 " with linkage, since one causal locus will cause sweeps at many linked SNP. \
So, one might greatly overestimate the extent of selection. "
}], "Text",
 CellChangeTimes->{{3.691837950971587*^9, 3.691837970315542*^9}, {
  3.6918380294033213`*^9, 3.691838039544816*^9}, {3.691838075938711*^9, 
  3.6918380978885117`*^9}},ExpressionUUID->"c8dee827-29c7-4848-8a71-\
5343fc7b2b74"],

Cell["\<\
Maybe use Gemma\[CloseCurlyQuote]s observation that \[Delta]p averaged over \
windows gives more reliable results?\
\>", "Text",
 CellChangeTimes->{{3.691837975826743*^9, 
  3.691838005284775*^9}},ExpressionUUID->"0bddfc54-f40b-4c96-a192-\
b9cf5acba79d"]
}, Open  ]],

Cell[CellGroupData[{

Cell["meanTable", "Subsubsection",
 CellChangeTimes->{
  3.6675423042570467`*^9, {3.667542823325799*^9, 
   3.667542823748487*^9}},ExpressionUUID->"e9208884-2b91-4e8f-94ac-\
675e2ef7319a"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"meanTable", "::", "usage"}], "=", 
   "\"\<meanTable[{\!\(\*SubscriptBox[\(p\), \
\(1\)]\),\!\(\*SubscriptBox[\(p\), \(T\)]\)},2N] tabulates the variance of \
final allele frequency, conditional on initial frequency\>\""}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.667542212166502*^9, 3.6675422650390863`*^9}, {
  3.667542830240842*^9, 3.667542834434616*^9}},
 CellLabel->
  "In[275]:=",ExpressionUUID->"fb073d54-2a39-47ab-a687-18457f2c00b2"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"meanTable", "[", 
    RowBox[{"p_List", ",", "ninds_"}], "]"}], ":=", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Mean", "/@", 
     RowBox[{"GatherBy", "[", 
      RowBox[{"p", ",", 
       RowBox[{
        RowBox[{"Round", "[", 
         RowBox[{"ninds", 
          RowBox[{
          "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], 
         "]"}], "&"}]}], "]"}]}], "//", "Sort"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.667542274048316*^9, 3.667542299317122*^9}, {
   3.667542754473895*^9, 3.6675428874559593`*^9}, {3.6675429344057837`*^9, 
   3.667542936771234*^9}, 3.667544576162472*^9},
 CellLabel->
  "In[276]:=",ExpressionUUID->"f24c567e-912d-4fff-8b17-c8ff5d9e40bf"]
}, Closed]],

Cell[CellGroupData[{

Cell["varTable", "Subsubsection",
 CellChangeTimes->{
  3.6675423042570467`*^9},ExpressionUUID->"c3d7257e-de10-4634-aa5d-\
3eff7415dc84"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"varTable", "::", "usage"}], "=", 
   "\"\<varTable[{\!\(\*SubscriptBox[\(p\), \
\(1\)]\),\!\(\*SubscriptBox[\(p\), \(T\)]\)},2N] tabulates the variance of \
final allele frequency, conditional on initial frequency\>\""}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.667542212166502*^9, 3.6675422650390863`*^9}},
 CellLabel->
  "In[277]:=",ExpressionUUID->"201590cf-1541-4b65-8f20-c040999df7ba"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"varTable", "[", 
    RowBox[{"p_List", ",", "ninds_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"gb", ",", "j"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"gb", "=", 
       RowBox[{"GatherBy", "[", 
        RowBox[{"p", ",", 
         RowBox[{
          RowBox[{"Round", "[", 
           RowBox[{"ninds", 
            RowBox[{
            "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], 
           "]"}], "&"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"DeleteCases", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Mean", "[", 
              RowBox[{"gb", "\[LeftDoubleBracket]", 
               RowBox[{"j", ",", "All", ",", "1"}], "\[RightDoubleBracket]"}],
               "]"}], ",", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"Length", "[", 
                 RowBox[{"gb", "\[LeftDoubleBracket]", 
                  RowBox[{"j", ",", "All", ",", "2"}], 
                  "\[RightDoubleBracket]"}], "]"}], "<", "2"}], ",", "Null", 
               ",", 
               RowBox[{"Variance", "[", 
                RowBox[{"gb", "\[LeftDoubleBracket]", 
                 RowBox[{"j", ",", "All", ",", "2"}], 
                 "\[RightDoubleBracket]"}], "]"}]}], "]"}]}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"_", ",", "Null"}], "}"}]}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"j", ",", 
           RowBox[{"Length", "[", "gb", "]"}]}], "}"}]}], "]"}], "//", 
       "Sort"}]}]}], "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.667542274048316*^9, 3.667542299317122*^9}, {
  3.667542754473895*^9, 3.6675428086143513`*^9}, {3.66754292895866*^9, 
  3.667542929773389*^9}, {3.66754456108774*^9, 3.6675445623904657`*^9}},
 CellLabel->
  "In[278]:=",ExpressionUUID->"57c96732-851a-4562-a67a-d6ad199af7c7"]
}, Closed]],

Cell[CellGroupData[{

Cell["dF", "Subsubsection",
 CellChangeTimes->{{3.667559270702585*^9, 
  3.66755927604737*^9}},ExpressionUUID->"1ecfbef7-6d91-4501-b6c7-\
dc4ae24139f3"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"dF", "::", "usage"}], "=", 
   "\"\<dF[{{p0,p1},\[Ellipsis]}] lists (p1-p0\!\(\*SuperscriptBox[\()\), \(2\
\)]\)/p0(1-p0), excluding cases where p0=0, 1\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6675592426481543`*^9, 3.6675593123559647`*^9}, {
  3.6675594530743017`*^9, 3.667559457968751*^9}, {3.7099469491215363`*^9, 
  3.709946958647628*^9}},
 CellLabel->
  "In[279]:=",ExpressionUUID->"b9915b31-14e4-41bc-8c8e-e227f002431f"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"dF", "[", "p_List", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"pp", "=", 
        RowBox[{"Select", "[", 
         RowBox[{"p", ",", 
          RowBox[{
           RowBox[{"0", "<", 
            RowBox[{
            "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], "<", 
            "1"}], "&"}]}], "]"}]}], ",", "p0", ",", "p1"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"p0", "=", 
       RowBox[{"pp", "\[LeftDoubleBracket]", 
        RowBox[{"All", ",", "1"}], "\[RightDoubleBracket]"}]}], ";", 
      RowBox[{"p1", "=", 
       RowBox[{"pp", "\[LeftDoubleBracket]", 
        RowBox[{"All", ",", "2"}], "\[RightDoubleBracket]"}]}], ";", 
      FractionBox[
       SuperscriptBox[
        RowBox[{"(", 
         RowBox[{"p1", "-", "p0"}], ")"}], "2"], 
       RowBox[{"p0", 
        RowBox[{"(", 
         RowBox[{"1", "-", "p0"}], ")"}]}]]}]}], "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.667559315072357*^9, 3.667559347681745*^9}, {
   3.667559511941483*^9, 3.667559576439707*^9}, {3.667559649892623*^9, 
   3.667559650682069*^9}, {3.667559680879396*^9, 3.667559697808279*^9}, {
   3.667559729117639*^9, 3.667559732658802*^9}, 3.709946976417006*^9, {
   3.7099470262868433`*^9, 3.709947077019812*^9}},
 CellLabel->
  "In[280]:=",ExpressionUUID->"e7e106c9-ec3a-4e62-92d2-36e996de22b1"]
}, Closed]],

Cell[CellGroupData[{

Cell["dZ", "Subsubsection",
 CellChangeTimes->{{3.667559270702585*^9, 3.66755927604737*^9}, 
   3.6675593636718903`*^9},ExpressionUUID->"5e010a89-839c-4a46-8ff2-\
ff1d28a78118"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"dZ", "::", "usage"}], "=", 
   "\"\<dZ[{{p0,p1},\[Ellipsis]}] lists the squared difference in \
2arcsin[\!\(\*SqrtBox[\(p\)]\)], excluding cases where p0=0, 1\>\""}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6675592426481543`*^9, 3.6675593123559647`*^9}, {
   3.6675593664697113`*^9, 3.6675593944371147`*^9}, 3.667559613368208*^9, {
   3.709951174517462*^9, 3.70995117667633*^9}},
 CellLabel->
  "In[281]:=",ExpressionUUID->"415dd9bd-6394-495b-b420-928b90e1f912"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"dZ", "[", "p_List", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"pp", "=", 
       RowBox[{"Select", "[", 
        RowBox[{"p", ",", 
         RowBox[{
          RowBox[{"0", "<", 
           RowBox[{
           "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], "<", 
           "1"}], "&"}]}], "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
     SuperscriptBox[
      RowBox[{"(", 
       RowBox[{
        RowBox[{"arcsin", "[", 
         RowBox[{"pp", "\[LeftDoubleBracket]", 
          RowBox[{"All", ",", "2"}], "\[RightDoubleBracket]"}], "]"}], "-", 
        RowBox[{"arcsin", "[", 
         RowBox[{"pp", "\[LeftDoubleBracket]", 
          RowBox[{"All", ",", "1"}], "\[RightDoubleBracket]"}], "]"}]}], 
       ")"}], "2"]}], "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.667559315072357*^9, 3.667559367429817*^9}, {
   3.667559401220512*^9, 3.667559417315193*^9}, {3.6675595919398327`*^9, 
   3.6675596058225193`*^9}, {3.6675596558014593`*^9, 3.6675596567449303`*^9}, 
   3.667559705843092*^9, {3.709951183129464*^9, 3.709951207395125*^9}},
 CellLabel->
  "In[282]:=",ExpressionUUID->"b7e9f5a2-41ed-4133-9ded-e8d72d6f7d31"]
}, Closed]]
}, Closed]],

Cell[CellGroupData[{

Cell["From \[OpenCurlyDoubleQuote]Infinitesimal\[CloseCurlyDoubleQuote]", \
"Subsection",
 CellChangeTimes->{{3.638941235140327*^9, 3.638941236763674*^9}, {
  3.643256925647977*^9, 3.6432569295595303`*^9}, {3.643259677701421*^9, 
  3.6432596838046217`*^9}, {3.6674581161121283`*^9, 
  3.667458120325829*^9}},ExpressionUUID->"e74ae715-11c5-4600-998c-\
988f13e6afdf"],

Cell[CellGroupData[{

Cell["arcsin", "Subsubsection",
 CellChangeTimes->{3.667479921214745*^9, 
  3.66748003967824*^9},ExpressionUUID->"423c3388-63aa-41ca-ba3b-f03febc43ee8"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"arcsin", "::", "usage"}], "=", 
   "\"\<arcsin[p]=2ArcSin[\!\(\*SqrtBox[\(p\)]\)], which ranges from 0 to \
\[Pi]\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.667479915704187*^9, 3.6674799789485283`*^9}, {
  3.667480016931493*^9, 3.667480043841551*^9}},
 CellLabel->
  "In[283]:=",ExpressionUUID->"58fb73a7-8697-4b63-9987-758e06938a33"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"arcsin", "[", "p_", "]"}], ":=", 
   RowBox[{"2", 
    RowBox[{"ArcSin", "[", 
     SqrtBox["p"], "]"}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Attributes", "[", "arcsin", "]"}], "=", 
   RowBox[{"{", "Listable", "}"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.667480029386204*^9, 3.6674800932279263`*^9}},
 CellLabel->
  "In[284]:=",ExpressionUUID->"82794268-8926-4f08-ab5f-7885c7dcf304"]
}, Closed]],

Cell[CellGroupData[{

Cell["makePop", "Subsubsection",
 CellChangeTimes->{
  3.638941409393363*^9},ExpressionUUID->"a862e6f5-151d-412c-aba6-\
90bbae6d8c2b"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"makePop", "::", "usage"}], "=", 
   "\"\<makePop[p,N] sets up N haploid genomes with allele frequencies \
{\!\(\*SubscriptBox[\(p\), \(1\)]\),\[Ellipsis]}.\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.638941249077549*^9, 3.638941282631716*^9}, 
   3.6389414270581007`*^9, 3.638943158871771*^9},
 CellLabel->
  "In[286]:=",ExpressionUUID->"0025bf22-4b7e-4445-a66e-8925cdd2f190"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"makePop", "[", 
    RowBox[{"p_List", ",", "n_"}], "]"}], ":=", 
   RowBox[{"Transpose", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"RandomInteger", "[", 
       RowBox[{
        RowBox[{"BernoulliDistribution", "[", "#", "]"}], ",", "n"}], "]"}], 
      "&"}], "/@", "p"}], "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.638941284677524*^9, 3.6389413079941053`*^9}, {
  3.63894138965781*^9, 3.638941394552223*^9}},
 CellLabel->
  "In[287]:=",ExpressionUUID->"1936bb67-765f-44ec-95e9-f156f0bb69c0"]
}, Closed]],

Cell[CellGroupData[{

Cell["makePopExact", "Subsubsection",
 CellChangeTimes->{
  3.638941409393363*^9, {3.692070744702586*^9, 
   3.6920707455734577`*^9}},ExpressionUUID->"6e7288da-5241-4d7b-8f08-\
dc89d77d4591"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"makePopExact", "::", "usage"}], "=", 
   "\"\<makePopExact[j,N,n] sets up N haploid genomes with exactly j copies \
at each locus, and n loci. makePopExact[{\!\(\*SubscriptBox[\(j\), \(1\)]\),\
\[Ellipsis]},N] specifies each locus separately.\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.638941249077549*^9, 3.638941282631716*^9}, 
   3.6389414270581007`*^9, 3.638943158871771*^9, {3.692070750073547*^9, 
   3.6920707519226*^9}, {3.692070787901845*^9, 3.692070884403409*^9}},
 CellLabel->
  "In[288]:=",ExpressionUUID->"b35ce805-388d-4129-ab8e-b2e81e5b54b8"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"makePopExact", "::", "badJ"}], "=", 
   "\"\<The number of 1 alleles, `1` is incompatible with the number of \
individuals, `2`\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6920710025418587`*^9, 3.692071006659362*^9}, {
  3.692071051326733*^9, 3.692071100520179*^9}, {3.692071212022192*^9, 
  3.6920712153330708`*^9}},
 CellLabel->
  "In[289]:=",ExpressionUUID->"f4f980d9-cb2b-42e4-9284-15ef15f21c96"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"makePopExact", "[", 
    RowBox[{"j_Integer", ",", "ninds_Integer", ",", "nloci_Integer"}], "]"}], 
   ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "c", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"0", "\[LessEqual]", "j", "\[LessEqual]", "ninds"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"c", "=", 
         RowBox[{"Join", "[", 
          RowBox[{
           RowBox[{"ConstantArray", "[", 
            RowBox[{"0", ",", 
             RowBox[{"ninds", "-", "j"}]}], "]"}], ",", 
           RowBox[{"ConstantArray", "[", 
            RowBox[{"1", ",", "j"}], "]"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Transpose", "[", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"RandomSample", "[", "c", "]"}], ",", 
           RowBox[{"{", "nloci", "}"}]}], "]"}], "]"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{
          RowBox[{"makePopExact", "::", "badJ"}], ",", "j", ",", "ninds"}], 
         "]"}], ";", 
        RowBox[{"makePopExact", "[", 
         RowBox[{
          RowBox[{"Max", "[", 
           RowBox[{"0", ",", 
            RowBox[{"Min", "[", 
             RowBox[{"ninds", ",", "j"}], "]"}]}], "]"}], ",", "ninds", ",", 
          "nloci"}], "]"}]}]}], "]"}]}], "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.638941284677524*^9, 3.6389413079941053`*^9}, {
  3.63894138965781*^9, 3.638941394552223*^9}, {3.692070817583845*^9, 
  3.6920708224126797`*^9}, {3.6920708897951193`*^9, 3.692070981153569*^9}, {
  3.692071111105536*^9, 3.692071203223074*^9}, {3.69207150331973*^9, 
  3.692071524173346*^9}},
 CellLabel->
  "In[290]:=",ExpressionUUID->"fbd6e01c-f5ae-4ea5-86b3-bc5a4b199fbf"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"makePopExact", "[", 
    RowBox[{
     RowBox[{"j", ":", 
      RowBox[{"{", "___Integer", "}"}]}], ",", "ninds_Integer"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "c", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"c", "[", "i_", "]"}], ":=", 
       RowBox[{
        RowBox[{"c", "[", "i", "]"}], "=", 
        RowBox[{"Join", "[", 
         RowBox[{
          RowBox[{"ConstantArray", "[", 
           RowBox[{"0", ",", 
            RowBox[{"ninds", "-", "i"}]}], "]"}], ",", 
          RowBox[{"ConstantArray", "[", 
           RowBox[{"1", ",", "i"}], "]"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"0", "\[LessEqual]", 
          RowBox[{"Min", "[", "j", "]"}]}], "\[And]", 
         RowBox[{
          RowBox[{"Max", "[", "j", "]"}], "\[LessEqual]", "ninds"}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"Transpose", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"RandomSample", "[", 
            RowBox[{"c", "[", "#", "]"}], "]"}], "&"}], "/@", "j"}], "]"}], 
        ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Message", "[", 
          RowBox[{
           RowBox[{"makePopExact", "::", "badJ"}], ",", "j", ",", "ninds"}], 
          "]"}], ";", 
         RowBox[{"makePopExact", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Max", "[", 
              RowBox[{"0", ",", 
               RowBox[{"Min", "[", 
                RowBox[{"ninds", ",", "#"}], "]"}]}], "]"}], "&"}], "/@", 
            "j"}], ",", "ninds"}], "]"}]}]}], "]"}]}]}], "]"}]}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.638941284677524*^9, 3.6389413079941053`*^9}, {
  3.63894138965781*^9, 3.638941394552223*^9}, {3.692070817583845*^9, 
  3.6920708224126797`*^9}, {3.6920708897951193`*^9, 3.692070981153569*^9}, {
  3.692071111105536*^9, 3.692071203223074*^9}, {3.69207150331973*^9, 
  3.692071524173346*^9}, {3.692071595596642*^9, 3.692071630673484*^9}, {
  3.692071660875471*^9, 3.692071777417231*^9}, {3.692071863752315*^9, 
  3.6920718727973127`*^9}},
 CellLabel->
  "In[291]:=",ExpressionUUID->"c78ddc12-250c-4d7e-a79f-7188d53944b7"]
}, Closed]],

Cell[CellGroupData[{

Cell["makePopDiploid", "Subsubsection",
 CellChangeTimes->{
  3.638941409393363*^9, {3.6919821918362713`*^9, 
   3.6919821932190113`*^9}},ExpressionUUID->"e76fd7d2-aec2-4925-acd1-\
07d758b30812"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"makePopDiploid", "::", "usage"}], "=", 
   "\"\<makePopDiploid[p,N] sets up N diploid genomes with allele frequencies \
{\!\(\*SubscriptBox[\(p\), \(1\)]\),\[Ellipsis]}.\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.638941249077549*^9, 3.638941282631716*^9}, 
   3.6389414270581007`*^9, 3.638943158871771*^9, {3.691982196792062*^9, 
   3.691982201747744*^9}},
 CellLabel->
  "In[292]:=",ExpressionUUID->"f3611b63-0394-4b41-9e5f-744e8f2b2b24"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"makePopDiploid", "[", 
    RowBox[{"p_List", ",", "n_"}], "]"}], ":=", 
   RowBox[{"Transpose", "[", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"RandomInteger", "[", 
        RowBox[{
         RowBox[{"BernoulliDistribution", "[", "#", "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"n", ",", "2"}], "}"}]}], "]"}], "&"}], "/@", "p"}], ",", 
     RowBox[{"{", 
      RowBox[{"3", ",", "1", ",", "2"}], "}"}]}], "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.638941284677524*^9, 3.6389413079941053`*^9}, {
   3.63894138965781*^9, 3.638941394552223*^9}, 3.691982205882732*^9, {
   3.691982246206113*^9, 3.6919822537327137`*^9}, {3.6919823470315857`*^9, 
   3.691982347263558*^9}},
 CellLabel->
  "In[293]:=",ExpressionUUID->"6d618a21-ea0b-4d25-a1ea-ef15597c6078"]
}, Closed]],

Cell[CellGroupData[{

Cell["makePopDiploidExact", "Subsubsection",
 CellChangeTimes->{
  3.638941409393363*^9, {3.692070744702586*^9, 3.6920707455734577`*^9}, 
   3.692071543023326*^9},ExpressionUUID->"8a3f81cb-4473-402a-8b38-\
6540e42a8d5a"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"makePopDiploidExact", "::", "usage"}], "=", 
   "\"\<makePopDiploidExact[j,N,n] sets up N diploid genomes with exactly \
j/2N copies at each locus, and n loci. \
makePopDiploidExact[{\!\(\*SubscriptBox[\(j\), \(1\)]\),\[Ellipsis]},N] \
specifies each locus separately.\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.638941249077549*^9, 3.638941282631716*^9}, 
   3.6389414270581007`*^9, 3.638943158871771*^9, {3.692070750073547*^9, 
   3.6920707519226*^9}, {3.692070787901845*^9, 3.692070884403409*^9}, {
   3.6920715478694344`*^9, 3.692071553724469*^9}, 3.692071909252658*^9, {
   3.692071987975985*^9, 3.692071988904127*^9}},
 CellLabel->
  "In[294]:=",ExpressionUUID->"b9ea185c-a59b-4fd6-a375-919858c3f2ed"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"makePopDiploidExact", "[", 
    RowBox[{"j_Integer", ",", "ninds_Integer", ",", "nloci_Integer"}], "]"}], 
   ":=", "\[IndentingNewLine]", 
   RowBox[{"Partition", "[", 
    RowBox[{
     RowBox[{"makePopExact", "[", 
      RowBox[{"j", ",", 
       RowBox[{"2", "ninds"}], ",", "nloci"}], "]"}], ",", "2"}], "]"}]}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.638941284677524*^9, 3.6389413079941053`*^9}, {
  3.63894138965781*^9, 3.638941394552223*^9}, {3.692070817583845*^9, 
  3.6920708224126797`*^9}, {3.6920708897951193`*^9, 3.692070981153569*^9}, {
  3.692071111105536*^9, 3.692071203223074*^9}, {3.69207150331973*^9, 
  3.692071524173346*^9}, {3.69207191509266*^9, 3.6920719197562943`*^9}, {
  3.692071958265389*^9, 3.6920720143211937`*^9}, {3.692072073710038*^9, 
  3.692072086771288*^9}},
 CellLabel->
  "In[295]:=",ExpressionUUID->"af4d6ef1-ce34-45f4-9238-c3964d8f0f30"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"makePopDiploidExact", "[", 
    RowBox[{
     RowBox[{"j", ":", 
      RowBox[{"{", "__Integer", "}"}]}], ",", "ninds_Integer"}], "]"}], ":=", 
   
   RowBox[{"Partition", "[", 
    RowBox[{
     RowBox[{"makePopExact", "[", 
      RowBox[{"j", ",", 
       RowBox[{"2", "ninds"}]}], "]"}], ",", "2"}], "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.638941284677524*^9, 3.6389413079941053`*^9}, {
   3.63894138965781*^9, 3.638941394552223*^9}, {3.692070817583845*^9, 
   3.6920708224126797`*^9}, {3.6920708897951193`*^9, 3.692070981153569*^9}, {
   3.692071111105536*^9, 3.692071203223074*^9}, {3.69207150331973*^9, 
   3.692071524173346*^9}, {3.692071595596642*^9, 3.692071630673484*^9}, {
   3.692071660875471*^9, 3.692071777417231*^9}, {3.692071863752315*^9, 
   3.6920718727973127`*^9}, 3.692071930403998*^9, {3.69207209852747*^9, 
   3.692072102717248*^9}, 3.700654532895287*^9},
 CellLabel->
  "In[296]:=",ExpressionUUID->"e9aa32b1-cf1d-4fba-959a-46f8ea29f366"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"makePopDiploidExact", "[", 
    RowBox[{
     RowBox[{"{", "}"}], ",", "ninds_Integer"}], "]"}], ":=", 
   RowBox[{"ConstantArray", "[", 
    RowBox[{
     RowBox[{"{", "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"ninds", ",", "2"}], "}"}]}], "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.638941284677524*^9, 3.6389413079941053`*^9}, {
   3.63894138965781*^9, 3.638941394552223*^9}, {3.692070817583845*^9, 
   3.6920708224126797`*^9}, {3.6920708897951193`*^9, 3.692070981153569*^9}, {
   3.692071111105536*^9, 3.692071203223074*^9}, {3.69207150331973*^9, 
   3.692071524173346*^9}, {3.692071595596642*^9, 3.692071630673484*^9}, {
   3.692071660875471*^9, 3.692071777417231*^9}, {3.692071863752315*^9, 
   3.6920718727973127`*^9}, 3.692071930403998*^9, {3.69207209852747*^9, 
   3.692072102717248*^9}, {3.7006545374775953`*^9, 3.70065455720144*^9}},
 CellLabel->
  "In[297]:=",ExpressionUUID->"feb8fc66-81c8-4e5b-b964-f45a1681d785"]
}, Closed]],

Cell[CellGroupData[{

Cell["makeP", "Subsubsection",
 CellChangeTimes->{{3.638942994363886*^9, 
  3.6389429950920258`*^9}},ExpressionUUID->"70aa070b-c55a-47a9-8909-\
054f4cc4d49d"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"makeP", "::", "usage"}], "=", 
   "\"\<makeP[p,F,n] makes a list of allele frequencies drawn from a beta \
distribution with mean p and variance \
F\[VeryThinSpace]p\[VeryThinSpace]q\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.638942997629239*^9, 3.638943039734617*^9}},
 CellLabel->
  "In[298]:=",ExpressionUUID->"f1baebc0-a9de-44de-9772-38d0d85b9b35"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"makeP", "[", 
    RowBox[{"p_", ",", "f_", ",", "n_"}], "]"}], ":=", 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"f", "\[Equal]", "0"}], ",", 
     RowBox[{"ConstantArray", "[", 
      RowBox[{"p", ",", "n"}], "]"}], ",", 
     RowBox[{"RandomReal", "[", 
      RowBox[{
       RowBox[{"BetaDistribution", "[", 
        RowBox[{
         RowBox[{
          FractionBox[
           RowBox[{"(", 
            RowBox[{"1", "-", "f"}], ")"}], "f"], " ", "p"}], ",", 
         RowBox[{
          FractionBox[
           RowBox[{"(", 
            RowBox[{"1", "-", "f"}], ")"}], "f"], " ", 
          RowBox[{"(", 
           RowBox[{"1", "-", "p"}], ")"}]}]}], "]"}], ",", "n"}], "]"}]}], 
    "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.638943044240384*^9, 3.638943090371117*^9}},
 CellLabel->
  "In[299]:=",ExpressionUUID->"e9aadbd6-6b8e-495d-b85c-f7e85fdfed22"]
}, Closed]],

Cell[CellGroupData[{

Cell["iter", "Subsubsection",
 CellChangeTimes->{{3.638971780522936*^9, 
  3.638971781147172*^9}},ExpressionUUID->"7be8227e-2816-414b-8520-\
f86a815c3a19"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"iter", "::", "usage"}], "=", 
   "\"\<iter[pop,w,\[Mu]] iterates a population of haploid individuals \
through one generation of selection, followed by mutation. There are n \
biallelic unlinked loci. pop is N\[Times]n, and w is a list of N fitnesses.\>\
\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.638971783647765*^9, 3.6389718768743057`*^9}},
 CellLabel->
  "In[300]:=",ExpressionUUID->"1bf003ac-5d31-48e1-8031-85a222d7c81e"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"iter", "[", 
    RowBox[{"pop_List", ",", "w_List", ",", "\[Mu]_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"pars", ",", "mask", ",", "np", ",", "mutn", ",", 
       RowBox[{"dp", "=", 
        RowBox[{"Dimensions", "[", "pop", "]"}]}]}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"mask", "=", 
       RowBox[{"RandomInteger", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"0", ",", "1"}], "}"}], ",", "dp"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pars", "=", 
       RowBox[{"RandomChoice", "[", 
        RowBox[{
         RowBox[{"w", "\[Rule]", "pop"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{
           "dp", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], ",", 
           "2"}], "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"np", "=", 
       RowBox[{"MapThread", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{
            "#1", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
            "#2"}], "+", 
           RowBox[{
            RowBox[{
            "#1", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
            RowBox[{"(", 
             RowBox[{"1", "-", "#2"}], ")"}]}]}], "&"}], ",", 
         RowBox[{"{", 
          RowBox[{"pars", ",", "mask"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"\[Mu]", "\[Equal]", "0"}], ",", "np", ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"mutn", "=", 
          RowBox[{"RandomInteger", "[", 
           RowBox[{
            RowBox[{"BernoulliDistribution", "[", "\[Mu]", "]"}], ",", "dp"}],
            "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"np", 
           RowBox[{"(", 
            RowBox[{"1", "-", "mutn"}], ")"}]}], "+", 
          RowBox[{"mutn", 
           RowBox[{"(", 
            RowBox[{"1", "-", "np"}], ")"}]}]}]}]}], "]"}]}]}], "]"}]}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.638971881111354*^9, 3.638972116441733*^9}},
 CellLabel->
  "In[301]:=",ExpressionUUID->"92c606d4-abea-4952-9181-01193dfd4ae6"]
}, Closed]],

Cell[CellGroupData[{

Cell["z", "Subsubsection",
 CellChangeTimes->{{3.638973930463475*^9, 
  3.638973935303853*^9}},ExpressionUUID->"5dbb1edc-2523-4b16-834a-\
564c9f3ed5b6"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"z", "::", "usage"}], "=", 
   "\"\<z[\[Alpha]][X] gives the trait value as \[Alpha].(X-1/2).  \
z[\[Alpha],\!\(\*SubsuperscriptBox[\(\[Sigma]\), \(E\), \(2\)]\)][X} allows \
for an additional random environmental noise. \>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.638973937653449*^9, 3.6389740985563803`*^9}, {
  3.643709456545467*^9, 3.643709470130924*^9}, {3.643885434934082*^9, 
  3.643885447955716*^9}, {3.667466589602983*^9, 3.667466611902318*^9}},
 CellLabel->
  "In[302]:=",ExpressionUUID->"6ab0ce66-f404-44b6-bdb6-2f58549c700b"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"z", "[", "\[Alpha]_List", "]"}], "[", "X_List", "]"}], ":=", 
  RowBox[{
   RowBox[{"(", 
    RowBox[{"X", "-", 
     RowBox[{"1", "/", "2"}]}], ")"}], ".", 
   "\[Alpha]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"z", "[", 
     RowBox[{"\[Alpha]_List", ",", "ve_"}], "]"}], "[", "X_List", "]"}], ":=", 
   RowBox[{
    RowBox[{
     RowBox[{"z", "[", "\[Alpha]", "]"}], "[", "X", "]"}], "+", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{"ve", "\[Equal]", "0"}], ",", "0", ",", 
      RowBox[{"RandomReal", "[", 
       RowBox[{"NormalDistribution", "[", 
        RowBox[{"0", ",", 
         SqrtBox["ve"]}], "]"}], "]"}]}], "]"}]}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6389746883253517`*^9, 3.6389747272990828`*^9}, {
  3.638974817552253*^9, 3.638974819769472*^9}, {3.6389748741740417`*^9, 
  3.6389748843978767`*^9}, {3.643709478320359*^9, 3.643709510306493*^9}, {
  3.66746661617428*^9, 3.667466650587468*^9}, {3.699670845037883*^9, 
  3.699670851259076*^9}},
 CellLabel->
  "In[303]:=",ExpressionUUID->"0f95182e-433d-4525-9150-a59e077ea3c7"]
}, Closed]],

Cell[CellGroupData[{

Cell["zDip", "Subsubsection",
 CellChangeTimes->{{3.638973930463475*^9, 3.638973935303853*^9}, {
  3.692017096831121*^9, 
  3.69201709763673*^9}},ExpressionUUID->"c0bd9bf3-d6fd-4893-859d-\
d9ada2809f5d"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"zDip", "::", "usage"}], "=", 
   "\"\<zDip[\[Alpha]][{X,Y}] gives the trait value as \[Alpha].(X+Y-1).  \
zDip[\[Alpha],\!\(\*SubsuperscriptBox[\(\[Sigma]\), \(E\), \(2\)]\)][{X,Y}} \
allows for an additional random environmental noise. \>\""}], ";"}]], "Input",\

 InitializationCell->True,
 CellChangeTimes->{{3.638973937653449*^9, 3.6389740985563803`*^9}, {
  3.643709456545467*^9, 3.643709470130924*^9}, {3.643885434934082*^9, 
  3.643885447955716*^9}, {3.667466589602983*^9, 3.667466611902318*^9}, {
  3.692017101581246*^9, 3.692017132249588*^9}},
 CellLabel->
  "In[305]:=",ExpressionUUID->"27be2adf-0a43-4851-8fcb-faa4f0470205"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"zDip", "[", "\[Alpha]_List", "]"}], "[", 
   RowBox[{"{", 
    RowBox[{"X_List", ",", "Y_List"}], "}"}], "]"}], ":=", 
  RowBox[{
   RowBox[{"(", 
    RowBox[{"X", "+", "Y", "-", "1"}], ")"}], ".", 
   "\[Alpha]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"zDip", "[", 
     RowBox[{"\[Alpha]_List", ",", "ve_"}], "]"}], "[", 
    RowBox[{"{", 
     RowBox[{"X_List", ",", "Y_List"}], "}"}], "]"}], ":=", 
   RowBox[{
    RowBox[{
     RowBox[{"zDip", "[", "\[Alpha]", "]"}], "[", 
     RowBox[{"{", 
      RowBox[{"X", ",", "Y"}], "}"}], "]"}], "+", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{"ve", "\[Equal]", "0"}], ",", "0", ",", 
      RowBox[{"RandomReal", "[", 
       RowBox[{"NormalDistribution", "[", 
        RowBox[{"0", ",", 
         SqrtBox["ve"]}], "]"}], "]"}]}], "]"}]}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6389746883253517`*^9, 3.6389747272990828`*^9}, {
  3.638974817552253*^9, 3.638974819769472*^9}, {3.6389748741740417`*^9, 
  3.6389748843978767`*^9}, {3.643709478320359*^9, 3.643709510306493*^9}, {
  3.66746661617428*^9, 3.667466650587468*^9}, {3.692017133959612*^9, 
  3.692017164588318*^9}, {3.6996708675888147`*^9, 3.699670880234598*^9}},
 CellLabel->
  "In[306]:=",ExpressionUUID->"cf849edb-c77f-48f2-82f3-bd94b39d85ef"]
}, Closed]],

Cell[CellGroupData[{

Cell["meanZ", "Subsubsection",
 CellChangeTimes->{{3.667465850841651*^9, 3.6674658513761272`*^9}, {
  3.667465924196794*^9, 
  3.667465925850799*^9}},ExpressionUUID->"f0dcceb2-acb1-4f97-9e36-\
cec439e33f87"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"meanZ", "::", "usage"}], "=", 
   "\"\<meanZ[\[Alpha]][{{0,1,\[Ellipsis]},\[Ellipsis]}] gives the mean \
z\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.667465855969808*^9, 3.667465880446355*^9}, {
  3.667465928600566*^9, 3.667465929791729*^9}},
 CellLabel->
  "In[308]:=",ExpressionUUID->"5ff64f17-b7b0-497b-8cd1-9d2d48ad0e12"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"meanZ", "[", "\[Alpha]_List", "]"}], "[", "pop_List", "]"}], ":=", 
   RowBox[{"Mean", "[", 
    RowBox[{
     RowBox[{"z", "[", "\[Alpha]", "]"}], "/@", "pop"}], "]"}]}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.667465883394719*^9, 3.667465930943581*^9}},
 CellLabel->
  "In[309]:=",ExpressionUUID->"5b628e63-3b61-4680-8918-9311a8b9fcee"]
}, Closed]],

Cell[CellGroupData[{

Cell["varZ", "Subsubsection",
 CellChangeTimes->{{3.667465850841651*^9, 3.6674658513761272`*^9}, {
  3.667465924196794*^9, 
  3.667465948273056*^9}},ExpressionUUID->"b7c75e27-194b-4e65-be4e-\
ea93d71ea3c0"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"varZ", "::", "usage"}], "=", 
   "\"\<varZ[\[Alpha]][{{0,1,\[Ellipsis]},\[Ellipsis]}] gives the variance of \
z, not including Ve\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.667465855969808*^9, 3.667465880446355*^9}, {
  3.667465928600566*^9, 3.66746595621664*^9}, {3.692016240226976*^9, 
  3.6920162461214314`*^9}},
 CellLabel->
  "In[310]:=",ExpressionUUID->"ca423c9c-bc21-4d39-99a7-4602b4bfad85"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"varZ", "[", "\[Alpha]_List", "]"}], "[", "pop_List", "]"}], ":=", 
   RowBox[{"Variance", "[", 
    RowBox[{
     RowBox[{"z", "[", "\[Alpha]", "]"}], "/@", "pop"}], "]"}]}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.667465883394719*^9, 3.667465961328231*^9}},
 CellLabel->
  "In[311]:=",ExpressionUUID->"b38be96d-b2e8-4286-a8fc-a71339ec9343"]
}, Closed]],

Cell[CellGroupData[{

Cell["varZLE", "Subsubsection",
 CellChangeTimes->{{3.667465850841651*^9, 3.6674658513761272`*^9}, {
  3.667465924196794*^9, 3.667465925850799*^9}, {3.66746596528931*^9, 
  3.66746597229539*^9}},ExpressionUUID->"0597a735-ee84-484d-ac1a-\
c8ddd3836a35"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"varZLE", "::", "usage"}], "=", 
   "\"\<varZLE[\[Alpha]][{{0,1,\[Ellipsis]},\[Ellipsis]}] gives the variance \
of z at LE,  \[Sum]\!\(\*SuperscriptBox[\(\[Alpha]\), \(2\)]\)p\
\[VeryThinSpace]q\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.667465855969808*^9, 3.667465880446355*^9}, {
  3.667465928600566*^9, 3.667465929791729*^9}, {3.667465977555702*^9, 
  3.667466000365464*^9}},
 CellLabel->
  "In[312]:=",ExpressionUUID->"f0c2adaa-22a8-48fc-b816-41e101189930"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"varZLE", "[", "\[Alpha]_List", "]"}], "[", "pop_List", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"p", "=", 
       RowBox[{"Mean", "[", "pop", "]"}]}], "}"}], ",", 
     RowBox[{
      SuperscriptBox["\[Alpha]", "2"], ".", 
      RowBox[{"(", 
       RowBox[{"p", 
        RowBox[{"(", 
         RowBox[{"1", "-", "p"}], ")"}]}], ")"}]}]}], "]"}]}], ";"}]], "Input",\

 InitializationCell->True,
 CellChangeTimes->{{3.667465883394719*^9, 3.667465930943581*^9}, {
  3.667466004298436*^9, 3.667466034450615*^9}},
 CellLabel->
  "In[313]:=",ExpressionUUID->"e5094dc6-3432-4190-9cfa-8dda80733bb4"]
}, Closed]],

Cell[CellGroupData[{

Cell["meanZDip", "Subsubsection",
 CellChangeTimes->{{3.667465850841651*^9, 3.6674658513761272`*^9}, {
  3.667465924196794*^9, 3.667465925850799*^9}, {3.6920209264964943`*^9, 
  3.692020929582178*^9}},ExpressionUUID->"1f6ff4e6-5c21-4db9-9768-\
0ffb5bb8ddf0"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"meanZDip", "::", "usage"}], "=", 
   "\"\<meanZDip[\[Alpha]][{{{0,1,\[Ellipsis]},\[Ellipsis]},\[Ellipsis]}] \
gives the mean z\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.667465855969808*^9, 3.667465880446355*^9}, {
  3.667465928600566*^9, 3.667465929791729*^9}, {3.692020941563938*^9, 
  3.692020950974642*^9}},
 CellLabel->
  "In[314]:=",ExpressionUUID->"b0bbbb63-834a-4dac-b76e-beba63d0e628"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"meanZDip", "[", "\[Alpha]_List", "]"}], "[", "pop_List", "]"}], ":=", 
   RowBox[{"Mean", "[", 
    RowBox[{
     RowBox[{"zDip", "[", "\[Alpha]", "]"}], "/@", "pop"}], "]"}]}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.667465883394719*^9, 3.667465930943581*^9}, {
  3.69202095654405*^9, 3.692020960534277*^9}},
 CellLabel->
  "In[315]:=",ExpressionUUID->"92bb77fc-d0fc-4cc3-b692-4b880405f1fb"]
}, Closed]],

Cell[CellGroupData[{

Cell["varZDip", "Subsubsection",
 CellChangeTimes->{{3.667465850841651*^9, 3.6674658513761272`*^9}, {
   3.667465924196794*^9, 3.667465948273056*^9}, 
   3.692020933000031*^9},ExpressionUUID->"5142824a-4a98-4c2d-a89f-\
9b3f6fb8b7a1"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"varZDip", "::", "usage"}], "=", 
   "\"\<varZDip[\[Alpha]][{{{0,1,\[Ellipsis]},\[Ellipsis]},\[Ellipsis]}] \
gives the variance of z, not including Ve\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.667465855969808*^9, 3.667465880446355*^9}, {
  3.667465928600566*^9, 3.66746595621664*^9}, {3.692016240226976*^9, 
  3.6920162461214314`*^9}, {3.6920209724943657`*^9, 3.692020981176827*^9}},
 CellLabel->
  "In[316]:=",ExpressionUUID->"18063771-675e-479e-9b83-0c9dce88ac39"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"varZDip", "[", "\[Alpha]_List", "]"}], "[", "pop_List", "]"}], ":=", 
   RowBox[{"Variance", "[", 
    RowBox[{
     RowBox[{"zDip", "[", "\[Alpha]", "]"}], "/@", "pop"}], "]"}]}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.667465883394719*^9, 3.667465961328231*^9}, {
  3.692020992880657*^9, 3.6920209987095327`*^9}},
 CellLabel->
  "In[317]:=",ExpressionUUID->"56e21eb3-59be-4281-8f16-ccdad8b4ba0f"]
}, Closed]],

Cell[CellGroupData[{

Cell["varZLEDip", "Subsubsection",
 CellChangeTimes->{{3.667465850841651*^9, 3.6674658513761272`*^9}, {
   3.667465924196794*^9, 3.667465925850799*^9}, {3.66746596528931*^9, 
   3.66746597229539*^9}, 
   3.6920209345284843`*^9},ExpressionUUID->"7cf32b6d-4567-4c8f-b462-\
64816521eed8"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"varZLEDip", "::", "usage"}], "=", 
   "\"\<varZLEDip[\[Alpha]][{{{0,1,\[Ellipsis]},\[Ellipsis]},\[Ellipsis]}] \
gives the variance of z at LE,  \[Sum]2\!\(\*SuperscriptBox[\(\[Alpha]\), \(2\
\)]\)p\[VeryThinSpace]q\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.667465855969808*^9, 3.667465880446355*^9}, {
  3.667465928600566*^9, 3.667465929791729*^9}, {3.667465977555702*^9, 
  3.667466000365464*^9}, {3.692021009902337*^9, 3.692021020606588*^9}},
 CellLabel->
  "In[318]:=",ExpressionUUID->"f79f5026-3257-4718-9dbe-d93763fe356e"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"varZLEDip", "[", "\[Alpha]_List", "]"}], "[", "pop_List", "]"}], 
   ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"p", "=", 
       RowBox[{"Mean", "[", 
        RowBox[{"Flatten", "[", 
         RowBox[{"pop", ",", "1"}], "]"}], "]"}]}], "}"}], ",", 
     RowBox[{"2", 
      RowBox[{
       SuperscriptBox["\[Alpha]", "2"], ".", 
       RowBox[{"(", 
        RowBox[{"p", 
         RowBox[{"(", 
          RowBox[{"1", "-", "p"}], ")"}]}], ")"}]}]}]}], "]"}]}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.667465883394719*^9, 3.667465930943581*^9}, {
  3.667466004298436*^9, 3.667466034450615*^9}, {3.692021024406672*^9, 
  3.692021036055768*^9}, {3.692021093822322*^9, 3.692021112750133*^9}},
 CellLabel->
  "In[319]:=",ExpressionUUID->"4770ba2b-346c-40c4-bf4e-36ce2bef9611"]
}, Closed]],

Cell[CellGroupData[{

Cell["W", "Subsubsection",
 CellChangeTimes->{
  3.643266975762858*^9},ExpressionUUID->"10d10d21-6f7e-4e94-b4d1-\
a1024b397504"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"W", "::", "usage"}], "=", 
   "\"\<W[\[Beta],\[Alpha]][X] gives directional selection Exp[\[Beta]\
\[VeryThinSpace]z] on an additive trait z=X.\[Alpha].  W[\[Beta],\[Alpha],\
\[Gamma]][X] gives directional selection Exp[\[Beta]\[VeryThinSpace]z] on an \
epistatic trait z=X.\[Alpha]+X.\[Gamma].X. \>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.643266978567301*^9, 3.643267137974822*^9}},
 CellLabel->
  "In[320]:=",ExpressionUUID->"90f21dc4-1ab0-4458-80f1-005f0e8f77a9"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"W", "[", 
     RowBox[{"\[Beta]_", ",", "\[Alpha]_"}], "]"}], "[", "X_", "]"}], ":=", 
   RowBox[{"Exp", "[", 
    RowBox[{"\[Beta]", " ", 
     RowBox[{
      RowBox[{"z", "[", "\[Alpha]", "]"}], "[", "X", "]"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"W", "[", 
     RowBox[{"\[Beta]_", ",", "\[Alpha]_", ",", "\[Gamma]_"}], "]"}], "[", 
    "X_", "]"}], ":=", 
   RowBox[{"Exp", "[", 
    RowBox[{"\[Beta]", " ", 
     RowBox[{
      RowBox[{"z", "[", 
       RowBox[{"\[Alpha]", ",", "\[Gamma]"}], "]"}], "[", "X", "]"}]}], 
    "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6432604796638193`*^9, 3.6432605198214283`*^9}, {
  3.6432670961324673`*^9, 3.643267102654636*^9}},
 CellLabel->
  "In[321]:=",ExpressionUUID->"362fbf8a-ae2a-4f6c-96a3-70f3776db8b1"]
}, Closed]],

Cell[CellGroupData[{

Cell["est2Ne", "Subsubsection",
 CellChangeTimes->{3.667477099031251*^9, 
  3.667477221345262*^9},ExpressionUUID->"4fb3eab0-c291-4607-aa8b-\
2a461a0c8335"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"est2Ne", "::", "usage"}], "=", 
   "\"\<est2Ne[{\!\(\*SubscriptBox[\(p\), \(1\)]\),\!\(\*SubscriptBox[\(p\), \
\(2\)]\)},\[Epsilon]] estimates 2\!\(\*SubscriptBox[\(N\), \(e\)]\) based on \
two successive generations.  \!\(\*SuperscriptBox[\(\[CapitalDelta]p\), \
\(2\)]\) is regressed on pq, and the gradient is \
1/(2\!\(\*SubscriptBox[\(N\), \(e\)]\)). Loci are gathered into bins of pq, \
width \[Epsilon]\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.667476898766851*^9, 3.667476931920138*^9}, {
  3.667476994428985*^9, 3.6674770387278843`*^9}, {3.66747707448672*^9, 
  3.6674770918915577`*^9}, {3.667477223201551*^9, 3.66747722745757*^9}},
 CellLabel->
  "In[323]:=",ExpressionUUID->"e03f3667-215e-41cf-87cc-b2e407baf010"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"est2Ne", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"p0_List", ",", "p1_List"}], "}"}], ",", "\[Epsilon]_"}], "]"}],
    ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"pqdp2", ",", "g", ",", "ft", ",", "pq"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"pqdp2", "=", 
       RowBox[{"Transpose", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"p0", 
           RowBox[{"(", 
            RowBox[{"1", "-", "p0"}], ")"}]}], ",", 
          SuperscriptBox[
           RowBox[{"(", 
            RowBox[{"p1", "-", "p0"}], ")"}], "2"]}], "}"}], "]"}]}], ";", 
      "\n", 
      RowBox[{"g", "=", 
       RowBox[{"GatherBy", "[", 
        RowBox[{"pqdp2", ",", 
         RowBox[{
          RowBox[{"Round", "[", 
           FractionBox[
            RowBox[{
            "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
            "\[Epsilon]"], "]"}], "&"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"ft", "=", 
       RowBox[{"Fit", "[", 
        RowBox[{
         RowBox[{"Sort", "[", 
          RowBox[{"Mean", "/@", "g"}], "]"}], ",", 
         RowBox[{"{", "pq", "}"}], ",", "pq"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"1", "/", 
       RowBox[{"D", "[", 
        RowBox[{"ft", ",", "pq"}], "]"}]}]}]}], "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.667477100333941*^9, 3.667477270712061*^9}},
 CellLabel->
  "In[324]:=",ExpressionUUID->"3511c9e4-9262-4169-8415-f90b62f0b857"]
}, Closed]]
}, Closed]],

Cell[CellGroupData[{

Cell["Definitions from \
\[OpenCurlyDoubleQuote]Ancestry\[CloseCurlyDoubleQuote]", "Subsection",
 CellChangeTimes->{{3.638941235140327*^9, 3.638941236763674*^9}, {
   3.643256925647977*^9, 3.6432569295595303`*^9}, 3.643256978131342*^9, {
   3.643259692763824*^9, 
   3.64325969544328*^9}},ExpressionUUID->"0bd9dff6-3de8-4a11-9a6c-\
1befebd69bde"],

Cell[TextData[{
 "This is copied over from the Ancestry paper. ",
 "Some of these definitions are loaded from the multilocus packages, but have \
now been replaced by ",
 StyleBox["Mathematica",
  FontSlant->"Italic"],
 "\[CloseCurlyQuote]s built in functions."
}], "Text",
 CellChangeTimes->{{3.6432569811575527`*^9, 3.643256990455716*^9}, {
   3.64325715380532*^9, 3.6432571540364437`*^9}, 
   3.643257200738036*^9},ExpressionUUID->"561f0436-3938-4f58-9adb-\
9b77f11c1c5f"],

Cell[CellGroupData[{

Cell["Notes April 2017", "Subsubsection",
 CellChangeTimes->{{3.700705179031352*^9, 
  3.7007051824875927`*^9}},ExpressionUUID->"71c2379c-429d-4118-b751-\
bc2328b24a0b"],

Cell["\<\
I have added infinite-sites mutation in a rather clumsy way. Eventually, it \
would be best to:
\t- Combine the discrete locus tracking with tracking mutations (i.e., pop \
and mutations). At they moment, they differ in that the discrete loci in pop \
are regularly spaced, whereas the mutations occur at random sites.  They do \
need to be combined to allow mutations to affect traits.
\t- I have two versions of iterateDiploidNew - one with truncation selection \
within families, the other neutral. One would like a variety of selection \
options for a single function definition.\
\>", "Text",
 CellChangeTimes->{{3.700705190328733*^9, 3.700705297558551*^9}, {
  3.700705566300208*^9, 
  3.70070562231559*^9}},ExpressionUUID->"05872cb2-2887-4cca-a89d-\
5a801020c469"]
}, Closed]],

Cell[CellGroupData[{

Cell["Set text style in graphics", "Subsubsection",ExpressionUUID->"da6f2180-8017-43f4-aaee-57ab0760e791"],

Cell[BoxData[
 RowBox[{
  RowBox[{"$TextStyle", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"FontFamily", "->", "\"\<Times\>\""}], ",", 
     RowBox[{"FontSize", "->", "16"}]}], "}"}]}], ";"}]], "Input",
 InitializationCell->True,
 FontSize->12,
 CellLabel->
  "In[325]:=",ExpressionUUID->"5a5f5cab-4770-4a99-bfc7-8f9314100e6b"]
}, Closed]],

Cell[CellGroupData[{

Cell["SparsePedigreeMatrix", "Subsubsection",
 InitializationCell->
  True,ExpressionUUID->"01f84648-b86a-40a3-b5c0-6b2b21e5c0d5"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"SparsePedigreeMatrix", "::", "usage"}], "=", 
   "\"\<SparsePedigreeMatrix[n] gives a random matrix.  \
SparsePedigreeMatrix[z,Va] allows for selection according to the \
infinitesimal model; returns {P,z} where z are the trait values amongst \
offspring; the z must be Real.  SparsePedigreeMatrix[p,w] takes a list of \
genotypes p (each {0,1,\[Ellipsis]}) and generates {P,p} according to the \
fitness function w[{0,0,1,\[Ellipsis]}]. \
SparsePedigreeMatrix[p,z,\!\(\*SuperscriptBox[\(N\), \(*\)]\)] generates \!\(\
\*SuperscriptBox[\(N\), \(*\)]\) haploid individuals at random, and then \
chooses the best N, according to z[{0,0,1,\[Ellipsis]}].  WARNING: z must \
return distinct values - assuming equal effects will cause problems. \
Including Ve in the function z will avoid this problem.  Note that P has \
either two entries of 1 per row, or one entry of 2.  Map->R assumes a linear \
map, length R.\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.643262627430993*^9, 3.6432626453801107`*^9}, {
   3.643297672986636*^9, 3.643297765942452*^9}, 3.643298002638741*^9, {
   3.6674624928412733`*^9, 3.667462559094553*^9}, {3.667463084391965*^9, 
   3.667463103405019*^9}, {3.66746526050453*^9, 3.667465285909399*^9}, {
   3.667469763785678*^9, 3.6674698152444983`*^9}, {3.6920157823806257`*^9, 
   3.6920158242825727`*^9}, {3.692015988773357*^9, 3.6920160118761377`*^9}},
 CellLabel->
  "In[326]:=",ExpressionUUID->"55e3ba3d-f3ba-4f77-a3f3-46416a56537c"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "SparsePedigreeMatrix", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{"Map", "\[Rule]", "\[Infinity]"}], "}"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.667470015181666*^9, 3.6674700264683104`*^9}, 
   3.667470057554564*^9},
 CellLabel->
  "In[327]:=",ExpressionUUID->"27a0e7a9-ac10-434d-833f-a4ac91d5b10f"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"SparsePedigreeMatrix", "[", "n_Integer", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"j", ",", "p1", ",", "p2", ",", "tt"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"tt", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"p1", "=", 
            RowBox[{"Random", "[", 
             RowBox[{"Integer", ",", 
              RowBox[{"{", 
               RowBox[{"1", ",", "n"}], "}"}]}], "]"}]}], ";", 
           RowBox[{"p2", "=", 
            RowBox[{"Random", "[", 
             RowBox[{"Integer", ",", 
              RowBox[{"{", 
               RowBox[{"1", ",", "n"}], "}"}]}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"p1", "\[Equal]", "p2"}], ",", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"j", ",", "p1"}], "}"}], "\[Rule]", "2"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"j", ",", "p1"}], "}"}], "\[Rule]", "1"}], ",", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"j", ",", "p2"}], "}"}], "->", "1"}]}], "}"}]}], 
            "]"}]}], ")"}], ",", 
         RowBox[{"{", 
          RowBox[{"j", ",", "n"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"SparseArray", "[", 
       RowBox[{
        RowBox[{"Flatten", "[", 
         RowBox[{"tt", ",", "1"}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"n", ",", "n"}], "}"}]}], "]"}]}]}], "]"}]}], ";"}]], "Input",\

 InitializationCell->True,
 CellLabel->
  "In[328]:=",ExpressionUUID->"d84173f7-6496-40ff-ac98-ffaed2f4070b"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"SparsePedigreeMatrix", "[", 
    RowBox[{
     RowBox[{"z", ":", 
      RowBox[{"{", "__Real", "}"}]}], ",", "v_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"n", "=", 
        RowBox[{"Length", "[", "z", "]"}]}], ",", "j", ",", "tt", ",", 
       RowBox[{"ww", "=", 
        RowBox[{"Exp", "[", "z", "]"}]}], ",", "pars", ",", 
       RowBox[{"sd", "=", 
        RowBox[{"Sqrt", "[", 
         FractionBox["v", "2"], "]"}]}]}], "}"}], ",", "\[IndentingNewLine]", 
     
     RowBox[{
      RowBox[{"pars", "=", 
       RowBox[{"RandomChoice", "[", 
        RowBox[{
         RowBox[{"ww", "\[Rule]", 
          RowBox[{"Range", "[", "n", "]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"n", ",", "2"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"tt", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"pars", "\[LeftDoubleBracket]", 
             RowBox[{"j", ",", "1"}], "\[RightDoubleBracket]"}], "\[Equal]", 
            RowBox[{"pars", "\[LeftDoubleBracket]", 
             RowBox[{"j", ",", "2"}], "\[RightDoubleBracket]"}]}], ",", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"j", ",", 
              RowBox[{"pars", "\[LeftDoubleBracket]", 
               RowBox[{"j", ",", "1"}], "\[RightDoubleBracket]"}]}], "}"}], 
            "\[Rule]", "2"}], ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              RowBox[{"{", 
               RowBox[{"j", ",", 
                RowBox[{"pars", "\[LeftDoubleBracket]", 
                 RowBox[{"j", ",", "1"}], "\[RightDoubleBracket]"}]}], "}"}], 
              "\[Rule]", "1"}], ",", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"j", ",", 
                RowBox[{"pars", "\[LeftDoubleBracket]", 
                 RowBox[{"j", ",", "2"}], "\[RightDoubleBracket]"}]}], "}"}], 
              "->", "1"}]}], "}"}]}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"j", ",", "n"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"SparseArray", "[", 
         RowBox[{
          RowBox[{"Flatten", "[", 
           RowBox[{"tt", ",", "1"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"n", ",", "n"}], "}"}]}], "]"}], ",", 
        RowBox[{
         RowBox[{"RandomReal", "[", 
          RowBox[{
           RowBox[{"NormalDistribution", "[", 
            RowBox[{"0", ",", " ", "sd"}], "]"}], ",", "n"}], "]"}], "+", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"Mean", "[", 
             RowBox[{
             "z", "\[LeftDoubleBracket]", "#", "\[RightDoubleBracket]"}], 
             "]"}], "&"}], "/@", "pars"}], ")"}]}]}], "}"}]}]}], "]"}]}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.643257227404862*^9, 3.6432572571933393`*^9}, {
  3.643257288663409*^9, 3.643257288886382*^9}, {3.6432573194167967`*^9, 
  3.643257331104529*^9}, {3.643257411936296*^9, 3.643257412622178*^9}},
 CellLabel->
  "In[329]:=",ExpressionUUID->"d5c831df-4666-4350-baf1-8d18e69d72ec"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"SparsePedigreeMatrix", "[", 
    RowBox[{
     RowBox[{"p", ":", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", "__Integer", "}"}], "..."}], "}"}]}], ",", "w_", ",", 
     "opts___Rule"}], "]"}], ":=", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"n", "=", 
        RowBox[{"Length", "[", "p", "]"}]}], ",", "j", ",", "tt", ",", "pars",
        ",", 
       RowBox[{"ww", "=", 
        RowBox[{"w", "/@", "p"}]}], ",", 
       RowBox[{"R", "=", 
        RowBox[{
         RowBox[{"Map", "/.", 
          RowBox[{"{", "opts", "}"}]}], "/.", 
         RowBox[{"Options", "[", "SparsePedigreeMatrix", "]"}]}]}]}], "}"}], 
     ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"pars", "=", 
       RowBox[{"RandomChoice", "[", 
        RowBox[{
         RowBox[{"ww", "\[Rule]", 
          RowBox[{"Range", "[", "n", "]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"n", ",", "2"}], "}"}]}], "]"}]}], ";", 
      RowBox[{"(*", " ", 
       RowBox[{
       "draw", " ", "pairs", " ", "of", " ", "haploid", " ", "parents", " ", 
        "according", " ", "to", " ", "their", " ", "fitness"}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"tt", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"pars", "\[LeftDoubleBracket]", 
             RowBox[{"j", ",", "1"}], "\[RightDoubleBracket]"}], "\[Equal]", 
            RowBox[{"pars", "\[LeftDoubleBracket]", 
             RowBox[{"j", ",", "2"}], "\[RightDoubleBracket]"}]}], ",", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"j", ",", 
              RowBox[{"pars", "\[LeftDoubleBracket]", 
               RowBox[{"j", ",", "1"}], "\[RightDoubleBracket]"}]}], "}"}], 
            "\[Rule]", "2"}], ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              RowBox[{"{", 
               RowBox[{"j", ",", 
                RowBox[{"pars", "\[LeftDoubleBracket]", 
                 RowBox[{"j", ",", "1"}], "\[RightDoubleBracket]"}]}], "}"}], 
              "\[Rule]", "1"}], ",", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"j", ",", 
                RowBox[{"pars", "\[LeftDoubleBracket]", 
                 RowBox[{"j", ",", "2"}], "\[RightDoubleBracket]"}]}], "}"}], 
              "->", "1"}]}], "}"}]}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"j", ",", "n"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"SparseArray", "[", 
         RowBox[{
          RowBox[{"Flatten", "[", 
           RowBox[{"tt", ",", "1"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"n", ",", "n"}], "}"}]}], "]"}], ",", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"Mendel", "[", "R", "]"}], "[", 
           RowBox[{
           "p", "\[LeftDoubleBracket]", "#", "\[RightDoubleBracket]"}], "]"}],
           "&"}], "/@", "pars"}]}], "}"}]}]}], "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.442760981087072*^9, 3.442760982475638*^9}, {
  3.643257421949876*^9, 3.6432574618297853`*^9}, {3.643262520460021*^9, 
  3.64326254302497*^9}, {3.6432979384164762`*^9, 3.643297949961801*^9}, {
  3.66747004041194*^9, 3.667470068881917*^9}},
 CellLabel->
  "In[330]:=",ExpressionUUID->"ad17fc9b-26ce-4474-b2b5-188064fb8883"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"SparsePedigreeMatrix", "[", 
    RowBox[{
     RowBox[{"p", ":", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", "__Integer", "}"}], "..."}], "}"}]}], ",", "z_", ",", 
     "nn_Integer", ",", "opts___Rule"}], "]"}], ":=", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"ninds", "=", 
        RowBox[{"Length", "[", "p", "]"}]}], ",", "j", ",", "tt", ",", "pars",
        ",", "np", ",", "zz", ",", "zt", ",", "sel", ",", 
       RowBox[{"R", "=", 
        RowBox[{
         RowBox[{"Map", "/.", 
          RowBox[{"{", "opts", "}"}]}], "/.", 
         RowBox[{"Options", "[", "SparsePedigreeMatrix", "]"}]}]}]}], "}"}], 
     ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"pars", "=", 
       RowBox[{"RandomInteger", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "ninds"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"nn", ",", "2"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
       "draw", " ", "nn", " ", "pairs", " ", "of", " ", "haploid", " ", 
        "parents", " ", "at", " ", "random"}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"np", "=", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"Mendel", "[", "R", "]"}], "[", 
          RowBox[{"p", "\[LeftDoubleBracket]", "#", "\[RightDoubleBracket]"}],
           "]"}], "&"}], "/@", "pars"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"zz", "=", 
       RowBox[{"z", "/@", "np"}]}], ";", 
      RowBox[{"zt", "=", 
       RowBox[{
        RowBox[{"Sort", "[", "zz", "]"}], "\[LeftDoubleBracket]", 
        RowBox[{"-", "ninds"}], "\[RightDoubleBracket]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"sel", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"#", "\[GreaterEqual]", "zt"}], ")"}], "&"}], "/@", 
        "zz"}]}], ";", 
      RowBox[{"(*", " ", 
       RowBox[{
       "lists", " ", "which", " ", "individuals", " ", "are", " ", "above", 
        " ", "threshold"}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"tt", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"pars", "\[LeftDoubleBracket]", 
             RowBox[{"j", ",", "1"}], "\[RightDoubleBracket]"}], "\[Equal]", 
            RowBox[{"pars", "\[LeftDoubleBracket]", 
             RowBox[{"j", ",", "2"}], "\[RightDoubleBracket]"}]}], ",", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"j", ",", 
              RowBox[{"pars", "\[LeftDoubleBracket]", 
               RowBox[{"j", ",", "1"}], "\[RightDoubleBracket]"}]}], "}"}], 
            "\[Rule]", "2"}], ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              RowBox[{"{", 
               RowBox[{"j", ",", 
                RowBox[{"pars", "\[LeftDoubleBracket]", 
                 RowBox[{"j", ",", "1"}], "\[RightDoubleBracket]"}]}], "}"}], 
              "\[Rule]", "1"}], ",", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"j", ",", 
                RowBox[{"pars", "\[LeftDoubleBracket]", 
                 RowBox[{"j", ",", "2"}], "\[RightDoubleBracket]"}]}], "}"}], 
              "->", "1"}]}], "}"}]}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"j", ",", "ninds"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"SparseArray", "[", 
         RowBox[{
          RowBox[{"Flatten", "[", 
           RowBox[{"tt", ",", "1"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"ninds", ",", "ninds"}], "}"}]}], "]"}], ",", 
        RowBox[{"Pick", "[", 
         RowBox[{"np", ",", "sel"}], "]"}]}], "}"}]}]}], "]"}]}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.442760981087072*^9, 3.442760982475638*^9}, {
   3.643257421949876*^9, 3.6432574618297853`*^9}, {3.643262520460021*^9, 
   3.64326254302497*^9}, {3.6432979384164762`*^9, 3.643297949961801*^9}, {
   3.667463068689343*^9, 3.6674630748873796`*^9}, {3.667463122067841*^9, 
   3.667463122235721*^9}, {3.667465306656519*^9, 3.6674655411460238`*^9}, {
   3.667465573737092*^9, 3.667465583259262*^9}, {3.66747007690565*^9, 
   3.667470081159478*^9}, {3.692015834930256*^9, 3.692015836667574*^9}, 
   3.692016021365259*^9, 3.6920161281539373`*^9},
 CellLabel->
  "In[331]:=",ExpressionUUID->"b2485ad6-d87e-432f-b719-8c547392a5e4"],

Cell["Recording the pedigree matrix does not cost much", "Text",
 CellChangeTimes->{{3.643376593859288*^9, 
  3.6433766114742527`*^9}},ExpressionUUID->"684ef792-e802-44d2-a2a7-\
bac36fbddae3"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Timing", "[", 
  RowBox[{
   RowBox[{"(", 
    RowBox[{
     RowBox[{"ww", "=", 
      RowBox[{
       RowBox[{"W", "[", 
        RowBox[{"0.1", ",", "\[Alpha]\[Alpha]"}], "]"}], "/@", "pop1000"}]}], 
     ";", 
     RowBox[{"pars", "=", 
      RowBox[{"RandomChoice", "[", 
       RowBox[{
        RowBox[{"ww", "\[Rule]", 
         RowBox[{"Range", "[", "1000", "]"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"1000", ",", "2"}], "}"}]}], "]"}]}], ";", 
     RowBox[{
      RowBox[{
       RowBox[{"Mendel", "[", 
        RowBox[{
        "pop1000", "\[LeftDoubleBracket]", "#", "\[RightDoubleBracket]"}], 
        "]"}], "&"}], "/@", "pars"}]}], ")"}], ";"}], "]"}]], "Input",
 CellChangeTimes->{{3.643376493128736*^9, 
  3.643376567934614*^9}},ExpressionUUID->"fdb4df7a-84f0-456b-bac3-\
e1d6ab383e33"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
  "0.07080500000000000682121026329696178436`4.870663840400705", ",", "Null"}],
   "}"}]], "Output",
 CellChangeTimes->{
  3.643376568956108*^9},ExpressionUUID->"0959bbb3-820a-40be-b41f-\
c9c08d3c7f85"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Timing", "[", 
  RowBox[{
   RowBox[{"SparsePedigreeMatrix", "[", 
    RowBox[{"pop1000", ",", 
     RowBox[{"W", "[", 
      RowBox[{"0.1", ",", "\[Alpha]\[Alpha]"}], "]"}]}], "]"}], ";"}], 
  "]"}]], "Input",
 CellChangeTimes->{{3.643376570221277*^9, 
  3.643376588324136*^9}},ExpressionUUID->"2692719b-70ce-444c-b3ac-\
bbe676565dcd"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
  "0.07531400000000000594102544937413767911`4.89747562729705", ",", "Null"}], 
  "}"}]], "Output",
 CellChangeTimes->{
  3.643376588773353*^9},ExpressionUUID->"a276c91d-acd3-4cfc-85b5-\
7fa4ca1ca932"]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["Mendel", "Subsubsection",ExpressionUUID->"23168383-d4ea-4822-8b8c-b45a147e9c4c"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Mendel", "::", "usage"}], "=", 
   "\"\<Mendel[{{0,1,\[Ellipsis]},{1,0,\[Ellipsis]}}] or \
Mendel[\[Infinity]][] gives a random gamete, assuming no linkage. \
Mendel[R][{{0,1,\[Ellipsis]},{1,0,\[Ellipsis]}}] assumes a linear map of \
total length R Morgans, with crossover rate R/(n-1) between adjacent loci. \
Mendel[\!\(\*SubscriptBox[\(X\), \(0\)]\),{\!\(\*SubscriptBox[\(x\), \(1, \
2\)]\),\[Ellipsis]},R][{{0,1,\[Ellipsis]},{1,0,\[Ellipsis]}}] uses the \
specified breakpoints, and drawing the leftmost locus according to \
\!\(\*SubscriptBox[\(X\), \(0\)]\); assumes that the first and last loci are \
at 0, R respectively. This is more efficient, since all the breakpoints can \
be drawn in one step. \!\(\*SubscriptBox[\(X\), \(0\)]\)=0 chooses from the \
first parental genme, \!\(\*SubscriptBox[\(X\), \(0\)]\)=1 from the second.\>\
\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.667466818792818*^9, 3.6674668409245453`*^9}, {
   3.667468117503953*^9, 3.667468136532881*^9}, {3.667469843506824*^9, 
   3.667469851208721*^9}, {3.693019581112945*^9, 3.693019637900856*^9}, 
   3.693019799168426*^9, {3.693019905486548*^9, 3.693019926716979*^9}, {
   3.693019971892815*^9, 3.6930200110984707`*^9}, {3.69303843529937*^9, 
   3.6930384676827374`*^9}, {3.693052379900229*^9, 3.693052428977365*^9}},
 CellLabel->
  "In[332]:=",ExpressionUUID->"fe33782e-eab2-4a59-b850-dcdda02abdd8"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Mendel", "[", 
    RowBox[{"{", 
     RowBox[{"x_List", ",", "y_List"}], "}"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"mask", ",", 
       RowBox[{"nl", "=", 
        RowBox[{"Length", "[", "x", "]"}]}]}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"mask", "=", 
       RowBox[{"RandomInteger", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"0", ",", "1"}], "}"}], ",", "nl"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"1", "-", "mask"}], ")"}], " ", "x"}], "+", 
       RowBox[{"mask", " ", "y"}]}]}]}], "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.643257577484548*^9, 3.643257628089859*^9}, {
   3.643258730028267*^9, 3.643258752952861*^9}, {3.6432587971028433`*^9, 
   3.643258815289199*^9}, 3.693052356832728*^9},
 CellLabel->
  "In[333]:=",ExpressionUUID->"0544453a-817c-4261-b5b5-784a7f80f860"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Mendel", "[", "0", "]"}], "[", 
    RowBox[{"{", 
     RowBox[{"x_List", ",", "y_List"}], "}"}], "]"}], ":=", 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"Random", "[", "Integer", "]"}], "\[Equal]", "0"}], ",", "x", 
     ",", "y"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Mendel", "[", "\[Infinity]", "]"}], "[", 
    RowBox[{"{", 
     RowBox[{"x_List", ",", "y_List"}], "}"}], "]"}], ":=", 
   RowBox[{"Mendel", "[", 
    RowBox[{"{", 
     RowBox[{"x", ",", "y"}], "}"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Mendel", "[", "R_", "]"}], "[", 
    RowBox[{"{", 
     RowBox[{"x_List", ",", "y_List"}], "}"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"mask", ",", 
       RowBox[{"n", "=", 
        RowBox[{"Length", "[", "x", "]"}]}]}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"mask", "=", 
       RowBox[{"makeMask", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{"1", "-", 
            RowBox[{"Exp", "[", 
             RowBox[{
              RowBox[{"-", "2"}], 
              RowBox[{"R", "/", 
               RowBox[{"(", 
                RowBox[{"n", "-", "1"}], ")"}]}]}], "]"}]}], ")"}], "/", 
          "2"}], ",", "n"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"1", "-", "mask"}], ")"}], " ", "x"}], "+", 
       RowBox[{"mask", " ", "y"}]}]}]}], "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.643257577484548*^9, 3.643257628089859*^9}, {
   3.643258730028267*^9, 3.643258752952861*^9}, {3.6432587971028433`*^9, 
   3.643258815289199*^9}, {3.6674668750434732`*^9, 3.667466879377179*^9}, {
   3.667469608085042*^9, 3.66746968007796*^9}, {3.667469878448539*^9, 
   3.667469939665572*^9}, 3.6930523531824427`*^9},
 CellLabel->
  "In[334]:=",ExpressionUUID->"09ee8678-781e-43ef-a902-b572ef6f53c9"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Mendel", "[", 
     RowBox[{
      RowBox[{"X0", ":", 
       RowBox[{"(", 
        RowBox[{"0", "|", "1"}], ")"}]}], ",", "b_List", ",", "R_"}], "]"}], 
    "[", 
    RowBox[{"{", 
     RowBox[{"x_List", ",", "y_List"}], "}"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"mask", ",", "bb", ",", "bk", ",", 
       RowBox[{"n", "=", 
        RowBox[{"Length", "[", "x", "]"}]}]}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"bb", "=", 
       RowBox[{"Gather", "[", 
        RowBox[{"Ceiling", "[", 
         RowBox[{
          FractionBox["b", "R"], 
          RowBox[{"(", 
           RowBox[{"n", "-", "1"}], ")"}]}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"bk", "=", 
       RowBox[{"Union", "[", 
        RowBox[{"Flatten", "[", 
         RowBox[{"Pick", "[", 
          RowBox[{"bb", ",", 
           RowBox[{
            RowBox[{
             RowBox[{"OddQ", "[", 
              RowBox[{"Length", "[", "#", "]"}], "]"}], "&"}], "/@", "bb"}]}],
           "]"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"mask", "=", 
       RowBox[{"makeMask", "[", 
        RowBox[{"X0", ",", "bk", ",", "n"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"1", "-", "mask"}], ")"}], " ", "x"}], "+", 
       RowBox[{"mask", " ", "y"}]}]}]}], "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.643257577484548*^9, 3.643257628089859*^9}, {
  3.643258730028267*^9, 3.643258752952861*^9}, {3.6432587971028433`*^9, 
  3.643258815289199*^9}, {3.6674668750434732`*^9, 3.667466879377179*^9}, {
  3.667469608085042*^9, 3.66746968007796*^9}, {3.667469878448539*^9, 
  3.667469939665572*^9}, {3.693020386399325*^9, 3.693020431978994*^9}, {
  3.6930385439424067`*^9, 3.69303855163693*^9}, {3.693040278850544*^9, 
  3.6930403282068167`*^9}, {3.693052341997225*^9, 3.693052347164259*^9}, {
  3.694140899285042*^9, 3.694140900963509*^9}},
 CellLabel->
  "In[337]:=",ExpressionUUID->"30a9d593-17f1-424e-8a62-3bf969c10c93"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Mendel", "[", 
     RowBox[{"{", 
      RowBox[{"x_Integer", ",", "y_Integer"}], "}"}], "]"}], ":=", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"Random", "[", "Integer", "]"}], "\[Equal]", "0"}], ",", "x", 
      ",", "y"}], "]"}]}], ";"}], 
  RowBox[{"(*", " ", 
   RowBox[{"not", " ", 
    RowBox[{"used", " ", "?"}]}], "*)"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6432588261224127`*^9, 3.643258831023129*^9}, {
   3.69301988415105*^9, 3.6930198987970943`*^9}, 3.6930201315678673`*^9},
 CellLabel->
  "In[338]:=",ExpressionUUID->"1601dc02-c86a-45b1-8673-a1ad8ffcb558"]
}, Closed]],

Cell[CellGroupData[{

Cell["MendelC", "Subsubsection",
 CellChangeTimes->{
  3.69305184575701*^9},ExpressionUUID->"b656c9bb-db23-41ac-98f8-41a311a862f8"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MendelC", "::", "usage"}], "=", 
   "\"\<MendelC[\[ScriptCapitalP],X,{\!\(\*SubscriptBox[\(x\), \
\(1\)]\),\!\(\*SubscriptBox[\(x\), \
\(2\)]\),\[Ellipsis]},R][{{\!\(\*SubscriptBox[\(j\), \
\(1\)]\),\[Ellipsis]},{\!\(\*SubscriptBox[\(k\), \(1\)]\),\[Ellipsis]}}] \
gives a random gamete, assuming a linear map of R Morgans, source of the left \
end, X=0 or 1, and breakpoints \!\(\*SubscriptBox[\(x\), \(1\)]\). The two \
continuous genomes of the parents are each represented as a list of \
junctions, {\!\(\*SubscriptBox[\(j\), \(1\)]\),\[Ellipsis]} and \
{\!\(\*SubscriptBox[\(k\), \(1\)]\),\[Ellipsis]} whose locations are in locJ[\
\[ScriptCapitalP]]. Returns the recombined gamete, including the new \
breakpoints, and updates locJ, hapJ, originJ with information on the new \
junctions. It is important that the breakpoints are ordered. Junctions \
between identical material are recorded in hapJ[\[ScriptCapitalP]], locJ[\
\[ScriptCapitalP]], origin[\[ScriptCapitalP]], but are not included in \
junctions[\[ScriptCapitalP]]\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.667466818792818*^9, 3.6674668409245453`*^9}, {
   3.667468117503953*^9, 3.667468136532881*^9}, {3.667469843506824*^9, 
   3.667469851208721*^9}, {3.693019581112945*^9, 3.693019637900856*^9}, 
   3.693019799168426*^9, {3.693019905486548*^9, 3.693019926716979*^9}, {
   3.693019971892815*^9, 3.6930200110984707`*^9}, {3.69303843529937*^9, 
   3.6930384676827374`*^9}, {3.693051104208496*^9, 3.693051324395186*^9}, {
   3.693377868692511*^9, 3.693378078865711*^9}, {3.6933781170736647`*^9, 
   3.693378119552228*^9}, {3.693378373837441*^9, 3.693378427656526*^9}, 
   3.693389013014264*^9, {3.693390821702415*^9, 3.693390827335506*^9}, {
   3.693404259091206*^9, 3.69340428356152*^9}, {3.6934560156376257`*^9, 
   3.6934560775932503`*^9}, {3.693461686851182*^9, 3.693461694505705*^9}},
 CellLabel->
  "In[339]:=",ExpressionUUID->"4b5f18b5-e71f-4671-8733-27c87125c542"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MendelC", "::", "badbreaks"}], "=", 
   "\"\<The breakpoints `1` are not ordered and in {0,`2`}\>\""}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6934042918520193`*^9, 3.693404323816058*^9}, 
   3.698306894590473*^9},
 CellLabel->
  "In[340]:=",ExpressionUUID->"4a6d01d2-81a2-4de8-83e3-8cb9cf02ce45"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MendelC", "[", 
     RowBox[{"\[ScriptCapitalP]_", ",", 
      RowBox[{"X0", ":", 
       RowBox[{"(", 
        RowBox[{"0", "|", "1"}], ")"}]}], ",", "b_List", ",", "R_"}], "]"}], 
    "[", 
    RowBox[{"{", 
     RowBox[{"j0_List", ",", "j1_List"}], "}"}], "]"}], ":=", 
   "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "int", ",", "intQ0", ",", "intQ1", ",", "sj", ",", "ssj", ",", "nj", 
       ",", "nnj", ",", "jn", ",", "aa", ",", "nf", ",", "h", ",", 
       RowBox[{"\[Epsilon]", "=", 
        SuperscriptBox["10", 
         RowBox[{"-", "9"}]]}], ",", "snh"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
      "check", " ", "that", " ", "b", " ", "is", " ", "ordered", " ", "and", 
       " ", "in", " ", 
       RowBox[{"{", 
        RowBox[{"0", ",", "R"}], "}"}]}], " ", "*)"}], "\[IndentingNewLine]", 
     
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Not", "[", 
          RowBox[{"OrderedQ", "[", "b", "]"}], "]"}], "&&", 
         RowBox[{
          RowBox[{"Min", "[", "b", "]"}], ">", "0"}], "&&", 
         RowBox[{
          RowBox[{"Max", "[", "b", "]"}], "<", "R"}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Message", "[", 
          RowBox[{
           RowBox[{"MendelC", "::", "badbreaks"}], ",", "b", ",", "R"}], 
          "]"}], ";", 
         RowBox[{"b", "=", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{"Min", "[", 
              RowBox[{
               RowBox[{"Max", "[", 
                RowBox[{"#", ",", "\[Epsilon]"}], "]"}], ",", 
               RowBox[{"R", "-", "\[Epsilon]"}]}], "]"}], ")"}], "&"}], "/@", 
           
           RowBox[{"Sort", "[", "b", "]"}]}]}]}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{
        "find", " ", "the", " ", "current", " ", "#", " ", "of", " ", 
         "junctions"}], ",", " ", 
        RowBox[{
        "and", " ", "the", " ", "numbers", " ", "of", " ", "the", " ", "new", 
         " ", "junctions"}]}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"nj", "=", 
       RowBox[{"numJ", "[", "\[ScriptCapitalP]", "]"}]}], ";", 
      RowBox[{"nnj", "=", 
       RowBox[{"nj", "+", 
        RowBox[{"Range", "[", 
         RowBox[{"Length", "[", "b", "]"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "update", " ", "the", " ", "locations", " ", "and", " ", "origin", " ",
         "times", " ", "of", " ", "the", " ", "new", " ", "breakpoints"}], 
       " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"MapThread", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"originJ", "[", "\[ScriptCapitalP]", "]"}], "[", "#1", 
             "]"}], "=", 
            RowBox[{"time", "[", "\[ScriptCapitalP]", "]"}]}], ";", 
           RowBox[{
            RowBox[{
             RowBox[{"locJ", "[", "\[ScriptCapitalP]", "]"}], "[", "#1", 
             "]"}], "=", "#2"}]}], ")"}], "&"}], ",", 
        RowBox[{"{", 
         RowBox[{"nnj", ",", "b"}], "}"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
       "find", " ", "the", " ", "flanking", " ", "haplotypes", " ", "of", " ",
         "the", " ", "new", " ", "junctions"}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"nf", "[", "0", "]"}], "=", 
       RowBox[{"nearestJunction", "[", 
        RowBox[{"\[ScriptCapitalP]", ",", "j0"}], "]"}]}], ";", 
      RowBox[{
       RowBox[{"nf", "[", "1", "]"}], "=", 
       RowBox[{"nearestJunction", "[", 
        RowBox[{"\[ScriptCapitalP]", ",", "j1"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"aa", "=", 
       RowBox[{"alternate01", "[", 
        RowBox[{"X0", ",", 
         RowBox[{"Length", "[", "b", "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"MapThread", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"(", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"jn", "[", "Y_", "]"}], ":=", 
            RowBox[{
             RowBox[{
              RowBox[{"nf", "[", "Y", "]"}], "[", "#1", "]"}], 
             "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], ";", 
           RowBox[{
            RowBox[{"h", "[", "Y_", "]"}], ":=", 
            RowBox[{
             RowBox[{
              RowBox[{"hapJ", "[", "\[ScriptCapitalP]", "]"}], "[", 
              RowBox[{"jn", "[", "Y", "]"}], "]"}], "\[LeftDoubleBracket]", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"locJ", "[", "\[ScriptCapitalP]", "]"}], "[", 
                 RowBox[{"jn", "[", "Y", "]"}], "]"}], "<", "#1"}], ",", "2", 
               ",", "1"}], "]"}], "\[RightDoubleBracket]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"hapJ", "[", "\[ScriptCapitalP]", "]"}], "[", "#3", 
             "]"}], "=", 
            RowBox[{"(", 
             RowBox[{"h", "/@", "#2"}], ")"}]}]}], ")"}], "&"}], ",", 
        RowBox[{"{", 
         RowBox[{"b", ",", "aa", ",", "nnj"}], "}"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{
        "if", " ", "any", " ", "junctions", " ", "are", " ", "between", " ", 
         "identical", " ", "ancestries"}], ",", " ", 
        RowBox[{
        "do", " ", "not", " ", "include", " ", "in", " ", "the", " ", "new", 
         " ", "gamete", " ", "or", " ", "in", " ", "numJ"}]}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"snh", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Not", "[", 
          RowBox[{"MatchQ", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"x_", ",", "x_"}], "}"}], ",", 
            RowBox[{
             RowBox[{"hapJ", "[", "\[ScriptCapitalP]", "]"}], "[", "#", 
             "]"}]}], "]"}], "]"}], "&"}], "/@", "nnj"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
       "add", " ", "the", " ", "numbers", " ", "of", " ", "the", " ", "new", 
        " ", "junctions"}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"numJ", "[", "\[ScriptCapitalP]", "]"}], "+=", 
       RowBox[{"Length", "[", "b", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
       "find", " ", "the", " ", "intervals", " ", "defined", " ", "by", " ", 
        "the", " ", "breakpoints"}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"int", "=", 
       RowBox[{"Interval", "@@", 
        RowBox[{"Partition", "[", 
         RowBox[{
          RowBox[{"Append", "[", 
           RowBox[{"b", ",", "R"}], "]"}], ",", "2"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"intQ0", "=", 
       RowBox[{
        RowBox[{"Not", "[", 
         RowBox[{"IntervalMemberQ", "[", 
          RowBox[{"int", ",", 
           RowBox[{
            RowBox[{"locJ", "[", "\[ScriptCapitalP]", "]"}], "[", "#", 
            "]"}]}], "]"}], "]"}], "&"}]}], ";", 
      RowBox[{"intQ1", "=", 
       RowBox[{
        RowBox[{"IntervalMemberQ", "[", 
         RowBox[{"int", ",", 
          RowBox[{
           RowBox[{"locJ", "[", "\[ScriptCapitalP]", "]"}], "[", "#", "]"}]}],
          "]"}], "&"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{
        "construct", " ", "the", " ", "recombinant", " ", "junctions"}], ",", 
        " ", 
        RowBox[{"including", " ", "the", " ", "new", " ", "junctions"}]}], 
       " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"sj", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"X0", "\[Equal]", "0"}], ",", "\[IndentingNewLine]", 
         RowBox[{"Join", "[", 
          RowBox[{
           RowBox[{"Select", "[", 
            RowBox[{"j0", ",", "intQ0"}], "]"}], ",", 
           RowBox[{"Select", "[", 
            RowBox[{"j1", ",", "intQ1"}], "]"}], ",", 
           RowBox[{"Pick", "[", 
            RowBox[{"nnj", ",", "snh"}], "]"}]}], "]"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"Join", "[", 
          RowBox[{
           RowBox[{"Select", "[", 
            RowBox[{"j1", ",", "intQ0"}], "]"}], ",", 
           RowBox[{"Select", "[", 
            RowBox[{"j0", ",", "intQ1"}], "]"}], ",", 
           RowBox[{"Pick", "[", 
            RowBox[{"nnj", ",", "snh"}], "]"}]}], "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{
        "order", " ", "the", " ", "junctions", " ", "by", " ", "location"}], 
        " ", "-", " ", 
        RowBox[{"not", " ", "strictly", " ", "necessary"}]}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"SortBy", "[", 
       RowBox[{"sj", ",", 
        RowBox[{"locJ", "[", "\[ScriptCapitalP]", "]"}]}], "]"}]}]}], "]"}]}],
   ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.643257577484548*^9, 3.643257628089859*^9}, {
   3.643258730028267*^9, 3.643258752952861*^9}, {3.6432587971028433`*^9, 
   3.643258815289199*^9}, {3.6674668750434732`*^9, 3.667466879377179*^9}, {
   3.667469608085042*^9, 3.66746968007796*^9}, {3.667469878448539*^9, 
   3.667469939665572*^9}, {3.693020386399325*^9, 3.693020431978994*^9}, {
   3.6930385439424067`*^9, 3.69303855163693*^9}, {3.693040278850544*^9, 
   3.6930403282068167`*^9}, {3.693051860653528*^9, 3.6930519177459097`*^9}, {
   3.6933780977708673`*^9, 3.6933781443038588`*^9}, {3.6933887021357803`*^9, 
   3.69338890994734*^9}, {3.6933889400519667`*^9, 3.693388969442958*^9}, {
   3.693389041381311*^9, 3.6933890796113243`*^9}, {3.693389126907181*^9, 
   3.693389169450918*^9}, {3.693390528917562*^9, 3.693390765754137*^9}, {
   3.6933908385444727`*^9, 3.6933908755001307`*^9}, {3.693395025227331*^9, 
   3.693395045988532*^9}, {3.693403832373064*^9, 3.693403942558861*^9}, {
   3.693404096905834*^9, 3.693404113176303*^9}, {3.693404170799788*^9, 
   3.693404185527198*^9}, {3.693404215757512*^9, 3.693404238531878*^9}, {
   3.6934043326491127`*^9, 3.6934045506295424`*^9}, {3.6934075711770782`*^9, 
   3.6934077409660263`*^9}, {3.693407772289339*^9, 3.693407927161995*^9}, {
   3.693455310157806*^9, 3.693455311869542*^9}, {3.693455577846773*^9, 
   3.693455670333139*^9}, {3.6934557724284697`*^9, 3.693455916520302*^9}, {
   3.69345594940114*^9, 3.6934560029594393`*^9}, {3.693461718181591*^9, 
   3.693461755706147*^9}, {3.693463786298604*^9, 3.693463790826138*^9}, 
   3.693483060251391*^9, {3.693486414466462*^9, 3.6934864553461647`*^9}},
 CellLabel->
  "In[341]:=",ExpressionUUID->"fe5c95aa-2e76-4d12-8efb-033a0858681c"],

Cell[TextData[{
 "- identify which regions come from which gamete\n- choose existing \
junctions accordingly\n- add the new junctions, provided that they \
distinguish different haplotypes\n- update information about the new \
junctions\n- haplotypes associated with the new breakpoints are hard to find. \
There will always be ancestral junctions at ",
 Cell[BoxData[
  FormBox[
   RowBox[{"{", 
    RowBox[{"0", ",", "R"}], "}"}], TraditionalForm]],ExpressionUUID->
  "4a14cbc2-d087-43dc-ac5b-6ff092100536"],
 ", so new junctions are flanked by pre-existing junctions.  If there is a \
single break in an interval, then its flanking material is derived from the \
flanking junctions. If there are an odd number of breaks in an interval, it  \
the ancestry of the two genomes is given by the right ancestry of the left \
junction and the left ancestry of the right junction. With an even number of \
breaks, those two must be the same, and the intervening material has to be \
determined by the flanking material on the other genome. So, we cannot \
dediuce the ancestry soelley form the new list of junctions."
}], "Text",
 CellChangeTimes->{{3.693384604805341*^9, 3.693384702868147*^9}, {
  3.69339092526151*^9, 3.693390936514783*^9}, {3.693395064687595*^9, 
  3.693395079583571*^9}, {3.693395549041894*^9, 3.6933956203852654`*^9}, {
  3.693396047143051*^9, 3.693396216930093*^9}, {3.6933963651872*^9, 
  3.6933965902257347`*^9}},ExpressionUUID->"5af375ba-4ba5-4ff2-a673-\
0613b01899aa"],

Cell["\<\
A solution (maybe not the most efficient) is to:
\t-  order the breakpoints
\t- if the left ancestry is 0, their haplotypes are {0,1},{1,0},{0,1}\
\[Ellipsis]
\t- the ancestry of the two genomes at a breakpoint are found from the \
nearest junction.
\t- Then, for each breakpoint with (say) {0,1}, its left ancestry is found \
from genome 0, and its right, from genome 1.\
\>", "Text",
 CellChangeTimes->{{3.693396596960251*^9, 3.693396617822744*^9}, {
  3.693397223238505*^9, 3.6933973068598433`*^9}, {3.693397853298544*^9, 
  3.693397857153089*^9}, {3.6934029937727537`*^9, 
  3.6934030401895943`*^9}},ExpressionUUID->"9058a04c-1cad-4258-a4b2-\
500d21f893ac"]
}, Closed]],

Cell[CellGroupData[{

Cell["MendelM", "Subsubsection",
 CellChangeTimes->{3.69305184575701*^9, 
  3.70070501244715*^9},ExpressionUUID->"a8bd9170-fbf2-4ea6-8dba-b3b8a59afb74"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MendelM", "::", "usage"}], "=", 
   "\"\<MendelM[\[ScriptCapitalP],X,{\!\(\*SubscriptBox[\(x\), \
\(1\)]\),\!\(\*SubscriptBox[\(x\), \
\(2\)]\),\[Ellipsis]},R][{{\!\(\*SubscriptBox[\(j\), \
\(1\)]\),\[Ellipsis]},{\!\(\*SubscriptBox[\(k\), \(1\)]\),\[Ellipsis]}}] \
gives a random gamete, assuming a linear map of R Morgans, source of the left \
end, X=0 or 1, and breakpoints \!\(\*SubscriptBox[\(x\), \(1\)]\). The two \
continuous genomes of the parents are each represented as a list of \
mutations, {\!\(\*SubscriptBox[\(j\), \(1\)]\),\[Ellipsis]} and \
{\!\(\*SubscriptBox[\(k\), \(1\)]\),\[Ellipsis]} whose locations are in locM[\
\[ScriptCapitalP]]. Returns the recombined gamete. It is important that the \
breakpoints are ordered. \>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.667466818792818*^9, 3.6674668409245453`*^9}, {
   3.667468117503953*^9, 3.667468136532881*^9}, {3.667469843506824*^9, 
   3.667469851208721*^9}, {3.693019581112945*^9, 3.693019637900856*^9}, 
   3.693019799168426*^9, {3.693019905486548*^9, 3.693019926716979*^9}, {
   3.693019971892815*^9, 3.6930200110984707`*^9}, {3.69303843529937*^9, 
   3.6930384676827374`*^9}, {3.693051104208496*^9, 3.693051324395186*^9}, {
   3.693377868692511*^9, 3.693378078865711*^9}, {3.6933781170736647`*^9, 
   3.693378119552228*^9}, {3.693378373837441*^9, 3.693378427656526*^9}, 
   3.693389013014264*^9, {3.693390821702415*^9, 3.693390827335506*^9}, {
   3.693404259091206*^9, 3.69340428356152*^9}, {3.6934560156376257`*^9, 
   3.6934560775932503`*^9}, {3.693461686851182*^9, 3.693461694505705*^9}, {
   3.7007050179377203`*^9, 3.700705060733191*^9}, {3.700705822936124*^9, 
   3.700705834661606*^9}},
 CellLabel->
  "In[342]:=",ExpressionUUID->"6d8d3d46-ecda-438a-8722-adab0a9c03d0"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MendelM", "::", "badbreaks"}], "=", 
   "\"\<The breakpoints `1` are not ordered and in {0,`2`}\>\""}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6934042918520193`*^9, 3.693404323816058*^9}, 
   3.698306894590473*^9, 3.7007058407519493`*^9},
 CellLabel->
  "In[343]:=",ExpressionUUID->"97beaf86-de6c-46f8-8ff5-46732b1558c0"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MendelM", "[", 
     RowBox[{"\[ScriptCapitalP]_", ",", 
      RowBox[{"X0", ":", 
       RowBox[{"(", 
        RowBox[{"0", "|", "1"}], ")"}]}], ",", "b_List", ",", "R_"}], "]"}], 
    "[", 
    RowBox[{"{", 
     RowBox[{"j0_List", ",", "j1_List"}], "}"}], "]"}], ":=", 
   "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"int", ",", "intQ0", ",", "intQ1", ",", "sm", ",", 
       RowBox[{"\[Epsilon]", "=", 
        SuperscriptBox["10", 
         RowBox[{"-", "9"}]]}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
      "check", " ", "that", " ", "b", " ", "is", " ", "ordered", " ", "and", 
       " ", "in", " ", 
       RowBox[{"{", 
        RowBox[{"0", ",", "R"}], "}"}]}], " ", "*)"}], "\[IndentingNewLine]", 
     
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Not", "[", 
          RowBox[{"OrderedQ", "[", "b", "]"}], "]"}], "&&", 
         RowBox[{
          RowBox[{"Min", "[", "b", "]"}], ">", "0"}], "&&", 
         RowBox[{
          RowBox[{"Max", "[", "b", "]"}], "<", "R"}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Message", "[", 
          RowBox[{
           RowBox[{"MendelM", "::", "badbreaks"}], ",", "b", ",", "R"}], 
          "]"}], ";", 
         RowBox[{"b", "=", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{"Min", "[", 
              RowBox[{
               RowBox[{"Max", "[", 
                RowBox[{"#", ",", "\[Epsilon]"}], "]"}], ",", 
               RowBox[{"R", "-", "\[Epsilon]"}]}], "]"}], ")"}], "&"}], "/@", 
           
           RowBox[{"Sort", "[", "b", "]"}]}]}]}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
       "find", " ", "the", " ", "intervals", " ", "defined", " ", "by", " ", 
        "the", " ", "breakpoints"}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"int", "=", 
       RowBox[{"Interval", "@@", 
        RowBox[{"Partition", "[", 
         RowBox[{
          RowBox[{"Append", "[", 
           RowBox[{"b", ",", "R"}], "]"}], ",", "2"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"intQ0", "=", 
       RowBox[{
        RowBox[{"Not", "[", 
         RowBox[{"IntervalMemberQ", "[", 
          RowBox[{"int", ",", 
           RowBox[{
            RowBox[{"locM", "[", "\[ScriptCapitalP]", "]"}], "[", "#", 
            "]"}]}], "]"}], "]"}], "&"}]}], ";", 
      RowBox[{"intQ1", "=", 
       RowBox[{
        RowBox[{"IntervalMemberQ", "[", 
         RowBox[{"int", ",", 
          RowBox[{
           RowBox[{"locM", "[", "\[ScriptCapitalP]", "]"}], "[", "#", "]"}]}],
          "]"}], "&"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
       "construct", " ", "the", " ", "recombinant", " ", "chromosomes"}], " ",
        "*)"}], "\[IndentingNewLine]", 
      RowBox[{"sm", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"X0", "\[Equal]", "0"}], ",", "\[IndentingNewLine]", 
         RowBox[{"Join", "[", 
          RowBox[{
           RowBox[{"Select", "[", 
            RowBox[{"j0", ",", "intQ0"}], "]"}], ",", 
           RowBox[{"Select", "[", 
            RowBox[{"j1", ",", "intQ1"}], "]"}]}], "]"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"Join", "[", 
          RowBox[{
           RowBox[{"Select", "[", 
            RowBox[{"j1", ",", "intQ0"}], "]"}], ",", 
           RowBox[{"Select", "[", 
            RowBox[{"j0", ",", "intQ1"}], "]"}]}], "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{
        "order", " ", "the", " ", "mutations", " ", "by", " ", "location"}], 
        " ", "-", " ", 
        RowBox[{"not", " ", "strictly", " ", "necessary"}]}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"SortBy", "[", 
       RowBox[{"sm", ",", 
        RowBox[{"locM", "[", "\[ScriptCapitalP]", "]"}]}], "]"}]}]}], "]"}]}],
   ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.643257577484548*^9, 3.643257628089859*^9}, {
   3.643258730028267*^9, 3.643258752952861*^9}, {3.6432587971028433`*^9, 
   3.643258815289199*^9}, {3.6674668750434732`*^9, 3.667466879377179*^9}, {
   3.667469608085042*^9, 3.66746968007796*^9}, {3.667469878448539*^9, 
   3.667469939665572*^9}, {3.693020386399325*^9, 3.693020431978994*^9}, {
   3.6930385439424067`*^9, 3.69303855163693*^9}, {3.693040278850544*^9, 
   3.6930403282068167`*^9}, {3.693051860653528*^9, 3.6930519177459097`*^9}, {
   3.6933780977708673`*^9, 3.6933781443038588`*^9}, {3.6933887021357803`*^9, 
   3.69338890994734*^9}, {3.6933889400519667`*^9, 3.693388969442958*^9}, {
   3.693389041381311*^9, 3.6933890796113243`*^9}, {3.693389126907181*^9, 
   3.693389169450918*^9}, {3.693390528917562*^9, 3.693390765754137*^9}, {
   3.6933908385444727`*^9, 3.6933908755001307`*^9}, {3.693395025227331*^9, 
   3.693395045988532*^9}, {3.693403832373064*^9, 3.693403942558861*^9}, {
   3.693404096905834*^9, 3.693404113176303*^9}, {3.693404170799788*^9, 
   3.693404185527198*^9}, {3.693404215757512*^9, 3.693404238531878*^9}, {
   3.6934043326491127`*^9, 3.6934045506295424`*^9}, {3.6934075711770782`*^9, 
   3.6934077409660263`*^9}, {3.693407772289339*^9, 3.693407927161995*^9}, {
   3.693455310157806*^9, 3.693455311869542*^9}, {3.693455577846773*^9, 
   3.693455670333139*^9}, {3.6934557724284697`*^9, 3.693455916520302*^9}, {
   3.69345594940114*^9, 3.6934560029594393`*^9}, {3.693461718181591*^9, 
   3.693461755706147*^9}, {3.693463786298604*^9, 3.693463790826138*^9}, 
   3.693483060251391*^9, {3.693486414466462*^9, 3.6934864553461647`*^9}, {
   3.70070584195387*^9, 3.700705859229183*^9}, {3.7007059077654943`*^9, 
   3.700706046903846*^9}},
 CellLabel->
  "In[344]:=",ExpressionUUID->"d1affc55-c19b-41c5-b265-8aa9bc32a7b8"]
}, Closed]],

Cell[CellGroupData[{

Cell["nearestJunction", "Subsubsection",
 CellChangeTimes->{{3.693403959335413*^9, 
  3.693403962398428*^9}},ExpressionUUID->"b8c8c688-b675-45eb-b91b-\
577693967959"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"nearestJunction", "::", "usage"}], "=", 
   "\"\<nearestJunction[\[ScriptCapitalP],{\!\(\*SubscriptBox[\(j\), \
\(1\)]\),\[Ellipsis]}] gives a Nearest function f, such that f[x] gives the \
closest junction in the list to x\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.693403965245802*^9, 3.69340402739502*^9}},
 CellLabel->
  "In[345]:=",ExpressionUUID->"5262f2c0-53e7-49fd-896e-92e9f9b3b396"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"nearestJunction", "[", 
    RowBox[{"\[ScriptCapitalP]_", ",", 
     RowBox[{"j", ":", 
      RowBox[{"{", "___Integer", "}"}]}]}], "]"}], ":=", 
   RowBox[{"Nearest", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"locJ", "[", "\[ScriptCapitalP]", "]"}], "[", "#", "]"}], 
        "\[Rule]", "#"}], ")"}], "&"}], "/@", "j"}], "]"}]}], ";"}]], "Input",\

 InitializationCell->True,
 CellChangeTimes->{{3.693404033411893*^9, 3.693404078231518*^9}},
 CellLabel->
  "In[346]:=",ExpressionUUID->"9698022b-9147-44fc-9c28-2f7c7b860005"]
}, Closed]],

Cell[CellGroupData[{

Cell["alternate01", "Subsubsection",
 CellChangeTimes->{
  3.693398296449401*^9},ExpressionUUID->"7b2fb9d3-20f9-4c31-8f52-\
0be933be227f"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"alternate01", "::", "usage"}], "=", 
   "\"\<alternate01[0,n] stores a series of n pairs {{0,1},{1,0},{0,1},\
\[Ellipsis]}. alternate01[1,n] gives {{1,0},{0,1),\[Ellipsis]}.\>\""}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.693398298434558*^9, 3.693398369652499*^9}},
 CellLabel->
  "In[347]:=",ExpressionUUID->"780bed91-f967-4b43-85bc-c133e32eacc2"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"alternate01", "[", "0", "]"}], "=", 
   RowBox[{"{", "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"alternate01", "[", "n_Integer", "]"}], ":=", 
   RowBox[{"Take", "[", 
    RowBox[{
     RowBox[{"Partition", "[", 
      RowBox[{
       RowBox[{"Drop", "[", 
        RowBox[{
         RowBox[{"Flatten", "[", 
          RowBox[{"ConstantArray", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"0", ",", "0", ",", "1", ",", "1"}], "}"}], ",", "n"}], 
           "]"}], "]"}], ",", "1"}], "]"}], ",", "2"}], "]"}], ",", "n"}], 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"alternate01", "[", 
    RowBox[{"0", ",", "n_Integer"}], "]"}], ":=", 
   RowBox[{
    RowBox[{"alternate01", "[", 
     RowBox[{"0", ",", "n"}], "]"}], "=", 
    RowBox[{"alternate01", "[", "n", "]"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"alternate01", "[", 
    RowBox[{"1", ",", "n_Integer"}], "]"}], ":=", 
   RowBox[{
    RowBox[{"alternate01", "[", 
     RowBox[{"1", ",", "n"}], "]"}], "=", 
    RowBox[{
     RowBox[{
      RowBox[{"(", 
       RowBox[{"1", "-", "#"}], ")"}], "&"}], "/@", 
     RowBox[{"alternate01", "[", "n", "]"}]}]}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6933979342909803`*^9, 3.693397946695759*^9}, {
  3.6933980038142633`*^9, 3.693398172033292*^9}, {3.693398204848547*^9, 
  3.693398224778934*^9}, {3.693398255330208*^9, 3.693398291926828*^9}},
 CellLabel->
  "In[348]:=",ExpressionUUID->"18d2847b-e532-4407-b2c6-f0a8f57c2a60"]
}, Closed]],

Cell[CellGroupData[{

Cell["makeMask", "Subsubsection",
 CellChangeTimes->{
  3.667469596673656*^9},ExpressionUUID->"0eb8473a-2205-438f-b980-\
9143cd291394"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"makeMask", "::", "usage"}], "=", 
   "\"\<makeMask[r,n] makes a list of {0,0,1,\[Ellipsis]} with n elements, \
and probability r of a crossover in each interval. \
makeMask[X,{\!\(\*SubscriptBox[\(i\), \(1\)]\),\[Ellipsis]},n] makes a mask, \
given the intervals in which effective recombinations occur; 1\[LessEqual]i\
\[LessEqual]n-1.\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.667469426754428*^9, 3.667469478580935*^9}, {
  3.693020635390688*^9, 3.693020697595313*^9}, {3.708571743656774*^9, 
  3.7085717443439617`*^9}},
 CellLabel->
  "In[352]:=",ExpressionUUID->"46bd84be-e717-44fc-b261-40b78b24e32b"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"makeMask", "[", 
    RowBox[{
     RowBox[{"r_", "?", "NumberQ"}], ",", "n_Integer"}], "]"}], ":=", 
   "\[IndentingNewLine]", 
   RowBox[{"makeMask", "[", 
    RowBox[{
     RowBox[{"RandomInteger", "[", 
      RowBox[{"{", 
       RowBox[{"0", ",", "1"}], "}"}], "]"}], ",", 
     RowBox[{"Sort", "[", 
      RowBox[{"RandomSample", "[", 
       RowBox[{
        RowBox[{"Range", "[", 
         RowBox[{"n", "-", "1"}], "]"}], ",", 
        RowBox[{"RandomInteger", "[", 
         RowBox[{"BinomialDistribution", "[", 
          RowBox[{
           RowBox[{"n", "-", "1"}], ",", "r"}], "]"}], "]"}]}], "]"}], "]"}], 
     ",", "n"}], "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.66746940592699*^9, 3.667469422609593*^9}, {
   3.6674694823342237`*^9, 3.667469557249086*^9}, 3.6919330543202467`*^9, {
   3.692005028491949*^9, 3.692005041892449*^9}, {3.692005099250979*^9, 
   3.69200513035312*^9}, {3.693020530722773*^9, 3.693020571856035*^9}, {
   3.693020732923991*^9, 3.693020735866835*^9}, {3.693020851650168*^9, 
   3.69302087696554*^9}, {3.7085724649846077`*^9, 3.7085724664920053`*^9}},
 CellLabel->
  "In[353]:=",ExpressionUUID->"ba081eb0-5369-4360-b4f7-9b93621971de"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"makeMask", "[", 
    RowBox[{"X0_", ",", 
     RowBox[{"il", ":", 
      RowBox[{"{", "___Integer", "}"}]}], ",", "n_Integer"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"kk", ",", "skk"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"kk", "=", 
       RowBox[{"Transpose", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"1", "+", 
           RowBox[{"Prepend", "[", 
            RowBox[{"il", ",", "0"}], "]"}]}], ",", 
          RowBox[{"Append", "[", 
           RowBox[{"il", ",", "n"}], "]"}]}], "}"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"skk", "=", 
       RowBox[{"Transpose", "[", 
        RowBox[{"{", 
         RowBox[{"kk", ",", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             SuperscriptBox[
              RowBox[{"(", 
               RowBox[{"-", "1"}], ")"}], 
              RowBox[{
               RowBox[{"Range", "[", 
                RowBox[{"Length", "[", "kk", "]"}], "]"}], "+", "X0"}]], "+", 
             "1"}], ")"}], "/", "2"}]}], "}"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Join", "@@", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"ConstantArray", "[", 
           RowBox[{
            RowBox[{
            "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], ",", 
            
            RowBox[{
             RowBox[{"#", "\[LeftDoubleBracket]", 
              RowBox[{"1", ",", "2"}], "\[RightDoubleBracket]"}], "-", 
             RowBox[{"#", "\[LeftDoubleBracket]", 
              RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], "+", 
             "1"}]}], "]"}], "&"}], "/@", "skk"}], ")"}]}]}]}], "]"}]}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.66746940592699*^9, 3.667469422609593*^9}, {
   3.6674694823342237`*^9, 3.667469557249086*^9}, 3.6919330543202467`*^9, {
   3.692005028491949*^9, 3.692005041892449*^9}, {3.692005099250979*^9, 
   3.69200513035312*^9}, {3.693020530722773*^9, 3.693020571856035*^9}, {
   3.6930207810826683`*^9, 3.693020817455791*^9}, {3.6930399441354322`*^9, 
   3.693039950895154*^9}},
 CellLabel->
  "In[354]:=",ExpressionUUID->"bf97437a-4fc9-4d9c-95f8-9dbc0181c6a8"]
}, Closed]],

Cell[CellGroupData[{

Cell["DropGenes", "Subsubsection",
 InitializationCell->
  True,ExpressionUUID->"949054c4-32e6-4bfa-93a7-df1e563500b6"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"DropGenes", "::", "usage"}], "=", 
   "\"\<DropGenes[p,P] generates random haploid genotypes, given the pedigree \
P; uses Mendel[]. DropGenes[p0,{P1,\[Ellipsis]}] does the same for many \
generations. Map->R allows for linkage on a linear map of length R.\>\""}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6675386045155067`*^9, 3.6675386149526987`*^9}, {
  3.667538791460452*^9, 3.667538797442479*^9}, {3.691906798053582*^9, 
  3.6919067994442244`*^9}},
 CellLabel->
  "In[355]:=",ExpressionUUID->"164f041a-ab1f-477a-9b1f-267ce34317ea"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "DropGenes", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{"Map", "\[Rule]", "\[Infinity]"}], "}"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6675386045155067`*^9, 3.6675386149526987`*^9}, {
  3.667538791460452*^9, 3.667538797442479*^9}, {3.667538869333138*^9, 
  3.667538880579741*^9}},
 CellLabel->
  "In[356]:=",ExpressionUUID->"4882819d-423d-4aaa-88f5-8eb3135176a5"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"DropGenes", "[", 
    RowBox[{
     RowBox[{"p", ":", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", "___", "}"}], "..."}], "}"}]}], ",", "P_SparseArray", 
     ",", "opts___Rule"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"R", "=", 
       RowBox[{
        RowBox[{"Map", "/.", 
         RowBox[{"{", "opts", "}"}]}], "/.", 
        RowBox[{"Options", "[", "DropGenes", "]"}]}]}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"Mendel", "[", "R", "]"}], "[", 
        RowBox[{"p", "\[LeftDoubleBracket]", "#", "\[RightDoubleBracket]"}], 
        "]"}], "&"}], "/@", 
      RowBox[{"Parents", "[", "P", "]"}]}]}], "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.667538833657012*^9, 3.667538929944538*^9}, {
   3.667538963598817*^9, 3.667538964613865*^9}, 3.691982758352428*^9},
 CellLabel->
  "In[357]:=",ExpressionUUID->"00fcf2d7-10df-448b-acc4-a0ddc0cafde8"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"DropGenes", "[", 
    RowBox[{
     RowBox[{"p0", ":", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", "___", "}"}], "..."}], "}"}]}], ",", 
     RowBox[{"Pl", ":", 
      RowBox[{"{", "___SparseArray", "}"}]}], ",", "opts___Rule"}], "]"}], ":=", 
   RowBox[{"FoldList", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"DropGenes", "[", 
       RowBox[{"#1", ",", "#2", ",", "opts"}], "]"}], "&"}], ",", " ", "p0", 
     ",", " ", "Pl"}], "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.667538978789452*^9, 3.6675389880691032`*^9}},
 CellLabel->
  "In[358]:=",ExpressionUUID->"6de8c097-bfb2-4f78-b68d-e8b5c86f18d7"]
}, Closed]],

Cell[CellGroupData[{

Cell["DropGenesDiploid ", "Subsubsection",
 InitializationCell->True,
 CellChangeTimes->{{3.6919086906509666`*^9, 3.691908692033594*^9}, {
   3.69192887672196*^9, 3.691928879640168*^9}, 
   3.691982146367844*^9},ExpressionUUID->"8242773b-6ae0-4bb3-aa2b-\
af0c452c7f22"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"DropGenesDiploid", "::", "usage"}], "=", 
   "\"\<DropGenesDiploid[p,P] generates random diploid genotypes, given the \
pedigree P, and starting with a diploid population p; uses Mendel[]. \
DropGenesDiploid[p0,{P1,\[Ellipsis]}] does the same for many generations. \
Map->R allows for linkage on a linear map of length R. \
DropGenesDiploid[p,P,z,\[Theta]] selects  within families, conditional on the \
pedigree. For every distinct pair of parents, which have j surviving \
offspring, Round[j/\[Theta]] are generated, and their phenotypes calculated \
using the function z[{{0,\[Ellipsis]},{1,\[Ellipsis]}}], which includes a \
random environmental component. The largest values are chosen to survive. \
DropGenesDiploid[p0,{P1,\[Ellipsis]},z,\[Theta]] does the same for many \
generations. DropGenesDiploid[{pop,{\!\(\*SubscriptBox[\(z\), \(1\)]\),\
\[Ellipsis]},{{\!\(\*SubscriptBox[\(F\), \(1, \
1\)]\),\[Ellipsis]},\[Ellipsis]}},P,\!\(\*SubscriptBox[\(V\), \(s\)]\),z,\
\[Theta]] includes an infinitesimal background, which is held in the vector {\
\!\(\*SubscriptBox[\(z\), \(1\)]\),\[Ellipsis]}. Offspring are generated \
using the function z[], which includes the environmental component and the \
chromosomal component, \!\(\*StyleBox[\"plus\",FontSlant->\"Italic\"]\) the \
infinitesimal component, which is normally distributed around the midparent, \
with segregation variance \!\(\*SubscriptBox[\(V\), \
\(s\)]\)(1-\!\(\*OverscriptBox[\(F\), \(_\)]\)). Returns the new \
{p,{\!\(\*SubscriptBox[\(z\), \
\(1\)]\),\[Ellipsis]},{{\!\(\*SubscriptBox[\(F\), \(1, 1\)]\),\[Ellipsis]},\
\[Ellipsis]}}. DropGenesDiploid[{p0,{\!\(\*SubscriptBox[\(z\), \(1\)]\),\
\[Ellipsis]},{{\!\(\*SubscriptBox[\(F\), \(1, \
1\)]\),\[Ellipsis]},\[Ellipsis]}},{P1,\[Ellipsis]},\[Ellipsis]},\!\(\*\
SubscriptBox[\(V\), \(s\)]\),z,\[Theta]] does the same for many generations. \
Note: this algorithm does not record the actual trait values - the \
environmental contribution generated by z is lost.\!\(\*StyleBox[\" \
\",FontWeight->\"Plain\"]\)\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6675386045155067`*^9, 3.6675386149526987`*^9}, {
   3.667538791460452*^9, 3.667538797442479*^9}, {3.691906798053582*^9, 
   3.6919067994442244`*^9}, {3.69190868658792*^9, 3.6919087195298986`*^9}, 
   3.6919088588743877`*^9, {3.692016301586026*^9, 3.692016482875176*^9}, {
   3.692433594403454*^9, 3.692433641203043*^9}, {3.692433677722492*^9, 
   3.6924338216425667`*^9}, {3.6924368337339573`*^9, 3.692436848211557*^9}, {
   3.692505481674611*^9, 3.692505526776856*^9}, {3.692777546695199*^9, 
   3.692777626730526*^9}, {3.692777666463048*^9, 3.6927776668170843`*^9}, {
   3.6927937078286657`*^9, 3.692793795945076*^9}},
 CellLabel->
  "In[359]:=",ExpressionUUID->"e79108bb-9701-4f9f-b5e0-451957d34045"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "DropGenesDiploid", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{"Map", "\[Rule]", "\[Infinity]"}], "}"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6675386045155067`*^9, 3.6675386149526987`*^9}, {
   3.667538791460452*^9, 3.667538797442479*^9}, {3.667538869333138*^9, 
   3.667538880579741*^9}, 3.691982689604506*^9},
 CellLabel->
  "In[360]:=",ExpressionUUID->"9c99a9d3-c547-4483-845b-b03f8d591e90"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"DropGenesDiploid", "[", 
    RowBox[{
     RowBox[{"p", ":", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", "___", "}"}], "..."}], "}"}]}], ",", "P_SparseArray", 
     ",", "opts___Rule"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"R", "=", 
       RowBox[{
        RowBox[{"Map", "/.", 
         RowBox[{"{", "opts", "}"}]}], "/.", 
        RowBox[{"Options", "[", "DropGenesDiploid", "]"}]}]}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{
          RowBox[{"Mendel", "[", "R", "]"}], "[", 
          RowBox[{"p", "\[LeftDoubleBracket]", 
           RowBox[{
           "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
           "\[RightDoubleBracket]"}], "]"}], ",", 
         RowBox[{
          RowBox[{"Mendel", "[", "R", "]"}], "[", 
          RowBox[{"p", "\[LeftDoubleBracket]", 
           RowBox[{
           "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
           "\[RightDoubleBracket]"}], "]"}]}], "}"}], "&"}], "/@", 
      RowBox[{"Parents", "[", "P", "]"}]}]}], "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.667538833657012*^9, 3.667538929944538*^9}, {
   3.667538963598817*^9, 3.667538964613865*^9}, 3.6919826916607933`*^9, {
   3.691982771727373*^9, 3.6919827770150967`*^9}, {3.691982870899932*^9, 
   3.691982896968453*^9}},
 CellLabel->
  "In[361]:=",ExpressionUUID->"8b163894-122c-4aa1-a520-b7588dfca165"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"DropGenesDiploid", "[", 
    RowBox[{
     RowBox[{"p", ":", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", "___", "}"}], "..."}], "}"}]}], ",", "P_SparseArray", 
     ",", "z_", ",", "\[Theta]_", ",", "opts___Rule"}], "]"}], ":=", 
   "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"R", "=", 
        RowBox[{
         RowBox[{"Map", "/.", 
          RowBox[{"{", "opts", "}"}]}], "/.", 
         RowBox[{"Options", "[", "DropGenesDiploid", "]"}]}]}], ",", 
       RowBox[{"pars", "=", 
        RowBox[{"Union", "[", 
         RowBox[{"Parents", "[", "P", "]"}], "]"}]}], ",", "kids", ",", "nn", 
       ",", "nk", ",", "zk", ",", "zt", ",", "fn", ",", "newkids"}], "}"}], 
     ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"kids", "=", 
       RowBox[{"Flatten", "/@", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"Position", "[", 
            RowBox[{
             RowBox[{"Parents", "[", "P", "]"}], ",", "#"}], "]"}], "&"}], "/@",
           "pars"}], ")"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"fn", "[", "xt_", "]"}], "[", "x_", "]"}], ":=", 
       RowBox[{"(", 
        RowBox[{"x", "\[GreaterEqual]", "xt"}], ")"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"newkids", "=", 
       RowBox[{"MapThread", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"(", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"nn", "=", 
             RowBox[{"Round", "[", 
              RowBox[{
               RowBox[{"Length", "[", "#1", "]"}], "/", "\[Theta]"}], "]"}]}],
             ";", "\[IndentingNewLine]", 
            RowBox[{"nk", "=", 
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{
                  RowBox[{"Mendel", "[", "R", "]"}], "[", 
                  RowBox[{"p", "\[LeftDoubleBracket]", 
                   RowBox[{
                   "#2", "\[LeftDoubleBracket]", "1", 
                    "\[RightDoubleBracket]"}], "\[RightDoubleBracket]"}], 
                  "]"}], ",", 
                 RowBox[{
                  RowBox[{"Mendel", "[", "R", "]"}], "[", 
                  RowBox[{"p", "\[LeftDoubleBracket]", 
                   RowBox[{
                   "#2", "\[LeftDoubleBracket]", "2", 
                    "\[RightDoubleBracket]"}], "\[RightDoubleBracket]"}], 
                  "]"}]}], "}"}], ",", 
               RowBox[{"{", "nn", "}"}]}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"zk", "=", 
             RowBox[{"z", "/@", "nk"}]}], ";", 
            RowBox[{"zt", "=", 
             RowBox[{
              RowBox[{"Sort", "[", "zk", "]"}], "\[LeftDoubleBracket]", 
              RowBox[{"-", 
               RowBox[{"Length", "[", "#1", "]"}]}], 
              "\[RightDoubleBracket]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"Pick", "[", 
             RowBox[{"nk", ",", 
              RowBox[{
               RowBox[{"fn", "[", "zt", "]"}], "/@", "zk"}]}], "]"}]}], ")"}],
           "&"}], ",", 
         RowBox[{"{", 
          RowBox[{"kids", ",", "pars"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Last", "/@", 
       RowBox[{"Sort", "[", 
        RowBox[{"Transpose", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Flatten", "[", "kids", "]"}], ",", 
           RowBox[{"Flatten", "[", 
            RowBox[{"newkids", ",", "1"}], "]"}]}], "}"}], "]"}], "]"}]}]}]}],
     "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.667538833657012*^9, 3.667538929944538*^9}, {
   3.667538963598817*^9, 3.667538964613865*^9}, 3.6919826916607933`*^9, {
   3.691982771727373*^9, 3.6919827770150967`*^9}, {3.691982870899932*^9, 
   3.691982896968453*^9}, {3.692016531289781*^9, 3.6920165832455473`*^9}, {
   3.6920166566000423`*^9, 3.692016689271001*^9}, {3.6920194825393333`*^9, 
   3.692019684216501*^9}, {3.6920197187911587`*^9, 3.692019719455627*^9}, {
   3.692019756844923*^9, 3.692019814657701*^9}, {3.692019856677642*^9, 
   3.692019858623295*^9}, {3.692020304047558*^9, 3.692020318909976*^9}},
 CellLabel->
  "In[362]:=",ExpressionUUID->"e9703639-bcf8-43ae-b1bf-eae174efbe82"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"DropGenesDiploid", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"p", ":", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", "___", "}"}], "..."}], "}"}]}], ",", 
       RowBox[{"zi", ":", 
        RowBox[{"(", 
         RowBox[{"_SparseArray", "|", "_List"}], ")"}]}], ",", 
       RowBox[{"F", ":", 
        RowBox[{"(", 
         RowBox[{"_SparseArray", "|", "_List"}], ")"}]}]}], "}"}], ",", 
     "P_SparseArray", ",", "Vs_", ",", "z_", ",", "\[Theta]_", ",", 
     "opts___Rule"}], "]"}], ":=", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"R", "=", 
        RowBox[{
         RowBox[{"Map", "/.", 
          RowBox[{"{", "opts", "}"}]}], "/.", 
         RowBox[{"Options", "[", "DropGenesDiploid", "]"}]}]}], ",", "pars", 
       ",", "kids", ",", "nn", ",", "nk", ",", "zk", ",", "zt", ",", "fn", 
       ",", "newkids", ",", "newzi", ",", "fd", ",", "sel", ",", "newpz", ",",
        "vsf"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"fd", "=", 
       RowBox[{"Tr", "[", 
        RowBox[{"F", ",", "List"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"pars", "=", 
       RowBox[{"Union", "[", 
        RowBox[{"Sort", "/@", 
         RowBox[{"Parents", "[", "P", "]"}]}], "]"}]}], ";", 
      RowBox[{"(*", " ", 
       RowBox[{"list", " ", "all", " ", "distinct", " ", "families"}], " ", 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{"kids", "=", 
       RowBox[{"Flatten", "/@", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"Position", "[", 
            RowBox[{
             RowBox[{"Parents", "[", "P", "]"}], ",", "#"}], "]"}], "&"}], "/@",
           "pars"}], ")"}]}]}], ";", 
      RowBox[{"(*", 
       RowBox[{
       "list", " ", "the", " ", "kids", " ", "from", " ", "each", " ", "of", 
        " ", "the", " ", "distinct", " ", 
        RowBox[{"families", ".", " ", "These"}], " ", "will", " ", "each", 
        " ", "be", " ", "selected", " ", "from", " ", "a", " ", "larger", " ",
         "#", " ", "of", " ", "kids"}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"fn", "[", "xt_", "]"}], "[", "x_", "]"}], ":=", 
       RowBox[{"(", 
        RowBox[{"x", "\[GreaterEqual]", "xt"}], ")"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"newkids", "=", 
       RowBox[{"MapThread", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{"(*", " ", 
            RowBox[{
             RowBox[{
             "run", " ", "through", " ", "all", " ", "the", " ", "families"}],
              ",", " ", 
             RowBox[{
             "selecting", " ", "the", " ", "new", " ", "kids", " ", "and", 
              " ", "the", " ", "new", " ", "infinitesimal", " ", 
              "background"}]}], "*)"}], "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"nn", "=", 
             RowBox[{"Round", "[", 
              RowBox[{
               RowBox[{"Length", "[", "#1", "]"}], "/", "\[Theta]"}], "]"}]}],
             ";", 
            RowBox[{"(*", " ", 
             RowBox[{
             "total", " ", "#", " ", "of", " ", "kids", " ", "for", " ", 
              "this", " ", "family"}], " ", "*)"}], "\[IndentingNewLine]", 
            RowBox[{"nk", "=", 
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{
                  RowBox[{"Mendel", "[", "R", "]"}], "[", 
                  RowBox[{"p", "\[LeftDoubleBracket]", 
                   RowBox[{
                   "#2", "\[LeftDoubleBracket]", "1", 
                    "\[RightDoubleBracket]"}], "\[RightDoubleBracket]"}], 
                  "]"}], ",", 
                 RowBox[{
                  RowBox[{"Mendel", "[", "R", "]"}], "[", 
                  RowBox[{"p", "\[LeftDoubleBracket]", 
                   RowBox[{
                   "#2", "\[LeftDoubleBracket]", "2", 
                    "\[RightDoubleBracket]"}], "\[RightDoubleBracket]"}], 
                  "]"}]}], "}"}], ",", 
               RowBox[{"{", "nn", "}"}]}], "]"}]}], ";", 
            RowBox[{"(*", " ", 
             RowBox[{
             "generate", " ", "the", " ", "children", " ", "by", " ", 
              "combining", " ", "gametes", " ", "from", " ", "the", " ", 
              "two", " ", "parents"}], " ", "*)"}], "\[IndentingNewLine]", 
            RowBox[{"zk", "=", 
             RowBox[{"(", 
              RowBox[{"z", "/@", "nk"}], ")"}]}], ";", 
            RowBox[{"(*", " ", 
             RowBox[{
              RowBox[{
              "calculate", " ", "trait", " ", "contribution", " ", "for", " ",
                "the", " ", "chromosome"}], ",", " ", "R"}], "*)"}], 
            "\[IndentingNewLine]", 
            RowBox[{"vsf", "=", 
             RowBox[{"Vs", " ", 
              RowBox[{"(", 
               RowBox[{"1", "-", 
                RowBox[{"Mean", "[", 
                 RowBox[{
                 "fd", "\[LeftDoubleBracket]", "#2", 
                  "\[RightDoubleBracket]"}], "]"}]}], ")"}]}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"newzi", "=", 
             RowBox[{
              RowBox[{"Mean", "[", 
               RowBox[{
               "zi", "\[LeftDoubleBracket]", "#2", "\[RightDoubleBracket]"}], 
               "]"}], "+", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"vsf", "\[Equal]", "0"}], ",", "0", ",", 
                RowBox[{"RandomReal", "[", 
                 RowBox[{
                  RowBox[{"NormalDistribution", "[", 
                   RowBox[{"0", ",", 
                    SqrtBox["vsf"]}], "]"}], ",", "nn"}], "]"}]}], "]"}]}]}], 
            ";", 
            RowBox[{"(*", 
             RowBox[{
             "generate", " ", "the", " ", "infinitesimal", " ", 
              "background"}], " ", "*)"}], "\[IndentingNewLine]", 
            RowBox[{"zt", "=", 
             RowBox[{
              RowBox[{"Sort", "[", 
               RowBox[{"zk", "+", "newzi"}], "]"}], "\[LeftDoubleBracket]", 
              RowBox[{"-", 
               RowBox[{"Length", "[", "#1", "]"}]}], 
              "\[RightDoubleBracket]"}]}], ";", 
            RowBox[{"(*", " ", 
             RowBox[{
             "find", " ", "the", " ", "threshold", " ", "for", " ", 
              "truncation", " ", "selection"}], " ", "*)"}], 
            "\[IndentingNewLine]", 
            RowBox[{"sel", "=", 
             RowBox[{
              RowBox[{"fn", "[", "zt", "]"}], "/@", 
              RowBox[{"(", 
               RowBox[{"zk", "+", "newzi"}], ")"}]}]}], ";", 
            RowBox[{"(*", " ", 
             RowBox[{
              RowBox[{
              "choose", " ", "which", " ", "kids", " ", "will", " ", "be", 
               " ", "selected"}], ",", " ", 
              RowBox[{
              "based", " ", "on", " ", "the", " ", "sum", " ", "of", " ", 
               "the", " ", "chromosomal", " ", "contribution", " ", "and", 
               " ", "the", " ", "background"}]}], " ", "*)"}], 
            "\[IndentingNewLine]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Pick", "[", 
               RowBox[{"nk", ",", "sel"}], "]"}], ",", 
              RowBox[{"Pick", "[", 
               RowBox[{"newzi", ",", "sel"}], "]"}]}], "}"}]}], ")"}], "&"}], 
         ",", 
         RowBox[{"{", 
          RowBox[{"kids", ",", "pars"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"return", " ", "the", " ", "new", " ", 
         RowBox[{"{", 
          RowBox[{"p", ",", "z", ",", "F"}], "}"}]}], ",", " ", 
        RowBox[{
        "making", " ", "sure", " ", "that", " ", "the", " ", "order", " ", 
         "corresponds", " ", "to", " ", "the", " ", "list", " ", "of", " ", 
         "kids", " ", "in", " ", "the", " ", "pedigree"}]}], " ", "*)"}], 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
        "find", " ", "the", " ", "new", " ", "F", " ", "amongst", " ", "the", 
         " ", "kids"}], " ", "-", " ", 
        RowBox[{"note", " ", "P", " ", "has", " ", "entries", " ", 
         RowBox[{"{", "\[Ellipsis]1\[Ellipsis]1\[Ellipsis]", "}"}]}]}], 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{"Append", "[", 
       RowBox[{
        RowBox[{"Drop", "[", 
         RowBox[{
          RowBox[{"Transpose", "[", 
           RowBox[{"Sort", "[", 
            RowBox[{"Transpose", "[", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"Flatten", "[", "kids", "]"}], ",", 
               RowBox[{"Flatten", "[", 
                RowBox[{
                 RowBox[{"newkids", "\[LeftDoubleBracket]", 
                  RowBox[{"All", ",", "1"}], "\[RightDoubleBracket]"}], ",", 
                 "1"}], "]"}], ",", 
               RowBox[{"Flatten", "[", 
                RowBox[{
                 RowBox[{"newkids", "\[LeftDoubleBracket]", 
                  RowBox[{"All", ",", "2"}], "\[RightDoubleBracket]"}], ",", 
                 "1"}], "]"}]}], "}"}], "]"}], "]"}], "]"}], ",", "1"}], 
         "]"}], ",", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"P", ".", 
           RowBox[{"(", 
            RowBox[{"F", "+", 
             RowBox[{"DiagonalMatrix", "[", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"1", "-", "fd"}], ")"}], "/", "2"}], "]"}]}], ")"}], 
           ".", 
           RowBox[{"Transpose", "[", "P", "]"}]}], ")"}], "/", "4"}]}], 
       "]"}]}]}], "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.667538833657012*^9, 3.667538929944538*^9}, {
   3.667538963598817*^9, 3.667538964613865*^9}, 3.6919826916607933`*^9, {
   3.691982771727373*^9, 3.6919827770150967`*^9}, {3.691982870899932*^9, 
   3.691982896968453*^9}, {3.692016531289781*^9, 3.6920165832455473`*^9}, {
   3.6920166566000423`*^9, 3.692016689271001*^9}, {3.6920194825393333`*^9, 
   3.692019684216501*^9}, {3.6920197187911587`*^9, 3.692019719455627*^9}, {
   3.692019756844923*^9, 3.692019814657701*^9}, {3.692019856677642*^9, 
   3.692019858623295*^9}, {3.692020304047558*^9, 3.692020318909976*^9}, {
   3.6924338332133017`*^9, 3.692433845042138*^9}, {3.692436950777597*^9, 
   3.6924369602782307`*^9}, {3.6924370030377083`*^9, 
   3.6924370032921867`*^9}, {3.692437236942505*^9, 3.692437318292788*^9}, {
   3.692437359830422*^9, 3.6924373717709627`*^9}, {3.69245474395648*^9, 
   3.6924547576655493`*^9}, {3.692455798434577*^9, 3.692455822395589*^9}, {
   3.692455864503039*^9, 3.692455869481414*^9}, {3.692505347088799*^9, 
   3.6925053476569757`*^9}, 3.692505431364753*^9, {3.692505534309514*^9, 
   3.6925055527319937`*^9}, {3.692777701968698*^9, 3.6927777049053917`*^9}, {
   3.6927921954944267`*^9, 3.692792299567438*^9}, {3.692792343972632*^9, 
   3.6927923966950283`*^9}, {3.6927924543641977`*^9, 
   3.6927925543014183`*^9}, {3.692792600135681*^9, 3.692792627369739*^9}, {
   3.6927933792908916`*^9, 3.692793387652047*^9}, {3.692793424966074*^9, 
   3.6927934738488407`*^9}, {3.692793539102133*^9, 3.692793540405376*^9}, {
   3.692793591633626*^9, 3.692793693662222*^9}, {3.6927940601304283`*^9, 
   3.6927942217608013`*^9}, {3.692794378231843*^9, 3.692794438617622*^9}, {
   3.692794478091794*^9, 3.692794480490116*^9}, {3.69279451884709*^9, 
   3.692794613248248*^9}, {3.692794686290906*^9, 3.692794730538795*^9}, {
   3.692795247486623*^9, 3.692795265860965*^9}, {3.692795296300028*^9, 
   3.692795299491096*^9}, {3.692795399176524*^9, 3.692795404295373*^9}, {
   3.692795483196252*^9, 3.692795544966769*^9}, {3.69280504165911*^9, 
   3.692805056511922*^9}, {3.692805128061509*^9, 3.692805182082822*^9}, {
   3.699670926405772*^9, 3.699670951323655*^9}},
 CellLabel->
  "In[363]:=",ExpressionUUID->"599dda00-cc05-4e90-a27b-c9c5aa49531f"],

Cell[BoxData[
 GraphicsBox[
  TagBox[RasterBox[CompressedData["
1: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
AAAAAAAAAAAAAAAAAAAAgC//H2al/6E=
    "], {{0, 158}, {815, 0}}, {0, 255},
    ColorFunction->RGBColor],
   BoxForm`ImageTag["Byte", ColorSpace -> "RGB", Interleaving -> True],
   Selectable->False],
  DefaultBaseStyle->"ImageGraphics",
  ImageSize->{665.2874999999995, Automatic},
  ImageSizeRaw->{815, 158},
  PlotRange->{{0, 815}, {0, 158}}]], "Input",ExpressionUUID->"40a5bee7-78d2-\
47f3-b6b3-a6f00d4b5054"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"DropGenesDiploid", "[", 
    RowBox[{
     RowBox[{"p0", ":", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", "___", "}"}], "..."}], "}"}]}], ",", 
     RowBox[{"Pl", ":", 
      RowBox[{"{", "___SparseArray", "}"}]}], ",", "opts___Rule"}], "]"}], ":=", 
   RowBox[{"FoldList", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"DropGenesDiploid", "[", 
       RowBox[{"#1", ",", "#2", ",", "opts"}], "]"}], "&"}], ",", " ", "p0", 
     ",", " ", "Pl"}], "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.667538978789452*^9, 3.6675389880691032`*^9}, {
  3.691982780255022*^9, 3.6919827819269342`*^9}},
 CellLabel->
  "In[364]:=",ExpressionUUID->"a43ff084-ea14-4615-a5ec-afaa3b61e5b2"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"DropGenesDiploid", "[", 
    RowBox[{
     RowBox[{"p0", ":", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", "___", "}"}], "..."}], "}"}]}], ",", 
     RowBox[{"Pl", ":", 
      RowBox[{"{", "___SparseArray", "}"}]}], ",", "z_", ",", "\[Theta]_", 
     ",", "opts___Rule"}], "]"}], ":=", 
   RowBox[{"FoldList", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"DropGenesDiploid", "[", 
       RowBox[{"#1", ",", "#2", ",", "z", ",", "\[Theta]", ",", "opts"}], 
       "]"}], "&"}], ",", " ", "p0", ",", " ", "Pl"}], "]"}]}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.667538978789452*^9, 3.6675389880691032`*^9}, {
  3.691982780255022*^9, 3.6919827819269342`*^9}, {3.69201650281045*^9, 
  3.692016515888678*^9}, {3.6925056050271893`*^9, 3.692505629976997*^9}, {
  3.69250568443572*^9, 3.69250568844174*^9}},
 CellLabel->
  "In[365]:=",ExpressionUUID->"c33b7fef-3d73-403a-92a3-f8f6064fc6c3"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"DropGenesDiploid", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"p0", ":", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", "___", "}"}], "..."}], "}"}]}], ",", 
       RowBox[{"zi", ":", 
        RowBox[{"(", 
         RowBox[{"_SparseArray", "|", "_List"}], ")"}]}], ",", 
       RowBox[{"F", ":", 
        RowBox[{"(", 
         RowBox[{"_SparseArray", "|", "_List"}], ")"}]}]}], "}"}], ",", 
     RowBox[{"Pl", ":", 
      RowBox[{"{", "___SparseArray", "}"}]}], ",", "Vs_", ",", "z_", ",", 
     "\[Theta]_", ",", "opts___Rule"}], "]"}], ":=", 
   RowBox[{"FoldList", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"DropGenesDiploid", "[", 
       RowBox[{
       "#1", ",", "#2", ",", "Vs", ",", "z", ",", "\[Theta]", ",", "opts"}], 
       "]"}], "&"}], ",", 
     RowBox[{"{", 
      RowBox[{"p0", ",", "zi", ",", "F"}], "}"}], ",", " ", "Pl"}], "]"}]}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.667538978789452*^9, 3.6675389880691032`*^9}, {
  3.691982780255022*^9, 3.6919827819269342`*^9}, {3.69201650281045*^9, 
  3.692016515888678*^9}, {3.6925056050271893`*^9, 3.692505629976997*^9}, {
  3.692505721186942*^9, 3.692505764898075*^9}, {3.692793983607205*^9, 
  3.6927940062753572`*^9}},
 CellLabel->
  "In[366]:=",ExpressionUUID->"cc755fe5-3613-416c-8439-cbaa5333f618"]
}, Closed]],

Cell[CellGroupData[{

Cell["iterateDiploidNew", "Subsubsection",
 InitializationCell->True,
 CellChangeTimes->{{3.6919086906509666`*^9, 3.691908692033594*^9}, {
   3.69192887672196*^9, 3.691928879640168*^9}, 3.691982146367844*^9, {
   3.6928628486914597`*^9, 3.692862850107448*^9}, {3.693367567699984*^9, 
   3.6933675709318132`*^9}, {3.6983029707237988`*^9, 
   3.698302971250799*^9}},ExpressionUUID->"03c8e6d6-3fb4-400f-b000-\
2a84ddf73058"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"iterateDiploidNew", "::", "usage"}], "=", 
   "\"\<iterateDiploidNew[\[ScriptCapitalP],P,{{\!\(\*SubscriptBox[\(n\), \
\(sons\)]\),\!\(\*SubscriptBox[\(n\), \
\(daughters\)]\)}\[Ellipsis]},{\!\(\*SubscriptBox[\(sex\), \(1\)]\),\
\[Ellipsis]},\!\(\*SubscriptBox[\(V\), \(s\)]\),\!\(\*SubscriptBox[\(V\), \(e\
\)]\),z,R] extends the simulation \[ScriptCapitalP] by one generation, given \
the pedigree matrix P, and the # of sons and daughters, from each family as \
generated by distinctParents[P]. The sexes of each of the selected offspring \
must also be given, ordered as in the offspring from P. If \
{{\!\(\*SubscriptBox[\(n\), \(sons\)]\),\!\(\*SubscriptBox[\(n\), \(daughters\
\)]\)}\[Ellipsis]},{\!\(\*SubscriptBox[\(sex\), \(1\)]\),\[Ellipsis]} are \
omitted, then the kids are drawn randomly. The pedigree is a sparse array. \
Starts with a diploid population represented by the last elements of pop[\
\[ScriptCapitalP]],junctions[\[ScriptCapitalP]],zInf[\[ScriptCapitalP]],zEnv[\
\[ScriptCapitalP]],F[\[ScriptCapitalP]].  Each generation of pop[\
\[ScriptCapitalP]] is a list of diploid genotypes at discrete loci with \
allelic states 0 or 1. Similarly, junctions[\[ScriptCapitalP]] lists diploid \
genomes, each described by their junctions, {\!\(\*SubscriptBox[\(j\), \(1\)]\
\),\[Ellipsis]}, representing a continuous genome, length R. Information \
about junctions is held in locJ[\[ScriptCapitalP]], hapJ[\[ScriptCapitalP]], \
originJ[\[ScriptCapitalP]]. There is an infinitesimal background, zInf[\
\[ScriptP]], represented by breeding values. Identity by descent, F[\
\[ScriptCapitalP]], is calculated from the pedigree.  Selection is within \
families, conditional on the pedigree, and made by choosing the best male and \
the best female from each family. Phenotypes are calculated using the \
function z[{{0,\[Ellipsis]},{1,\[Ellipsis]}}], which does NOT include a \
random environmental component, and adding the infinitesimal component, from \
{\!\(\*SubscriptBox[\(z\), \(1\)]\),\[Ellipsis]}. The infinitesimal component \
is normally distributed around the midparent, with segregation variance \
\!\(\*SubscriptBox[\(V\), \(s\)]\)(1-\!\(\*OverscriptBox[\(F\), \(_\)]\)), \!\
\(\*OverscriptBox[\(F\), \(_\)]\) being the mean F between distinct genes \
within the parents. iterateDiploidNew[\[ScriptCapitalP],P,\!\(\*SubscriptBox[\
\(V\), \(s\)]\),z,\[Theta],R] makes no selection, by setting the # of sons \
and daughters to the # selected. \
iterateDiploid[\[ScriptCapitalP],{\!\(\*SubscriptBox[\(P\), \(1\)]\),\
\[Ellipsis]},{\!\(\*SubscriptBox[\(nK\), \
\(1\)]\),\[Ellipsis]},{\!\(\*SubscriptBox[\(sex\), \(1\)]\),\[Ellipsis]},\!\(\
\*SubscriptBox[\(V\), \(s\)]\),z] or \
iterateDiploid[\[ScriptCapitalP],{\!\(\*SubscriptBox[\(P\), \(1\)]\),\
\[Ellipsis]},\!\(\*SubscriptBox[\(V\), \(s\)]\),z] iterates for many \
generations, adding to pop[\[ScriptCapitalP]], junctions[\[ScriptCapitalP]], \
zInf[\[ScriptCapitalP]], F[\[ScriptCapitalP]], and storing pedigreeList[\
\[ScriptCapitalP]]={\!\(\*SubscriptBox[\(P\), \(1\)]\),\[Ellipsis]}. Trait \
values are recorded in zKids[\[ScriptCapitalP]], in the form \
{{sons,daughters},\[Ellipsis]}, the list being organised according to the \
families defined by distinctParents[P]. Each is divided into three \
components. Mutations\[Rule]U allows for infinite-sites mutation at rate U \
per haploid genome. Locations are stored in locM[\[ScriptCapitalP]], and the \
neutral mutations carried by an individual by mutations[\[ScriptCapitalP]], \
which is treated like junctions[\[ScriptCapitalP]]\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6675386045155067`*^9, 3.6675386149526987`*^9}, {
   3.667538791460452*^9, 3.667538797442479*^9}, {3.691906798053582*^9, 
   3.6919067994442244`*^9}, {3.69190868658792*^9, 3.6919087195298986`*^9}, 
   3.6919088588743877`*^9, {3.692016301586026*^9, 3.692016482875176*^9}, {
   3.692433594403454*^9, 3.692433641203043*^9}, {3.692433677722492*^9, 
   3.6924338216425667`*^9}, {3.6924368337339573`*^9, 3.692436848211557*^9}, {
   3.692505481674611*^9, 3.692505526776856*^9}, {3.692777546695199*^9, 
   3.692777626730526*^9}, {3.692777666463048*^9, 3.6927776668170843`*^9}, {
   3.6927937078286657`*^9, 3.692793795945076*^9}, {3.69286285312022*^9, 
   3.692863070905595*^9}, {3.692863198909171*^9, 3.692863288481285*^9}, {
   3.692863320172968*^9, 3.692863461727201*^9}, {3.692863563995429*^9, 
   3.692863569631765*^9}, {3.692863965460837*^9, 3.692864083030568*^9}, {
   3.692864277584635*^9, 3.6928642824947643`*^9}, {3.692867996629299*^9, 
   3.692868029747164*^9}, {3.6930612864500237`*^9, 3.6930613163132563`*^9}, {
   3.6930613594882*^9, 3.69306150382259*^9}, {3.693279678712373*^9, 
   3.693279679294909*^9}, {3.693280202264105*^9, 3.69328037583566*^9}, {
   3.693280728253373*^9, 3.6932807903130713`*^9}, {3.693280880193718*^9, 
   3.693280881801025*^9}, {3.693280917281805*^9, 3.693281015310154*^9}, {
   3.693281075261157*^9, 3.6932810871990833`*^9}, {3.693281158587203*^9, 
   3.693281166667367*^9}, {3.693282214261389*^9, 3.693282426318266*^9}, {
   3.6932824868531427`*^9, 3.693282546011204*^9}, {3.6932829570641336`*^9, 
   3.693282962112606*^9}, {3.693367574251128*^9, 3.6933675796435843`*^9}, {
   3.69336761500651*^9, 3.693367631508881*^9}, {3.69337309095022*^9, 
   3.693373092644497*^9}, {3.693373220717763*^9, 3.693373315329618*^9}, {
   3.693457971849574*^9, 3.693458011241437*^9}, {3.6983029834157057`*^9, 
   3.698302984625325*^9}, {3.698310633848592*^9, 3.6983109503685904`*^9}, {
   3.6983113194883957`*^9, 3.698311430180357*^9}, {3.698314889102561*^9, 
   3.698315001834187*^9}, {3.698315059218362*^9, 3.698315157862578*^9}, {
   3.698317153463135*^9, 3.698317153845022*^9}, {3.698317433279323*^9, 
   3.698317436143517*^9}, {3.6983861703422117`*^9, 3.6983862210188*^9}, {
   3.698386265033369*^9, 3.698386288009901*^9}, {3.700632942588983*^9, 
   3.700632974897072*^9}, {3.700633111629842*^9, 3.700633145786688*^9}, {
   3.700635976053361*^9, 3.700635977676786*^9}, {3.700657137130766*^9, 
   3.7006571604433727`*^9}, {3.700709361872972*^9, 3.700709383222824*^9}},
 CellLabel->
  "In[367]:=",ExpressionUUID->"f6903759-f947-4d8f-8191-2d7e626b1ec5"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "iterateDiploidNew", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{"mutationRate", "\[Rule]", "0"}], "}"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.700633167724231*^9, 3.700633185954278*^9}},
 CellLabel->
  "In[368]:=",ExpressionUUID->"0acef82c-2af5-4e29-9667-dd0dbeb3b9dc"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"iterateDiploidNew", "[", 
    RowBox[{"\[ScriptCapitalP]_", ",", "P_SparseArray", ",", 
     RowBox[{"nK", ":", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"_Integer", ",", "_Integer"}], "}"}], "..."}], "}"}]}], ",", 
     
     RowBox[{"sx", ":", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"0", "|", "1"}], ")"}], "..."}], "}"}]}], ",", "Vs_", ",", 
     "Ve_", ",", "z_", ",", "R_", ",", "opts___Rule"}], "]"}], ":=", 
   "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"p", "=", 
        RowBox[{
         RowBox[{"pop", "[", "\[ScriptCapitalP]", "]"}], 
         "\[LeftDoubleBracket]", 
         RowBox[{"-", "1"}], "\[RightDoubleBracket]"}]}], ",", 
       RowBox[{"zi", "=", 
        RowBox[{
         RowBox[{"zInf", "[", "\[ScriptCapitalP]", "]"}], 
         "\[LeftDoubleBracket]", 
         RowBox[{"-", "1"}], "\[RightDoubleBracket]"}]}], ",", 
       RowBox[{"mut", "=", 
        RowBox[{
         RowBox[{"mutations", "[", "\[ScriptCapitalP]", "]"}], 
         "\[LeftDoubleBracket]", 
         RowBox[{"-", "1"}], "\[RightDoubleBracket]"}]}], ",", 
       RowBox[{"jun", "=", 
        RowBox[{
         RowBox[{"junctions", "[", "\[ScriptCapitalP]", "]"}], 
         "\[LeftDoubleBracket]", 
         RowBox[{"-", "1"}], "\[RightDoubleBracket]"}]}], ",", 
       RowBox[{"f", "=", 
        RowBox[{
         RowBox[{"F", "[", "\[ScriptCapitalP]", "]"}], "\[LeftDoubleBracket]", 
         RowBox[{"-", "1"}], "\[RightDoubleBracket]"}]}], ",", "fd", ",", 
       "f1", ",", "fii", ",", "fij", ",", "pars", ",", "kids", ",", "nn", ",",
        "nk", ",", "nKs", ",", "zk", ",", "zt", ",", "ze", ",", "newkids", 
       ",", "newzi", ",", "sel", ",", "Xl", ",", "bpl", ",", "njk", ",", 
       "sbp", ",", "sXl", ",", "i", ",", "j", ",", "vsf", ",", 
       RowBox[{"U", "=", 
        RowBox[{
         RowBox[{"mutationRate", "/.", 
          RowBox[{"{", "opts", "}"}]}], "/.", 
         RowBox[{"Options", "[", "iterateDiploidNew", "]"}]}]}], ",", "nm", 
       ",", "nMut", ",", "nMutTot", ",", "nmk", ",", "newM", ",", "rn"}], 
      "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"list", " ", "all", " ", "distinct", " ", "families"}], " ", 
      "*)"}], "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"pars", "=", 
       RowBox[{"distinctParents", "[", "P", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "list", " ", "the", " ", "indices", " ", "for", " ", "kids", " ", 
        "from", " ", "each", " ", "of", " ", "the", " ", "distinct", " ", 
        "families"}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"kids", "=", 
       RowBox[{"Flatten", "/@", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"Position", "[", 
            RowBox[{
             RowBox[{"Parents", "[", "P", "]"}], ",", "#"}], "]"}], "&"}], "/@",
           "pars"}], ")"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
       "#", " ", "of", " ", "sons", " ", "and", " ", "daughters", " ", "to", 
        " ", "be", " ", "selected"}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"nKs", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Count", "[", 
            RowBox[{
             RowBox[{
             "sx", "\[LeftDoubleBracket]", "#", "\[RightDoubleBracket]"}], 
             ",", "0"}], "]"}], ",", 
           RowBox[{"Count", "[", 
            RowBox[{
             RowBox[{
             "sx", "\[LeftDoubleBracket]", "#", "\[RightDoubleBracket]"}], 
             ",", "1"}], "]"}]}], "}"}], "&"}], "/@", "kids"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{
        "total", " ", "numbers", " ", "of", " ", "kids", " ", "to", " ", "be",
          " ", "produced"}], ",", " ", 
        RowBox[{"for", " ", "each", " ", "family"}]}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"nn", "=", 
       RowBox[{"Total", "/@", "nK"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"The", " ", "left", " ", "origins"}], ",", " ", "Xl", ",", 
        " ", 
        RowBox[{"and", " ", "breakpoints"}], ",", " ", "bpl", ",", " ", 
        RowBox[{
        "are", " ", "drawn", " ", "in", " ", "one", " ", "step", " ", "to", 
         " ", "save", " ", "time"}]}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"Xl", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Partition", "[", 
          RowBox[{
           RowBox[{"RandomInteger", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"0", ",", "1"}], "}"}], ",", 
             RowBox[{"2", "#"}]}], "]"}], ",", "2"}], "]"}], "&"}], "/@", 
        "nn"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"bpl", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Partition", "[", 
          RowBox[{
           RowBox[{"makeBreakPoints", "[", 
            RowBox[{
             RowBox[{"2", "#"}], ",", "R"}], "]"}], ",", "2"}], "]"}], "&"}], 
        "/@", "nn"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"fd", "=", 
       RowBox[{"Diagonal", "[", "f", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"newkids", "=", 
       RowBox[{"MapThread", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{"(*", " ", 
            RowBox[{
             RowBox[{
             "run", " ", "through", " ", "all", " ", "the", " ", "families"}],
              ",", " ", 
             RowBox[{
             "selecting", " ", "the", " ", "new", " ", "kids", " ", "and", 
              " ", "the", " ", "new", " ", "infinitesimal", " ", 
              "background"}]}], "*)"}], "\[IndentingNewLine]", 
           RowBox[{"(*", " ", 
            RowBox[{
            "generate", " ", "the", " ", "diploid", " ", "children", " ", 
             "by", " ", "combining", " ", "gametes", " ", "from", " ", "the", 
             " ", "two", " ", "parents"}], " ", "*)"}], "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"nk", "=", 
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"Mendel", "[", 
                 RowBox[{
                  RowBox[{"#4", "\[LeftDoubleBracket]", 
                   RowBox[{"j", ",", "i"}], "\[RightDoubleBracket]"}], ",", 
                  RowBox[{"#5", "\[LeftDoubleBracket]", 
                   RowBox[{"j", ",", "i"}], "\[RightDoubleBracket]"}], ",", 
                  "R"}], "]"}], "[", 
                RowBox[{"p", "\[LeftDoubleBracket]", 
                 RowBox[{
                 "#2", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}],
                  "\[RightDoubleBracket]"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"j", ",", "#3"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"i", ",", "2"}], "}"}]}], "]"}]}], ";", 
            RowBox[{"(*", " ", 
             RowBox[{
             "calculate", " ", "trait", " ", "contributions", " ", "due", " ",
               "to", " ", "the", " ", "chromosome"}], " ", "*)"}], 
            "\[IndentingNewLine]", 
            RowBox[{"zk", "=", 
             RowBox[{"(", 
              RowBox[{"z", "/@", "nk"}], ")"}]}], ";", "\[IndentingNewLine]", 
            
            RowBox[{"(*", " ", 
             RowBox[{
             "calculate", " ", "trait", " ", "contributions", " ", "due", " ",
               "to", " ", "the", " ", "infinitesimal", " ", "background"}], 
             " ", "*)"}], "\[IndentingNewLine]", 
            RowBox[{"vsf", "=", 
             RowBox[{"Vs", " ", 
              RowBox[{"(", 
               RowBox[{"1", "-", 
                RowBox[{"Mean", "[", 
                 RowBox[{
                 "fd", "\[LeftDoubleBracket]", "#2", 
                  "\[RightDoubleBracket]"}], "]"}]}], ")"}]}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"newzi", "=", 
             RowBox[{
              RowBox[{"Mean", "[", 
               RowBox[{
               "zi", "\[LeftDoubleBracket]", "#2", "\[RightDoubleBracket]"}], 
               "]"}], "+", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"vsf", "\[LessEqual]", "0"}], ",", 
                RowBox[{"ConstantArray", "[", 
                 RowBox[{"0", ",", "#3"}], "]"}], ",", 
                RowBox[{"RandomReal", "[", 
                 RowBox[{
                  RowBox[{"NormalDistribution", "[", 
                   RowBox[{"0", ",", 
                    SqrtBox["vsf"]}], "]"}], ",", "#3"}], "]"}]}], "]"}]}]}], 
            ";", "\[IndentingNewLine]", 
            RowBox[{"ze", "=", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"Ve", "\[LessEqual]", "0"}], ",", 
               RowBox[{"ConstantArray", "[", 
                RowBox[{"0", ",", "#3"}], "]"}], ",", 
               RowBox[{"RandomReal", "[", 
                RowBox[{
                 RowBox[{"NormalDistribution", "[", 
                  RowBox[{"0", ",", 
                   SqrtBox["Ve"]}], "]"}], ",", "#3"}], "]"}]}], "]"}]}], ";",
             "\[IndentingNewLine]", 
            RowBox[{"(*", " ", 
             RowBox[{
              RowBox[{
              "select", " ", "kids", " ", "based", " ", "on", " ", "the", " ",
                "sum", " ", "of", " ", "the", " ", "chromosomal", " ", 
               "contribution"}], ",", " ", 
              RowBox[{
               RowBox[{"background", " ", "&"}], " ", "environment"}]}], " ", 
             "*)"}], "\[IndentingNewLine]", 
            RowBox[{"sel", "=", 
             RowBox[{"selectKids", "[", 
              RowBox[{
               RowBox[{"zk", "+", "newzi", "+", "ze"}], ",", "#6", ",", 
               "#7"}], "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"(*", " ", 
             RowBox[{
             "find", " ", "the", " ", "left", " ", "origin", " ", "and", " ", 
              "breakpoints", " ", "of", " ", "the", " ", "selected", " ", 
              "offspring"}], " ", "*)"}], "\[IndentingNewLine]", 
            RowBox[{"sbp", "=", 
             RowBox[{"Pick", "[", 
              RowBox[{"#5", ",", "sel"}], "]"}]}], ";", 
            RowBox[{"sXl", "=", 
             RowBox[{"Pick", "[", 
              RowBox[{"#4", ",", "sel"}], "]"}]}], ";", 
            RowBox[{"(*", " ", 
             RowBox[{
             "generate", " ", "junctions", " ", "in", " ", "the", " ", 
              "selected", " ", "children", " ", "by", " ", "combining", " ", 
              "gametes", " ", "from", " ", "the", " ", "two", " ", 
              "parents"}], " ", "*)"}], "\[IndentingNewLine]", 
            RowBox[{"njk", "=", 
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"MendelC", "[", 
                 RowBox[{"\[ScriptCapitalP]", ",", 
                  RowBox[{"sXl", "\[LeftDoubleBracket]", 
                   RowBox[{"j", ",", "i"}], "\[RightDoubleBracket]"}], ",", 
                  RowBox[{"sbp", "\[LeftDoubleBracket]", 
                   RowBox[{"j", ",", "i"}], "\[RightDoubleBracket]"}], ",", 
                  "R"}], "]"}], "[", 
                RowBox[{"jun", "\[LeftDoubleBracket]", 
                 RowBox[{
                 "#2", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}],
                  "\[RightDoubleBracket]"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"j", ",", 
                 RowBox[{"Length", "[", "#1", "]"}]}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"i", ",", "2"}], "}"}]}], "]"}]}], ";", 
            RowBox[{"(*", " ", 
             RowBox[{
             "generate", " ", "mutations", " ", "in", " ", "the", " ", 
              "selected", " ", "children", " ", "by", " ", "combining", " ", 
              "gametes", " ", "from", " ", "the", " ", "two", " ", 
              "parents"}], " ", "*)"}], "\[IndentingNewLine]", 
            RowBox[{"nmk", "=", 
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"MendelM", "[", 
                 RowBox[{"\[ScriptCapitalP]", ",", 
                  RowBox[{"sXl", "\[LeftDoubleBracket]", 
                   RowBox[{"j", ",", "i"}], "\[RightDoubleBracket]"}], ",", 
                  RowBox[{"sbp", "\[LeftDoubleBracket]", 
                   RowBox[{"j", ",", "i"}], "\[RightDoubleBracket]"}], ",", 
                  "R"}], "]"}], "[", 
                RowBox[{"mut", "\[LeftDoubleBracket]", 
                 RowBox[{
                 "#2", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}],
                  "\[RightDoubleBracket]"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"j", ",", 
                 RowBox[{"Length", "[", "#1", "]"}]}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"i", ",", "2"}], "}"}]}], "]"}]}], ";", 
            RowBox[{"(*", 
             RowBox[{"return", " ", "the", " ", "new", " ", 
              RowBox[{"{", 
               RowBox[{
               "kids", ",", "p", ",", "j", ",", "zk", ",", "zi", ",", "ze", 
                ",", "mut"}], "}"}]}], " ", "*)"}], "\[IndentingNewLine]", 
            RowBox[{"Transpose", "[", 
             RowBox[{"{", 
              RowBox[{"#1", ",", 
               RowBox[{"Pick", "[", 
                RowBox[{"nk", ",", "sel"}], "]"}], ",", "njk", ",", " ", 
               RowBox[{"Pick", "[", 
                RowBox[{"zk", ",", "sel"}], "]"}], ",", 
               RowBox[{"Pick", "[", 
                RowBox[{"newzi", ",", "sel"}], "]"}], ",", 
               RowBox[{"Pick", "[", 
                RowBox[{"ze", ",", "sel"}], "]"}], ",", "nmk"}], "}"}], 
             "]"}]}], ")"}], "&"}], ",", 
         RowBox[{"{", 
          RowBox[{
          "kids", ",", "pars", ",", "nn", ",", "Xl", ",", "bpl", ",", "nK", 
           ",", "nKs"}], "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
       "make", " ", "sure", " ", "that", " ", "the", " ", "order", " ", 
        "corresponds", " ", "to", " ", "the", " ", "list", " ", "of", " ", 
        "kids", " ", "in", " ", "the", " ", "pedigree"}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"newkids", "=", 
       RowBox[{"Transpose", "[", 
        RowBox[{"Sort", "[", 
         RowBox[{"Flatten", "[", 
          RowBox[{"newkids", ",", "1"}], "]"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{"update", " ", "the", " ", "data", " ", "structures"}], " ", 
        "-", " ", 
        RowBox[{"note", " ", "that", " ", 
         RowBox[{"MapThread", "[", 
          RowBox[{"AppendTo", ",", 
           RowBox[{"{", "\[Ellipsis]", "}"}]}], "]"}], " ", "cannot", " ", 
         "be", " ", "used"}]}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"time", "[", "\[ScriptCapitalP]", "]"}], "+=", "1"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"AppendTo", "[", 
       RowBox[{
        RowBox[{"pop", "[", "\[ScriptCapitalP]", "]"}], ",", 
        RowBox[{
        "newkids", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}], 
       "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"AppendTo", "[", 
       RowBox[{
        RowBox[{"junctions", "[", "\[ScriptCapitalP]", "]"}], ",", 
        RowBox[{
        "newkids", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}]}], 
       "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"AppendTo", "[", 
       RowBox[{
        RowBox[{"zChrom", "[", "\[ScriptCapitalP]", "]"}], ",", 
        RowBox[{
        "newkids", "\[LeftDoubleBracket]", "4", "\[RightDoubleBracket]"}]}], 
       "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"AppendTo", "[", 
       RowBox[{
        RowBox[{"zInf", "[", "\[ScriptCapitalP]", "]"}], ",", 
        RowBox[{
        "newkids", "\[LeftDoubleBracket]", "5", "\[RightDoubleBracket]"}]}], 
       "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"AppendTo", "[", 
       RowBox[{
        RowBox[{"zEnv", "[", "\[ScriptCapitalP]", "]"}], ",", 
        RowBox[{
        "newkids", "\[LeftDoubleBracket]", "6", "\[RightDoubleBracket]"}]}], 
       "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{
        "find", " ", "the", " ", "new", " ", "F", " ", "amongst", " ", "the", 
         " ", "kids"}], " ", "-", " ", 
        RowBox[{"note", " ", "P", " ", "has", " ", "entries", " ", 
         RowBox[{"{", "\[Ellipsis]1\[Ellipsis]1\[Ellipsis]", "}"}]}]}], 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{"f1", "=", 
       RowBox[{"f", "+", 
        RowBox[{"DiagonalMatrix", "[", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"1.", "-", "fd"}], ")"}], "/", "2"}], "]"}]}]}], ";", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{"F", " ", "for", " ", "random"}], ",", " ", 
        RowBox[{"not", " ", "distinct"}], ",", " ", "genes"}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"fii", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Extract", "[", 
          RowBox[{"f1", ",", "#"}], "]"}], "&"}], "/@", 
        RowBox[{"posPars", "[", "P", "]"}]}]}], ";", 
      RowBox[{"(*", " ", 
       RowBox[{"The", " ", "new", " ", 
        SubscriptBox["F", 
         RowBox[{"i", ",", "i"}]]}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"fij", "=", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"P", ".", "f1", ".", 
          RowBox[{"Transpose", "[", "P", "]"}]}], ")"}], "/", "4"}]}], ";", 
      RowBox[{"(*", " ", 
       RowBox[{"The", " ", "new", " ", 
        SubscriptBox["F", 
         RowBox[{"i", ",", "j"}]]}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"AppendTo", "[", 
       RowBox[{
        RowBox[{"F", "[", "\[ScriptCapitalP]", "]"}], ",", 
        RowBox[{"fij", "+", 
         RowBox[{"DiagonalMatrix", "[", 
          RowBox[{"fii", "-", 
           RowBox[{"Diagonal", "[", "fij", "]"}]}], "]"}]}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"newM", "=", 
       RowBox[{
       "newkids", "\[LeftDoubleBracket]", "7", "\[RightDoubleBracket]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"U", ">", "0"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"nMut", "=", 
          RowBox[{"RandomInteger", "[", 
           RowBox[{
            RowBox[{"PoissonDistribution", "[", "U", "]"}], ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Length", "[", "mut", "]"}], ",", "2"}], "}"}]}], 
           "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"nMutTot", "=", 
          RowBox[{"Total", "[", 
           RowBox[{"nMut", ",", "2"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"nm", "=", 
          RowBox[{"numM", "[", "\[ScriptCapitalP]", "]"}]}], ";", 
         RowBox[{
          RowBox[{"numM", "[", "\[ScriptCapitalP]", "]"}], "=", 
          RowBox[{"nm", "+", "nMutTot"}]}], ";", 
         RowBox[{"rn", "=", 
          RowBox[{"nm", "+", 
           RowBox[{"Range", "[", "nMutTot", "]"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"MapThread", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"originM", "[", "\[ScriptCapitalP]", "]"}], "[", "#1",
                 "]"}], "=", 
               RowBox[{"time", "[", "\[ScriptCapitalP]", "]"}]}], ";", 
              RowBox[{
               RowBox[{
                RowBox[{"locM", "[", "\[ScriptCapitalP]", "]"}], "[", "#1", 
                "]"}], "=", "#2"}]}], ")"}], "&"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{"rn", ",", 
             RowBox[{"RandomReal", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"0", ",", "R"}], "}"}], ",", "nMutTot"}], "]"}]}], 
            "}"}]}], "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"newM", "=", 
          RowBox[{"Map", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Join", "@@", "#"}], "&"}], ",", 
            RowBox[{"Transpose", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"newM", ",", 
                RowBox[{"nm", "+", 
                 RowBox[{"partitionList", "[", "nMut", "]"}]}]}], "}"}], ",", 
              
              RowBox[{"{", 
               RowBox[{"3", ",", "1", ",", "2"}], "}"}]}], "]"}], ",", 
            RowBox[{"{", "2", "}"}]}], "]"}]}]}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"AppendTo", "[", 
       RowBox[{
        RowBox[{"mutations", "[", "\[ScriptCapitalP]", "]"}], ",", "newM"}], 
       "]"}], ";"}]}], "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.667538833657012*^9, 3.667538929944538*^9}, {
   3.667538963598817*^9, 3.667538964613865*^9}, 3.6919826916607933`*^9, {
   3.691982771727373*^9, 3.6919827770150967`*^9}, {3.691982870899932*^9, 
   3.691982896968453*^9}, {3.692016531289781*^9, 3.6920165832455473`*^9}, {
   3.6920166566000423`*^9, 3.692016689271001*^9}, {3.6920194825393333`*^9, 
   3.692019684216501*^9}, {3.6920197187911587`*^9, 3.692019719455627*^9}, {
   3.692019756844923*^9, 3.692019814657701*^9}, {3.692019856677642*^9, 
   3.692019858623295*^9}, {3.692020304047558*^9, 3.692020318909976*^9}, {
   3.6924338332133017`*^9, 3.692433845042138*^9}, {3.692436950777597*^9, 
   3.6924369602782307`*^9}, {3.6924370030377083`*^9, 
   3.6924370032921867`*^9}, {3.692437236942505*^9, 3.692437318292788*^9}, {
   3.692437359830422*^9, 3.6924373717709627`*^9}, {3.69245474395648*^9, 
   3.6924547576655493`*^9}, {3.692455798434577*^9, 3.692455822395589*^9}, {
   3.692455864503039*^9, 3.692455869481414*^9}, {3.692505347088799*^9, 
   3.6925053476569757`*^9}, 3.692505431364753*^9, {3.692505534309514*^9, 
   3.6925055527319937`*^9}, {3.692777701968698*^9, 3.6927777049053917`*^9}, {
   3.6927921954944267`*^9, 3.692792299567438*^9}, {3.692792343972632*^9, 
   3.6927923966950283`*^9}, {3.6927924543641977`*^9, 
   3.6927925543014183`*^9}, {3.692792600135681*^9, 3.692792627369739*^9}, {
   3.6927933792908916`*^9, 3.692793387652047*^9}, {3.692793424966074*^9, 
   3.6927934738488407`*^9}, {3.692793539102133*^9, 3.692793540405376*^9}, {
   3.692793591633626*^9, 3.692793693662222*^9}, {3.6927940601304283`*^9, 
   3.6927942217608013`*^9}, {3.692794378231843*^9, 3.692794438617622*^9}, {
   3.692794478091794*^9, 3.692794480490116*^9}, {3.69279451884709*^9, 
   3.692794613248248*^9}, {3.692794686290906*^9, 3.692794730538795*^9}, {
   3.692795247486623*^9, 3.692795265860965*^9}, {3.692795296300028*^9, 
   3.692795299491096*^9}, {3.692795399176524*^9, 3.692795404295373*^9}, {
   3.692795483196252*^9, 3.692795544966769*^9}, {3.69280504165911*^9, 
   3.692805056511922*^9}, {3.692805128061509*^9, 3.692805182082822*^9}, {
   3.692863104706209*^9, 3.692863122213643*^9}, {3.69286408973346*^9, 
   3.692864120681922*^9}, {3.6928642901347857`*^9, 3.692864291718186*^9}, {
   3.693040817399316*^9, 3.693040912510538*^9}, {3.693041008671734*^9, 
   3.693041186631576*^9}, {3.693041675011348*^9, 3.693041704914547*^9}, 
   3.693041930109172*^9, 3.693042457640297*^9, {3.693049449737628*^9, 
   3.69304949427253*^9}, {3.6930495451915293`*^9, 3.6930495952774887`*^9}, {
   3.693050512359908*^9, 3.693050703319364*^9}, {3.693050753574728*^9, 
   3.693050756851881*^9}, 3.693062568540903*^9, {3.6932808009812527`*^9, 
   3.693280840564837*^9}, {3.693281048271302*^9, 3.693281065411634*^9}, 
   3.6932825807163553`*^9, 3.693367577124544*^9, {3.693373135923843*^9, 
   3.693373142067278*^9}, {3.693376892221119*^9, 3.6933769581135893`*^9}, {
   3.693378460851931*^9, 3.6933784889508142`*^9}, {3.693458390365932*^9, 
   3.6934584065973682`*^9}, {3.6934584542998877`*^9, 3.693458587623515*^9}, {
   3.693458625935972*^9, 3.693458626921006*^9}, {3.6934587163743973`*^9, 
   3.6934587177110453`*^9}, {3.69345988157408*^9, 3.693459885916984*^9}, {
   3.693459987480242*^9, 3.693460010067601*^9}, {3.6934600820824633`*^9, 
   3.693460085031432*^9}, {3.6934601575091257`*^9, 3.693460159060553*^9}, {
   3.6934602723607397`*^9, 3.6934603294147997`*^9}, {3.693460499547368*^9, 
   3.693460623455646*^9}, {3.6934609355267057`*^9, 3.693461091665492*^9}, {
   3.693461138089816*^9, 3.693461163633677*^9}, 3.693461361779065*^9, {
   3.6934613945303173`*^9, 3.6934614313771477`*^9}, {3.693463297215989*^9, 
   3.693463298815074*^9}, {3.693463593061068*^9, 3.693463629220956*^9}, {
   3.693463670176505*^9, 3.693463701012918*^9}, 3.693463753949194*^9, 
   3.6934638042273684`*^9, {3.696952396007182*^9, 3.696952400989687*^9}, {
   3.6969949226083193`*^9, 3.696994963781088*^9}, {3.696997000484433*^9, 
   3.6969971711003523`*^9}, {3.6969975234109497`*^9, 3.696997585714143*^9}, {
   3.69699765339014*^9, 3.696997706298675*^9}, {3.696998015270891*^9, 
   3.696998017942786*^9}, {3.696998110556696*^9, 3.696998114884564*^9}, {
   3.698311960708725*^9, 3.698312012699255*^9}, {3.698312048402445*^9, 
   3.698312067001975*^9}, {3.698312115825604*^9, 3.698312136839394*^9}, {
   3.698312173967965*^9, 3.698312174847466*^9}, 3.698312227542263*^9, {
   3.698315016246441*^9, 3.6983150222974997`*^9}, {3.698315164166871*^9, 
   3.698315185182397*^9}, {3.6983171724948177`*^9, 3.698317239358279*^9}, {
   3.698317456751486*^9, 3.69831751182232*^9}, {3.6983176922096577`*^9, 
   3.698317708592944*^9}, {3.698320405431508*^9, 3.698320425964529*^9}, {
   3.698320480411677*^9, 3.6983204827001247`*^9}, {3.698320565317387*^9, 
   3.698320590307733*^9}, {3.698320643188398*^9, 3.698320644180255*^9}, {
   3.69883434387757*^9, 3.69883434502866*^9}, {3.698834432512723*^9, 
   3.698834443787525*^9}, {3.698838750617539*^9, 3.6988388547756453`*^9}, {
   3.6988391054113503`*^9, 3.698839109073421*^9}, {3.6988399768281116`*^9, 
   3.698840166110155*^9}, {3.6988962832392483`*^9, 3.698896363523984*^9}, {
   3.698897122916926*^9, 3.6988971280434113`*^9}, {3.6988974640528316`*^9, 
   3.6988974693155813`*^9}, {3.698979180799863*^9, 3.6989791930170097`*^9}, 
   3.698981225818396*^9, {3.698981260985882*^9, 3.698981287367011*^9}, {
   3.6995976077808857`*^9, 3.699597703757359*^9}, 3.6996029600017843`*^9, {
   3.70063315104667*^9, 3.700633160221238*^9}, {3.700635783515545*^9, 
   3.70063579376012*^9}, 3.700635834055127*^9, {3.700635867085177*^9, 
   3.700635953409295*^9}, {3.70063599059477*^9, 3.7006360633703127`*^9}, {
   3.70063610140226*^9, 3.700636209159903*^9}, 3.7006388814184103`*^9, {
   3.700638963499516*^9, 3.700638985987258*^9}, {3.700642025600794*^9, 
   3.700642201570163*^9}, 3.700642235250581*^9, 3.700642592733203*^9, {
   3.700642656768321*^9, 3.700642795633177*^9}, {3.700642831637575*^9, 
   3.700642875660808*^9}, {3.700643146901423*^9, 3.7006431854064493`*^9}, {
   3.700643233045929*^9, 3.700643263372954*^9}, {3.700643342088242*^9, 
   3.700643414627348*^9}, {3.700643471358396*^9, 3.700643475445025*^9}, {
   3.700643654428956*^9, 3.7006436856492987`*^9}, {3.7006494255290623`*^9, 
   3.700649445786227*^9}, {3.700650197417192*^9, 3.7006502072792253`*^9}, {
   3.7006504147342243`*^9, 3.70065043544479*^9}, {3.700706196255118*^9, 
   3.700706263627675*^9}, 3.700707339247098*^9, 3.700709690237193*^9, 
   3.700719117654079*^9, {3.70071939674133*^9, 3.700719397268804*^9}},
 CellLabel->
  "In[369]:=",ExpressionUUID->"7b551446-4d6e-436f-a250-7fe1710b8003"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"iterateDiploidNew", "[", 
    RowBox[{"\[ScriptCapitalP]_", ",", 
     RowBox[{"P", ":", 
      RowBox[{"{", "___SparseArray", "}"}]}], ",", "nKids_List", ",", 
     "sex_List", ",", "Vs_", ",", "Ve_", ",", "z_", ",", "R_", ",", 
     "opts___Rule"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "t", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"pedigreeList", "[", "\[ScriptCapitalP]", "]"}], "=", "P"}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{"iterateDiploidNew", "[", 
         RowBox[{"\[ScriptCapitalP]", ",", 
          RowBox[{"P", "\[LeftDoubleBracket]", "t", "\[RightDoubleBracket]"}],
           ",", 
          RowBox[{
          "nKids", "\[LeftDoubleBracket]", "t", "\[RightDoubleBracket]"}], 
          ",", 
          RowBox[{
          "sex", "\[LeftDoubleBracket]", "t", "\[RightDoubleBracket]"}], ",", 
          "Vs", ",", "Ve", ",", "z", ",", "R", ",", "opts"}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"t", ",", 
          RowBox[{"Length", "[", "P", "]"}]}], "}"}]}], "]"}]}]}], "]"}]}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.667538978789452*^9, 3.6675389880691032`*^9}, {
   3.691982780255022*^9, 3.6919827819269342`*^9}, {3.69201650281045*^9, 
   3.692016515888678*^9}, {3.6925056050271893`*^9, 3.692505629976997*^9}, {
   3.692505721186942*^9, 3.692505764898075*^9}, {3.692793983607205*^9, 
   3.6927940062753572`*^9}, {3.6928631068965282`*^9, 
   3.6928631755593443`*^9}, {3.6928642999961452`*^9, 3.692864301459963*^9}, {
   3.693373044328743*^9, 3.693373046920403*^9}, {3.693457880395282*^9, 
   3.693457883354137*^9}, {3.693457928104776*^9, 3.693457929833337*^9}, {
   3.693458024877343*^9, 3.693458066292261*^9}, {3.6934582259076777`*^9, 
   3.693458238625869*^9}, {3.698307971395857*^9, 3.69830800188699*^9}, {
   3.6988345800792217`*^9, 3.698834599112224*^9}, {3.698835784247013*^9, 
   3.698835808532668*^9}, {3.698835857959433*^9, 3.6988358742981157`*^9}, {
   3.698835907159892*^9, 3.6988359103744707`*^9}, {3.6988371245789413`*^9, 
   3.698837243428219*^9}, {3.699427271638323*^9, 3.6994272736625233`*^9}, 
   3.699434668798869*^9, {3.700633199028289*^9, 3.700633210058124*^9}, {
   3.700709318190854*^9, 3.7007093295581017`*^9}},
 CellLabel->
  "In[370]:=",ExpressionUUID->"f4d0eaa8-e4e7-4eb9-a11f-d3e442d7a711"],

Cell[TextData[{
 "** There had been a bug in calculating F.  The formula for ",
 Cell[BoxData[
  FormBox[
   SubscriptBox["F", 
    RowBox[{"i", ",", "i"}]], TraditionalForm]],ExpressionUUID->
  "ab53384d-d8dd-472f-9af3-c4b48ef73e62"],
 " is not the same as for ",
 Cell[BoxData[
  FormBox[
   SubscriptBox["F", 
    RowBox[{"i", ",", "j"}]], TraditionalForm]],ExpressionUUID->
  "9e435db5-2db8-4341-a34c-1d5270110d21"],
 ".  The new code is less efficient, because I could not find a way to use \
matrix operations throughout, and instead extract elements. "
}], "Text",
 CellChangeTimes->{{3.696997773339595*^9, 3.696997836545496*^9}, {
  3.696998637193987*^9, 
  3.6969986435545597`*^9}},ExpressionUUID->"a629617d-a5cb-4500-a319-\
b7a80186f630"],

Cell["\<\
Algorithm:
- For each family, first calculate the # of kids needed from that family.
- Generate the break points for the whole set of offspring, to be used later
- Run through families again, generating and selecting offspring.
- The continuous genome only needs to be generated for the selected \
individuals, but using the correct bp.
- One should discard breaks that are in homozygous material - but still carry \
out the recombination of course.\
\>", "Text",
 CellChangeTimes->{{3.6929565534961023`*^9, 3.692956595109606*^9}, {
  3.692957030576849*^9, 3.692957100524488*^9}, {3.6929581267676573`*^9, 
  3.692958161383341*^9}, {3.692958294988262*^9, 
  3.6929583386007233`*^9}},ExpressionUUID->"bbb1f434-ebcd-4f2d-a26b-\
9f19776466fd"],

Cell[TextData[{
 "It is most efficient to just record breakpoint locations, which are unique. \
 Previously, I had stored their properties (time of origin, flanking \
haplotypes..) in global variables. However, this is cumbersome. It may be \
more efficient to store this information in named functions. Thus, ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    RowBox[{"leftHaplotype", "[", "f", "]"}], "[", "x", "]"}], 
   TraditionalForm]],ExpressionUUID->"26261d1c-f467-40c3-8c39-6e5921d324e3"],
 " could store the left haplotype of a breakpoint at ",
 Cell[BoxData[
  FormBox["x", TraditionalForm]],ExpressionUUID->
  "391e12da-8a9d-4a28-9cf2-c24e165a6e8b"],
 ". Retrieving information from functions is faster than from lists.  This \
could be generalised to store all information about the simulation in this \
way, but I will not attempt that just now."
}], "Text",
 CellChangeTimes->{{3.693279686755642*^9, 3.693279850512364*^9}, {
  3.69328012225646*^9, 
  3.693280182333707*^9}},ExpressionUUID->"aa6ce812-9b4e-4a1a-9ecd-\
64091d2cd3c1"],

Cell[TextData[StyleBox["The form below for a neutral simulation is clumsy. It \
would be better to allow the #\[NonBreakingSpace]of kids etc to be specified \
as additional options within one definition.  Otherwise it is hard to keep \
the two definitions coordinated",
 FontSlant->"Italic"]], "Text",
 CellChangeTimes->{{3.7006574447239237`*^9, 3.700657484242009*^9}, {
  3.700707458346416*^9, 
  3.700707469577739*^9}},ExpressionUUID->"1bab784d-8209-49f6-979e-\
a564ca7dd91a"],

Cell[TextData[{
 StyleBox["Note: I corrected ",
  FontSlant->"Italic"],
 Cell[BoxData[
  RowBox[{
   RowBox[{"newzi", "=", 
    RowBox[{
     RowBox[{"Mean", "[", 
      RowBox[{"zi", "\[LeftDoubleBracket]", "#2", "\[RightDoubleBracket]"}], 
      "]"}], "+", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"vsf", "\[LessEqual]", "0"}], ",", 
       RowBox[{"ConstantArray", "[", 
        RowBox[{"0", ",", "#3"}], "]"}], ",", 
       RowBox[{"RandomReal", "[", 
        RowBox[{
         RowBox[{"NormalDistribution", "[", 
          RowBox[{"0", ",", 
           SqrtBox["vsf"]}], "]"}], ",", "#3"}], "]"}]}], "]"}]}]}], ";"}]],
  InitializationCell->True,
  CellChangeTimes->{{3.667538833657012*^9, 3.667538929944538*^9}, {
    3.667538963598817*^9, 3.667538964613865*^9}, 3.6919826916607933`*^9, {
    3.691982771727373*^9, 3.6919827770150967`*^9}, {3.691982870899932*^9, 
    3.691982896968453*^9}, {3.692016531289781*^9, 3.6920165832455473`*^9}, {
    3.6920166566000423`*^9, 3.692016689271001*^9}, {3.6920194825393333`*^9, 
    3.692019684216501*^9}, {3.6920197187911587`*^9, 3.692019719455627*^9}, {
    3.692019756844923*^9, 3.692019814657701*^9}, {3.692019856677642*^9, 
    3.692019858623295*^9}, {3.692020304047558*^9, 3.692020318909976*^9}, {
    3.6924338332133017`*^9, 3.692433845042138*^9}, {3.692436950777597*^9, 
    3.6924369602782307`*^9}, {3.6924370030377083`*^9, 
    3.6924370032921867`*^9}, {3.692437236942505*^9, 3.692437318292788*^9}, {
    3.692437359830422*^9, 3.6924373717709627`*^9}, {3.69245474395648*^9, 
    3.6924547576655493`*^9}, {3.692455798434577*^9, 3.692455822395589*^9}, {
    3.692455864503039*^9, 3.692455869481414*^9}, {3.692505347088799*^9, 
    3.6925053476569757`*^9}, 3.692505431364753*^9, {3.692505534309514*^9, 
    3.6925055527319937`*^9}, {3.692777701968698*^9, 3.6927777049053917`*^9}, {
    3.6927921954944267`*^9, 3.692792299567438*^9}, {3.692792343972632*^9, 
    3.6927923966950283`*^9}, {3.6927924543641977`*^9, 
    3.6927925543014183`*^9}, {3.692792600135681*^9, 3.692792627369739*^9}, {
    3.6927933792908916`*^9, 3.692793387652047*^9}, {3.692793424966074*^9, 
    3.6927934738488407`*^9}, {3.692793539102133*^9, 3.692793540405376*^9}, {
    3.692793591633626*^9, 3.692793693662222*^9}, {3.6927940601304283`*^9, 
    3.6927942217608013`*^9}, {3.692794378231843*^9, 3.692794438617622*^9}, {
    3.692794478091794*^9, 3.692794480490116*^9}, {3.69279451884709*^9, 
    3.692794613248248*^9}, {3.692794686290906*^9, 3.692794730538795*^9}, {
    3.692795247486623*^9, 3.692795265860965*^9}, {3.692795296300028*^9, 
    3.692795299491096*^9}, {3.692795399176524*^9, 3.692795404295373*^9}, {
    3.692795483196252*^9, 3.692795544966769*^9}, {3.69280504165911*^9, 
    3.692805056511922*^9}, {3.692805128061509*^9, 3.692805182082822*^9}, {
    3.692863104706209*^9, 3.692863122213643*^9}, {3.69286408973346*^9, 
    3.692864120681922*^9}, {3.6928642901347857`*^9, 3.692864291718186*^9}, {
    3.693040817399316*^9, 3.693040912510538*^9}, {3.693041008671734*^9, 
    3.693041186631576*^9}, {3.693041675011348*^9, 3.693041704914547*^9}, 
    3.693041930109172*^9, 3.693042457640297*^9, {3.693049449737628*^9, 
    3.69304949427253*^9}, {3.6930495451915293`*^9, 3.6930495952774887`*^9}, {
    3.693050512359908*^9, 3.693050703319364*^9}, {3.693050753574728*^9, 
    3.693050756851881*^9}, 3.693062568540903*^9, {3.6932808009812527`*^9, 
    3.693280840564837*^9}, {3.693281048271302*^9, 3.693281065411634*^9}, 
    3.6932825807163553`*^9, 3.693367577124544*^9, {3.693373135923843*^9, 
    3.693373142067278*^9}, {3.693376892221119*^9, 3.6933769581135893`*^9}, {
    3.693378460851931*^9, 3.6933784889508142`*^9}, {3.693458390365932*^9, 
    3.6934584065973682`*^9}, {3.6934584542998877`*^9, 3.693458587623515*^9}, {
    3.693458625935972*^9, 3.693458626921006*^9}, {3.6934587163743973`*^9, 
    3.6934587177110453`*^9}, {3.69345988157408*^9, 3.693459885916984*^9}, {
    3.693459987480242*^9, 3.693460010067601*^9}, {3.6934600820824633`*^9, 
    3.693460085031432*^9}, {3.6934601575091257`*^9, 3.693460159060553*^9}, {
    3.6934602723607397`*^9, 3.6934603294147997`*^9}, {3.693460499547368*^9, 
    3.693460623455646*^9}, {3.6934609355267057`*^9, 3.693461091665492*^9}, {
    3.693461138089816*^9, 3.693461163633677*^9}, 3.693461361779065*^9, {
    3.6934613945303173`*^9, 3.6934614313771477`*^9}, {3.693463297215989*^9, 
    3.693463298815074*^9}, {3.693463593061068*^9, 3.693463629220956*^9}, {
    3.693463670176505*^9, 3.693463701012918*^9}, 3.693463753949194*^9, 
    3.6934638042273684`*^9, {3.696952396007182*^9, 3.696952400989687*^9}, {
    3.6969949226083193`*^9, 3.696994963781088*^9}, {3.696997000484433*^9, 
    3.6969971711003523`*^9}, {3.6969975234109497`*^9, 3.696997585714143*^9}, {
    3.69699765339014*^9, 3.696997706298675*^9}, {3.696998015270891*^9, 
    3.696998017942786*^9}, {3.696998110556696*^9, 3.696998114884564*^9}, {
    3.698311960708725*^9, 3.698312012699255*^9}, {3.698312048402445*^9, 
    3.698312067001975*^9}, {3.698312115825604*^9, 3.698312136839394*^9}, {
    3.698312173967965*^9, 3.698312174847466*^9}, 3.698312227542263*^9, {
    3.698315016246441*^9, 3.6983150222974997`*^9}, {3.698315164166871*^9, 
    3.698315185182397*^9}, {3.6983171724948177`*^9, 3.698317239358279*^9}, {
    3.698317456751486*^9, 3.69831751182232*^9}, {3.6983176922096577`*^9, 
    3.698317708592944*^9}, {3.698320405431508*^9, 3.698320425964529*^9}, {
    3.698320480411677*^9, 3.6983204827001247`*^9}, {3.698320565317387*^9, 
    3.698320590307733*^9}, {3.698320643188398*^9, 3.698320644180255*^9}, {
    3.69883434387757*^9, 3.69883434502866*^9}, {3.698834432512723*^9, 
    3.698834443787525*^9}, {3.698838750617539*^9, 3.6988388547756453`*^9}, {
    3.6988391054113503`*^9, 3.698839109073421*^9}, {3.6988399768281116`*^9, 
    3.698840166110155*^9}, {3.6988962832392483`*^9, 3.698896363523984*^9}, {
    3.698897122916926*^9, 3.6988971280434113`*^9}, {3.6988974640528316`*^9, 
    3.6988974693155813`*^9}, {3.698979180799863*^9, 3.6989791930170097`*^9}, 
    3.698981225818396*^9, {3.698981260985882*^9, 3.698981287367011*^9}, {
    3.6995976077808857`*^9, 3.699597703757359*^9}, 3.6996029600017843`*^9, {
    3.70063315104667*^9, 3.700633160221238*^9}, {3.700635783515545*^9, 
    3.70063579376012*^9}, 3.700635834055127*^9, {3.700635867085177*^9, 
    3.700635953409295*^9}, {3.70063599059477*^9, 3.7006360633703127`*^9}, {
    3.70063610140226*^9, 3.700636209159903*^9}, 3.7006388814184103`*^9, {
    3.700638963499516*^9, 3.700638985987258*^9}, {3.700642025600794*^9, 
    3.700642201570163*^9}, 3.700642235250581*^9, 3.700642592733203*^9, {
    3.700642656768321*^9, 3.700642795633177*^9}, {3.700642831637575*^9, 
    3.700642875660808*^9}, {3.700643146901423*^9, 3.7006431854064493`*^9}, {
    3.700643233045929*^9, 3.700643263372954*^9}, {3.700643342088242*^9, 
    3.700643414627348*^9}, {3.700643471358396*^9, 3.700643475445025*^9}, {
    3.700643654428956*^9, 3.7006436856492987`*^9}, {3.7006494255290623`*^9, 
    3.700649445786227*^9}, {3.700650197417192*^9, 3.7006502072792253`*^9}, {
    3.7006504147342243`*^9, 3.70065043544479*^9}, 3.700657213613455*^9, {
    3.7006572593956337`*^9, 3.700657266365881*^9}, {3.7006573240460367`*^9, 
    3.700657329811975*^9}, {3.700657373275465*^9, 3.7006573835927258`*^9}, {
    3.700657418617488*^9, 3.700657430375683*^9}, 3.700706504688836*^9, 
    3.70070696010182*^9, 3.7007071911637917`*^9, {3.700707283350231*^9, 
    3.7007072944058933`*^9}},ExpressionUUID->
  "9a8f8f8b-fa2d-4281-8035-e7ee06f65fb2"],
 StyleBox[" to include ConstantArray[0,#3]. It is not clear why it \
nevertheless worked before....",
  FontSlant->"Italic"]
}], "Text",
 CellChangeTimes->{{3.700707471993037*^9, 
  3.70070752072818*^9}},ExpressionUUID->"4708018b-2c7e-4ff7-ab06-\
8b056b86f33c"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"iterateDiploidNew", "[", 
    RowBox[{
    "\[ScriptCapitalP]_", ",", "P_SparseArray", ",", "Vs_", ",", "Ve_", ",", 
     "z_", ",", "R_", ",", "opts___Rule"}], "]"}], ":=", 
   "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"p", "=", 
        RowBox[{
         RowBox[{"pop", "[", "\[ScriptCapitalP]", "]"}], 
         "\[LeftDoubleBracket]", 
         RowBox[{"-", "1"}], "\[RightDoubleBracket]"}]}], ",", 
       RowBox[{"zi", "=", 
        RowBox[{
         RowBox[{"zInf", "[", "\[ScriptCapitalP]", "]"}], 
         "\[LeftDoubleBracket]", 
         RowBox[{"-", "1"}], "\[RightDoubleBracket]"}]}], ",", 
       RowBox[{"mut", "=", 
        RowBox[{
         RowBox[{"mutations", "[", "\[ScriptCapitalP]", "]"}], 
         "\[LeftDoubleBracket]", 
         RowBox[{"-", "1"}], "\[RightDoubleBracket]"}]}], ",", 
       RowBox[{"jun", "=", 
        RowBox[{
         RowBox[{"junctions", "[", "\[ScriptCapitalP]", "]"}], 
         "\[LeftDoubleBracket]", 
         RowBox[{"-", "1"}], "\[RightDoubleBracket]"}]}], ",", 
       RowBox[{"f", "=", 
        RowBox[{
         RowBox[{"F", "[", "\[ScriptCapitalP]", "]"}], "\[LeftDoubleBracket]", 
         RowBox[{"-", "1"}], "\[RightDoubleBracket]"}]}], ",", "fd", ",", 
       "f1", ",", "fii", ",", "fij", ",", "pars", ",", "kids", ",", "nn", ",",
        "nk", ",", "nKs", ",", "zk", ",", "zt", ",", "ze", ",", "newkids", 
       ",", "newzi", ",", "sel", ",", "Xl", ",", "bpl", ",", "njk", ",", 
       "sbp", ",", "sXl", ",", "i", ",", "j", ",", "vsf", ",", 
       RowBox[{"U", "=", 
        RowBox[{
         RowBox[{"mutationRate", "/.", 
          RowBox[{"{", "opts", "}"}]}], "/.", 
         RowBox[{"Options", "[", "iterateDiploidNew", "]"}]}]}], ",", "nMut", 
       ",", "nMutTot", ",", "nmk", ",", "newM", ",", "rn", ",", "nm"}], "}"}],
      ",", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"list", " ", "all", " ", "distinct", " ", "families"}], " ", 
      "*)"}], "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"pars", "=", 
       RowBox[{"distinctParents", "[", "P", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "list", " ", "the", " ", "indices", " ", "for", " ", "kids", " ", 
        "from", " ", "each", " ", "of", " ", "the", " ", "distinct", " ", 
        "families"}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"kids", "=", 
       RowBox[{"Flatten", "/@", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"Position", "[", 
            RowBox[{
             RowBox[{"Parents", "[", "P", "]"}], ",", "#"}], "]"}], "&"}], "/@",
           "pars"}], ")"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{
        "total", " ", "numbers", " ", "of", " ", "kids", " ", "to", " ", "be",
          " ", "produced"}], ",", " ", 
        RowBox[{"for", " ", "each", " ", "family"}]}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"nn", "=", 
       RowBox[{"Length", "/@", "kids"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"The", " ", "left", " ", "origins"}], ",", " ", "Xl", ",", 
        " ", 
        RowBox[{"and", " ", "breakpoints"}], ",", " ", "bpl", ",", " ", 
        RowBox[{
        "are", " ", "drawn", " ", "in", " ", "one", " ", "step", " ", "to", 
         " ", "save", " ", "time"}]}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"Xl", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Partition", "[", 
          RowBox[{
           RowBox[{"RandomInteger", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"0", ",", "1"}], "}"}], ",", 
             RowBox[{"2", "#"}]}], "]"}], ",", "2"}], "]"}], "&"}], "/@", 
        "nn"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"bpl", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Partition", "[", 
          RowBox[{
           RowBox[{"makeBreakPoints", "[", 
            RowBox[{
             RowBox[{"2", "#"}], ",", "R"}], "]"}], ",", "2"}], "]"}], "&"}], 
        "/@", "nn"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"fd", "=", 
       RowBox[{"Diagonal", "[", "f", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"newkids", "=", 
       RowBox[{"MapThread", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{"(*", " ", 
            RowBox[{
             RowBox[{
             "run", " ", "through", " ", "all", " ", "the", " ", "families"}],
              ",", " ", 
             RowBox[{
             "selecting", " ", "the", " ", "new", " ", "kids", " ", "and", 
              " ", "the", " ", "new", " ", "infinitesimal", " ", 
              "background"}]}], "*)"}], "\[IndentingNewLine]", 
           RowBox[{"(*", " ", 
            RowBox[{
            "generate", " ", "the", " ", "diploid", " ", "children", " ", 
             "by", " ", "combining", " ", "gametes", " ", "from", " ", "the", 
             " ", "two", " ", "parents"}], " ", "*)"}], "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"nk", "=", 
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"Mendel", "[", 
                 RowBox[{
                  RowBox[{"#4", "\[LeftDoubleBracket]", 
                   RowBox[{"j", ",", "i"}], "\[RightDoubleBracket]"}], ",", 
                  RowBox[{"#5", "\[LeftDoubleBracket]", 
                   RowBox[{"j", ",", "i"}], "\[RightDoubleBracket]"}], ",", 
                  "R"}], "]"}], "[", 
                RowBox[{"p", "\[LeftDoubleBracket]", 
                 RowBox[{
                 "#2", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}],
                  "\[RightDoubleBracket]"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"j", ",", "#3"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"i", ",", "2"}], "}"}]}], "]"}]}], ";", 
            RowBox[{"(*", " ", 
             RowBox[{
             "calculate", " ", "trait", " ", "contributions", " ", "due", " ",
               "to", " ", "the", " ", "chromosome"}], " ", "*)"}], 
            "\[IndentingNewLine]", 
            RowBox[{"zk", "=", 
             RowBox[{"(", 
              RowBox[{"z", "/@", "nk"}], ")"}]}], ";", "\[IndentingNewLine]", 
            
            RowBox[{"(*", " ", 
             RowBox[{
             "calculate", " ", "trait", " ", "contributions", " ", "due", " ",
               "to", " ", "the", " ", "infinitesimal", " ", "background"}], 
             " ", "*)"}], "\[IndentingNewLine]", 
            RowBox[{"vsf", "=", 
             RowBox[{"Vs", " ", 
              RowBox[{"(", 
               RowBox[{"1", "-", 
                RowBox[{"Mean", "[", 
                 RowBox[{
                 "fd", "\[LeftDoubleBracket]", "#2", 
                  "\[RightDoubleBracket]"}], "]"}]}], ")"}]}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"newzi", "=", 
             RowBox[{
              RowBox[{"Mean", "[", 
               RowBox[{
               "zi", "\[LeftDoubleBracket]", "#2", "\[RightDoubleBracket]"}], 
               "]"}], "+", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"vsf", "\[LessEqual]", "0"}], ",", 
                RowBox[{"ConstantArray", "[", 
                 RowBox[{"0", ",", "#3"}], "]"}], ",", 
                RowBox[{"RandomReal", "[", 
                 RowBox[{
                  RowBox[{"NormalDistribution", "[", 
                   RowBox[{"0", ",", 
                    SqrtBox["vsf"]}], "]"}], ",", "#3"}], "]"}]}], "]"}]}]}], 
            ";", "\[IndentingNewLine]", 
            RowBox[{"ze", "=", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"Ve", "\[LessEqual]", "0"}], ",", 
               RowBox[{"ConstantArray", "[", 
                RowBox[{"0", ",", "#3"}], "]"}], ",", 
               RowBox[{"RandomReal", "[", 
                RowBox[{
                 RowBox[{"NormalDistribution", "[", 
                  RowBox[{"0", ",", 
                   SqrtBox["Ve"]}], "]"}], ",", "#3"}], "]"}]}], "]"}]}], ";",
             "\[IndentingNewLine]", 
            RowBox[{"(*", " ", 
             RowBox[{
             "find", " ", "the", " ", "left", " ", "origin", " ", "and", " ", 
              "breakpoints", " ", "of", " ", "the", " ", "selected", " ", 
              "offspring"}], " ", "*)"}], "\[IndentingNewLine]", 
            RowBox[{"sbp", "=", "#5"}], ";", 
            RowBox[{"sXl", "=", "#4"}], ";", 
            RowBox[{"(*", " ", 
             RowBox[{
             "generate", " ", "junctions", " ", "in", " ", "the", " ", 
              "selected", " ", "children", " ", "by", " ", "combining", " ", 
              "gametes", " ", "from", " ", "the", " ", "two", " ", 
              "parents"}], " ", "*)"}], "\[IndentingNewLine]", 
            RowBox[{"njk", "=", 
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"MendelC", "[", 
                 RowBox[{"\[ScriptCapitalP]", ",", 
                  RowBox[{"sXl", "\[LeftDoubleBracket]", 
                   RowBox[{"j", ",", "i"}], "\[RightDoubleBracket]"}], ",", 
                  RowBox[{"sbp", "\[LeftDoubleBracket]", 
                   RowBox[{"j", ",", "i"}], "\[RightDoubleBracket]"}], ",", 
                  "R"}], "]"}], "[", 
                RowBox[{"jun", "\[LeftDoubleBracket]", 
                 RowBox[{
                 "#2", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}],
                  "\[RightDoubleBracket]"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"j", ",", 
                 RowBox[{"Length", "[", "#1", "]"}]}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"i", ",", "2"}], "}"}]}], "]"}]}], ";", 
            RowBox[{"(*", " ", 
             RowBox[{
             "generate", " ", "mutations", " ", "in", " ", "the", " ", 
              "selected", " ", "children", " ", "by", " ", "combining", " ", 
              "gametes", " ", "from", " ", "the", " ", "two", " ", 
              "parents"}], " ", "*)"}], "\[IndentingNewLine]", 
            RowBox[{"nmk", "=", 
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"MendelM", "[", 
                 RowBox[{"\[ScriptCapitalP]", ",", 
                  RowBox[{"sXl", "\[LeftDoubleBracket]", 
                   RowBox[{"j", ",", "i"}], "\[RightDoubleBracket]"}], ",", 
                  RowBox[{"sbp", "\[LeftDoubleBracket]", 
                   RowBox[{"j", ",", "i"}], "\[RightDoubleBracket]"}], ",", 
                  "R"}], "]"}], "[", 
                RowBox[{"mut", "\[LeftDoubleBracket]", 
                 RowBox[{
                 "#2", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}],
                  "\[RightDoubleBracket]"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"j", ",", 
                 RowBox[{"Length", "[", "#1", "]"}]}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"i", ",", "2"}], "}"}]}], "]"}]}], ";", 
            RowBox[{"(*", 
             RowBox[{"return", " ", "the", " ", "new", " ", 
              RowBox[{"{", 
               RowBox[{
               "kids", ",", "p", ",", "j", ",", "zk", ",", "zi", ",", "ze", 
                ",", "mut"}], "}"}]}], " ", "*)"}], "\[IndentingNewLine]", 
            RowBox[{"Transpose", "[", 
             RowBox[{"{", 
              RowBox[{
              "#1", ",", "nk", ",", "njk", ",", " ", "zk", ",", "newzi", ",", 
               "ze", ",", "nmk"}], "}"}], "]"}]}], ")"}], "&"}], ",", 
         RowBox[{"{", 
          RowBox[{"kids", ",", "pars", ",", "nn", ",", "Xl", ",", "bpl"}], 
          "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
       "make", " ", "sure", " ", "that", " ", "the", " ", "order", " ", 
        "corresponds", " ", "to", " ", "the", " ", "list", " ", "of", " ", 
        "kids", " ", "in", " ", "the", " ", "pedigree"}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"newkids", "=", 
       RowBox[{"Transpose", "[", 
        RowBox[{"Sort", "[", 
         RowBox[{"Flatten", "[", 
          RowBox[{"newkids", ",", "1"}], "]"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{"update", " ", "the", " ", "data", " ", "structures"}], " ", 
        "-", " ", 
        RowBox[{"note", " ", "that", " ", 
         RowBox[{"MapThread", "[", 
          RowBox[{"AppendTo", ",", 
           RowBox[{"{", "\[Ellipsis]", "}"}]}], "]"}], " ", "cannot", " ", 
         "be", " ", "used"}]}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"time", "[", "\[ScriptCapitalP]", "]"}], "+=", "1"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"AppendTo", "[", 
       RowBox[{
        RowBox[{"pop", "[", "\[ScriptCapitalP]", "]"}], ",", 
        RowBox[{
        "newkids", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}], 
       "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"AppendTo", "[", 
       RowBox[{
        RowBox[{"junctions", "[", "\[ScriptCapitalP]", "]"}], ",", 
        RowBox[{
        "newkids", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}]}], 
       "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"AppendTo", "[", 
       RowBox[{
        RowBox[{"zChrom", "[", "\[ScriptCapitalP]", "]"}], ",", 
        RowBox[{
        "newkids", "\[LeftDoubleBracket]", "4", "\[RightDoubleBracket]"}]}], 
       "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"AppendTo", "[", 
       RowBox[{
        RowBox[{"zInf", "[", "\[ScriptCapitalP]", "]"}], ",", 
        RowBox[{
        "newkids", "\[LeftDoubleBracket]", "5", "\[RightDoubleBracket]"}]}], 
       "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"AppendTo", "[", 
       RowBox[{
        RowBox[{"zEnv", "[", "\[ScriptCapitalP]", "]"}], ",", 
        RowBox[{
        "newkids", "\[LeftDoubleBracket]", "6", "\[RightDoubleBracket]"}]}], 
       "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{
        "find", " ", "the", " ", "new", " ", "F", " ", "amongst", " ", "the", 
         " ", "kids"}], " ", "-", " ", 
        RowBox[{"note", " ", "P", " ", "has", " ", "entries", " ", 
         RowBox[{"{", "\[Ellipsis]1\[Ellipsis]1\[Ellipsis]", "}"}]}]}], 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{"f1", "=", 
       RowBox[{"f", "+", 
        RowBox[{"DiagonalMatrix", "[", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"1.", "-", "fd"}], ")"}], "/", "2"}], "]"}]}]}], ";", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{"F", " ", "for", " ", "random"}], ",", " ", 
        RowBox[{"not", " ", "distinct"}], ",", " ", "genes"}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"fii", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Extract", "[", 
          RowBox[{"f1", ",", "#"}], "]"}], "&"}], "/@", 
        RowBox[{"posPars", "[", "P", "]"}]}]}], ";", 
      RowBox[{"(*", " ", 
       RowBox[{"The", " ", "new", " ", 
        SubscriptBox["F", 
         RowBox[{"i", ",", "i"}]]}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"fij", "=", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"P", ".", "f1", ".", 
          RowBox[{"Transpose", "[", "P", "]"}]}], ")"}], "/", "4"}]}], ";", 
      RowBox[{"(*", " ", 
       RowBox[{"The", " ", "new", " ", 
        SubscriptBox["F", 
         RowBox[{"i", ",", "j"}]]}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"AppendTo", "[", 
       RowBox[{
        RowBox[{"F", "[", "\[ScriptCapitalP]", "]"}], ",", 
        RowBox[{"fij", "+", 
         RowBox[{"DiagonalMatrix", "[", 
          RowBox[{"fii", "-", 
           RowBox[{"Diagonal", "[", "fij", "]"}]}], "]"}]}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"newM", "=", 
       RowBox[{
       "newkids", "\[LeftDoubleBracket]", "7", "\[RightDoubleBracket]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"U", ">", "0"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"nMut", "=", 
          RowBox[{"RandomInteger", "[", 
           RowBox[{
            RowBox[{"PoissonDistribution", "[", "U", "]"}], ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Length", "[", "mut", "]"}], ",", "2"}], "}"}]}], 
           "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"nMutTot", "=", 
          RowBox[{"Total", "[", 
           RowBox[{"nMut", ",", "2"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"nm", "=", 
          RowBox[{"numM", "[", "\[ScriptCapitalP]", "]"}]}], ";", 
         RowBox[{
          RowBox[{"numM", "[", "\[ScriptCapitalP]", "]"}], "=", 
          RowBox[{"nm", "+", "nMutTot"}]}], ";", 
         RowBox[{"rn", "=", 
          RowBox[{"nm", "+", 
           RowBox[{"Range", "[", "nMutTot", "]"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"MapThread", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"originM", "[", "\[ScriptCapitalP]", "]"}], "[", "#1",
                 "]"}], "=", 
               RowBox[{"time", "[", "\[ScriptCapitalP]", "]"}]}], ";", 
              RowBox[{
               RowBox[{
                RowBox[{"locM", "[", "\[ScriptCapitalP]", "]"}], "[", "#1", 
                "]"}], "=", "#2"}]}], ")"}], "&"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{"rn", ",", 
             RowBox[{"RandomReal", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"0", ",", "R"}], "}"}], ",", "nMutTot"}], "]"}]}], 
            "}"}]}], "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"newM", "=", 
          RowBox[{"Map", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Join", "@@", "#"}], "&"}], ",", 
            RowBox[{"Transpose", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"newM", ",", 
                RowBox[{"nm", "+", 
                 RowBox[{"partitionList", "[", "nMut", "]"}]}]}], "}"}], ",", 
              
              RowBox[{"{", 
               RowBox[{"3", ",", "1", ",", "2"}], "}"}]}], "]"}], ",", 
            RowBox[{"{", "2", "}"}]}], "]"}]}]}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"AppendTo", "[", 
       RowBox[{
        RowBox[{"mutations", "[", "\[ScriptCapitalP]", "]"}], ",", "newM"}], 
       "]"}], ";"}]}], "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.667538833657012*^9, 3.667538929944538*^9}, {
   3.667538963598817*^9, 3.667538964613865*^9}, 3.6919826916607933`*^9, {
   3.691982771727373*^9, 3.6919827770150967`*^9}, {3.691982870899932*^9, 
   3.691982896968453*^9}, {3.692016531289781*^9, 3.6920165832455473`*^9}, {
   3.6920166566000423`*^9, 3.692016689271001*^9}, {3.6920194825393333`*^9, 
   3.692019684216501*^9}, {3.6920197187911587`*^9, 3.692019719455627*^9}, {
   3.692019756844923*^9, 3.692019814657701*^9}, {3.692019856677642*^9, 
   3.692019858623295*^9}, {3.692020304047558*^9, 3.692020318909976*^9}, {
   3.6924338332133017`*^9, 3.692433845042138*^9}, {3.692436950777597*^9, 
   3.6924369602782307`*^9}, {3.6924370030377083`*^9, 
   3.6924370032921867`*^9}, {3.692437236942505*^9, 3.692437318292788*^9}, {
   3.692437359830422*^9, 3.6924373717709627`*^9}, {3.69245474395648*^9, 
   3.6924547576655493`*^9}, {3.692455798434577*^9, 3.692455822395589*^9}, {
   3.692455864503039*^9, 3.692455869481414*^9}, {3.692505347088799*^9, 
   3.6925053476569757`*^9}, 3.692505431364753*^9, {3.692505534309514*^9, 
   3.6925055527319937`*^9}, {3.692777701968698*^9, 3.6927777049053917`*^9}, {
   3.6927921954944267`*^9, 3.692792299567438*^9}, {3.692792343972632*^9, 
   3.6927923966950283`*^9}, {3.6927924543641977`*^9, 
   3.6927925543014183`*^9}, {3.692792600135681*^9, 3.692792627369739*^9}, {
   3.6927933792908916`*^9, 3.692793387652047*^9}, {3.692793424966074*^9, 
   3.6927934738488407`*^9}, {3.692793539102133*^9, 3.692793540405376*^9}, {
   3.692793591633626*^9, 3.692793693662222*^9}, {3.6927940601304283`*^9, 
   3.6927942217608013`*^9}, {3.692794378231843*^9, 3.692794438617622*^9}, {
   3.692794478091794*^9, 3.692794480490116*^9}, {3.69279451884709*^9, 
   3.692794613248248*^9}, {3.692794686290906*^9, 3.692794730538795*^9}, {
   3.692795247486623*^9, 3.692795265860965*^9}, {3.692795296300028*^9, 
   3.692795299491096*^9}, {3.692795399176524*^9, 3.692795404295373*^9}, {
   3.692795483196252*^9, 3.692795544966769*^9}, {3.69280504165911*^9, 
   3.692805056511922*^9}, {3.692805128061509*^9, 3.692805182082822*^9}, {
   3.692863104706209*^9, 3.692863122213643*^9}, {3.69286408973346*^9, 
   3.692864120681922*^9}, {3.6928642901347857`*^9, 3.692864291718186*^9}, {
   3.693040817399316*^9, 3.693040912510538*^9}, {3.693041008671734*^9, 
   3.693041186631576*^9}, {3.693041675011348*^9, 3.693041704914547*^9}, 
   3.693041930109172*^9, 3.693042457640297*^9, {3.693049449737628*^9, 
   3.69304949427253*^9}, {3.6930495451915293`*^9, 3.6930495952774887`*^9}, {
   3.693050512359908*^9, 3.693050703319364*^9}, {3.693050753574728*^9, 
   3.693050756851881*^9}, 3.693062568540903*^9, {3.6932808009812527`*^9, 
   3.693280840564837*^9}, {3.693281048271302*^9, 3.693281065411634*^9}, 
   3.6932825807163553`*^9, 3.693367577124544*^9, {3.693373135923843*^9, 
   3.693373142067278*^9}, {3.693376892221119*^9, 3.6933769581135893`*^9}, {
   3.693378460851931*^9, 3.6933784889508142`*^9}, {3.693458390365932*^9, 
   3.6934584065973682`*^9}, {3.6934584542998877`*^9, 3.693458587623515*^9}, {
   3.693458625935972*^9, 3.693458626921006*^9}, {3.6934587163743973`*^9, 
   3.6934587177110453`*^9}, {3.69345988157408*^9, 3.693459885916984*^9}, {
   3.693459987480242*^9, 3.693460010067601*^9}, {3.6934600820824633`*^9, 
   3.693460085031432*^9}, {3.6934601575091257`*^9, 3.693460159060553*^9}, {
   3.6934602723607397`*^9, 3.6934603294147997`*^9}, {3.693460499547368*^9, 
   3.693460623455646*^9}, {3.6934609355267057`*^9, 3.693461091665492*^9}, {
   3.693461138089816*^9, 3.693461163633677*^9}, 3.693461361779065*^9, {
   3.6934613945303173`*^9, 3.6934614313771477`*^9}, {3.693463297215989*^9, 
   3.693463298815074*^9}, {3.693463593061068*^9, 3.693463629220956*^9}, {
   3.693463670176505*^9, 3.693463701012918*^9}, 3.693463753949194*^9, 
   3.6934638042273684`*^9, {3.696952396007182*^9, 3.696952400989687*^9}, {
   3.6969949226083193`*^9, 3.696994963781088*^9}, {3.696997000484433*^9, 
   3.6969971711003523`*^9}, {3.6969975234109497`*^9, 3.696997585714143*^9}, {
   3.69699765339014*^9, 3.696997706298675*^9}, {3.696998015270891*^9, 
   3.696998017942786*^9}, {3.696998110556696*^9, 3.696998114884564*^9}, {
   3.698311960708725*^9, 3.698312012699255*^9}, {3.698312048402445*^9, 
   3.698312067001975*^9}, {3.698312115825604*^9, 3.698312136839394*^9}, {
   3.698312173967965*^9, 3.698312174847466*^9}, 3.698312227542263*^9, {
   3.698315016246441*^9, 3.6983150222974997`*^9}, {3.698315164166871*^9, 
   3.698315185182397*^9}, {3.6983171724948177`*^9, 3.698317239358279*^9}, {
   3.698317456751486*^9, 3.69831751182232*^9}, {3.6983176922096577`*^9, 
   3.698317708592944*^9}, {3.698320405431508*^9, 3.698320425964529*^9}, {
   3.698320480411677*^9, 3.6983204827001247`*^9}, {3.698320565317387*^9, 
   3.698320590307733*^9}, {3.698320643188398*^9, 3.698320644180255*^9}, {
   3.69883434387757*^9, 3.69883434502866*^9}, {3.698834432512723*^9, 
   3.698834443787525*^9}, {3.698838750617539*^9, 3.6988388547756453`*^9}, {
   3.6988391054113503`*^9, 3.698839109073421*^9}, {3.6988399768281116`*^9, 
   3.698840166110155*^9}, {3.6988962832392483`*^9, 3.698896363523984*^9}, {
   3.698897122916926*^9, 3.6988971280434113`*^9}, {3.6988974640528316`*^9, 
   3.6988974693155813`*^9}, {3.698979180799863*^9, 3.6989791930170097`*^9}, 
   3.698981225818396*^9, {3.698981260985882*^9, 3.698981287367011*^9}, {
   3.6995976077808857`*^9, 3.699597703757359*^9}, 3.6996029600017843`*^9, {
   3.70063315104667*^9, 3.700633160221238*^9}, {3.700635783515545*^9, 
   3.70063579376012*^9}, 3.700635834055127*^9, {3.700635867085177*^9, 
   3.700635953409295*^9}, {3.70063599059477*^9, 3.7006360633703127`*^9}, {
   3.70063610140226*^9, 3.700636209159903*^9}, 3.7006388814184103`*^9, {
   3.700638963499516*^9, 3.700638985987258*^9}, {3.700642025600794*^9, 
   3.700642201570163*^9}, 3.700642235250581*^9, 3.700642592733203*^9, {
   3.700642656768321*^9, 3.700642795633177*^9}, {3.700642831637575*^9, 
   3.700642875660808*^9}, {3.700643146901423*^9, 3.7006431854064493`*^9}, {
   3.700643233045929*^9, 3.700643263372954*^9}, {3.700643342088242*^9, 
   3.700643414627348*^9}, {3.700643471358396*^9, 3.700643475445025*^9}, {
   3.700643654428956*^9, 3.7006436856492987`*^9}, {3.7006494255290623`*^9, 
   3.700649445786227*^9}, {3.700650197417192*^9, 3.7006502072792253`*^9}, {
   3.7006504147342243`*^9, 3.70065043544479*^9}, 3.700657213613455*^9, {
   3.7006572593956337`*^9, 3.700657266365881*^9}, {3.7006573240460367`*^9, 
   3.700657329811975*^9}, {3.700657373275465*^9, 3.7006573835927258`*^9}, {
   3.700657418617488*^9, 3.700657430375683*^9}, 3.700706504688836*^9, 
   3.70070696010182*^9, 3.7007071911637917`*^9, {3.700707283350231*^9, 
   3.7007072944058933`*^9}, 3.700709773350975*^9, {3.700719155834394*^9, 
   3.700719156274*^9}, {3.700719389164824*^9, 3.700719389756776*^9}},
 CellLabel->
  "In[371]:=",ExpressionUUID->"73387dba-904f-418b-98b3-602c0febb0af"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"iterateDiploidNew", "[", 
    RowBox[{"\[ScriptCapitalP]_", ",", 
     RowBox[{"P", ":", 
      RowBox[{"{", "___SparseArray", "}"}]}], ",", "Vs_", ",", "Ve_", ",", 
     "z_", ",", "R_", ",", "opts___Rule"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "t", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"pedigreeList", "[", "\[ScriptCapitalP]", "]"}], "=", "P"}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{"iterateDiploidNew", "[", 
         RowBox[{"\[ScriptCapitalP]", ",", 
          RowBox[{"P", "\[LeftDoubleBracket]", "t", "\[RightDoubleBracket]"}],
           ",", "Vs", ",", "Ve", ",", "z", ",", "R", ",", "opts"}], "]"}], 
        ",", 
        RowBox[{"{", 
         RowBox[{"t", ",", 
          RowBox[{"Length", "[", "P", "]"}]}], "}"}]}], "]"}]}]}], "]"}]}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.667538978789452*^9, 3.6675389880691032`*^9}, {
   3.691982780255022*^9, 3.6919827819269342`*^9}, {3.69201650281045*^9, 
   3.692016515888678*^9}, {3.6925056050271893`*^9, 3.692505629976997*^9}, {
   3.692505721186942*^9, 3.692505764898075*^9}, {3.692793983607205*^9, 
   3.6927940062753572`*^9}, {3.6928631068965282`*^9, 
   3.6928631755593443`*^9}, {3.6928642999961452`*^9, 3.692864301459963*^9}, {
   3.693373044328743*^9, 3.693373046920403*^9}, {3.693457880395282*^9, 
   3.693457883354137*^9}, {3.693457928104776*^9, 3.693457929833337*^9}, {
   3.693458024877343*^9, 3.693458066292261*^9}, {3.6934582259076777`*^9, 
   3.693458238625869*^9}, {3.698307971395857*^9, 3.69830800188699*^9}, {
   3.6988345800792217`*^9, 3.698834599112224*^9}, {3.698835784247013*^9, 
   3.698835808532668*^9}, {3.698835857959433*^9, 3.6988358742981157`*^9}, {
   3.698835907159892*^9, 3.6988359103744707`*^9}, {3.6988371245789413`*^9, 
   3.698837243428219*^9}, {3.699427271638323*^9, 3.6994272736625233`*^9}, 
   3.699434668798869*^9, {3.700633199028289*^9, 3.700633210058124*^9}, {
   3.700657200737542*^9, 3.700657204113022*^9}, 3.700709339839513*^9},
 CellLabel->
  "In[372]:=",ExpressionUUID->"18f31a6e-4126-4605-a0d2-9259bcf77baa"]
}, Closed]],

Cell[CellGroupData[{

Cell["mutationRate", "Subsubsection",
 CellChangeTimes->{{3.700633219793922*^9, 
  3.700633223424739*^9}},ExpressionUUID->"b3cc47f6-a635-4692-abc7-\
daeedc416d6b"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"mutationRate", "::", "usage"}], "=", 
   "\"\<mutationRate is an option for iterateDiploidNew that sets the rate of \
infinite-sites mutation per haploid genome.\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.700633228006473*^9, 3.7006332621197157`*^9}, 
   3.703379748303501*^9},
 CellLabel->
  "In[373]:=",ExpressionUUID->"bc8a9808-c4d7-424d-8272-3cc69cbee6e0"]
}, Closed]],

Cell[CellGroupData[{

Cell["selectKids", "Subsubsection",
 CellChangeTimes->{
  3.6983241152054873`*^9},ExpressionUUID->"b34a201c-eabd-4c82-b22e-\
2841599ad0e0"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"selectKids", "::", "usage"}], "=", 
   "\"\<selectKids[{\!\(\*SubscriptBox[\(z\), \
\(1\)]\),\[Ellipsis]},{\!\(\*SubscriptBox[\(n\), \(s\)]\),\!\(\*SubscriptBox[\
\(n\), \(d\)]\)},{\!\(\*SubsuperscriptBox[\(n\), \(s\), \
\(*\)]\),\!\(\*SubsuperscriptBox[\(n\), \(d\), \(*\)]\)}] selects, for one \
family, \!\(\*SubsuperscriptBox[\(n\), \(s\), \(*\)]\) sons and \
\!\(\*SubsuperscriptBox[\(n\), \(d\), \(*\)]\) daughters out of \
\!\(\*SubscriptBox[\(n\), \(s\)]\), \!\(\*SubscriptBox[\(n\), \(d\)]\), \
returning a Boolean vector that determines which individuals from the whole \
sibship will be selected. Selection is based on the \!\(\*SubscriptBox[\(z\), \
\(i\)]\), which must have length (\!\(\*SubscriptBox[\(n\), \
\(s\)]\)+\!\(\*SubscriptBox[\(n\), \(d\)]\)). The first \
\!\(\*SubscriptBox[\(n\), \(s\)]\) are taken to be male, the remainder \
female. \>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.69832382345284*^9, 3.698324107089306*^9}, {
  3.698324744415228*^9, 3.69832481022791*^9}, {3.698324878561098*^9, 
  3.69832489516846*^9}, {3.6983249261197*^9, 3.6983249364877*^9}, {
  3.698327995358131*^9, 3.698328002260957*^9}, {3.698831688130966*^9, 
  3.6988317294191027`*^9}},
 CellLabel->
  "In[374]:=",ExpressionUUID->"9bc5612a-1f5b-44ca-9550-dc94bc75b639"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"selectKids", "::", "badSons"}], "=", 
   "\"\<# of selected sons, `1`, is not consistent with the total #, \
`2`\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6988388764716578`*^9, 3.69883892722157*^9}, {
  3.698839006343623*^9, 3.698839010349893*^9}},
 CellLabel->
  "In[375]:=",ExpressionUUID->"aa53de80-bde2-4b73-8522-233d615117ab"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"selectKids", "::", "badDaughters"}], "=", 
   "\"\<# of selected daughters, `1`, is not consistent with the total #, `2`\
\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6988388764716578`*^9, 3.69883892722157*^9}, {
  3.698839006343623*^9, 3.6988390240135937`*^9}},
 CellLabel->
  "In[376]:=",ExpressionUUID->"677d9dd4-6b28-44e3-8be3-3561c0492d87"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"selectKids", "[", 
    RowBox[{"zl_List", ",", 
     RowBox[{"{", 
      RowBox[{"n0_", ",", "n1_"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"ns0_", ",", "ns1_"}], "}"}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"ztl", ",", "ss"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"ztl", "=", 
       RowBox[{"Transpose", "[", 
        RowBox[{"{", 
         RowBox[{"zl", ",", 
          RowBox[{"Range", "[", 
           RowBox[{"Length", "[", "zl", "]"}], "]"}]}], "}"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"ns0", ">", "n0"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Message", "[", 
          RowBox[{
           RowBox[{"selectKids", "::", "badSons"}], ",", "ns0", ",", "n0"}], 
          "]"}], ";", 
         RowBox[{"ns0", "=", "n0"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"ns1", ">", "n1"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Message", "[", 
          RowBox[{
           RowBox[{"selectKids", "::", "badDaughters"}], ",", "ns1", ",", 
           "n1"}], "]"}], ";", 
         RowBox[{"ns1", "=", "n1"}]}]}], "]"}], ";", 
      RowBox[{"ss", "=", 
       RowBox[{"Flatten", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Last", "/@", 
           RowBox[{"Take", "[", 
            RowBox[{
             RowBox[{"Sort", "[", 
              RowBox[{
               RowBox[{"Take", "[", 
                RowBox[{"ztl", ",", "n0"}], "]"}], ",", 
               RowBox[{
                RowBox[{
                 RowBox[{
                 "#1", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}],
                  ">", 
                 RowBox[{
                 "#2", "\[LeftDoubleBracket]", "1", 
                  "\[RightDoubleBracket]"}]}], "&"}]}], "]"}], ",", "ns0"}], 
            "]"}]}], ",", 
          RowBox[{"Last", "/@", 
           RowBox[{"Take", "[", 
            RowBox[{
             RowBox[{"Sort", "[", 
              RowBox[{
               RowBox[{"Take", "[", 
                RowBox[{"ztl", ",", 
                 RowBox[{"-", "n1"}]}], "]"}], ",", 
               RowBox[{
                RowBox[{
                 RowBox[{
                 "#1", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}],
                  ">", 
                 RowBox[{
                 "#2", "\[LeftDoubleBracket]", "1", 
                  "\[RightDoubleBracket]"}]}], "&"}]}], "]"}], ",", "ns1"}], 
            "]"}]}]}], "}"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"ReplacePart", "[", 
       RowBox[{
        RowBox[{"ConstantArray", "[", 
         RowBox[{"False", ",", 
          RowBox[{"n0", "+", "n1"}]}], "]"}], ",", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"List", "/@", "ss"}], ")"}], "\[Rule]", "True"}]}], 
       "]"}]}]}], "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.698324116502487*^9, 3.698324211548954*^9}, {
  3.698324593366034*^9, 3.6983246662731647`*^9}, {3.698328024004919*^9, 
  3.698328247034346*^9}, {3.6983282870826187`*^9, 3.698328433251382*^9}, {
  3.698329173550371*^9, 3.698329188053055*^9}, {3.69883893825394*^9, 
  3.69883899843076*^9}, {3.698839031637821*^9, 3.698839060078266*^9}},
 CellLabel->
  "In[377]:=",ExpressionUUID->"eefcd97f-3699-48af-9ffd-6505aa00728c"]
}, Closed]],

Cell[CellGroupData[{

Cell["iterateDiploid", "Subsubsection",
 InitializationCell->True,
 CellChangeTimes->{{3.6919086906509666`*^9, 3.691908692033594*^9}, {
   3.69192887672196*^9, 3.691928879640168*^9}, 3.691982146367844*^9, {
   3.6928628486914597`*^9, 3.692862850107448*^9}, {3.693367567699984*^9, 
   3.6933675709318132`*^9}},ExpressionUUID->"1e06bff0-28cc-498d-bc1f-\
7e24640a1871"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"iterateDiploid", "::", "usage"}], "=", 
   "\"\<iterateDiploid[\[ScriptCapitalP],P,\!\(\*SubscriptBox[\(V\), \
\(s\)]\),z,\[Theta],R] extends the simulation \[ScriptCapitalP] by one \
generation, given the pedigree matrix P, and starting with a diploid \
population represented by the last elements of \
pop[\[ScriptCapitalP]],junctions[\[ScriptCapitalP]],zInf[\[ScriptCapitalP]],F[\
\[ScriptCapitalP]].  Each generation of pop[\[ScriptCapitalP]] is a list of \
diploid genotypes at discrete loci with allelic states 0 or 1. Similarly, \
junctions[\[ScriptCapitalP]] lists diploid genomes, each described by their \
junctions, {\!\(\*SubscriptBox[\(j\), \(1\)]\),\[Ellipsis]}, representing a \
continuous genome, length R. Information about junctions is held in locJ[\
\[ScriptCapitalP]], hapJ[\[ScriptCapitalP]], originJ[\[ScriptCapitalP]]. \
There is an infinitesimal background, zInf[\[ScriptP]], represented by \
breeding values. Identity by descent, F[\[ScriptCapitalP]], is calculated \
from the pedigree.  Selection is within families, conditional on the \
pedigree. For every distinct pair of parents, which have k surviving \
offspring, Round[k/\[Theta]] are generated, and their phenotypes calculated \
using the function z[{{0,\[Ellipsis]},{1,\[Ellipsis]}}], which includes a \
random environmental component, and adding the infinitesimal component, from \
{\!\(\*SubscriptBox[\(z\), \(1\)]\),\[Ellipsis]}. The largest values are \
chosen to survive.  The infinitesimal component is normally distributed \
around the midparent, with segregation variance \!\(\*SubscriptBox[\(V\), \(s\
\)]\)(1-\!\(\*OverscriptBox[\(F\), \(_\)]\)), \!\(\*OverscriptBox[\(F\), \
\(_\)]\) being the mean F between distinct genes within the parents. \
iterateDiploid[\[ScriptCapitalP],{\!\(\*SubscriptBox[\(P\), \(1\)]\),\
\[Ellipsis]},\!\(\*SubscriptBox[\(V\), \(s\)]\),z,\[Theta]] does the same for \
many generations, adding to pop[\[ScriptCapitalP]], junctions[\
\[ScriptCapitalP]], zInf[\[ScriptCapitalP]], F[\[ScriptCapitalP]].  Note: \
this algorithm does not record the actual trait values - the environmental \
contribution generated by z is lost.\!\(\*StyleBox[\" \
\",FontWeight->\"Plain\"]\)\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6675386045155067`*^9, 3.6675386149526987`*^9}, {
   3.667538791460452*^9, 3.667538797442479*^9}, {3.691906798053582*^9, 
   3.6919067994442244`*^9}, {3.69190868658792*^9, 3.6919087195298986`*^9}, 
   3.6919088588743877`*^9, {3.692016301586026*^9, 3.692016482875176*^9}, {
   3.692433594403454*^9, 3.692433641203043*^9}, {3.692433677722492*^9, 
   3.6924338216425667`*^9}, {3.6924368337339573`*^9, 3.692436848211557*^9}, {
   3.692505481674611*^9, 3.692505526776856*^9}, {3.692777546695199*^9, 
   3.692777626730526*^9}, {3.692777666463048*^9, 3.6927776668170843`*^9}, {
   3.6927937078286657`*^9, 3.692793795945076*^9}, {3.69286285312022*^9, 
   3.692863070905595*^9}, {3.692863198909171*^9, 3.692863288481285*^9}, {
   3.692863320172968*^9, 3.692863461727201*^9}, {3.692863563995429*^9, 
   3.692863569631765*^9}, {3.692863965460837*^9, 3.692864083030568*^9}, {
   3.692864277584635*^9, 3.6928642824947643`*^9}, {3.692867996629299*^9, 
   3.692868029747164*^9}, {3.6930612864500237`*^9, 3.6930613163132563`*^9}, {
   3.6930613594882*^9, 3.69306150382259*^9}, {3.693279678712373*^9, 
   3.693279679294909*^9}, {3.693280202264105*^9, 3.69328037583566*^9}, {
   3.693280728253373*^9, 3.6932807903130713`*^9}, {3.693280880193718*^9, 
   3.693280881801025*^9}, {3.693280917281805*^9, 3.693281015310154*^9}, {
   3.693281075261157*^9, 3.6932810871990833`*^9}, {3.693281158587203*^9, 
   3.693281166667367*^9}, {3.693282214261389*^9, 3.693282426318266*^9}, {
   3.6932824868531427`*^9, 3.693282546011204*^9}, {3.6932829570641336`*^9, 
   3.693282962112606*^9}, {3.693367574251128*^9, 3.6933675796435843`*^9}, {
   3.69336761500651*^9, 3.693367631508881*^9}, {3.69337309095022*^9, 
   3.693373092644497*^9}, {3.693373220717763*^9, 3.693373315329618*^9}, {
   3.693457971849574*^9, 3.693458011241437*^9}},
 CellLabel->
  "In[378]:=",ExpressionUUID->"c79fbb0d-e09e-4d82-b00d-80c6305ca619"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"iterateDiploid", "[", 
    RowBox[{
    "\[ScriptCapitalP]_", ",", "P_SparseArray", ",", "Vs_", ",", "z_", ",", 
     "\[Theta]_", ",", "R_"}], "]"}], ":=", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"p", "=", 
        RowBox[{
         RowBox[{"pop", "[", "\[ScriptCapitalP]", "]"}], 
         "\[LeftDoubleBracket]", 
         RowBox[{"-", "1"}], "\[RightDoubleBracket]"}]}], ",", 
       RowBox[{"zi", "=", 
        RowBox[{
         RowBox[{"zInf", "[", "\[ScriptCapitalP]", "]"}], 
         "\[LeftDoubleBracket]", 
         RowBox[{"-", "1"}], "\[RightDoubleBracket]"}]}], ",", 
       RowBox[{"jun", "=", 
        RowBox[{
         RowBox[{"junctions", "[", "\[ScriptCapitalP]", "]"}], 
         "\[LeftDoubleBracket]", 
         RowBox[{"-", "1"}], "\[RightDoubleBracket]"}]}], ",", 
       RowBox[{"f", "=", 
        RowBox[{
         RowBox[{"F", "[", "\[ScriptCapitalP]", "]"}], "\[LeftDoubleBracket]", 
         RowBox[{"-", "1"}], "\[RightDoubleBracket]"}]}], ",", "fd", ",", 
       "f1", ",", "fii", ",", "fij", ",", "pars", ",", "kids", ",", "nn", ",",
        "nk", ",", "zk", ",", "zt", ",", "fn", ",", "newkids", ",", "newzi", 
       ",", "sel", ",", "Xl", ",", "bpl", ",", "nck", ",", "sbp", ",", "sXl", 
       ",", "i", ",", "j", ",", "vsf"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"list", " ", "all", " ", "distinct", " ", "families"}], " ", 
      "*)"}], "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"pars", "=", 
       RowBox[{"Union", "[", 
        RowBox[{"Sort", "/@", 
         RowBox[{"Parents", "[", "P", "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "list", " ", "the", " ", "kids", " ", "from", " ", "each", " ", "of", 
        " ", "the", " ", "distinct", " ", 
        RowBox[{"families", ".", " ", "These"}], " ", "will", " ", "each", 
        " ", "be", " ", "selected", " ", "from", " ", "a", " ", "larger", " ",
         "#", " ", "of", " ", "kids"}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"kids", "=", 
       RowBox[{"Flatten", "/@", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"Position", "[", 
            RowBox[{
             RowBox[{"Parents", "[", "P", "]"}], ",", "#"}], "]"}], "&"}], "/@",
           "pars"}], ")"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"nn", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Round", "[", 
          RowBox[{
           RowBox[{"Length", "[", "#", "]"}], "/", "\[Theta]"}], "]"}], "&"}],
         "/@", "kids"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"The", " ", "left", " ", "origins"}], ",", " ", "Xl", ",", 
        " ", 
        RowBox[{"and", " ", "breakpoints"}], ",", " ", "bpl", ",", " ", 
        RowBox[{
        "are", " ", "drawn", " ", "in", " ", "one", " ", "step", " ", "to", 
         " ", "save", " ", "time"}]}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"Xl", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Partition", "[", 
          RowBox[{
           RowBox[{"RandomInteger", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"0", ",", "1"}], "}"}], ",", 
             RowBox[{"2", "#"}]}], "]"}], ",", "2"}], "]"}], "&"}], "/@", 
        "nn"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"bpl", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Partition", "[", 
          RowBox[{
           RowBox[{"makeBreakPoints", "[", 
            RowBox[{
             RowBox[{"2", "#"}], ",", "R"}], "]"}], ",", "2"}], "]"}], "&"}], 
        "/@", "nn"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"fn", "[", "xt_", "]"}], "[", "y_", "]"}], ":=", 
       RowBox[{"(", 
        RowBox[{"y", "\[GreaterEqual]", "xt"}], ")"}]}], ";", 
      RowBox[{"fd", "=", 
       RowBox[{"Diagonal", "[", "f", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"newkids", "=", 
       RowBox[{"MapThread", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{"(*", " ", 
            RowBox[{
             RowBox[{
             "run", " ", "through", " ", "all", " ", "the", " ", "families"}],
              ",", " ", 
             RowBox[{
             "selecting", " ", "the", " ", "new", " ", "kids", " ", "and", 
              " ", "the", " ", "new", " ", "infinitesimal", " ", 
              "background"}]}], "*)"}], "\[IndentingNewLine]", 
           RowBox[{"(*", " ", 
            RowBox[{
            "generate", " ", "the", " ", "children", " ", "by", " ", 
             "combining", " ", "gametes", " ", "from", " ", "the", " ", "two",
              " ", "parents"}], " ", "*)"}], "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"nk", "=", 
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"Mendel", "[", 
                 RowBox[{
                  RowBox[{"#4", "\[LeftDoubleBracket]", 
                   RowBox[{"j", ",", "i"}], "\[RightDoubleBracket]"}], ",", 
                  RowBox[{"#5", "\[LeftDoubleBracket]", 
                   RowBox[{"j", ",", "i"}], "\[RightDoubleBracket]"}], ",", 
                  "R"}], "]"}], "[", 
                RowBox[{"p", "\[LeftDoubleBracket]", 
                 RowBox[{
                 "#2", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}],
                  "\[RightDoubleBracket]"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"j", ",", "#3"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"i", ",", "2"}], "}"}]}], "]"}]}], ";", 
            RowBox[{"(*", " ", 
             RowBox[{
             "calculate", " ", "trait", " ", "contribution", " ", "due", " ", 
              "to", " ", "the", " ", "chromosome"}], " ", "*)"}], 
            "\[IndentingNewLine]", 
            RowBox[{"zk", "=", 
             RowBox[{"(", 
              RowBox[{"z", "/@", "nk"}], ")"}]}], ";", "\[IndentingNewLine]", 
            
            RowBox[{"(*", " ", 
             RowBox[{
             "calculate", " ", "trait", " ", "contribution", " ", "due", " ", 
              "to", " ", "the", " ", "infinitesimal", " ", "background"}], 
             " ", "*)"}], "\[IndentingNewLine]", 
            RowBox[{"vsf", "=", 
             RowBox[{"Vs", " ", 
              RowBox[{"(", 
               RowBox[{"1", "-", 
                RowBox[{"Mean", "[", 
                 RowBox[{
                 "fd", "\[LeftDoubleBracket]", "#2", 
                  "\[RightDoubleBracket]"}], "]"}]}], ")"}]}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"newzi", "=", 
             RowBox[{
              RowBox[{"Mean", "[", 
               RowBox[{
               "zi", "\[LeftDoubleBracket]", "#2", "\[RightDoubleBracket]"}], 
               "]"}], "+", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"vsf", "\[Equal]", "0"}], ",", "0", ",", 
                RowBox[{"RandomReal", "[", 
                 RowBox[{
                  RowBox[{"NormalDistribution", "[", 
                   RowBox[{"0", ",", 
                    SqrtBox["vsf"]}], "]"}], ",", "#3"}], "]"}]}], "]"}]}]}], 
            ";", 
            RowBox[{"(*", " ", 
             RowBox[{
             "find", " ", "the", " ", "threshold", " ", "for", " ", 
              "truncation", " ", "selection"}], " ", "*)"}], 
            "\[IndentingNewLine]", 
            RowBox[{"zt", "=", 
             RowBox[{
              RowBox[{"Sort", "[", 
               RowBox[{"zk", "+", "newzi"}], "]"}], "\[LeftDoubleBracket]", 
              RowBox[{"-", 
               RowBox[{"Length", "[", "#1", "]"}]}], 
              "\[RightDoubleBracket]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"(*", " ", 
             RowBox[{
              RowBox[{
              "choose", " ", "which", " ", "kids", " ", "will", " ", "be", 
               " ", "selected"}], ",", " ", 
              RowBox[{
              "based", " ", "on", " ", "the", " ", "sum", " ", "of", " ", 
               "the", " ", "chromosomal", " ", "contribution", " ", "and", 
               " ", "the", " ", "background"}]}], " ", "*)"}], 
            "\[IndentingNewLine]", 
            RowBox[{"sel", "=", 
             RowBox[{
              RowBox[{"fn", "[", "zt", "]"}], "/@", 
              RowBox[{"(", 
               RowBox[{"zk", "+", "newzi"}], ")"}]}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"(*", " ", 
             RowBox[{
             "find", " ", "the", " ", "left", " ", "origin", " ", "and", " ", 
              "breakpoints", " ", "of", " ", "the", " ", "selected", " ", 
              "offspring"}], " ", "*)"}], "\[IndentingNewLine]", 
            RowBox[{"sbp", "=", 
             RowBox[{"Pick", "[", 
              RowBox[{"#5", ",", "sel"}], "]"}]}], ";", 
            RowBox[{"sXl", "=", 
             RowBox[{"Pick", "[", 
              RowBox[{"#4", ",", "sel"}], "]"}]}], ";", 
            RowBox[{"(*", " ", 
             RowBox[{
             "generate", " ", "junctions", " ", "in", " ", "the", " ", 
              "selected", " ", "children", " ", "by", " ", "combining", " ", 
              "gametes", " ", "from", " ", "the", " ", "two", " ", 
              "parents"}], " ", "*)"}], "\[IndentingNewLine]", 
            RowBox[{"nck", "=", 
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"MendelC", "[", 
                 RowBox[{"\[ScriptCapitalP]", ",", 
                  RowBox[{"sXl", "\[LeftDoubleBracket]", 
                   RowBox[{"j", ",", "i"}], "\[RightDoubleBracket]"}], ",", 
                  RowBox[{"sbp", "\[LeftDoubleBracket]", 
                   RowBox[{"j", ",", "i"}], "\[RightDoubleBracket]"}], ",", 
                  "R"}], "]"}], "[", 
                RowBox[{"jun", "\[LeftDoubleBracket]", 
                 RowBox[{
                 "#2", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}],
                  "\[RightDoubleBracket]"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"j", ",", 
                 RowBox[{"Length", "[", "#1", "]"}]}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"i", ",", "2"}], "}"}]}], "]"}]}], ";", 
            RowBox[{"(*", 
             RowBox[{"return", " ", "the", " ", "new", " ", 
              RowBox[{"{", 
               RowBox[{"kids", ",", "p", ",", "j", ",", "z"}], "}"}]}], " ", 
             "*)"}], "\[IndentingNewLine]", 
            RowBox[{"Transpose", "[", 
             RowBox[{"{", 
              RowBox[{"#1", ",", 
               RowBox[{"Pick", "[", 
                RowBox[{"nk", ",", "sel"}], "]"}], ",", "nck", ",", " ", 
               RowBox[{"Pick", "[", 
                RowBox[{"newzi", ",", "sel"}], "]"}]}], "}"}], "]"}]}], ")"}],
           "&"}], ",", 
         RowBox[{"{", 
          RowBox[{"kids", ",", "pars", ",", "nn", ",", "Xl", ",", "bpl"}], 
          "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
       "make", " ", "sure", " ", "that", " ", "the", " ", "order", " ", 
        "corresponds", " ", "to", " ", "the", " ", "list", " ", "of", " ", 
        "kids", " ", "in", " ", "the", " ", "pedigree"}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"newkids", "=", 
       RowBox[{"Transpose", "[", 
        RowBox[{"Sort", "[", 
         RowBox[{"Flatten", "[", 
          RowBox[{"newkids", ",", "1"}], "]"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"update", " ", "the", " ", "data", " ", "structures"}], " ", 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"time", "[", "\[ScriptCapitalP]", "]"}], "+=", "1"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"AppendTo", "[", 
       RowBox[{
        RowBox[{"pop", "[", "\[ScriptCapitalP]", "]"}], ",", 
        RowBox[{
        "newkids", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}], 
       "]"}], ";", 
      RowBox[{"AppendTo", "[", 
       RowBox[{
        RowBox[{"junctions", "[", "\[ScriptCapitalP]", "]"}], ",", 
        RowBox[{
        "newkids", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}]}], 
       "]"}], ";", 
      RowBox[{"AppendTo", "[", 
       RowBox[{
        RowBox[{"zInf", "[", "\[ScriptCapitalP]", "]"}], ",", 
        RowBox[{
        "newkids", "\[LeftDoubleBracket]", "4", "\[RightDoubleBracket]"}]}], 
       "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{
        "find", " ", "the", " ", "new", " ", "F", " ", "amongst", " ", "the", 
         " ", "kids"}], " ", "-", " ", 
        RowBox[{"note", " ", "P", " ", "has", " ", "entries", " ", 
         RowBox[{"{", "\[Ellipsis]1\[Ellipsis]1\[Ellipsis]", "}"}]}]}], 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{"f1", "=", 
       RowBox[{"f", "+", 
        RowBox[{"DiagonalMatrix", "[", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"1", "-", "fd"}], ")"}], "/", "2"}], "]"}]}]}], ";", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{"F", " ", "for", " ", "random"}], ",", " ", 
        RowBox[{"not", " ", "distinct"}], ",", " ", "genes"}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"fii", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Extract", "[", 
          RowBox[{"f1", ",", "#"}], "]"}], "&"}], "/@", 
        RowBox[{"posPars", "[", "P", "]"}]}]}], ";", 
      RowBox[{"(*", " ", 
       RowBox[{"The", " ", "new", " ", 
        SubscriptBox["F", 
         RowBox[{"i", ",", "i"}]]}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"fij", "=", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"P", ".", "f1", ".", 
          RowBox[{"Transpose", "[", "P", "]"}]}], ")"}], "/", "4"}]}], ";", 
      RowBox[{"(*", " ", 
       RowBox[{"The", " ", "new", " ", 
        SubscriptBox["F", 
         RowBox[{"i", ",", "j"}]]}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"AppendTo", "[", 
       RowBox[{
        RowBox[{"F", "[", "\[ScriptCapitalP]", "]"}], ",", 
        RowBox[{"fij", "+", 
         RowBox[{"DiagonalMatrix", "[", 
          RowBox[{"fii", "-", 
           RowBox[{"Diagonal", "[", "fij", "]"}]}], "]"}]}]}], "]"}], ";"}]}],
     "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.667538833657012*^9, 3.667538929944538*^9}, {
   3.667538963598817*^9, 3.667538964613865*^9}, 3.6919826916607933`*^9, {
   3.691982771727373*^9, 3.6919827770150967`*^9}, {3.691982870899932*^9, 
   3.691982896968453*^9}, {3.692016531289781*^9, 3.6920165832455473`*^9}, {
   3.6920166566000423`*^9, 3.692016689271001*^9}, {3.6920194825393333`*^9, 
   3.692019684216501*^9}, {3.6920197187911587`*^9, 3.692019719455627*^9}, {
   3.692019756844923*^9, 3.692019814657701*^9}, {3.692019856677642*^9, 
   3.692019858623295*^9}, {3.692020304047558*^9, 3.692020318909976*^9}, {
   3.6924338332133017`*^9, 3.692433845042138*^9}, {3.692436950777597*^9, 
   3.6924369602782307`*^9}, {3.6924370030377083`*^9, 
   3.6924370032921867`*^9}, {3.692437236942505*^9, 3.692437318292788*^9}, {
   3.692437359830422*^9, 3.6924373717709627`*^9}, {3.69245474395648*^9, 
   3.6924547576655493`*^9}, {3.692455798434577*^9, 3.692455822395589*^9}, {
   3.692455864503039*^9, 3.692455869481414*^9}, {3.692505347088799*^9, 
   3.6925053476569757`*^9}, 3.692505431364753*^9, {3.692505534309514*^9, 
   3.6925055527319937`*^9}, {3.692777701968698*^9, 3.6927777049053917`*^9}, {
   3.6927921954944267`*^9, 3.692792299567438*^9}, {3.692792343972632*^9, 
   3.6927923966950283`*^9}, {3.6927924543641977`*^9, 
   3.6927925543014183`*^9}, {3.692792600135681*^9, 3.692792627369739*^9}, {
   3.6927933792908916`*^9, 3.692793387652047*^9}, {3.692793424966074*^9, 
   3.6927934738488407`*^9}, {3.692793539102133*^9, 3.692793540405376*^9}, {
   3.692793591633626*^9, 3.692793693662222*^9}, {3.6927940601304283`*^9, 
   3.6927942217608013`*^9}, {3.692794378231843*^9, 3.692794438617622*^9}, {
   3.692794478091794*^9, 3.692794480490116*^9}, {3.69279451884709*^9, 
   3.692794613248248*^9}, {3.692794686290906*^9, 3.692794730538795*^9}, {
   3.692795247486623*^9, 3.692795265860965*^9}, {3.692795296300028*^9, 
   3.692795299491096*^9}, {3.692795399176524*^9, 3.692795404295373*^9}, {
   3.692795483196252*^9, 3.692795544966769*^9}, {3.69280504165911*^9, 
   3.692805056511922*^9}, {3.692805128061509*^9, 3.692805182082822*^9}, {
   3.692863104706209*^9, 3.692863122213643*^9}, {3.69286408973346*^9, 
   3.692864120681922*^9}, {3.6928642901347857`*^9, 3.692864291718186*^9}, {
   3.693040817399316*^9, 3.693040912510538*^9}, {3.693041008671734*^9, 
   3.693041186631576*^9}, {3.693041675011348*^9, 3.693041704914547*^9}, 
   3.693041930109172*^9, 3.693042457640297*^9, {3.693049449737628*^9, 
   3.69304949427253*^9}, {3.6930495451915293`*^9, 3.6930495952774887`*^9}, {
   3.693050512359908*^9, 3.693050703319364*^9}, {3.693050753574728*^9, 
   3.693050756851881*^9}, 3.693062568540903*^9, {3.6932808009812527`*^9, 
   3.693280840564837*^9}, {3.693281048271302*^9, 3.693281065411634*^9}, 
   3.6932825807163553`*^9, 3.693367577124544*^9, {3.693373135923843*^9, 
   3.693373142067278*^9}, {3.693376892221119*^9, 3.6933769581135893`*^9}, {
   3.693378460851931*^9, 3.6933784889508142`*^9}, {3.693458390365932*^9, 
   3.6934584065973682`*^9}, {3.6934584542998877`*^9, 3.693458587623515*^9}, {
   3.693458625935972*^9, 3.693458626921006*^9}, {3.6934587163743973`*^9, 
   3.6934587177110453`*^9}, {3.69345988157408*^9, 3.693459885916984*^9}, {
   3.693459987480242*^9, 3.693460010067601*^9}, {3.6934600820824633`*^9, 
   3.693460085031432*^9}, {3.6934601575091257`*^9, 3.693460159060553*^9}, {
   3.6934602723607397`*^9, 3.6934603294147997`*^9}, {3.693460499547368*^9, 
   3.693460623455646*^9}, {3.6934609355267057`*^9, 3.693461091665492*^9}, {
   3.693461138089816*^9, 3.693461163633677*^9}, 3.693461361779065*^9, {
   3.6934613945303173`*^9, 3.6934614313771477`*^9}, {3.693463297215989*^9, 
   3.693463298815074*^9}, {3.693463593061068*^9, 3.693463629220956*^9}, {
   3.693463670176505*^9, 3.693463701012918*^9}, 3.693463753949194*^9, 
   3.6934638042273684`*^9, {3.696952396007182*^9, 3.696952400989687*^9}, {
   3.6969949226083193`*^9, 3.696994963781088*^9}, {3.696997000484433*^9, 
   3.6969971711003523`*^9}, {3.6969975234109497`*^9, 3.696997585714143*^9}, {
   3.69699765339014*^9, 3.696997706298675*^9}, {3.696998015270891*^9, 
   3.696998017942786*^9}, {3.696998110556696*^9, 3.696998114884564*^9}, {
   3.699670982437828*^9, 3.699671009217342*^9}},
 CellLabel->
  "In[379]:=",ExpressionUUID->"1e2f05f8-ee29-4ab4-a666-9edbf5b4346d"],

Cell[TextData[{
 "** There had been a bug in calculating F.  The formula for ",
 Cell[BoxData[
  FormBox[
   SubscriptBox["F", 
    RowBox[{"i", ",", "i"}]], TraditionalForm]],ExpressionUUID->
  "df7c15ec-530a-4516-87f4-445142b01a78"],
 " is not the same as for ",
 Cell[BoxData[
  FormBox[
   SubscriptBox["F", 
    RowBox[{"i", ",", "j"}]], TraditionalForm]],ExpressionUUID->
  "05bc8749-f61d-44e8-85a5-e956f77bc639"],
 ".  The new code is less efficient, because I could not find a way to use \
matrix operations throughout, and instead extract elements. "
}], "Text",
 CellChangeTimes->{{3.696997773339595*^9, 3.696997836545496*^9}, {
  3.696998637193987*^9, 
  3.6969986435545597`*^9}},ExpressionUUID->"3f11e49e-6f2a-4b92-9535-\
f513190eceeb"],

Cell["\<\
** A potential bug: the discrete haplotypes and the junctions are generated \
from the same list left origins and breakpoints, by Mendel and MendelC \
respectively.  These must correspond **\
\>", "Text",
 CellChangeTimes->{{3.693459904928*^9, 
  3.693459960695058*^9}},ExpressionUUID->"85ded258-0a04-4013-b634-\
44ffed430c49"],

Cell["\<\
Algorithm:
- For each family, first calculate the # of kids needed from that family.
- Generate the break points for the whole set of offspring, to be used later
- Run through families again, generating and selecting offspring.
- The continuous genome only needs to be generated for the selected \
individuals, but using the correct bp.
- One should discard breaks that are in homozygous material - but still carry \
out the recombination of course.\
\>", "Text",
 CellChangeTimes->{{3.6929565534961023`*^9, 3.692956595109606*^9}, {
  3.692957030576849*^9, 3.692957100524488*^9}, {3.6929581267676573`*^9, 
  3.692958161383341*^9}, {3.692958294988262*^9, 
  3.6929583386007233`*^9}},ExpressionUUID->"1711ea31-cc83-470c-82ce-\
cfbba7739580"],

Cell[TextData[{
 "It is most efficient to just record breakpoint locations, which are unique. \
 Previously, I had stored their properties (time of origin, flanking \
haplotypes..) in global variables. However, this is cumbersome. It may be \
more efficient to store this information in named functions. Thus, ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    RowBox[{"leftHaplotype", "[", "f", "]"}], "[", "x", "]"}], 
   TraditionalForm]],ExpressionUUID->"5427beb9-ff18-4358-804e-a1f6ea329f3b"],
 " could store the left haplotype of a breakpoint at ",
 Cell[BoxData[
  FormBox["x", TraditionalForm]],ExpressionUUID->
  "c4405c14-c674-49ce-863c-660fbb2db391"],
 ". Retrieving information from functions is faster than from lists.  This \
could be generalised to store all information about the simulation in this \
way, but I will not attempt that just now."
}], "Text",
 CellChangeTimes->{{3.693279686755642*^9, 3.693279850512364*^9}, {
  3.69328012225646*^9, 
  3.693280182333707*^9}},ExpressionUUID->"30ef9b4a-b090-4ca2-ac59-\
e960b3f76543"],

Cell[TextData[{
 "It is slightly awkward to use Fold here, because the first argument is not \
used and is set to 0, arbitrarily. . An alternative would have been to use ",
 Cell[BoxData[
  FormBox[
   RowBox[{"Do", "[", 
    RowBox[{
     RowBox[{"iterateDiploid", "[", 
      RowBox[{"\[ScriptCapitalP]", ",", 
       RowBox[{"Pl", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
       ",", "Vs", ",", "z", ",", "\[Theta]", ",", "R"}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", 
       RowBox[{"Length", "[", "Pl", "]"}]}], "}"}]}], "]"}], 
   TraditionalForm]],ExpressionUUID->"dce1c365-b193-40f5-b786-304e6889a1c9"]
}], "Text",
 CellChangeTimes->{{3.6934582481780167`*^9, 
  3.693458352162787*^9}},ExpressionUUID->"a1a33404-9dc4-476d-99bc-\
6d42ae3717e8"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"iterateDiploid", "[", 
    RowBox[{"\[ScriptCapitalP]_", ",", 
     RowBox[{"Pl", ":", 
      RowBox[{"{", "___SparseArray", "}"}]}], ",", "Vs_", ",", "z_", ",", 
     "\[Theta]_", ",", "R_"}], "]"}], ":=", 
   RowBox[{"Fold", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"iterateDiploid", "[", 
       RowBox[{
       "\[ScriptCapitalP]", ",", "#2", ",", "Vs", ",", "z", ",", "\[Theta]", 
        ",", "R"}], "]"}], "&"}], ",", "0", ",", " ", "Pl"}], "]"}]}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.667538978789452*^9, 3.6675389880691032`*^9}, {
  3.691982780255022*^9, 3.6919827819269342`*^9}, {3.69201650281045*^9, 
  3.692016515888678*^9}, {3.6925056050271893`*^9, 3.692505629976997*^9}, {
  3.692505721186942*^9, 3.692505764898075*^9}, {3.692793983607205*^9, 
  3.6927940062753572`*^9}, {3.6928631068965282`*^9, 3.6928631755593443`*^9}, {
  3.6928642999961452`*^9, 3.692864301459963*^9}, {3.693373044328743*^9, 
  3.693373046920403*^9}, {3.693457880395282*^9, 3.693457883354137*^9}, {
  3.693457928104776*^9, 3.693457929833337*^9}, {3.693458024877343*^9, 
  3.693458066292261*^9}, {3.6934582259076777`*^9, 3.693458238625869*^9}},
 CellLabel->
  "In[380]:=",ExpressionUUID->"d706bec7-798a-4b54-835c-d3d5e73198e6"],

Cell["\<\
How to make sense of the results? We would like to see:
- frequencies of junctions over time
- pictures of the mosaic structure of the population
- the relation between \
\>", "Text",
 CellChangeTimes->{{3.693465241729782*^9, 
  3.693465300041102*^9}},ExpressionUUID->"b396b315-4a75-4e85-88f7-\
c6ab73d9e3e1"]
}, Closed]],

Cell[CellGroupData[{

Cell["distinctParents", "Subsubsection",
 CellChangeTimes->{{3.698306524779895*^9, 3.698306527381336*^9}, 
   3.698306717750458*^9},ExpressionUUID->"41a7f342-015d-4e24-a9cd-\
30b83b160175"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"distinctParents", "::", "usage"}], "=", 
   "\"\<distinctParents[P] gives the distinct families defined by the \
pedigree matrix, which is given as a SparseArray. Calculated as \
Union[Sort/@Parents[P].\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.698306544704006*^9, 3.6983065683161173`*^9}, {
  3.698306640705443*^9, 3.69830664673808*^9}, {3.698306700497939*^9, 
  3.698306719317012*^9}},
 CellLabel->
  "In[381]:=",ExpressionUUID->"1e135051-0991-48aa-b64a-c889a4e2e103"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"distinctParents", "[", "P_SparseArray", "]"}], ":=", 
   RowBox[{"Union", "[", 
    RowBox[{"Sort", "/@", 
     RowBox[{"Parents", "[", "P", "]"}]}], "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.698306572299922*^9, 3.6983065861565857`*^9}, {
   3.698306632515253*^9, 3.698306637225576*^9}, {3.69830668354963*^9, 
   3.698306689465892*^9}, 3.698306722829018*^9},
 CellLabel->
  "In[382]:=",ExpressionUUID->"d9d46c52-d730-45dd-8704-46537da73746"]
}, Closed]],

Cell[CellGroupData[{

Cell["makeRandomPartition", "Subsubsection",
 CellChangeTimes->{{3.699165347597765*^9, 
  3.699165355828426*^9}},ExpressionUUID->"bea02d65-ac4e-4d54-8e60-\
755c2b3a8498"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"makeRandomPartition", "::", "usage"}], "=", 
   "\"\<makeRandomPartition[{\!\(\*SubscriptBox[\(n\), \
\(1\)]\),\[Ellipsis]},k] divides the {\!\(\*SubscriptBox[\(n\), \(1\)]\),\
\[Ellipsis]} randomly across k families\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.699165358194085*^9, 3.699165402075038*^9}, {
  3.70064785667391*^9, 3.7006478579202843`*^9}},
 CellLabel->
  "In[383]:=",ExpressionUUID->"564a9567-02fa-4156-b874-70a2563087d7"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"makeRandomPartition", "[", 
    RowBox[{
     RowBox[{"n", ":", 
      RowBox[{"{", "___Integer", "}"}]}], ",", "k_Integer"}], "]"}], ":=", 
   RowBox[{"Transpose", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"#", "\[Equal]", "0"}], ",", 
        RowBox[{"ConstantArray", "[", 
         RowBox[{"0", ",", "k"}], "]"}], ",", 
        RowBox[{"RandomVariate", "[", 
         RowBox[{"MultinomialDistribution", "[", 
          RowBox[{"#", ",", 
           RowBox[{"ConstantArray", "[", 
            RowBox[{
             FractionBox["1", "k"], ",", "k"}], "]"}]}], "]"}], "]"}]}], 
       "]"}], "&"}], "/@", "n"}], "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.699165126041073*^9, 3.699165194021864*^9}, {
  3.699165259201542*^9, 3.6991653393509207`*^9}, {3.6991654045358257`*^9, 
  3.6991654353783827`*^9}, {3.699189083722052*^9, 3.699189097050334*^9}},
 CellLabel->
  "In[384]:=",ExpressionUUID->"1c4b203b-cc6b-4ea8-9a22-1d18c3b3b7de"]
}, Closed]],

Cell[CellGroupData[{

Cell["partitionList", "Subsubsection",
 CellChangeTimes->{{3.700647971118404*^9, 
  3.7006479928685007`*^9}},ExpressionUUID->"c973a4ee-b3f8-48b7-9c37-\
31f90052140f"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"partitionList", "::", "usage"}], "=", 
    "\"\<partitionList[{\!\(\*SubscriptBox[\(a\), \(1\)]\),\[Ellipsis]},{\!\(\
\*SubscriptBox[\(n\), \(1\)]\),\!\(\*SubscriptBox[\(n\), \
\(2\)]\),\[Ellipsis]}] partitions the list into sublists with \
{\!\(\*SubscriptBox[\(n\), \(1\)]\),\[Ellipsis]} elements. \
partitionList[{\!\(\*SubscriptBox[\(n\), \(1\)]\),\!\(\*SubscriptBox[\(n\), \
\(2\)]\),\[Ellipsis]}] partitions {1,2,\[Ellipsis]}. \
partitionList[{\!\(\*SubscriptBox[\(a\), \
\(1\)]\),\[Ellipsis]},{{\!\(\*SubscriptBox[\(n\), \(1, \
1\)]\),\[Ellipsis]},{\!\(\*SubscriptBox[\(n\), \(2, 1\)]\),\[Ellipsis]},\
\[Ellipsis]} is also defined\>\""}], ";"}], " "}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.700647998329605*^9, 3.700648067654447*^9}, {
  3.7006481728508472`*^9, 3.700648197536756*^9}, {3.700649263640477*^9, 
  3.700649289798581*^9}},
 CellLabel->
  "In[385]:=",ExpressionUUID->"446dff93-a513-451a-b705-65a0c29341c0"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"partitionList", "::", "badNumber"}], "=", 
   "\"\<List `1` does not have the same length as the total of `2`\>\""}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.700648074767293*^9, 3.70064810286893*^9}},
 CellLabel->
  "In[386]:=",ExpressionUUID->"78957941-bb31-43c5-a93d-645d24ec0b3d"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"partitionList", "[", 
    RowBox[{"n", ":", 
     RowBox[{"{", "___Integer", "}"}]}], "]"}], ":=", 
   RowBox[{"partitionList", "[", 
    RowBox[{
     RowBox[{"Range", "[", 
      RowBox[{"Total", "[", "n", "]"}], "]"}], ",", "n"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"partitionList", "[", 
    RowBox[{"a_List", ",", 
     RowBox[{"n", ":", 
      RowBox[{"{", "___Integer", "}"}]}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"fl", ",", "nx"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "a", "]"}], "\[NotEqual]", 
         RowBox[{"Total", "[", "n", "]"}]}], ",", 
        RowBox[{"Message", "[", 
         RowBox[{
          RowBox[{"partitionList", "::", "badNumber"}], ",", "a", ",", "n"}], 
         "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"fl", "=", 
       RowBox[{"FoldList", "[", 
        RowBox[{"Plus", ",", "0", ",", "n"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"nx", "=", 
       RowBox[{"Transpose", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Drop", "[", 
           RowBox[{
            RowBox[{"fl", "+", "1"}], ",", 
            RowBox[{"-", "1"}]}], "]"}], ",", 
          RowBox[{"Drop", "[", 
           RowBox[{"fl", ",", "1"}], "]"}]}], "}"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"a", "\[LeftDoubleBracket]", 
         RowBox[{"Span", "@@", "#"}], "\[RightDoubleBracket]"}], "&"}], "/@", 
       "nx"}]}]}], "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.700648107517873*^9, 3.7006481656342*^9}, {
  3.7006482027710333`*^9, 3.700648248778367*^9}, {3.700648502016746*^9, 
  3.7006485502623577`*^9}},
 CellLabel->
  "In[387]:=",ExpressionUUID->"6a3fc562-907a-4351-8605-2a6b98b7ea4f"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"partitionList", "[", 
    RowBox[{"n", ":", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", "___Integer", "}"}], "..."}], "}"}]}], "]"}], ":=", 
   RowBox[{"partitionList", "[", 
    RowBox[{
     RowBox[{"Range", "[", 
      RowBox[{"Total", "[", 
       RowBox[{"n", ",", "2"}], "]"}], "]"}], ",", "n"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"partitionList", "[", 
    RowBox[{"a_List", ",", 
     RowBox[{"n", ":", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", "___Integer", "}"}], "..."}], "}"}]}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "fpl", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"fpl", "=", 
       RowBox[{"partitionList", "[", 
        RowBox[{"a", ",", 
         RowBox[{"Flatten", "[", 
          RowBox[{"n", ",", "1"}], "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"partitionList", "[", 
       RowBox[{"fpl", ",", 
        RowBox[{"Length", "/@", "n"}]}], "]"}]}]}], "]"}]}], ";"}]}], "Input",\

 InitializationCell->True,
 CellChangeTimes->{{3.700648107517873*^9, 3.7006481656342*^9}, {
  3.7006482027710333`*^9, 3.700648248778367*^9}, {3.700648502016746*^9, 
  3.7006485502623577`*^9}, {3.700649303567575*^9, 3.700649369172925*^9}},
 CellLabel->
  "In[389]:=",ExpressionUUID->"2c1e7f32-e549-4442-b6b5-90f362ab1104"]
}, Closed]],

Cell[CellGroupData[{

Cell["posPars", "Subsubsection",
 CellChangeTimes->{{3.696995268996998*^9, 
  3.696995271028838*^9}},ExpressionUUID->"5ff7df1d-0ab2-4853-842f-\
3cc3845b48a2"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"posPars", "::", "usage"}], "=", 
   "\"\<posPars[{{0,0,1,\[Ellipsis]},\[Ellipsis]}] returns the positions of \
the parents, in  the form {{\!\(\*SubscriptBox[\(i\), \
\(1\)]\),\!\(\*SubscriptBox[\(i\), \(2\)]\)},\[Ellipsis]}. With selfing, \
returns {\!\(\*SubscriptBox[\(i\), \(1\)]\),\!\(\*SubscriptBox[\(i\), \
\(1\)]\)}\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.696995273769537*^9, 3.69699532907824*^9}, {
  3.696995360972427*^9, 3.69699538884447*^9}},
 CellLabel->
  "In[391]:=",ExpressionUUID->"7fd251c2-2f1e-4243-a3ac-39e13ccb5a51"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"posPars", "::", "badpars"}], "=", 
   "\"\<Wrong number of parents in `1`\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.696995504118062*^9, 3.696995520977889*^9}},
 CellLabel->
  "In[392]:=",ExpressionUUID->"7848d8ef-e59c-468a-b643-043dbfdefed2"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"posPars", "[", 
    RowBox[{"p", ":", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"0", "|", "1", "|", "2"}], ")"}], "..."}], "}"}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"p2", ",", 
       RowBox[{"fp", "=", 
        RowBox[{"Flatten", "[", 
         RowBox[{"Position", "[", 
          RowBox[{"p", ",", "1"}], "]"}], "]"}]}]}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"Switch", "[", 
      RowBox[{
       RowBox[{"Length", "[", "fp", "]"}], ",", "2", ",", "fp", ",", 
       "\[IndentingNewLine]", "0", ",", 
       RowBox[{
        RowBox[{"p2", "=", 
         RowBox[{"Position", "[", 
          RowBox[{"p", ",", "2"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"MatchQ", "[", 
           RowBox[{"p2", ",", 
            RowBox[{"{", 
             RowBox[{"{", "_Integer", "}"}], "}"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"p2", "\[LeftDoubleBracket]", 
             RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], ",", 
            RowBox[{"p2", "\[LeftDoubleBracket]", 
             RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}]}], "}"}], ",",
           "\[IndentingNewLine]", 
          RowBox[{"Message", "[", 
           RowBox[{
            RowBox[{"posPars", "::", "badpars"}], ",", "p"}], "]"}]}], 
         "]"}]}], ",", "\[IndentingNewLine]", "_", ",", 
       RowBox[{"Message", "[", 
        RowBox[{
         RowBox[{"posPars", "::", "badpars"}], ",", "p"}], "]"}]}], "]"}]}], 
    "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.696995395695138*^9, 3.696995498418749*^9}, {
   3.696995546195402*^9, 3.696995680061831*^9}, 3.6969957209489098`*^9, {
   3.696995769583736*^9, 3.696995814052993*^9}},
 CellLabel->
  "In[393]:=",ExpressionUUID->"b7b92fb6-1097-4b6f-b2cb-1aaff448769e"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"posPars", "[", 
    RowBox[{"p", ":", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"0", "|", "1", "|", "2"}], ")"}], "..."}], "}"}], "..."}], 
      "}"}]}], "]"}], ":=", 
   RowBox[{"posPars", "/@", "p"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.696995504118062*^9, 3.696995520977889*^9}, {
  3.69699583702841*^9, 3.6969958621654587`*^9}},
 CellLabel->
  "In[394]:=",ExpressionUUID->"0c61b3e4-5513-443d-b6cd-51af63f083ed"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"posPars", "[", "p_SparseArray", "]"}], ":=", 
   RowBox[{"posPars", "[", 
    RowBox[{"Normal", "[", "p", "]"}], "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.696995504118062*^9, 3.696995520977889*^9}, {
  3.69699583702841*^9, 3.6969958621654587`*^9}, {3.696996977008005*^9, 
  3.6969969876734962`*^9}},
 CellLabel->
  "In[395]:=",ExpressionUUID->"89841355-82e9-4abb-a1b4-29d9d15e4e06"]
}, Closed]],

Cell[CellGroupData[{

Cell["posKids", "Subsubsection",
 CellChangeTimes->{{3.696995268996998*^9, 3.696995271028838*^9}, {
  3.699005389451043*^9, 
  3.699005390081463*^9}},ExpressionUUID->"953e5164-7775-4bbf-8c5a-\
514539aee5b7"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"posKids", "::", "usage"}], "=", 
   "\"\<posKids[{{0,0,1,\[Ellipsis]},\[Ellipsis]}] returns the positions of \
the offspring, in  the form {{\!\(\*SubscriptBox[\(i\), \
\(1\)]\),\!\(\*SubscriptBox[\(i\), \(2\)]\),\[Ellipsis]},\[Ellipsis]}\>\""}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.696995273769537*^9, 3.69699532907824*^9}, {
  3.696995360972427*^9, 3.69699538884447*^9}, {3.699005393718965*^9, 
  3.699005411657764*^9}},
 CellLabel->
  "In[396]:=",ExpressionUUID->"d801b8aa-10de-4788-b08d-1c186d879d69"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"posKids", "[", 
    RowBox[{"p", ":", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"0", "|", "1", "|", "2"}], ")"}], "..."}], "}"}]}], "]"}], ":=", 
   RowBox[{"Flatten", "[", 
    RowBox[{"Position", "[", 
     RowBox[{"p", ",", "1"}], "]"}], "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.696995395695138*^9, 3.696995498418749*^9}, {
   3.696995546195402*^9, 3.696995680061831*^9}, 3.6969957209489098`*^9, {
   3.696995769583736*^9, 3.696995814052993*^9}, 3.699005422829208*^9, {
   3.69900545431488*^9, 3.699005459058712*^9}, 3.6990055399709063`*^9, 
   3.6990058433796263`*^9},
 CellLabel->
  "In[397]:=",ExpressionUUID->"2686b2f7-15f1-42ee-985e-31955d488e8a"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"posKids", "[", 
    RowBox[{"p", ":", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"0", "|", "1", "|", "2"}], ")"}], "..."}], "}"}], "..."}], 
      "}"}]}], "]"}], ":=", 
   RowBox[{"posKids", "/@", 
    RowBox[{"Transpose", "[", "p", "]"}]}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.696995504118062*^9, 3.696995520977889*^9}, {
  3.69699583702841*^9, 3.6969958621654587`*^9}, {3.69900544013271*^9, 
  3.699005446580364*^9}, {3.69900584649166*^9, 3.699005848707252*^9}},
 CellLabel->
  "In[398]:=",ExpressionUUID->"8dc22be5-1e37-46a9-af19-11a929997b72"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"posKids", "[", "p_SparseArray", "]"}], ":=", 
   RowBox[{"posKids", "[", 
    RowBox[{"Normal", "[", "p", "]"}], "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.696995504118062*^9, 3.696995520977889*^9}, {
  3.69699583702841*^9, 3.6969958621654587`*^9}, {3.696996977008005*^9, 
  3.6969969876734962`*^9}, {3.699005441804234*^9, 3.699005443196508*^9}},
 CellLabel->
  "In[399]:=",ExpressionUUID->"c25c2f1d-d20a-40ee-8563-f30739546dbb"]
}, Closed]],

Cell[CellGroupData[{

Cell["initialise", "Subsubsection",
 CellChangeTimes->{{3.693281738995903*^9, 
  3.693281745987544*^9}},ExpressionUUID->"24198bc4-cfc9-4d00-ad26-\
0d1ba6e0b166"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"initialise", "::", "usage"}], "=", 
   "\"\<initialise[\[ScriptCapitalP]][\!\(\*SubscriptBox[\(n\), \(inds\)]\),{\
\!\(\*SubscriptBox[\(j\), \(1\)]\),\[Ellipsis]},\!\(\*SubscriptBox[\(V\), \(z\
\)]\),\!\(\*SubscriptBox[\(V\), \(e\)]\),z,R] initialises a population of \
\!\(\*SubscriptBox[\(n\), \(inds\)]\) diploid individuals, represented by \
pop[\[ScriptCapitalP]], junctions[\[ScriptCapitalP]], \
zInf[\[ScriptCapitalP]], zChrom[\[ScriptCapitalP]],zEnv[\[ScriptCapitalP]],F[\
\[ScriptCapitalP]]. pop[\[ScriptCapitalP]] lists diploid genotypes,  with \
alleles labelled 0 or 1, and with exactly \!\(\*SubscriptBox[\(j\), \(i\)]\) \
copies of the + alleles. initialise[\[ScriptCapitalP]][\!\(\*SubscriptBox[\(n\
\), \(inds\)]\),{{{0,\[Ellipsis]},{1,\[Ellipsis]}},\[Ellipsis]},\!\(\*\
SubscriptBox[\(V\), \(z\)]\),\!\(\*SubscriptBox[\(V\), \(e\)]\),z,R] \
initiates with a specific initial population. The infinitesimal background is \
drawn from a distribution with variance \!\(\*SubscriptBox[\(V\), \(g\)]\), \
and the environmental component with variance \!\(\*SubscriptBox[\(V\), \
\(e\)]\). zChrom[\[ScriptCapitalP]] is determined by applying the function z \
to diploid genotypes. zKids[\[ScriptCapitalP]] is initially empty, since \
phenotypes of the founding generation do not directly influence later \
generations - the genetics are entirely described by zInf[\[ScriptCapitalP]], \
pop[\[ScriptCapitalP]], and in any case, the founder individuals are not \
organised by family. There are initially 2\!\(\*SubscriptBox[\(n\), \(inds\)]\
\) dummy junctions at locations 0, R, with properties held in locJ[\
\[ScriptCapitalP]], hapJ[\[ScriptCapitalP]], originJ[\[ScriptCapitalP]], the \
latter being set to zero. Updates time[\[ScriptCapitalP]], mapLength[\
\[ScriptCapitalP]] and numJ[\[ScriptCapitalP]]. Mutations are initally \
absent: mutations[\[ScriptCapitalP]] is set as empty.\>\""}], ";"}]], "Input",\

 InitializationCell->True,
 CellChangeTimes->{{3.693281751900257*^9, 3.6932817759715137`*^9}, 
   3.693282138819085*^9, {3.693373562804638*^9, 3.6933736018329906`*^9}, {
   3.693373633816909*^9, 3.693373747007115*^9}, {3.6933737776733217`*^9, 
   3.693373908813633*^9}, {3.693376711986146*^9, 3.6933767270179*^9}, {
   3.6933951854778223`*^9, 3.693395198820655*^9}, {3.693569442837764*^9, 
   3.693569447620625*^9}, {3.698311633194417*^9, 3.698311635553146*^9}, {
   3.698311666128694*^9, 3.698311793181871*^9}, {3.6983118511800737`*^9, 
   3.698311867212118*^9}, {3.6988332342030973`*^9, 3.6988333259183903`*^9}, {
   3.698833356533989*^9, 3.698833413828343*^9}, {3.698934592201605*^9, 
   3.698934611637148*^9}, {3.699604518462207*^9, 3.699604560817368*^9}, {
   3.700632100177352*^9, 3.700632180238346*^9}, {3.700705714750844*^9, 
   3.70070572534098*^9}, {3.710236131300188*^9, 3.710236161202488*^9}},
 CellLabel->
  "In[400]:=",ExpressionUUID->"2fc380a9-1d38-4a3b-8811-dcd7a1b0bc9f"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"initialise", "[", "\[ScriptCapitalP]_", "]"}], "[", 
    RowBox[{"n_Integer", ",", 
     RowBox[{"j", ":", 
      RowBox[{"{", "___Integer", "}"}]}], ",", "Vz_", ",", "Ve_", ",", "z_", 
     ",", "R_"}], "]"}], ":=", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"initialise", "[", "\[ScriptCapitalP]", "]"}], "[", 
    RowBox[{"n", ",", 
     RowBox[{"makePopDiploidExact", "[", 
      RowBox[{"j", ",", "n"}], "]"}], ",", "Vz", ",", "Ve", ",", "z", ",", 
     "R"}], "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6933739109419527`*^9, 3.6933739588345423`*^9}, {
   3.69337475133175*^9, 3.693374764414893*^9}, {3.693374839908758*^9, 
   3.693374843606277*^9}, {3.693374921430235*^9, 3.6933750424859667`*^9}, {
   3.693375092574152*^9, 3.6933751208354797`*^9}, {3.693375183204215*^9, 
   3.6933752737748528`*^9}, {3.693375359902772*^9, 3.693375432187272*^9}, {
   3.693376367998126*^9, 3.6933763816471663`*^9}, 3.693376469812686*^9, {
   3.6933765613701973`*^9, 3.693376563440246*^9}, {3.693376731251505*^9, 
   3.693376738089793*^9}, {3.693376776042179*^9, 3.6933767934593353`*^9}, {
   3.6933951349971247`*^9, 3.69339531845864*^9}, {3.693395352376285*^9, 
   3.6933954234146223`*^9}, {3.6933954708142776`*^9, 3.6933954843071413`*^9}, 
   3.6933955150911093`*^9, {3.693461796329482*^9, 3.693461799929303*^9}, {
   3.693569411254796*^9, 3.693569426188983*^9}, {3.6983118123101997`*^9, 
   3.6983118335649548`*^9}, {3.698833202982873*^9, 3.6988332235103893`*^9}, {
   3.698833421315792*^9, 3.698833443963554*^9}, {3.698833492755184*^9, 
   3.6988335107143593`*^9}, {3.698897862836464*^9, 3.6988978649323483`*^9}, {
   3.6989346168215923`*^9, 3.6989346203351793`*^9}, {3.69960480070437*^9, 
   3.699604846691057*^9}},
 CellLabel->
  "In[401]:=",ExpressionUUID->"74b06022-0e85-4135-ae21-41006fb7a0a2"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"initialise", "[", "\[ScriptCapitalP]_", "]"}], "[", 
    RowBox[{"n_Integer", ",", 
     RowBox[{"pop0", ":", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"0", "|", "1"}], ")"}], "..."}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"0", "|", "1"}], ")"}], "..."}], "}"}]}], "}"}], "..."}],
        "}"}]}], ",", "Vz_", ",", "Ve_", ",", "z_", ",", "R_"}], "]"}], ":=", 
   
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"time", "[", "\[ScriptCapitalP]", "]"}], "=", "0"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"pop", "[", "\[ScriptCapitalP]", "]"}], "=", 
       RowBox[{"{", "pop0", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"junctions", "[", "\[ScriptCapitalP]", "]"}], "=", 
       RowBox[{"{", 
        RowBox[{"Partition", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{
               RowBox[{"2", "#"}], "-", "1"}], ",", 
              RowBox[{"2", "#"}]}], "}"}], "&"}], "/@", 
           RowBox[{"Range", "[", 
            RowBox[{"2", "n"}], "]"}]}], ",", "2"}], "]"}], "}"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"zInf", "[", "\[ScriptCapitalP]", "]"}], "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"Vz", "\[Equal]", "0"}], ",", 
         RowBox[{"{", 
          RowBox[{"ConstantArray", "[", 
           RowBox[{"0", ",", 
            RowBox[{"{", "n", "}"}]}], "]"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"RandomReal", "[", 
           RowBox[{
            RowBox[{"NormalDistribution", "[", 
             RowBox[{"0", ",", 
              SqrtBox["Vz"]}], "]"}], ",", 
            RowBox[{"{", "n", "}"}]}], "]"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"zEnv", "[", "\[ScriptCapitalP]", "]"}], "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"Ve", "\[Equal]", "0"}], ",", 
         RowBox[{"{", 
          RowBox[{"ConstantArray", "[", 
           RowBox[{"0", ",", 
            RowBox[{"{", "n", "}"}]}], "]"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"RandomReal", "[", 
           RowBox[{
            RowBox[{"NormalDistribution", "[", 
             RowBox[{"0", ",", 
              SqrtBox["Ve"]}], "]"}], ",", 
            RowBox[{"{", "n", "}"}]}], "]"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"zChrom", "[", "\[ScriptCapitalP]", "]"}], "=", 
       RowBox[{"{", 
        RowBox[{"z", "/@", 
         RowBox[{"First", "[", 
          RowBox[{"pop", "[", "\[ScriptCapitalP]", "]"}], "]"}]}], "}"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"zKids", "[", "\[ScriptCapitalP]", "]"}], "=", 
       RowBox[{"{", 
        RowBox[{"{", "}"}], "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"F", "[", "\[ScriptCapitalP]", "]"}], "=", 
       RowBox[{"{", 
        RowBox[{"SparseArray", "[", 
         RowBox[{
          RowBox[{"{", "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"n", ",", "n"}], "}"}]}], "]"}], "}"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"mutations", "[", "\[ScriptCapitalP]", "]"}], "=", 
       RowBox[{"{", 
        RowBox[{"ConstantArray", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", "}"}], ",", 
            RowBox[{"{", "}"}]}], "}"}], ",", 
          RowBox[{"Length", "[", "pop0", "]"}]}], "]"}], "}"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"numM", "[", "\[ScriptCapitalP]", "]"}], "=", "0"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"numJ", "[", "\[ScriptCapitalP]", "]"}], "=", 
       RowBox[{"4", "n"}]}], ";", 
      RowBox[{
       RowBox[{"mapLength", "[", "\[ScriptCapitalP]", "]"}], "=", "R"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"locJ", "[", "\[ScriptCapitalP]", "]"}], "[", 
            RowBox[{
             RowBox[{"2", "#"}], "-", "1"}], "]"}], "=", "0"}], ";", 
          RowBox[{
           RowBox[{
            RowBox[{"locJ", "[", "\[ScriptCapitalP]", "]"}], "[", 
            RowBox[{"2", "#"}], "]"}], "=", "R"}], ";", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"hapJ", "[", "\[ScriptCapitalP]", "]"}], "[", 
            RowBox[{
             RowBox[{"2", "#"}], "-", "1"}], "]"}], "=", 
           RowBox[{"{", 
            RowBox[{"0", ",", "#"}], "}"}]}], ";", 
          RowBox[{
           RowBox[{
            RowBox[{"hapJ", "[", "\[ScriptCapitalP]", "]"}], "[", 
            RowBox[{"2", "#"}], "]"}], "=", 
           RowBox[{"{", 
            RowBox[{"#", ",", "0"}], "}"}]}], ";", 
          RowBox[{
           RowBox[{
            RowBox[{"originJ", "[", "\[ScriptCapitalP]", "]"}], "[", 
            RowBox[{
             RowBox[{"2", "#"}], "-", "1"}], "]"}], "=", "0"}], ";", 
          RowBox[{
           RowBox[{
            RowBox[{"originJ", "[", "\[ScriptCapitalP]", "]"}], "[", 
            RowBox[{"2", "#"}], "]"}], "=", "0"}]}], ")"}], "&"}], "/@", 
       RowBox[{"Range", "[", 
        RowBox[{"2", "n"}], "]"}]}], ";"}]}], "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6933739109419527`*^9, 3.6933739588345423`*^9}, {
   3.69337475133175*^9, 3.693374764414893*^9}, {3.693374839908758*^9, 
   3.693374843606277*^9}, {3.693374921430235*^9, 3.6933750424859667`*^9}, {
   3.693375092574152*^9, 3.6933751208354797`*^9}, {3.693375183204215*^9, 
   3.6933752737748528`*^9}, {3.693375359902772*^9, 3.693375432187272*^9}, {
   3.693376367998126*^9, 3.6933763816471663`*^9}, 3.693376469812686*^9, {
   3.6933765613701973`*^9, 3.693376563440246*^9}, {3.693376731251505*^9, 
   3.693376738089793*^9}, {3.693376776042179*^9, 3.6933767934593353`*^9}, {
   3.6933951349971247`*^9, 3.69339531845864*^9}, {3.693395352376285*^9, 
   3.6933954234146223`*^9}, {3.6933954708142776`*^9, 3.6933954843071413`*^9}, 
   3.6933955150911093`*^9, {3.693461796329482*^9, 3.693461799929303*^9}, {
   3.693569411254796*^9, 3.693569426188983*^9}, {3.6983118123101997`*^9, 
   3.6983118335649548`*^9}, {3.698833202982873*^9, 3.6988332235103893`*^9}, {
   3.698833421315792*^9, 3.698833443963554*^9}, {3.698833492755184*^9, 
   3.6988335107143593`*^9}, {3.698897862836464*^9, 3.6988978649323483`*^9}, {
   3.6989346168215923`*^9, 3.6989346203351793`*^9}, {3.699604571392256*^9, 
   3.699604600344401*^9}, {3.699604635663085*^9, 3.699604637343895*^9}, {
   3.6996047602735443`*^9, 3.6996047697337427`*^9}, {3.6996710480261908`*^9, 
   3.699671092932349*^9}, {3.700632284337741*^9, 3.700632301888208*^9}, {
   3.700632882038371*^9, 3.7006329090526247`*^9}, {3.7006426077935143`*^9, 
   3.700642634283867*^9}, {3.700659915048478*^9, 3.700659917735272*^9}},
 CellLabel->
  "In[402]:=",ExpressionUUID->"958f0106-9220-4c46-990e-03d00b15549d"]
}, Closed]],

Cell[CellGroupData[{

Cell["makeBreakPoints", "Subsubsection",
 CellChangeTimes->{{3.692958920598654*^9, 
  3.692958923917666*^9}},ExpressionUUID->"1f9a8f51-d700-41da-8a9d-\
6dbf3b1853aa"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"makeBreakPoints", "::", "usage"}], "=", 
   "\"\<makeBreakPoints[2N,R] generates a list of breakpoints on {0,R} for \
each of 2N gametes\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.692958926978602*^9, 3.692958975556265*^9}},
 CellLabel->
  "In[403]:=",ExpressionUUID->"498ce0af-e35f-4b0d-8cbe-a17b58cf3da1"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"makeBreakPoints", "[", 
     RowBox[{"n_", ",", "R_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"nbp", ",", "bp", ",", "fbp"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"nbp", "=", 
        RowBox[{"RandomInteger", "[", 
         RowBox[{
          RowBox[{"PoissonDistribution", "[", "R", "]"}], ",", "n"}], "]"}]}],
        ";", "\[IndentingNewLine]", 
       RowBox[{"bp", "=", 
        RowBox[{"RandomReal", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0", ",", "R"}], "}"}], ",", 
          RowBox[{"Total", "[", "nbp", "]"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"fbp", "=", 
        RowBox[{"FoldList", "[", 
         RowBox[{"Plus", ",", "1", ",", "nbp"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"Sort", "[", 
          RowBox[{"Take", "[", 
           RowBox[{"bp", ",", "#"}], "]"}], "]"}], "&"}], "/@", 
        RowBox[{"Transpose", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Drop", "[", 
            RowBox[{"fbp", ",", 
             RowBox[{"-", "1"}]}], "]"}], ",", 
           RowBox[{
            RowBox[{"Drop", "[", 
             RowBox[{"fbp", ",", "1"}], "]"}], "-", "1"}]}], "}"}], 
         "]"}]}]}]}], "]"}]}], ";"}], "\[IndentingNewLine]"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6929589807175293`*^9, 3.692959035556686*^9}, {
  3.6929625343892612`*^9, 3.692962537724668*^9}},
 CellLabel->
  "In[404]:=",ExpressionUUID->"4cc95104-80ac-416d-9630-553a45f5f195"]
}, Closed]],

Cell[CellGroupData[{

Cell["randomPedigree", "Subsubsection",
 CellChangeTimes->{{3.691916378217474*^9, 
  3.691916383072146*^9}},ExpressionUUID->"99628abd-dec7-4334-bcbb-\
9c65b3488494"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"randomPedigree", "::", "usage"}], "=", 
   "\"\<randomPedigree[{n,p}] makes a random WF pedigree (but with no \
selfing), with n offspring and p parents. \
randomPedigree[{{\!\(\*SubscriptBox[\(n\), \(1\)]\),\!\(\*SubscriptBox[\(n\), \
\(2\)]\),\[Ellipsis],\!\(\*SubscriptBox[\(n\), \(k\)]\)},{\!\(\*SubscriptBox[\
\(p\), \(1\)]\),\[Ellipsis],\!\(\*SubscriptBox[\(p\), \
\(k\)]\)}},{{\!\(\*SubscriptBox[\(m\), \(1, 1\)]\),\!\(\*SubscriptBox[\(m\), \
\(1, 2\)]\),\[Ellipsis]},\[Ellipsis]}] makes a random pedigree for the \
k-island model, with \!\(\*SubscriptBox[\(n\), \(i\)]\) offspring, \
\!\(\*SubscriptBox[\(p\), \(i\)]\) parents, and a fraction \
\!\(\*SubscriptBox[\(m\), \(i, j\)]\) in deme i coming from deme j. \
randomPedigree[{n,p},{{\!\(\*SubscriptBox[\(m\), \(1, \
1\)]\),\!\(\*SubscriptBox[\(m\), \(1, 2\)]\),\[Ellipsis]},\[Ellipsis]}] \
assumes that all k demes have n offspring and p parents. There must be at \
least two parents per deme to avoid selfing. Returns a SparseArray.\>\""}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.691916385614503*^9, 3.691916437358726*^9}, {
  3.6919166367568417`*^9, 3.6919166455877047`*^9}, {3.700650500520503*^9, 
  3.700650703095437*^9}, {3.700650740294093*^9, 3.700650740566358*^9}, {
  3.7006513788001738`*^9, 3.700651390165962*^9}},
 CellLabel->
  "In[405]:=",ExpressionUUID->"25ccddcd-2b21-4bdf-9639-dc3b53351fb5"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"randomPedigree", "[", 
    RowBox[{"{", 
     RowBox[{"n_Integer", ",", "p_Integer"}], "}"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"c", "=", 
       RowBox[{"ConstantArray", "[", 
        RowBox[{"0", ",", "p"}], "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"SparseArray", "[", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"ReplacePart", "[", 
         RowBox[{"c", ",", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"List", "/@", 
             RowBox[{"RandomSample", "[", 
              RowBox[{
               RowBox[{"Range", "[", "p", "]"}], ",", "2"}], "]"}]}], ")"}], 
           "\[Rule]", "1"}]}], "]"}], ",", 
        RowBox[{"{", "n", "}"}]}], "]"}], "]"}]}], "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6919164415949297`*^9, 3.6919165210702868`*^9}, {
  3.69191655723879*^9, 3.69191665506758*^9}, {3.700650721965412*^9, 
  3.7006507269096003`*^9}},
 CellLabel->
  "In[406]:=",ExpressionUUID->"4d8707fe-018e-47c6-91e5-30953063147e"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"randomPedigree", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"n_Integer", ",", "p_Integer"}], "}"}], ",", "m_List"}], "]"}], 
   ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"k", "=", 
       RowBox[{"Length", "[", "m", "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"randomPedigree", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"ConstantArray", "[", 
          RowBox[{"n", ",", "k"}], "]"}], ",", 
         RowBox[{"ConstantArray", "[", 
          RowBox[{"p", ",", "k"}], "]"}]}], "}"}], ",", "m"}], "]"}]}], 
    "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6919164415949297`*^9, 3.6919165210702868`*^9}, {
   3.69191655723879*^9, 3.69191665506758*^9}, 3.700650736485277*^9, {
   3.7006507764833403`*^9, 3.700650824578232*^9}},
 CellLabel->
  "In[407]:=",ExpressionUUID->"e85018e1-b96f-4996-b456-33ed805f5eb0"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"randomPedigree", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"n", ":", 
        RowBox[{"{", "___Integer", "}"}]}], ",", 
       RowBox[{"p", ":", 
        RowBox[{"{", "___Integer", "}"}]}]}], "}"}], ",", "m_List"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"demes", "=", 
        RowBox[{"Range", "[", 
         RowBox[{"Length", "[", "m", "]"}], "]"}]}], ",", "ds", ",", "pars", 
       ",", 
       RowBox[{"c", "=", 
        RowBox[{"ConstantArray", "[", 
         RowBox[{"0", ",", 
          RowBox[{"Total", "[", "p", "]"}]}], "]"}]}], ",", "rp"}], "}"}], 
     ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"rp", "=", 
       RowBox[{"partitionList", "[", "p", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"ds", "=", 
       RowBox[{"Flatten", "[", 
        RowBox[{
         RowBox[{"MapThread", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"RandomChoice", "[", 
             RowBox[{
              RowBox[{"#1", "\[Rule]", "demes"}], ",", 
              RowBox[{"{", 
               RowBox[{"#2", ",", "2"}], "}"}]}], "]"}], "&"}], ",", 
           RowBox[{"{", 
            RowBox[{"m", ",", "n"}], "}"}]}], "]"}], ",", "1"}], "]"}]}], ";",
       "\[IndentingNewLine]", 
      RowBox[{"pars", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
            "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
            "\[Equal]", 
            RowBox[{
            "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}], 
           ",", 
           RowBox[{"RandomSample", "[", 
            RowBox[{
             RowBox[{"rp", "\[LeftDoubleBracket]", 
              RowBox[{
              "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
              "\[RightDoubleBracket]"}], ",", "2"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"RandomChoice", "[", 
              RowBox[{"rp", "\[LeftDoubleBracket]", 
               RowBox[{
               "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
               "\[RightDoubleBracket]"}], "]"}], ",", 
             RowBox[{"RandomChoice", "[", 
              RowBox[{"rp", "\[LeftDoubleBracket]", 
               RowBox[{
               "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
               "\[RightDoubleBracket]"}], "]"}]}], "}"}]}], "]"}], "&"}], "/@",
         "ds"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"SparseArray", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"ReplacePart", "[", 
          RowBox[{"c", ",", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"List", "/@", "#"}], ")"}], "\[Rule]", "1"}]}], "]"}], 
         "&"}], "/@", "pars"}], "]"}]}]}], "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6919164415949297`*^9, 3.6919165210702868`*^9}, {
   3.69191655723879*^9, 3.69191665506758*^9}, 3.700650736485277*^9, {
   3.7006507764833403`*^9, 3.700650862610285*^9}, {3.700653139013734*^9, 
   3.700653187797533*^9}, {3.700653474946766*^9, 3.700653495057569*^9}, {
   3.700653687676621*^9, 3.700653697811091*^9}},
 CellLabel->
  "In[408]:=",ExpressionUUID->"a8025232-2527-4c27-8fca-b48a32ad8ab8"]
}, Closed]],

Cell[CellGroupData[{

Cell["DropZ", "Subsubsection",
 InitializationCell->
  True,ExpressionUUID->"1244779b-be37-46e0-9fd8-6c8a60d4edc8"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"DropZ", "::", "usage"}], "=", 
   "\"\<DropZ[z,P,Va] generates random trait values, given the pedigree P, \
under the infinitesimal model. DropZ[z0,{P1,\[Ellipsis]},Va] does the same \
for many generations\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{3.691906736343442*^9},
 CellLabel->
  "In[409]:=",ExpressionUUID->"58cc022b-55b1-45a6-b6e6-aef28706422d"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"DropZ", "[", 
    RowBox[{
     RowBox[{"z", ":", 
      RowBox[{"{", "___Real", "}"}]}], ",", "P_SparseArray", ",", "v_"}], 
    "]"}], ":=", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{"v", "\[Equal]", "0"}], ",", "0", ",", 
      RowBox[{"RandomReal", "[", 
       RowBox[{
        RowBox[{"NormalDistribution", "[", 
         RowBox[{"0", ",", " ", 
          RowBox[{"Sqrt", "[", 
           FractionBox["v", "2"], "]"}]}], "]"}], ",", 
        RowBox[{"Length", "[", "z", "]"}]}], "]"}]}], "]"}], "+", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       RowBox[{"Mean", "[", 
        RowBox[{"z", "\[LeftDoubleBracket]", "#", "\[RightDoubleBracket]"}], 
        "]"}], "&"}], "/@", 
      RowBox[{"Parents", "[", "P", "]"}]}], ")"}]}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6919067504949017`*^9, 3.6919067513170652`*^9}, {
  3.699671118259892*^9, 3.699671124785873*^9}},
 CellLabel->
  "In[410]:=",ExpressionUUID->"784779d3-6636-4149-88af-e16a8666ff78"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"DropZ", "[", 
    RowBox[{
     RowBox[{"z0", ":", 
      RowBox[{"{", "___Real", "}"}]}], ",", "Pl_List", ",", "v_"}], "]"}], ":=",
    "\[IndentingNewLine]", 
   RowBox[{"FoldList", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"DropZ", "[", 
       RowBox[{"#1", ",", "#2", ",", "v"}], "]"}], "&"}], ",", "z0", ",", 
     "Pl"}], "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellLabel->
  "In[411]:=",ExpressionUUID->"05f61333-8cc7-47d1-b5f7-21fb48468f37"]
}, Closed]],

Cell[CellGroupData[{

Cell["Parents", "Subsubsection",ExpressionUUID->"1d3fa83e-5641-4942-b958-7b2997ea0d91"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Parents", "::", "usage"}], "=", 
   "\"\<Parents[P] returns the parents of each individual in the pedigree.  P \
must be a SparseArray.\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellLabel->
  "In[412]:=",ExpressionUUID->"3f29b3bf-dbed-4f35-bc84-7bc39c64d998"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Parents", "[", "P_SparseArray", "]"}], ":=", 
   RowBox[{"Partition", "[", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"#", "\[LeftDoubleBracket]", 
        RowBox[{"1", ",", "2"}], "\[RightDoubleBracket]"}], "&"}], "/@", 
      RowBox[{"Drop", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"ArrayRules", "[", "P", "]"}], "/.", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"x_", "\[Rule]", "2"}], ")"}], "\[Rule]", 
           RowBox[{"Sequence", "[", 
            RowBox[{
             RowBox[{"x", "\[Rule]", "2"}], ",", 
             RowBox[{"x", "\[Rule]", "2"}]}], " ", "]"}]}], "}"}]}], ",", 
        RowBox[{"-", "1"}]}], "]"}]}], ",", "2"}], "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellLabel->
  "In[413]:=",ExpressionUUID->"1b108211-56ce-496a-b824-8dc693621ce5"]
}, Closed]],

Cell[CellGroupData[{

Cell["diag", "Subsubsection",
 InitializationCell->True,
 CellChangeTimes->{{3.4428367032702627`*^9, 
  3.442836703724061*^9}},ExpressionUUID->"3a7576dc-8075-471b-9337-\
8e207f61eebd"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"diag", "::", "usage"}], "=", 
   "\"\<diag[{a,b,c}] gives a diagonal matrix.  Differs from DiagonalMatrix \
in that it can take vector arguments.\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.4428367066607027`*^9, 3.442836749536867*^9}},
 CellLabel->
  "In[414]:=",ExpressionUUID->"e056ea3b-193b-44d6-a89f-86a9afd45c37"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"diag", "[", "v_List", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"n", "=", 
        RowBox[{"Length", "[", "v", "]"}]}], ",", "i"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"ReplacePart", "[", 
      RowBox[{
       RowBox[{"IdentityMatrix", "[", "n", "]"}], ",", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{"i", ",", "i"}], "}"}], "\[Rule]", 
          RowBox[{
          "v", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}]}], ",", 
         
         RowBox[{"{", 
          RowBox[{"i", ",", "n"}], "}"}]}], "]"}]}], "]"}]}], "]"}]}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.442836612283471*^9, 3.4428366892954607`*^9}},
 CellLabel->
  "In[415]:=",ExpressionUUID->"145ddcea-2485-4b76-924a-d670a2117181"]
}, Closed]],

Cell[CellGroupData[{

Cell["het", "Subsubsection",
 CellChangeTimes->{{3.643271761913978*^9, 
  3.64327176209866*^9}},ExpressionUUID->"dd1cc427-de7e-498e-8a38-\
5e508295be50"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"het", "::", "usage"}], "=", 
   "\"\<het[{0,1,\[Ellipsis]},{1,0,\[Ellipsis]}] lists a 1 if the locus is \
heterozygous.\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6432717263495283`*^9, 3.643271771281735*^9}},
 CellLabel->
  "In[416]:=",ExpressionUUID->"b3b8d0d1-3261-47e6-8ea8-ee6e15be34aa"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"het", "[", 
    RowBox[{"X_List", ",", "Y_List"}], "]"}], ":=", 
   RowBox[{"X", "+", "Y", "-", 
    RowBox[{"2", "X", " ", "Y"}]}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.643271773613389*^9, 3.643271797630991*^9}},
 CellLabel->
  "In[417]:=",ExpressionUUID->"ad4f731f-d857-4129-9230-71b0bc87739f"]
}, Closed]],

Cell[CellGroupData[{

Cell["segVariance", "Subsubsection",
 CellChangeTimes->{{3.64327155965289*^9, 
  3.64327156205154*^9}},ExpressionUUID->"8dd224d9-42e8-4d8b-95b1-\
347c914e2d8b"],

Cell["\<\
The segregation variance can be calculated in several ways: from the pedigree \
relatedness; from the actual variance that would be released between any \
particular pair (which depends solely on the heterozygous loci that they \
share); and for the whole population, on the mean pairwise segregation \
variance - which I think should be identical with the segregation variance.  \
\
\>", "Text",
 CellChangeTimes->{{3.6432715690983887`*^9, 3.643271692667465*^9}, {
  3.6920156571974907`*^9, 
  3.692015657827776*^9}},ExpressionUUID->"a079da0a-a054-4471-a67d-\
3c08d5302ab2"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"segVariance", "::", "usage"}], "=", 
   "\"\<segVariance[\[Alpha]][{0,1,\[Ellipsis]},{1,0,\[Ellipsis]}] gives the \
segregation variance between each pair of individuals, which is just the sum \
of \!\(\*FractionBox[\(1\), \(4\)]\)\!\(\*SuperscriptBox[\(\[Alpha]\), \(2\)]\
\) over all heterozygous loci.  \>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6432727641246147`*^9, 3.6432728850990553`*^9}, {
  3.643272918934518*^9, 3.643272926835959*^9}},
 CellLabel->
  "In[418]:=",ExpressionUUID->"fc4d2a5e-1d0a-442a-b57a-8194178f6240"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"segVariance", "[", "\[Alpha]_List", "]"}], "[", 
    RowBox[{"X_List", ",", "Y_List"}], "]"}], ":=", 
   RowBox[{
    FractionBox["1", "4"], 
    RowBox[{
     SuperscriptBox["\[Alpha]", "2"], ".", 
     RowBox[{"het", "[", 
      RowBox[{"X", ",", "Y"}], "]"}]}]}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6432728646670227`*^9, 3.6432729370964813`*^9}, 
   3.643273488853726*^9},
 CellLabel->
  "In[419]:=",ExpressionUUID->"321c9ced-0ab5-4944-b389-430c74240466"]
}, Closed]],

Cell[CellGroupData[{

Cell["makeReps", "Subsubsection",
 CellChangeTimes->{{3.64328466218714*^9, 
  3.643284663824994*^9}},ExpressionUUID->"29375def-28c7-4839-be67-\
ae6dda3ab036"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"makeReps", "::", "usage"}], "=", 
   "\"\<makeReps[W,\[Alpha],p0,tmax,nreps] generates replicate simulations, \
with fitness W[X] and trait z defined by additive effects \[Alpha]. Stores a \
table of {\!\(\*OverscriptBox[\(z\), \(_\)]\),\!\(\*SubscriptBox[\(V\), \
\(g\)]\),\!\(\*SubscriptBox[\(V\), \(a\)]\)} for each replicate; dimensions \
nreps\[Times]3\[Times](\!\(\*SubscriptBox[\(t\), \(max\)]\)+1).  Tracks \
rep.\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.643285117323534*^9, 3.643285175594336*^9}, {
  3.64328520565009*^9, 3.643285323968858*^9}, {3.6432854047131653`*^9, 
  3.6432854535369177`*^9}, {3.643285915368759*^9, 3.643285919206057*^9}, {
  3.643337850761175*^9, 3.6433378544482603`*^9}, {3.643337937834601*^9, 
  3.6433379454935207`*^9}, {3.643377550579711*^9, 3.643377560629849*^9}},
 CellLabel->
  "In[420]:=",ExpressionUUID->"ffac52e3-4537-487b-bfd0-7e3998fae4e7"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"makeReps", "[", 
    RowBox[{
    "w_", ",", "\[Alpha]_", ",", "p0_", ",", "tm_Integer", ",", 
     "nreps_Integer"}], "]"}], ":=", 
   RowBox[{
    RowBox[{"makeReps", "[", 
     RowBox[{"w", ",", "\[Alpha]", ",", "p0", ",", "tm", ",", "nreps"}], 
     "]"}], "=", "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"pl", ",", 
        RowBox[{"n", "=", 
         RowBox[{"Length", "[", "p0", "]"}]}]}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"pl", "=", 
          RowBox[{"NestList", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"SparsePedigreeMatrix", "[", 
              RowBox[{
               RowBox[{
               "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
               ",", "w"}], "]"}], "&"}], ",", 
            RowBox[{"{", 
             RowBox[{"Null", ",", "p0"}], "}"}], ",", "tm"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Mean", "[", 
              RowBox[{
               RowBox[{"z", "[", "\[Alpha]", "]"}], "[", 
               RowBox[{
               "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
               "]"}], "]"}], "&"}], "/@", "pl"}], ",", 
           RowBox[{
            RowBox[{
             RowBox[{"Variance", "[", 
              RowBox[{
               RowBox[{"z", "[", "\[Alpha]", "]"}], "[", 
               RowBox[{
               "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
               "]"}], "]"}], "&"}], "/@", "pl"}], ",", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"genicVariance", "[", "\[Alpha]", "]"}], "[", 
              RowBox[{
              "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
              "]"}], "&"}], "/@", "pl"}]}], "}"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"rep", ",", "nreps"}], "}"}]}], "]"}]}], "]"}]}]}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.643285327351657*^9, 3.643285392191782*^9}, {
   3.643285460215963*^9, 3.6432856044460163`*^9}, {3.643285637562141*^9, 
   3.6432856441444387`*^9}, {3.643285686950494*^9, 3.6432856915462513`*^9}, {
   3.643285745365881*^9, 3.643285790942893*^9}, {3.6432859236470213`*^9, 
   3.643285934456707*^9}, 3.643286008722427*^9, {3.643337860522814*^9, 
   3.6433379232341423`*^9}, {3.64333806297005*^9, 3.6433380664937277`*^9}, {
   3.643377565041803*^9, 3.643377579542848*^9}},
 CellLabel->
  "In[421]:=",ExpressionUUID->"2df516b1-b79b-45ba-a454-66e806ff0778"]
}, Closed]]
}, Closed]],

Cell[CellGroupData[{

Cell["Transition matrix", "Subsection",
 CellChangeTimes->{{3.667455210813991*^9, 
  3.667455213757864*^9}},ExpressionUUID->"7fc763a1-f6b9-4e4f-b127-\
cc311e3fcf9d"],

Cell[CellGroupData[{

Cell["transitionMatrix", "Subsubsection",
 CellChangeTimes->{{3.5851043267034063`*^9, 
  3.585104329927321*^9}},ExpressionUUID->"1c1624fb-91f3-486b-9916-\
39e1bbbb9cbc"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"transitionMatrix", "::", "usage"}], "=", 
   "\"\<transitionMatrix[N,\[Beta]\[Alpha],\[Mu]] stores the transition \
matrix for the distribution of allele frequencies under mutation and \
directional selection.\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.565457072861456*^9, 3.5654570785669928`*^9}, {
  3.565457120024033*^9, 3.5654571697056713`*^9}, {3.565501279432078*^9, 
  3.5655013080710278`*^9}, {3.565501707778797*^9, 3.565501726164199*^9}, {
  3.565581730945407*^9, 3.565581733737029*^9}, {3.585104488720087*^9, 
  3.5851045428371487`*^9}, {3.585104646618394*^9, 3.585104667989368*^9}, {
  3.585104881285883*^9, 3.585104882268261*^9}},
 CellLabel->
  "In[422]:=",ExpressionUUID->"1aa4c713-ba4e-41d4-85df-fb3ce84e350d"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"transitionMatrix", "[", 
    RowBox[{"nn_Integer", ",", "\[Beta]\[Alpha]_", ",", "\[Mu]_"}], "]"}], ":=", 
   RowBox[{
    RowBox[{"transitionMatrix", "[", 
     RowBox[{"nn", ",", "\[Beta]\[Alpha]", ",", "\[Mu]"}], "]"}], "=", 
    "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"j", ",", "npl"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"npl", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"\[Mu]", "+", 
           FractionBox[
            RowBox[{"j", "\[VeryThinSpace]", 
             RowBox[{"(", 
              RowBox[{"1", "-", 
               RowBox[{"2", "\[Mu]"}]}], ")"}]}], 
            RowBox[{"j", "+", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"nn", "-", "j"}], ")"}], 
              RowBox[{"Exp", "[", 
               RowBox[{"-", "\[Beta]\[Alpha]"}], "]"}], 
              "\[VeryThinSpace]"}]}]]}], ",", 
          RowBox[{"{", 
           RowBox[{"j", ",", "0", ",", "nn"}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"PDF", "[", 
            RowBox[{
             RowBox[{"BinomialDistribution", "[", 
              RowBox[{"nn", ",", "#"}], "]"}], ",", "j"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"j", ",", "0", ",", "nn"}], "}"}]}], "]"}], "&"}], "/@", 
        "npl"}]}]}], "]"}]}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.565431684442993*^9, 3.565431914511509*^9}, {
   3.565432271014388*^9, 3.565432284008582*^9}, 3.5654352888601227`*^9, {
   3.5654365082232018`*^9, 3.5654365093836946`*^9}, {3.5655010850348988`*^9, 
   3.5655012721861343`*^9}, {3.5655013125399113`*^9, 3.56550132442168*^9}, {
   3.565501734735208*^9, 3.565501793686553*^9}, {3.565503199348651*^9, 
   3.565503209983128*^9}, {3.565581737526621*^9, 3.56558174246594*^9}, {
   3.565581804115757*^9, 3.565581810736423*^9}, 3.5851044914087687`*^9, 
   3.585104638744328*^9, {3.585104670713067*^9, 3.585104737305663*^9}, {
   3.5851047901382637`*^9, 3.585104829802196*^9}, {3.585104886280281*^9, 
   3.585104891580497*^9}},
 CellLabel->
  "In[423]:=",ExpressionUUID->"c9bc1ded-1901-4b3f-8a8d-b46b4938ec21"],

Cell[BoxData[
 RowBox[{"tm", "=", 
  RowBox[{"transitionMatrix", "[", 
   RowBox[{"1000", ",", "0.001", ",", 
    SuperscriptBox["10", 
     RowBox[{"-", "6."}]]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.605782217449636*^9, 
  3.605782234268873*^9}},ExpressionUUID->"ed35992d-4eca-41b2-b912-\
0896f182be4a"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Timing", "[", 
  RowBox[{
   RowBox[{"Chop", "[", 
    RowBox[{
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"PDF", "[", 
        RowBox[{
         RowBox[{"BinomialDistribution", "[", 
          RowBox[{"1000", ",", "0.3"}], "]"}], ",", "j"}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"j", ",", "0", ",", "1000"}], "}"}]}], "]"}], ",", 
     SuperscriptBox["10", 
      RowBox[{"-", "8"}]]}], "]"}], ";"}], "]"}]], "Input",
 CellChangeTimes->{{3.605782116616683*^9, 3.6057821523504*^9}, {
  3.605782265499329*^9, 
  3.6057822702992268`*^9}},ExpressionUUID->"367c0278-783b-455e-95c3-\
b639826979b2"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
  "0.02455999999999999849897847070678835735`4.410828275748754", ",", "Null"}],
   "}"}]], "Output",
 CellChangeTimes->{3.6057821255443687`*^9, 3.605782203238491*^9, 
  3.605782276010188*^9},ExpressionUUID->"c739baa9-c408-49ad-b2ee-\
e875a84de186"]
}, Open  ]],

Cell[BoxData[{
 RowBox[{
  RowBox[{"tm", "=", 
   RowBox[{"npl", "=", 
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{"\[Mu]", "+", 
       FractionBox[
        RowBox[{"j", "\[VeryThinSpace]", 
         RowBox[{"(", 
          RowBox[{"1", "-", 
           RowBox[{"2", "\[Mu]"}]}], ")"}]}], 
        RowBox[{"j", "+", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"nn", "-", "j"}], ")"}], 
          RowBox[{"Exp", "[", 
           RowBox[{"-", "\[Beta]\[Alpha]"}], "]"}], "\[VeryThinSpace]"}]}]]}],
       ",", 
      RowBox[{"{", 
       RowBox[{"j", ",", "0", ",", "np"}], "}"}]}], "]"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"PDF", "[", 
      RowBox[{
       RowBox[{"BinomialDistribution", "[", 
        RowBox[{"nn", ",", "#"}], "]"}], ",", "j"}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"j", ",", "0", ",", "nn"}], "}"}]}], "]"}], "&"}], "/@", 
  "npl"}]}], "Input",
 CellChangeTimes->{{3.6057831073427353`*^9, 
  3.605783119176661*^9}},ExpressionUUID->"74e357a8-5ee9-4ed6-9b6b-\
1cb02a38cd78"]
}, Closed]],

Cell[CellGroupData[{

Cell["transitionMatrixFast", "Subsubsection",
 CellChangeTimes->{{3.5851043267034063`*^9, 3.585104329927321*^9}, {
  3.605783765622171*^9, 
  3.605783766020232*^9}},ExpressionUUID->"e098dc96-8cdc-4637-8d63-\
1536401919eb"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"transitionMatrixFast", "::", "usage"}], "=", 
   "\"\<transitionMatrixFast[N,s,\[Mu],\[Epsilon]] stores the transition \
matrix as a sparse array, truncating probabilities smaller than \
\!\(\*SubscriptBox[\(P\), \(max\)]\)\[Epsilon]. Fitnesses are in the ratio 1:\
\!\(\*SuperscriptBox[\(\[ExponentialE]\), \(s\)]\), and mutation is \
symmetric. Probabilities truncated at some small \[Epsilon]. WARNING: Use \
numerical values for s, \[Mu], otherwise this will be very slow!\>\""}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.565457072861456*^9, 3.5654570785669928`*^9}, {
  3.565457120024033*^9, 3.5654571697056713`*^9}, {3.565501279432078*^9, 
  3.5655013080710278`*^9}, {3.565501707778797*^9, 3.565501726164199*^9}, {
  3.565581730945407*^9, 3.565581733737029*^9}, {3.585104488720087*^9, 
  3.5851045428371487`*^9}, {3.585104646618394*^9, 3.585104667989368*^9}, {
  3.585104881285883*^9, 3.585104882268261*^9}, {3.605783769337921*^9, 
  3.605783833011142*^9}, {3.605783881850835*^9, 3.605783911153906*^9}, {
  3.605784127372344*^9, 3.60578412972416*^9}, {3.667455497041828*^9, 
  3.667455512519*^9}, {3.667455694770227*^9, 3.667455713304084*^9}},
 CellLabel->
  "In[424]:=",ExpressionUUID->"6b6d75ca-d13a-4f45-99b0-e50b48da28fb"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"transitionMatrixFast", "[", 
    RowBox[{
    "nn_Integer", ",", "\[Beta]\[Alpha]_", ",", "\[Mu]_", ",", 
     "\[Epsilon]_"}], "]"}], ":=", 
   RowBox[{
    RowBox[{"transitionMatrixFast", "[", 
     RowBox[{"nn", ",", "\[Beta]\[Alpha]", ",", "\[Mu]", ",", "\[Epsilon]"}], 
     "]"}], "=", "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"j", ",", "p", ",", "b"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{"SparseArray", "[", 
       RowBox[{"Table", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"p", "=", 
           RowBox[{"\[Mu]", "+", 
            FractionBox[
             RowBox[{"j", "\[VeryThinSpace]", 
              RowBox[{"(", 
               RowBox[{"1", "-", 
                RowBox[{"2", "\[Mu]"}]}], ")"}]}], 
             RowBox[{"j", "+", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"nn", "-", "j"}], ")"}], 
               RowBox[{"Exp", "[", 
                RowBox[{"-", "\[Beta]\[Alpha]"}], "]"}], 
               "\[VeryThinSpace]"}]}]]}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"b", "=", 
           RowBox[{"BinomialPDF", "[", 
            RowBox[{"nn", ",", "p", ",", "\[Epsilon]"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"SparseArray", "[", 
           RowBox[{
            RowBox[{"MapThread", "[", 
             RowBox[{"Rule", ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"Range", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{
                   "b", "\[LeftDoubleBracket]", "1", 
                    "\[RightDoubleBracket]"}], "+", "1"}], ",", 
                  RowBox[{
                   RowBox[{
                   "b", "\[LeftDoubleBracket]", "1", 
                    "\[RightDoubleBracket]"}], "+", 
                   RowBox[{"Length", "[", 
                    RowBox[{
                    "b", "\[LeftDoubleBracket]", "2", 
                    "\[RightDoubleBracket]"}], "]"}]}]}], "]"}], ",", 
                RowBox[{
                "b", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}],
                "}"}]}], "]"}], ",", 
            RowBox[{"nn", "+", "1"}]}], "]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"j", ",", "0", ",", "nn"}], "}"}]}], "]"}], "]"}]}], 
     "]"}]}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.565431684442993*^9, 3.565431914511509*^9}, {
   3.565432271014388*^9, 3.565432284008582*^9}, 3.5654352888601227`*^9, {
   3.5654365082232018`*^9, 3.5654365093836946`*^9}, {3.5655010850348988`*^9, 
   3.5655012721861343`*^9}, {3.5655013125399113`*^9, 3.56550132442168*^9}, {
   3.565501734735208*^9, 3.565501793686553*^9}, {3.565503199348651*^9, 
   3.565503209983128*^9}, {3.565581737526621*^9, 3.56558174246594*^9}, {
   3.565581804115757*^9, 3.565581810736423*^9}, 3.5851044914087687`*^9, 
   3.585104638744328*^9, {3.585104670713067*^9, 3.585104737305663*^9}, {
   3.5851047901382637`*^9, 3.585104829802196*^9}, {3.585104886280281*^9, 
   3.585104891580497*^9}, {3.6057837822299623`*^9, 3.605783808184503*^9}, {
   3.60578891050959*^9, 3.6057890439267*^9}, {3.605789957448739*^9, 
   3.6057899590716753`*^9}},
 CellLabel->
  "In[425]:=",ExpressionUUID->"1c6e6661-bbfc-4d4b-9bb2-0982173c6fb0"]
}, Closed]],

Cell[CellGroupData[{

Cell["BinomialPDF", "Subsubsection",
 CellChangeTimes->{
  3.605787034887376*^9},ExpressionUUID->"c3fd0086-f72e-432b-8b9b-\
ccc7e42d5841"],

Cell[TextData[{
 "The PDF is ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    SubscriptBox["\[Psi]", "j"], "=", 
    RowBox[{
     FractionBox[
      RowBox[{"n", "!"}], 
      RowBox[{
       RowBox[{"j", "!"}], 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"n", "-", "j"}], ")"}], "!"}]}]], 
     SuperscriptBox[
      RowBox[{
       SuperscriptBox["p", "j"], "(", 
       RowBox[{"1", "-", "p"}], ")"}], "j"]}]}], TraditionalForm]],
  ExpressionUUID->"b008358e-0522-4840-9d3b-a8dc23b138fe"],
 ".  So, ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    FractionBox[
     SubscriptBox["\[Psi]", 
      RowBox[{"j", "+", "1"}]], 
     SubscriptBox["\[Psi]", "j"]], "=", 
    RowBox[{
     FractionBox["p", 
      RowBox[{"1", "-", "p"}]], 
     FractionBox[
      RowBox[{"n", "-", "j"}], 
      RowBox[{"j", "+", "1"}]]}]}], TraditionalForm]],ExpressionUUID->
  "163f20fd-0892-467c-8a61-4fd139b62807"],
 ", ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    FractionBox[
     SubscriptBox["\[Psi]", 
      RowBox[{"j", "-", "1"}]], 
     SubscriptBox["\[Psi]", "j"]], "=", 
    RowBox[{
     FractionBox[
      RowBox[{"1", "-", "p"}], "p"], 
     FractionBox["j", 
      RowBox[{"n", "-", "j", "+", "1"}]]}]}], TraditionalForm]],
  ExpressionUUID->"c8e434f3-0052-466f-a7f4-5588590bc79a"],
 ". Start at ",
 Cell[BoxData[
  FormBox[
   RowBox[{"Round", "[", 
    RowBox[{"p", "\[Times]", "\[VeryThinSpace]", "j"}], "]"}], 
   TraditionalForm]],ExpressionUUID->"72923686-cf39-44bb-b9e5-1154f8245978"],
 ", and work up and down until the probability has decreased by a factor \
\[Epsilon]."
}], "Text",
 CellChangeTimes->{{3.6057839334095984`*^9, 
  3.6057841450741177`*^9}},ExpressionUUID->"8d656cf2-f705-48cb-b85d-\
ad3648e56772"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"BinomialPDF", "::", "usage"}], "=", 
    "\"\<BinomialPDF[n,p,\[Epsilon]] gives the binomial PDF, truncating \
values smaller than \[Epsilon]*\!\(\*SubscriptBox[\(\[Psi]\), \(max\)]\).  \
Returns {\!\(\*SubscriptBox[\(j\), \(0\)]\),{\!\(\*SubscriptBox[\(\[Psi]\), \
SubscriptBox[\(j\), \(0\)]]\),\[Ellipsis]}}\>\""}], ";"}], " "}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.605784167818699*^9, 3.605784207186049*^9}, {
  3.605784592567622*^9, 3.605784669667213*^9}, {3.605786461940284*^9, 
  3.605786483863781*^9}},
 CellLabel->
  "In[426]:=",ExpressionUUID->"ecdec3bb-55f9-4338-a6dd-11e5a8b13ab4"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"BinomialPDF", "[", 
    RowBox[{"n_", ",", "p_", ",", "\[Epsilon]_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"j", ",", 
       RowBox[{"j0", "=", 
        RowBox[{"Round", "[", 
         RowBox[{"n", "*", "p"}], "]"}]}], ",", 
       RowBox[{"\[Psi]", "=", 
        RowBox[{"{", "1", "}"}]}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"p", "\[LessEqual]", "0"}], ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", "\[Psi]"}], "}"}], ",", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"p", "\[GreaterEqual]", "1"}], ",", 
         RowBox[{"{", 
          RowBox[{"n", ",", "\[Psi]"}], "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"j", "=", "j0"}], ";", 
          RowBox[{"While", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"j", "<", "n"}], "\[And]", 
             RowBox[{
              RowBox[{"\[Psi]", "\[LeftDoubleBracket]", 
               RowBox[{"-", "1"}], "\[RightDoubleBracket]"}], ">", 
              "\[Epsilon]"}]}], ",", 
            RowBox[{
             RowBox[{"AppendTo", "[", 
              RowBox[{"\[Psi]", ",", 
               RowBox[{
                RowBox[{"\[Psi]", "\[LeftDoubleBracket]", 
                 RowBox[{"-", "1"}], "\[RightDoubleBracket]"}], 
                FractionBox["p", 
                 RowBox[{"1", "-", "p"}]], 
                FractionBox[
                 RowBox[{"n", "-", "j"}], 
                 RowBox[{"j", "+", "1"}]]}]}], "]"}], ";", 
             RowBox[{"j", "+=", "1"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
          
          RowBox[{"j", "=", "j0"}], ";", 
          RowBox[{"While", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"j", ">", "0"}], "\[And]", 
             RowBox[{
              RowBox[{
              "\[Psi]", "\[LeftDoubleBracket]", "1", 
               "\[RightDoubleBracket]"}], ">", "\[Epsilon]"}]}], ",", 
            RowBox[{
             RowBox[{"PrependTo", "[", 
              RowBox[{"\[Psi]", ",", 
               RowBox[{
                RowBox[{
                "\[Psi]", "\[LeftDoubleBracket]", "1", 
                 "\[RightDoubleBracket]"}], 
                FractionBox[
                 RowBox[{"1", "-", "p"}], "p"], 
                FractionBox["j", 
                 RowBox[{"n", "-", "j", "+", "1"}]]}]}], "]"}], ";", 
             RowBox[{"j", "-=", "1"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
          
          RowBox[{"{", 
           RowBox[{"j", ",", 
            FractionBox["\[Psi]", 
             RowBox[{"Total", "[", "\[Psi]", "]"}]]}], "}"}]}]}], "]"}]}], 
      "]"}]}], "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.605784152321157*^9, 3.605784161770368*^9}, {
  3.605784672626152*^9, 3.605785005908456*^9}, {3.605786487928894*^9, 
  3.6057865872870293`*^9}, {3.605786795622136*^9, 3.605786831628187*^9}},
 CellLabel->
  "In[427]:=",ExpressionUUID->"1a22e445-bc15-4b35-a478-f99105780eab"]
}, Closed]],

Cell[CellGroupData[{

Cell["stationaryDist", "Subsubsection",
 CellChangeTimes->{{3.585372329205145*^9, 3.585372331475074*^9}, {
  3.585372431552207*^9, 
  3.585372436606681*^9}},ExpressionUUID->"78552497-8de2-4120-9da6-\
91e638a247ce"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"stationaryDist", "::", "usage"}], "=", 
   "\"\<stationaryDist[2N,s,\[Mu]] stores the stationary distribution.  Avoid \
using exact numbers. stationaryDist[2N,s,\[Mu],\[Epsilon]]  uses a sparse \
matrix\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.585372337522807*^9, 3.585372373676236*^9}, {
  3.585372440220751*^9, 3.5853724414609013`*^9}, {3.585372503610227*^9, 
  3.585372512577132*^9}, {3.605790040012246*^9, 3.605790049114354*^9}},
 CellLabel->
  "In[428]:=",ExpressionUUID->"557ff3d9-b0b0-4f9d-95dc-9f63a089229a"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"stationaryDist", "[", 
    RowBox[{"n_Integer", ",", "s_", ",", "\[Mu]_"}], "]"}], ":=", 
   RowBox[{
    RowBox[{"stationaryDist", "[", 
     RowBox[{"n", ",", "s", ",", "\[Mu]"}], "]"}], "=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "ev", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"ev", "=", 
        RowBox[{
         RowBox[{"Eigenvectors", "[", 
          RowBox[{
           RowBox[{"Transpose", "[", 
            RowBox[{"transitionMatrix", "[", 
             RowBox[{"n", ",", "s", ",", "\[Mu]"}], "]"}], "]"}], ",", "1"}], 
          "]"}], "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], 
       ";", 
       RowBox[{"ev", "=", 
        FractionBox["ev", 
         RowBox[{"Total", "[", "ev", "]"}]]}]}]}], "]"}]}]}], ";"}]], "Input",\

 InitializationCell->True,
 CellChangeTimes->{{3.585372345653819*^9, 3.5853723456553926`*^9}, {
   3.5853723763470078`*^9, 3.585372444692651*^9}, 3.6057900568668823`*^9},
 CellLabel->
  "In[429]:=",ExpressionUUID->"12e5d148-1be3-4696-a32f-228595623745"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"stationaryDist", "[", 
    RowBox[{"n_Integer", ",", "s_", ",", "\[Mu]_", ",", "\[Epsilon]_"}], 
    "]"}], ":=", 
   RowBox[{
    RowBox[{"stationaryDist", "[", 
     RowBox[{"n", ",", "s", ",", "\[Mu]", ",", "\[Epsilon]"}], "]"}], "=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "ev", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"ev", "=", 
        RowBox[{
         RowBox[{"Eigenvectors", "[", 
          RowBox[{
           RowBox[{"Transpose", "[", 
            RowBox[{"transitionMatrixFast", "[", 
             RowBox[{"n", ",", "s", ",", "\[Mu]", ",", "\[Epsilon]"}], "]"}], 
            "]"}], ",", "1"}], "]"}], "\[LeftDoubleBracket]", "1", 
         "\[RightDoubleBracket]"}]}], ";", 
       RowBox[{"ev", "=", 
        FractionBox["ev", 
         RowBox[{"Total", "[", "ev", "]"}]]}]}]}], "]"}]}]}], ";"}]], "Input",\

 InitializationCell->True,
 CellChangeTimes->{{3.585372345653819*^9, 3.5853723456553926`*^9}, {
  3.5853723763470078`*^9, 3.585372444692651*^9}, {3.605790060755262*^9, 
  3.605790074983691*^9}, {3.605790152663333*^9, 3.6057901633041487`*^9}},
 CellLabel->
  "In[430]:=",ExpressionUUID->"164d7184-ec46-4dab-995a-0b5fa123aecc"]
}, Closed]]
}, Closed]],

Cell[CellGroupData[{

Cell["Diffusion theory", "Subsection",
 CellChangeTimes->{{3.667455389937119*^9, 
  3.6674553977997217`*^9}},ExpressionUUID->"a5dc54ba-92b5-40fb-a8c4-\
8855760bdb3c"],

Cell[CellGroupData[{

Cell["Z", "Subsubsection",
 InitializationCell->True,
 CellChangeTimes->{
  3.565707763222876*^9},ExpressionUUID->"92e293bc-3e28-4cd6-bbb0-\
ccbaa39d45e3"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Z", "::", "usage"}], "=", 
   "\"\<Z[N\[VeryThinSpace]\[Mu],N\[VeryThinSpace]\!\(\*OverscriptBox[\(s\), \
\(~\)]\)\!\(\*SuperscriptBox[\(\[Alpha]\), \(2\)]\),\!\(\*FractionBox[\(\
\[CapitalDelta]\), \(\[Alpha]\)]\)] gives the normalisation for the \
distribution of allele frequency at a single locus\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.5657077148796587`*^9, 3.5657077820690603`*^9}},
 CellLabel->
  "In[431]:=",ExpressionUUID->"ca32b954-8515-4401-ab46-e1645aa2268d"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Z", "[", 
    RowBox[{"N\[Mu]_", ",", "Ns\[Alpha]\[Alpha]_", ",", "\[Delta]_"}], "]"}], 
   ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "p", "}"}], ",", 
     RowBox[{"NIntegrate", "[", 
      RowBox[{
       RowBox[{
        SuperscriptBox[
         RowBox[{"(", 
          RowBox[{"p", 
           RowBox[{"(", 
            RowBox[{"1", "-", "p"}], ")"}]}], ")"}], 
         RowBox[{
          RowBox[{"2", "N\[Mu]"}], "-", "1"}]], 
        RowBox[{"Exp", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"-", "2"}], "Ns\[Alpha]\[Alpha]", "\[VeryThinSpace]", 
           "\[Delta]", " ", "p"}], "-", 
          RowBox[{"Ns\[Alpha]\[Alpha]", " ", "p", 
           RowBox[{"(", 
            RowBox[{"1", "-", "p"}], ")"}]}]}], "]"}]}], ",", 
       RowBox[{"{", 
        RowBox[{"p", ",", "0", ",", "1"}], "}"}]}], "]"}]}], "]"}]}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.5657074443743877`*^9, 3.5657075065246696`*^9}},
 CellLabel->
  "In[432]:=",ExpressionUUID->"afb2a216-4a22-4cd1-9827-21713aac36a1"]
}, Closed]],

Cell[CellGroupData[{

Cell["pbar", "Subsubsection",
 InitializationCell->True,
 CellChangeTimes->{
  3.565707763222876*^9, {3.565707835128484*^9, 
   3.565707835900814*^9}},ExpressionUUID->"8d17f8e3-180e-45af-b49d-\
e2c2e9be0327"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"pbar", "::", "usage"}], "=", 
   "\"\<pbar[N\[VeryThinSpace]\[Mu],N\[VeryThinSpace]\!\(\*OverscriptBox[\(s\)\
, \(~\)]\)\!\(\*SuperscriptBox[\(\[Alpha]\), \(2\)]\),\!\(\*FractionBox[\(\
\[CapitalDelta]\), \(\[Alpha]\)]\)] gives the mean p\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.5657077148796587`*^9, 3.5657077820690603`*^9}, {
  3.5657078391296387`*^9, 3.5657078482166653`*^9}},
 CellLabel->
  "In[433]:=",ExpressionUUID->"490de6db-fb1e-4771-97eb-ae70d0562daf"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"pbar", "[", 
    RowBox[{"N\[Mu]_", ",", "Ns\[Alpha]\[Alpha]_", ",", "\[Delta]_"}], "]"}], 
   ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "p", "}"}], ",", 
     RowBox[{
      RowBox[{"NIntegrate", "[", 
       RowBox[{
        RowBox[{
         SuperscriptBox["p", 
          RowBox[{"2", "N\[Mu]"}]], 
         SuperscriptBox[
          RowBox[{"(", 
           RowBox[{"1", "-", "p"}], ")"}], 
          RowBox[{
           RowBox[{"2", "N\[Mu]"}], "-", "1"}]], 
         RowBox[{"Exp", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"-", "2"}], "Ns\[Alpha]\[Alpha]", "\[VeryThinSpace]", 
            "\[Delta]", " ", "p"}], "-", 
           RowBox[{"Ns\[Alpha]\[Alpha]", " ", "p", 
            RowBox[{"(", 
             RowBox[{"1", "-", "p"}], ")"}]}]}], "]"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"p", ",", "0", ",", "1"}], "}"}]}], "]"}], "/", 
      RowBox[{"Z", "[", 
       RowBox[{"N\[Mu]", ",", "Ns\[Alpha]\[Alpha]", ",", "\[Delta]"}], 
       "]"}]}]}], "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.5657074443743877`*^9, 3.5657075065246696`*^9}, {
  3.565707858174284*^9, 3.565707895886436*^9}},
 CellLabel->
  "In[434]:=",ExpressionUUID->"ddf5580f-976f-4fda-bb35-1f499d9dd8aa"]
}, Closed]],

Cell[CellGroupData[{

Cell["pqbar", "Subsubsection",
 InitializationCell->True,
 CellChangeTimes->{
  3.565707763222876*^9, {3.565707835128484*^9, 3.565707835900814*^9}, 
   3.565708094187784*^9},ExpressionUUID->"a36b77bb-7e97-4671-a092-\
bd6033fbee6d"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"pqbar", "::", "usage"}], "=", 
   "\"\<pqbar[N\[VeryThinSpace]\[Mu],N\[VeryThinSpace]\!\(\*OverscriptBox[\(s\
\), \(~\)]\)\!\(\*SuperscriptBox[\(\[Alpha]\), \(2\)]\),\!\(\*FractionBox[\(\
\[CapitalDelta]\), \(\[Alpha]\)]\)] gives the mean p\[VeryThinSpace]q\>\""}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.5657077148796587`*^9, 3.5657077820690603`*^9}, {
  3.5657078391296387`*^9, 3.5657078482166653`*^9}, {3.565708095592471*^9, 
  3.5657081001340723`*^9}},
 CellLabel->
  "In[435]:=",ExpressionUUID->"18750f96-a1f8-4ef3-b07e-52e6c8355752"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"pqbar", "[", 
    RowBox[{"N\[Mu]_", ",", "Ns\[Alpha]\[Alpha]_", ",", "\[Delta]_"}], "]"}], 
   ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "p", "}"}], ",", 
     RowBox[{
      RowBox[{"NIntegrate", "[", 
       RowBox[{
        RowBox[{
         SuperscriptBox[
          RowBox[{"(", 
           RowBox[{"p", 
            RowBox[{"(", 
             RowBox[{"1", "-", "p"}], ")"}]}], ")"}], 
          RowBox[{"2", "N\[Mu]"}]], 
         RowBox[{"Exp", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"-", "2"}], "Ns\[Alpha]\[Alpha]", "\[VeryThinSpace]", 
            "\[Delta]", " ", "p"}], "-", 
           RowBox[{"Ns\[Alpha]\[Alpha]", " ", "p", 
            RowBox[{"(", 
             RowBox[{"1", "-", "p"}], ")"}]}]}], "]"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"p", ",", "0", ",", "1"}], "}"}]}], "]"}], "/", 
      RowBox[{"Z", "[", 
       RowBox[{"N\[Mu]", ",", "Ns\[Alpha]\[Alpha]", ",", "\[Delta]"}], 
       "]"}]}]}], "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.5657074443743877`*^9, 3.5657075065246696`*^9}, {
  3.565707858174284*^9, 3.565707895886436*^9}, {3.565708106270344*^9, 
  3.565708117160441*^9}},
 CellLabel->
  "In[436]:=",ExpressionUUID->"1f143773-a9be-45c4-8eb9-cef548203f56"]
}, Closed]],

Cell[CellGroupData[{

Cell["Tfix", "Subsubsection",
 CellChangeTimes->{{3.584338192273617*^9, 3.584338193208272*^9}, {
  3.584338291256474*^9, 
  3.584338291902831*^9}},ExpressionUUID->"00c4c972-4e88-4ffd-85e1-\
9de70f3c4207"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Tfix", "::", "usage"}], "=", 
    "\"\<Tfix[x,4N\[VeryThinSpace]s] gives the expected time spent at x, \
starting with 1 copy, and conditioning on fixation\>\""}], ";"}], 
  " "}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.584338198506341*^9, 3.584338230306779*^9}, {
  3.584338266188859*^9, 3.58433829639083*^9}},
 CellLabel->
  "In[437]:=",ExpressionUUID->"9f132e29-3ed8-45de-8337-92f700aa96ef"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Tfix", "[", 
    RowBox[{"x_", ",", "\[Alpha]_"}], "]"}], ":=", " ", 
   RowBox[{
    FractionBox["2", 
     RowBox[{"\[Alpha]", "\[VeryThinSpace]", "x", 
      RowBox[{"(", 
       RowBox[{"1", "-", "x"}], ")"}]}]], 
    FractionBox[
     RowBox[{
      RowBox[{"(", 
       RowBox[{
        SuperscriptBox["\[ExponentialE]", 
         RowBox[{"\[Alpha]", "\[VeryThinSpace]", "x"}]], "-", "1"}], ")"}], 
      RowBox[{"(", 
       RowBox[{
        SuperscriptBox["\[ExponentialE]", 
         RowBox[{"\[Alpha]", "\[VeryThinSpace]", 
          RowBox[{"(", 
           RowBox[{"1", "-", "x"}], ")"}]}]], "-", "1"}], ")"}]}], 
     RowBox[{"(", 
      RowBox[{
       SuperscriptBox["\[ExponentialE]", "\[Alpha]"], "-", "1"}], ")"}]]}]}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.584338298164259*^9, 3.584338313265007*^9}},
 CellLabel->
  "In[438]:=",ExpressionUUID->"54d889d6-6ad8-408f-8d50-755caabcf269"]
}, Closed]],

Cell[CellGroupData[{

Cell["Tloss", "Subsubsection",
 InitializationCell->True,
 CellChangeTimes->{{3.5843383205840387`*^9, 
  3.584338321687454*^9}},ExpressionUUID->"5ebbf6b5-6f23-4e9d-93e5-\
2c8132f802b5"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Tloss", "::", "usage"}], "=", 
    "\"\<Tloss[x,4N\[VeryThinSpace]s] gives 2N times the expected time spent \
at x, starting with 1 copy, and conditioning on fixation\>\""}], ";"}], 
  " "}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.584338198506341*^9, 3.584338230306779*^9}, {
  3.584338266188859*^9, 3.58433829639083*^9}, {3.5843383320490303`*^9, 
  3.584338352826683*^9}},
 CellLabel->
  "In[439]:=",ExpressionUUID->"3e692f0e-8963-4204-855d-53bdf246c450"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Tloss", "[", 
    RowBox[{"x_", ",", "\[Alpha]_"}], "]"}], ":=", " ", 
   RowBox[{
    FractionBox[
     RowBox[{"2", 
      SuperscriptBox["\[ExponentialE]", 
       RowBox[{
        RowBox[{"-", "\[Alpha]"}], 
        RowBox[{"(", 
         RowBox[{"1", "-", "x"}], ")"}]}]]}], 
     RowBox[{"x", 
      RowBox[{"(", 
       RowBox[{"1", "-", "x"}], ")"}]}]], 
    FractionBox[
     SuperscriptBox[
      RowBox[{"(", 
       RowBox[{
        SuperscriptBox["\[ExponentialE]", 
         RowBox[{"\[Alpha]", "\[VeryThinSpace]", 
          RowBox[{"(", 
           RowBox[{"1", "-", "x"}], ")"}]}]], "-", "1"}], ")"}], "2"], 
     RowBox[{
      RowBox[{"(", 
       RowBox[{
        SuperscriptBox["\[ExponentialE]", 
         RowBox[{"\[Alpha]", "\[VeryThinSpace]"}]], "-", "1"}], ")"}], 
      RowBox[{"(", 
       RowBox[{"1", "-", 
        SuperscriptBox["\[ExponentialE]", 
         RowBox[{"-", "\[Alpha]"}]]}], ")"}]}]]}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.584338298164259*^9, 3.584338313265007*^9}, {
  3.584338516484974*^9, 3.584338530882475*^9}},
 CellLabel->
  "In[440]:=",ExpressionUUID->"51eeaaf8-1c2e-4885-a31a-a518cc6af819"]
}, Closed]],

Cell[CellGroupData[{

Cell["Tbar", "Subsubsection",
 InitializationCell->True,
 CellChangeTimes->{{3.5843383205840387`*^9, 3.584338321687454*^9}, {
  3.5843385400775948`*^9, 
  3.584338540900426*^9}},ExpressionUUID->"7bcb3426-4752-42c2-9f17-\
2b0955315841"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Tbar", "::", "usage"}], "=", 
    "\"\<Tbar[x,4N\[VeryThinSpace]s] gives 2N times the expected time spent \
at x, starting with 1 copy\>\""}], ";"}], " "}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.584338198506341*^9, 3.584338230306779*^9}, {
  3.584338266188859*^9, 3.58433829639083*^9}, {3.5843383320490303`*^9, 
  3.584338352826683*^9}, {3.584338545339019*^9, 3.584338556248955*^9}},
 CellLabel->
  "In[441]:=",ExpressionUUID->"e5f2405b-7877-47cf-9882-3c1efecbd887"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Tbar", "[", 
    RowBox[{"x_", ",", "\[Alpha]_"}], "]"}], ":=", " ", 
   RowBox[{
    FractionBox["2", 
     RowBox[{" \[VeryThinSpace]", 
      RowBox[{"x", 
       RowBox[{"(", 
        RowBox[{"1", "-", "x"}], ")"}]}]}]], 
    FractionBox[
     RowBox[{"(", 
      RowBox[{"1", "-", 
       SuperscriptBox["\[ExponentialE]", 
        RowBox[{
         RowBox[{"-", "\[Alpha]"}], "\[VeryThinSpace]", 
         RowBox[{"(", 
          RowBox[{"1", "-", "x"}], ")"}]}]]}], ")"}], 
     RowBox[{"(", 
      RowBox[{"1", "-", 
       SuperscriptBox["\[ExponentialE]", 
        RowBox[{"-", "\[Alpha]"}]]}], ")"}]]}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.584338298164259*^9, 3.584338313265007*^9}, {
  3.584338516484974*^9, 3.5843385757277946`*^9}},
 CellLabel->
  "In[442]:=",ExpressionUUID->"e3ba3460-ec13-4229-be82-ca55583b5a69"]
}, Closed]],

Cell[CellGroupData[{

Cell["psi", "Subsubsection",
 InitializationCell->True,
 CellChangeTimes->{{3.5657077118804083`*^9, 
  3.565707712224676*^9}},ExpressionUUID->"46d74f0f-ce53-467f-9c01-\
049289379c8d"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"psi", "::", "usage"}], "=", 
   "\"\<psi[p,N\[VeryThinSpace]\[Mu],N\[VeryThinSpace]\!\(\*OverscriptBox[\(s\
\), \(~\)]\)\!\(\*SuperscriptBox[\(\[Alpha]\), \(2\)]\),\!\(\*FractionBox[\(\
\[CapitalDelta]\), \(\[Alpha]\)]\)] gives the unnormalised distribution of \
allele frequency at a single locus under stabilising selection. psi[p,N\
\[VeryThinSpace]\[Mu],Ns] gives the same for directional selection s.  N is \
the haploid population size.\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.5657077148796587`*^9, 3.5657077567458143`*^9}, {
  3.5851050589817677`*^9, 3.5851051054523277`*^9}},
 CellLabel->
  "In[443]:=",ExpressionUUID->"51eb8ab0-770d-40e5-b0bc-742237253ee6"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"psi", "[", 
    RowBox[{"p_", ",", "N\[Mu]_", ",", " ", "Ns_"}], "]"}], ":=", 
   RowBox[{
    SuperscriptBox[
     RowBox[{"(", 
      RowBox[{"p", 
       RowBox[{"(", 
        RowBox[{"1", "-", "p"}], ")"}]}], ")"}], 
     RowBox[{
      RowBox[{"2", "N\[Mu]"}], "-", "1"}]], 
    RowBox[{"Exp", "[", 
     RowBox[{"2", "Ns", " ", "p"}], "]"}]}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.5657072929676723`*^9, 3.565707403846615*^9}, {
  3.58510511754774*^9, 3.585105133018682*^9}},
 CellLabel->
  "In[444]:=",ExpressionUUID->"7b0f912f-9477-4422-a937-47416b0c3387"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"psi", "[", 
    RowBox[{
    "p_", ",", "N\[Mu]_", ",", " ", "Ns\[Alpha]\[Alpha]_", ",", " ", 
     "\[Delta]_"}], "]"}], ":=", 
   RowBox[{
    SuperscriptBox[
     RowBox[{"(", 
      RowBox[{"p", 
       RowBox[{"(", 
        RowBox[{"1", "-", "p"}], ")"}]}], ")"}], 
     RowBox[{
      RowBox[{"2", "N\[Mu]"}], "-", "1"}]], 
    RowBox[{"Exp", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"-", "2"}], "Ns\[Alpha]\[Alpha]", "\[VeryThinSpace]", 
       "\[Delta]", " ", "p"}], "-", 
      RowBox[{"Ns\[Alpha]\[Alpha]", " ", "p", 
       RowBox[{"(", 
        RowBox[{"1", "-", "p"}], ")"}]}]}], "]"}]}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.5657072929676723`*^9, 3.565707403846615*^9}},
 CellLabel->
  "In[445]:=",ExpressionUUID->"2f9285af-aab0-419c-91c5-d841d83270c8"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"NIntegrate", "[", 
    RowBox[{
     RowBox[{"psi", "[", 
      RowBox[{"p", ",", "0.01", ",", "1"}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"p", ",", "0", ",", "0.01"}], "}"}]}], "]"}], ",", 
   RowBox[{"NIntegrate", "[", 
    RowBox[{
     RowBox[{"psi", "[", 
      RowBox[{"p", ",", "0.01", ",", "1"}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"p", ",", "0.99", ",", "1"}], "}"}]}], "]"}]}], "}"}]], "Input",\

 CellChangeTimes->{{3.585105217877268*^9, 
  3.5851052896404953`*^9}},ExpressionUUID->"1ed00e15-2b21-4418-bc86-\
8ef0d68c2857"],

Cell[BoxData[
 RowBox[{
  StyleBox[
   RowBox[{"NIntegrate", "::", "slwcon"}], "MessageName"], ":", 
  " ", "\<\"Numerical integration converging too slowly; suspect one of the \
following: singularity, value of the integration is 0, highly oscillatory \
integrand, or WorkingPrecision too small. \\!\\(\\*ButtonBox[\\\"\
\[RightSkeleton]\\\", ButtonStyle->\\\"Link\\\", ButtonFrame->None, \
ButtonData:>\\\"paclet:ref/message/NIntegrate/slwcon\\\", ButtonNote -> \
\\\"NIntegrate::slwcon\\\"]\\)\"\>"}]], "Message", "MSG",
 CellChangeTimes->{
  3.585105290152606*^9},ExpressionUUID->"f0eba94e-a0a4-4cc4-ad1f-\
f4bce6b540a8"],

Cell[BoxData[
 RowBox[{
  StyleBox[
   RowBox[{"NIntegrate", "::", "ncvb"}], "MessageName"], ":", 
  " ", "\<\"NIntegrate failed to converge to prescribed accuracy after \
\[NoBreak]\\!\\(9\\)\[NoBreak] recursive bisections in \[NoBreak]\\!\\(p\\)\
\[NoBreak] near \[NoBreak]\\!\\({p}\\)\[NoBreak] = \
\[NoBreak]\\!\\({0.\
9999999999999999999999999999998369273566250910121778715299113888`65.\
954589770191}\\)\[NoBreak]. NIntegrate obtained \
\[NoBreak]\\!\\(320.60630912809904`\\)\[NoBreak] and \
\[NoBreak]\\!\\(8.519614995971937`\\)\[NoBreak] for the integral and error \
estimates. \\!\\(\\*ButtonBox[\\\"\[RightSkeleton]\\\", ButtonStyle->\\\"Link\
\\\", ButtonFrame->None, ButtonData:>\\\"paclet:ref/message/NIntegrate/ncvb\\\
\", ButtonNote -> \\\"NIntegrate::ncvb\\\"]\\)\"\>"}]], "Message", "MSG",
 CellChangeTimes->{
  3.585105290197247*^9},ExpressionUUID->"f3d8c603-153e-4816-b7ff-\
99c947284d81"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"45.62741147134099`", ",", "320.60630912809904`"}], "}"}]], "Output",\

 CellChangeTimes->{{3.585105247923674*^9, 
  3.585105290199119*^9}},ExpressionUUID->"f754cb40-ac0f-4d45-aea1-\
a2fb5087c52d"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"\[Integral]", 
  RowBox[{
   RowBox[{"psi", "[", 
    RowBox[{"p", ",", "N\[Mu]", ",", "0"}], "]"}], 
   RowBox[{"\[DifferentialD]", "p"}]}]}]], "Input",
 CellChangeTimes->{{3.58510530687344*^9, 3.585105318074287*^9}, 
   3.585105350504318*^9},ExpressionUUID->"0a1550ee-789f-4c64-9979-\
9c46159efc2a"],

Cell[BoxData[
 FractionBox[
  RowBox[{
   SuperscriptBox[
    RowBox[{"(", 
     RowBox[{"1", "-", "p"}], ")"}], 
    RowBox[{
     RowBox[{"-", "2"}], " ", "N\[Mu]"}]], " ", 
   SuperscriptBox[
    RowBox[{"(", 
     RowBox[{
      RowBox[{"-", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"-", "1"}], "+", "p"}], ")"}]}], " ", "p"}], ")"}], 
    RowBox[{"2", " ", "N\[Mu]"}]], " ", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"2", " ", "N\[Mu]", " ", "p", " ", 
      RowBox[{"Hypergeometric2F1", "[", 
       RowBox[{
        RowBox[{"1", "-", 
         RowBox[{"2", " ", "N\[Mu]"}]}], ",", 
        RowBox[{"1", "+", 
         RowBox[{"2", " ", "N\[Mu]"}]}], ",", 
        RowBox[{"2", "+", 
         RowBox[{"2", " ", "N\[Mu]"}]}], ",", "p"}], "]"}]}], "+", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{"1", "+", 
        RowBox[{"2", " ", "N\[Mu]"}]}], ")"}], " ", 
      RowBox[{"Hypergeometric2F1", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"-", "2"}], " ", "N\[Mu]"}], ",", 
        RowBox[{"2", " ", "N\[Mu]"}], ",", 
        RowBox[{"1", "+", 
         RowBox[{"2", " ", "N\[Mu]"}]}], ",", "p"}], "]"}]}]}], ")"}]}], 
  RowBox[{"2", " ", "N\[Mu]", " ", 
   RowBox[{"(", 
    RowBox[{"1", "+", 
     RowBox[{"2", " ", "N\[Mu]"}]}], ")"}]}]]], "Output",
 CellChangeTimes->{3.5851053200201883`*^9, 
  3.5851053544864473`*^9},ExpressionUUID->"3df68017-8d36-4610-9ab2-\
5ff8354608a9"]
}, Open  ]]
}, Closed]]
}, Closed]],

Cell[CellGroupData[{

Cell["Dec 2016", "Subsection",
 CellChangeTimes->{{3.691497209727442*^9, 
  3.691497211239571*^9}},ExpressionUUID->"580df034-70a3-40d4-9e2e-\
5fcff82eccfa"],

Cell[CellGroupData[{

Cell["makeAllelicEffects", "Subsubsection",
 CellChangeTimes->{{3.692073291070944*^9, 
  3.6920733063681717`*^9}},ExpressionUUID->"abefc359-3832-4c45-8cea-\
2a8528164b49"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"makeAllelicEffects", "::", "usage"}], "=", 
   "\"\<makeAllelicEffects[n] draws n values from a reflected exponential, \
with mean effect 1/\!\(\*SqrtBox[\(n\)]\). makeAllelicEffects[j,n] draws j \
loci from the reflected exponential, with mean 1/\!\(\*SqrtBox[\(j\)]\), and \
the rest from zero.\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.692073309355741*^9, 3.692073427933584*^9}},
 CellLabel->
  "In[446]:=",ExpressionUUID->"61b74f60-0b41-44d5-892f-869cda3eb5c0"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"makeAllelicEffects", "[", "n_Integer", "]"}], ":=", 
   RowBox[{
    RowBox[{"RandomReal", "[", 
     RowBox[{
      RowBox[{"ExponentialDistribution", "[", 
       SqrtBox["n"], "]"}], ",", "n"}], "]"}], 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"2", 
       RowBox[{"RandomInteger", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"0", ",", "1"}], "}"}], ",", "n"}], "]"}]}], "-", "1"}], 
     ")"}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"makeAllelicEffects", "[", 
    RowBox[{"j_Integer", ",", "n_Integer"}], "]"}], ":=", 
   RowBox[{"RandomSample", "[", 
    RowBox[{"Join", "[", 
     RowBox[{
      RowBox[{"ConstantArray", "[", 
       RowBox[{"0", ",", 
        RowBox[{"n", "-", "j"}]}], "]"}], ",", 
      RowBox[{"makeAllelicEffects", "[", "j", "]"}]}], "]"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"makeAllelicEffects", "[", 
    RowBox[{"0", ",", "n_Integer"}], "]"}], ":=", 
   RowBox[{"ConstantArray", "[", 
    RowBox[{"0", ",", "n"}], "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.692073431384746*^9, 3.69207351219709*^9}, {
  3.6920736163865213`*^9, 3.692073620137837*^9}},
 CellLabel->
  "In[447]:=",ExpressionUUID->"8de5a225-5660-4263-a92a-f08ba11be7d6"]
}, Closed]],

Cell[CellGroupData[{

Cell["makeJList", "Subsubsection",
 CellChangeTimes->{
  3.692073048143668*^9},ExpressionUUID->"29dc85c5-f92a-4f33-9c09-\
f7f6b287bbef"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"makeJList", "::", "usage"}], "=", 
   "\"\<makeJList[2N,k] makes a list of k+1 integers, from 1 to N, which \
approximately follow a 1/p\[VeryThinSpace]q distribution, and are \
approximately uniform on a log(p/q) scale.\>\""}], " ", ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.692073049538952*^9, 3.6920731603998547`*^9}, 
   3.6921819439034653`*^9},
 CellLabel->
  "In[450]:=",ExpressionUUID->"48652528-709c-4471-a698-4633cb04cc42"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"makeJList", "[", 
    RowBox[{"n2_Integer", ",", "k_Integer"}], "]"}], ":=", 
   RowBox[{"Round", "[", 
    FractionBox["n2", 
     RowBox[{"1", "+", 
      SuperscriptBox[
       RowBox[{"(", 
        RowBox[{"n2", "-", "1"}], ")"}], 
       RowBox[{"Range", "[", 
        RowBox[{"1", ",", "0", ",", 
         RowBox[{
          RowBox[{"-", "1"}], "/", "k"}]}], "]"}]]}]], "]"}]}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.692072863158016*^9, 3.6920730431268063`*^9}},
 CellLabel->
  "In[451]:=",ExpressionUUID->"ca368961-5a7d-4ee5-a5b4-2ddb4e8f0fb6"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"makeJList", "[", 
  RowBox[{"100", ",", "4"}], "]"}]], "Input",
 CellChangeTimes->{{3.692182042420411*^9, 
  3.6921820444111633`*^9}},ExpressionUUID->"74ef48c6-51ad-4f88-b8a2-\
cbf7da2493fc"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"1", ",", "3", ",", "9", ",", "24", ",", "50"}], "}"}]], "Output",
 CellChangeTimes->{
  3.69218204507768*^9},ExpressionUUID->"6942e863-dd6e-4a21-8ee4-1b99f8c2d72d"]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["sel, P, invP", "Subsubsection",
 CellChangeTimes->{{3.691497156784326*^9, 3.691497157032262*^9}, {
  3.692849607244162*^9, 
  3.6928496093180237`*^9}},ExpressionUUID->"e8b894b4-8bdb-4abb-9b5b-\
ad217ee00b37"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"sel", "::", "usage"}], "=", 
   "\"\<sel[\[Theta]] gives the ratio between the selection coefficient and \
the allelic effect, for a rare allele, measured in phenotypic standard \
deviations. This is also the selection differential.\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.691497159179854*^9, 3.691497193655636*^9}, {
  3.691573636465784*^9, 3.691573641025004*^9}, {3.692017013384136*^9, 
  3.692017013775247*^9}, {3.692849593160595*^9, 3.692849596791663*^9}, {
  3.692850456627705*^9, 3.692850465337614*^9}},
 CellLabel->
  "In[452]:=",ExpressionUUID->"2c9db652-e761-45a9-92e9-521fca50469c"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"P", "[", "x_", "]"}], ":=", 
   RowBox[{
    FractionBox["1", "2"], " ", 
    RowBox[{"Erfc", "[", 
     FractionBox["x", 
      SqrtBox["2"]], "]"}]}]}], ";", 
  RowBox[{
   RowBox[{"invP", "[", "\[Theta]_", "]"}], ":=", 
   RowBox[{
    SqrtBox["2"], " ", 
    RowBox[{"InverseErfc", "[", 
     RowBox[{"2", " ", "\[Theta]"}], "]"}]}]}], ";", 
  RowBox[{
   RowBox[{"sel", "[", "\[Theta]_", "]"}], ":=", 
   RowBox[{
    FractionBox["1", 
     RowBox[{"\[Theta]", 
      SqrtBox[
       RowBox[{"2", "\[Pi]"}]]}]], 
    RowBox[{"Exp", "[", 
     RowBox[{"-", 
      FractionBox[
       SuperscriptBox[
        RowBox[{"invP", "[", "\[Theta]", "]"}], "2"], "2"]}], "]"}]}]}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.691496625641515*^9, 3.6914966702347507`*^9}, 
   3.6914971539729443`*^9},
 CellLabel->
  "In[453]:=",ExpressionUUID->"a487f5b3-1e71-4ca7-86b9-66127f5cb521"]
}, Closed]],

Cell[CellGroupData[{

Cell["relW", "Subsubsection",
 CellChangeTimes->{
  3.692849768022863*^9},ExpressionUUID->"da1ed2ae-00a2-4f96-8c65-\
4d07faecf62b"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"relW", "::", "usage"}], "=", 
   "\"\<relW[\[Alpha],p,\[Theta]] gives the relative probability of being \
selected, for an allele at frequency p and with effect \[Alpha], measured in \
phenotypic standard deviations. For small \[Alpha], this tends to 1+\[Alpha]\
\[VeryThinSpace]q\[VeryThinSpace]sel[\[Theta]]\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.691497159179854*^9, 3.691497193655636*^9}, {
  3.691573636465784*^9, 3.691573641025004*^9}, {3.692017013384136*^9, 
  3.692017013775247*^9}, {3.692849593160595*^9, 3.692849596791663*^9}, {
  3.692849694441935*^9, 3.692849758952669*^9}},
 CellLabel->
  "In[454]:=",ExpressionUUID->"89b6d497-3ee8-41df-833f-98135018aff8"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"relW", "[", 
    RowBox[{"\[Alpha]_", ",", "p_", ",", "\[Theta]_"}], "]"}], ":=", 
   RowBox[{
    FractionBox["1", 
     RowBox[{"2", "\[Theta]"}]], 
    RowBox[{"Erfc", "[", 
     FractionBox[
      RowBox[{
       RowBox[{"invP", "[", "\[Theta]", "]"}], "-", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"1", "-", "p"}], ")"}], " ", "\[Alpha]"}]}], 
      RowBox[{
       SqrtBox["2"], " ", 
       SqrtBox[
        RowBox[{"1", "-", 
         RowBox[{
          SuperscriptBox["\[Alpha]", "2"], "p", 
          RowBox[{"(", 
           RowBox[{"1", "-", "p"}], ")"}]}]}]]}]], "]"}]}]}], ";"}]], "Input",\

 InitializationCell->True,
 CellChangeTimes->{{3.692848308144805*^9, 3.692848378520619*^9}, 
   3.692849551787016*^9, {3.692849624016365*^9, 3.6928496365984364`*^9}},
 CellLabel->
  "In[455]:=",ExpressionUUID->"2aa85267-1c8c-46e6-8575-7142073f9538"]
}, Closed]],

Cell[CellGroupData[{

Cell["plotGenomes", "Subsubsection",
 CellChangeTimes->{{3.6934876569955063`*^9, 
  3.693487662658186*^9}},ExpressionUUID->"3dba8a32-6422-4158-aa96-\
f2aad6c049b6"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"plotGenomes", "::", "usage"}], "=", 
   "\"\<plotGenomes[\[ScriptCapitalP],t,\[Tau]] plots the genomes in \
generation t=0\[Ellipsis]T of simulation \[ScriptCapitalP]. \[Tau] specifies \
the thickness of each line. Ancestral genomes are distinguished by \
colour\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.693487666786175*^9, 3.693487773196877*^9}, {
  3.693487827468951*^9, 3.693487829059957*^9}},
 CellLabel->
  "In[456]:=",ExpressionUUID->"1f970488-432a-42cd-b9b1-da7d31b3313b"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"plotGenomes", "[", 
    RowBox[{
    "\[ScriptCapitalP]_", ",", "t_Integer", ",", "\[Tau]_", ",", 
     "opts___Rule"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"g", ",", "cf", ",", 
       RowBox[{"n0", "=", 
        RowBox[{"2", " ", 
         RowBox[{"Length", "[", 
          RowBox[{
           RowBox[{"junctions", "[", "\[ScriptCapitalP]", "]"}], 
           "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], "]"}]}]}], 
       ",", 
       RowBox[{"n", "=", 
        RowBox[{"2", " ", 
         RowBox[{"Length", "[", 
          RowBox[{
           RowBox[{"junctions", "[", "\[ScriptCapitalP]", "]"}], 
           "\[LeftDoubleBracket]", 
           RowBox[{"t", "+", "1"}], "\[RightDoubleBracket]"}], "]"}]}]}], ",",
        "k", ",", "jj"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"cf", "[", "j_Integer", "]"}], ":=", 
       RowBox[{
        RowBox[{"ColorData", "[", "\"\<DarkRainbow\>\"", "]"}], "[", 
        FractionBox["j", "n0"], "]"}]}], ";", "\n", 
      RowBox[{"Show", "[", 
       RowBox[{
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"jj", "=", 
            RowBox[{"blocks", "[", 
             RowBox[{
              RowBox[{"Flatten", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"junctions", "[", "\[ScriptCapitalP]", "]"}], 
                 "\[LeftDoubleBracket]", 
                 RowBox[{"t", "+", "1"}], "\[RightDoubleBracket]"}], ",", 
                "1"}], "]"}], "\[LeftDoubleBracket]", "k", 
              "\[RightDoubleBracket]"}], "]"}]}], ";", "\[IndentingNewLine]", 
           
           RowBox[{"Graphics", "[", 
            RowBox[{"Prepend", "[", 
             RowBox[{
              RowBox[{"Flatten", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"cf", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"hapJ", "[", "\[ScriptCapitalP]", "]"}], "[", 
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "1", 
                    "\[RightDoubleBracket]"}], "]"}], "\[LeftDoubleBracket]", 
                    "2", "\[RightDoubleBracket]"}], "]"}], ",", 
                    RowBox[{"Line", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"locJ", "[", "\[ScriptCapitalP]", "]"}], "[", 
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "1", 
                    "\[RightDoubleBracket]"}], "]"}], ",", 
                    FractionBox["k", "n"]}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"locJ", "[", "\[ScriptCapitalP]", "]"}], "[", 
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "2", 
                    "\[RightDoubleBracket]"}], "]"}], ",", 
                    FractionBox["k", "n"]}], "}"}]}], "}"}], "]"}]}], "}"}], 
                  "&"}], "/@", "jj"}], ",", "1"}], "]"}], ",", 
              RowBox[{"Thickness", "[", "\[Tau]", "]"}]}], "]"}], "]"}]}], 
          ",", 
          RowBox[{"{", 
           RowBox[{"k", ",", "n"}], "}"}]}], "]"}], ",", "opts"}], "]"}]}]}], 
    "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.693487673278838*^9, 3.693487673280814*^9}, {
  3.6934877769276037`*^9, 3.693487971536981*^9}, {3.6934880560760813`*^9, 
  3.693488056219282*^9}, {3.693488702317893*^9, 3.69348872453892*^9}, {
  3.6934910643004436`*^9, 3.693491071436041*^9}},
 CellLabel->
  "In[457]:=",ExpressionUUID->"db63978c-5bcb-4c8c-aa9d-d777d40875a1"]
}, Closed]],

Cell[CellGroupData[{

Cell["blocks", "Subsubsection",
 CellChangeTimes->{{3.69349094256548*^9, 
  3.6934909515730457`*^9}},ExpressionUUID->"486f28ed-9da8-425f-84bc-\
d21753afaa44"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"blocks", "::", "usage"}], "=", 
   "\"\<blocks[{\!\(\*SubscriptBox[\(j\), \
\(1\)]\),\[Ellipsis],\!\(\*SubscriptBox[\(j\), \(n\)]\)}] lists the blocks \
that define a haplotype.  Assumes that the list of junctions is ordered by \
location and bounded by {0,R}. \>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6934909475849524`*^9, 3.693491004779965*^9}, {
  3.693491107634954*^9, 3.693491122287763*^9}},
 CellLabel->
  "In[458]:=",ExpressionUUID->"e9a67d71-55d4-407f-bf2b-87596286d53e"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"blocks", "[", 
    RowBox[{"j", ":", 
     RowBox[{"{", 
      RowBox[{"___", "?", "NumberQ"}], "}"}]}], "]"}], ":=", 
   RowBox[{"Transpose", "[", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"Drop", "[", 
       RowBox[{"j", ",", 
        RowBox[{"-", "1"}]}], "]"}], ",", 
      RowBox[{"Drop", "[", 
       RowBox[{"j", ",", "1"}], "]"}]}], "}"}], "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6934910101011868`*^9, 3.6934910283878098`*^9}, {
  3.732003538024802*^9, 3.73200354046091*^9}},
 CellLabel->
  "In[459]:=",ExpressionUUID->"7e74ee68-d254-4562-9b78-b0a04a86cc4d"]
}, Closed]],

Cell[CellGroupData[{

Cell["locPos", "Subsubsection",
 CellChangeTimes->{
  3.6934912079546137`*^9},ExpressionUUID->"419630e7-3d25-4804-9016-\
886dd5b42514"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"locPos", "::", "usage"}], "=", 
    "\"\<locPos[\!\(\*SubscriptBox[\(n\), \(loci\)]\),R][{\!\(\*SubscriptBox[\
\(x\), \(1\)]\),\!\(\*SubscriptBox[\(x\), \(2\)]\)}] gives the positions of \
the loci within the interval {\!\(\*SubscriptBox[\(x\), \
\(1\)]\),\!\(\*SubscriptBox[\(x\), \(2\)]\)} (including the ends).  \
{1\!\(\*SubscriptBox[\(\[Ellipsis]n\), \(loci\)]\)} corresponds to \
{0,R}.\>\""}], ";"}], "  "}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.693491170086587*^9, 3.693491290178932*^9}, {
  3.694140160886612*^9, 3.694140168650872*^9}},
 CellLabel->
  "In[460]:=",ExpressionUUID->"72c1004e-6836-4c49-ba54-c0f40de11010"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"locPos", "[", 
     RowBox[{"n_Integer", ",", "R_"}], "]"}], "[", 
    RowBox[{"{", 
     RowBox[{"x0_", ",", "x1_"}], "}"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "jj", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"jj", "=", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"Ceiling", "[", 
          RowBox[{"1", "+", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"n", "-", "1"}], ")"}], 
            RowBox[{"x0", "/", "R"}]}]}], "]"}], ",", 
         RowBox[{"Floor", "[", 
          RowBox[{"1", "+", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"n", "-", "1"}], ")"}], 
            RowBox[{"x1", "/", "R"}]}]}], "]"}]}], "}"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"jj", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}],
          ">", 
         RowBox[{
         "jj", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}], ",", 
        
        RowBox[{"{", "}"}], ",", "jj"}], "]"}]}]}], "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6934912955719957`*^9, 3.693491429972104*^9}, {
  3.6934915169205923`*^9, 3.693491561123646*^9}},
 CellLabel->
  "In[461]:=",ExpressionUUID->"56f1fd47-71c7-4bc2-b09f-fbde641a6e49"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"locPos", "[", 
   RowBox[{"11", ",", "10"}], "]"}], "/@", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"0", ",", "1.3"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"1.3", ",", "7.2"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"7.2", ",", "10"}], "}"}]}], "}"}]}]], "Input",
 CellChangeTimes->{{3.694139794517541*^9, 3.6941398351977873`*^9}, {
  3.694139903916491*^9, 3.694139906417859*^9}, {3.694139984528936*^9, 
  3.694140071500196*^9}, {3.694140128853504*^9, 
  3.694140129765253*^9}},ExpressionUUID->"367d2f06-85f9-4ed2-96dc-\
df0ea7d24bd7"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"1", ",", "2"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"3", ",", "8"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"9", ",", "11"}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{
  3.694139835990076*^9, 3.694139923676798*^9, {3.6941399855706663`*^9, 
   3.694140004595887*^9}, {3.6941400389701443`*^9, 3.6941400719529533`*^9}, 
   3.694140130729653*^9},ExpressionUUID->"f560c720-2b33-46ba-b10f-\
444b1d7bed20"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"{", 
   RowBox[{
    RowBox[{"Range", "[", 
     RowBox[{"0", ",", "10"}], "]"}], ",", 
    RowBox[{"Range", "[", 
     RowBox[{"1", ",", "11"}], "]"}]}], "}"}], "//", "TableForm"}]], "Input",
 CellChangeTimes->{{3.69413985014188*^9, 3.694139852261714*^9}, {
  3.694139929273241*^9, 3.69413996351947*^9}, {3.694140087485561*^9, 
  3.69414008998801*^9}},ExpressionUUID->"68024995-41e3-4ab4-a69f-\
f94c888534c2"],

Cell[BoxData[
 TagBox[GridBox[{
    {"0", "1", "2", "3", "4", "5", "6", "7", "8", "9", "10"},
    {"1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11"}
   },
   GridBoxAlignment->{
    "Columns" -> {{Left}}, "ColumnsIndexed" -> {}, "Rows" -> {{Baseline}}, 
     "RowsIndexed" -> {}},
   GridBoxSpacings->{"Columns" -> {
       Offset[0.27999999999999997`], {
        Offset[2.0999999999999996`]}, 
       Offset[0.27999999999999997`]}, "ColumnsIndexed" -> {}, "Rows" -> {
       Offset[0.2], {
        Offset[0.4]}, 
       Offset[0.2]}, "RowsIndexed" -> {}}],
  Function[BoxForm`e$, 
   TableForm[BoxForm`e$]]]], "Output",
 CellChangeTimes->{
  3.694139852515656*^9, {3.6941399319023037`*^9, 3.694139964048513*^9}, 
   3.6941400905423527`*^9},ExpressionUUID->"6ce2d00d-6ad0-43be-8569-\
aa607aae0928"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["dropDip", "Subsubsection",
 CellChangeTimes->{{3.69695068290807*^9, 
  3.696950684847372*^9}},ExpressionUUID->"89e7d65e-4cc1-4a92-830a-\
77f7b4e022d6"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"dropDip", "::", "usage"}], "=", 
   "\"\<dropDip[{{{1,2},\[Ellipsis]},\[Ellipsis]},{{0,1,0,1,\[Ellipsis]},\
\[Ellipsis]}] draws a random set of diploid offspring, according to the \
pedigree matrix {{0,1,0,1,\[Ellipsis]},\[Ellipsis]}, assuming no \
linkage.\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6969512744090843`*^9, 3.696951357940242*^9}, {
  3.696952196901272*^9, 3.6969522031593933`*^9}},
 CellLabel->
  "In[462]:=",ExpressionUUID->"07c86814-e509-495a-bc12-09bf5b48295b"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"dropDip", "[", 
    RowBox[{"pop_List", ",", "ped_SparseArray"}], "]"}], ":=", 
   RowBox[{"dropDip", "[", 
    RowBox[{"pop", ",", 
     RowBox[{"Normal", "[", "ped", "]"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"dropDip", "[", 
    RowBox[{"pop_List", ",", "ped_List"}], "]"}], ":=", 
   RowBox[{
    RowBox[{
     RowBox[{"Transpose", "[", 
      RowBox[{"Map", "[", 
       RowBox[{"RandomChoice", ",", 
        RowBox[{"pop", "\[LeftDoubleBracket]", 
         RowBox[{"Flatten", "[", 
          RowBox[{
           RowBox[{"Position", "[", 
            RowBox[{"#", ",", "1"}], "]"}], ",", "1"}], "]"}], 
         "\[RightDoubleBracket]"}], ",", 
        RowBox[{"{", "2", "}"}]}], "]"}], "]"}], "&"}], "/@", "ped"}]}], 
  ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6969513611779222`*^9, 3.696951447734809*^9}},
 CellLabel->
  "In[463]:=",ExpressionUUID->"0332e0ee-a087-417c-aea8-282974575b31"]
}, Closed]],

Cell[CellGroupData[{

Cell["loci, lociJ, \[Alpha]\[Alpha]", "Subsubsection",
 CellChangeTimes->{{3.699667829168147*^9, 3.6996678326411333`*^9}, {
  3.699667947081582*^9, 
  3.6996679490344133`*^9}},ExpressionUUID->"b69e56ca-df12-4156-a23e-\
2d1439881b4f"],

Cell[TextData[StyleBox["These are low-level functions, useful for picking out \
certain sets of loci. Do not confuse with locJ, locPos!",
 FontSlant->"Italic"]], "Text",
 CellChangeTimes->{{3.699667837959837*^9, 
  3.699667865288328*^9}},ExpressionUUID->"a90c73f3-faf7-44a3-b992-\
9f64d4f27c72"],

Cell[TextData[StyleBox["I had originally used specific defaults \[Alpha]\
\[Alpha], jl - but it is better to avoid these.",
 FontSlant->"Italic"]], "Text",
 CellChangeTimes->{{3.699669590347889*^9, 
  3.6996696151724463`*^9}},ExpressionUUID->"c2b7ae63-77fe-4bce-9681-\
5a18edada4f9"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"\[Alpha]\[Alpha]", "::", "usage"}], "=", 
   "\"\<\[Alpha]\[Alpha][j] is a default list of allelic effects, indexed by \
the # of selected loci in the list\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.699667954275806*^9, 3.699668026389921*^9}},
 CellLabel->
  "In[465]:=",ExpressionUUID->"44592c3b-e6ac-4c55-8876-a6c915da279c"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"loci", "::", "usage"}], "=", 
   "\"\<loci[{\!\(\*SubscriptBox[\(x\), \(0\)]\),\!\(\*SubscriptBox[\(x\), \
\(1\)]\)},\[Alpha]] lists loci i within the range \!\(\*SubscriptBox[\(x\), \
\(0\)]\)<|\!\(\*SubscriptBox[\(\[Alpha]\), \
\(i\)]\)|\[LessEqual]\!\(\*SubscriptBox[\(x\), \(1\)]\); loci[0,\[Alpha]] \
finds loci with zero effect. loci[{\!\(\*SubscriptBox[\(x\), \
\(0\)]\),\!\(\*SubscriptBox[\(x\), \(1\)]\)},j] uses the default \[Alpha]\
\[Alpha][j]\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.699667870677882*^9, 3.699667931724275*^9}, {
  3.699668030647053*^9, 3.699668090253989*^9}, {3.699669270132738*^9, 
  3.699669301890953*^9}},
 CellLabel->
  "In[466]:=",ExpressionUUID->"2d4c8e80-f2e3-4d57-bb8f-d6906f4ceef0"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"loci", "[", 
    RowBox[{"0", ",", "\[Alpha]_List"}], "]"}], ":=", 
   RowBox[{
    RowBox[{"loci", "[", 
     RowBox[{"0", ",", "\[Alpha]"}], "]"}], "=", 
    RowBox[{"Pick", "[", 
     RowBox[{
      RowBox[{"Range", "[", 
       RowBox[{"Length", "[", "\[Alpha]", "]"}], "]"}], ",", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"#", "\[Equal]", "0"}], ")"}], "&"}], "/@", 
       RowBox[{"Abs", "[", "\[Alpha]", "]"}]}]}], "]"}]}]}], ";", 
  RowBox[{
   RowBox[{"loci", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"x0_", ",", "x1_"}], "}"}], ",", "\[Alpha]_List"}], "]"}], ":=", 
   RowBox[{
    RowBox[{"loci", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"x0", ",", "x1"}], "}"}], ",", "\[Alpha]"}], "]"}], "=", 
    RowBox[{"Pick", "[", 
     RowBox[{
      RowBox[{"Range", "[", 
       RowBox[{"Length", "[", "\[Alpha]", "]"}], "]"}], ",", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"x0", "<", "#", "\[LessEqual]", "x1"}], ")"}], "&"}], "/@", 
       RowBox[{"Abs", "[", "\[Alpha]", "]"}]}]}], "]"}]}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.692073088518551*^9, 3.692073108078149*^9}, {
   3.692073984515493*^9, 3.692074084058135*^9}, {3.692074120029257*^9, 
   3.692074185051694*^9}, 3.692074577351245*^9, {3.692077325877483*^9, 
   3.6920773334278307`*^9}, {3.692164032363092*^9, 3.6921640463398247`*^9}, 
   3.699667824562768*^9, {3.699669324803645*^9, 3.699669371921194*^9}},
 CellLabel->
  "In[467]:=",ExpressionUUID->"c0c567f0-5225-4bbc-bd0b-a98bbf66a63d"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"loci", "[", 
    RowBox[{"0", ",", "j_Integer"}], "]"}], ":=", 
   RowBox[{
    RowBox[{"loci", "[", 
     RowBox[{"0", ",", "j"}], "]"}], "=", 
    RowBox[{"loci", "[", 
     RowBox[{"0", ",", 
      RowBox[{"\[Alpha]\[Alpha]", "[", "j", "]"}]}], "]"}]}]}], ";", 
  RowBox[{
   RowBox[{"loci", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"x0_", ",", "x1_"}], "}"}], ",", "j_Integer"}], "]"}], ":=", 
   RowBox[{
    RowBox[{"loci", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"x0", ",", "x1"}], "}"}], ",", "j"}], "]"}], "=", 
    RowBox[{"loci", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"x0", ",", "x1"}], "}"}], ",", 
      RowBox[{"\[Alpha]\[Alpha]", "[", "j", "]"}]}], "]"}]}]}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.692073088518551*^9, 3.692073108078149*^9}, {
   3.692073984515493*^9, 3.692074084058135*^9}, {3.692074120029257*^9, 
   3.692074185051694*^9}, 3.692074577351245*^9, {3.692077325877483*^9, 
   3.6920773334278307`*^9}, {3.692164032363092*^9, 3.6921640463398247`*^9}, 
   3.699667824562768*^9, {3.699669376538311*^9, 3.6996694246673717`*^9}},
 CellLabel->
  "In[468]:=",ExpressionUUID->"41e3301a-ac07-4f40-b84d-3a84fa93ff6d"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"jl", "::", "usage"}], "=", 
   "\"\<jl is the default list of starting # for the initial \
population\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.699669561989417*^9, 3.6996695841170673`*^9}},
 CellLabel->
  "In[469]:=",ExpressionUUID->"2880efef-a798-4b60-9d20-b7815d0b76f8"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"lociJ", "::", "usage"}], "=", 
   "\"\<lociJ[j,{\!\(\*SubscriptBox[\(j\), \(1\)]\),\[Ellipsis]}] picks out \
loci {i,\[Ellipsis]} corresponding to \!\(\*SubscriptBox[\(j\), \
\(i\)]\)=j\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6996694384536324`*^9, 3.699669515716196*^9}},
 CellLabel->
  "In[470]:=",ExpressionUUID->"4c79a275-91ea-4123-b82e-1edd4bfbcd46"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"lociJ", "[", "j_", "]"}], ":=", 
   RowBox[{
    RowBox[{"lociJ", "[", "j", "]"}], "=", 
    RowBox[{"lociJ", "[", 
     RowBox[{"j", ",", "jl"}], "]"}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"lociJ", "[", 
    RowBox[{"j_Integer", ",", 
     RowBox[{"jl", ":", 
      RowBox[{"{", "___Integer", "}"}]}]}], "]"}], ":=", 
   RowBox[{
    RowBox[{"lociJ", "[", 
     RowBox[{"j", ",", "jl"}], "]"}], "=", 
    RowBox[{"Flatten", "[", 
     RowBox[{"Position", "[", 
      RowBox[{"jl", ",", "j"}], "]"}], "]"}]}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.692075506004717*^9, 3.692075531588376*^9}, {
  3.6920773730977*^9, 3.692077417038228*^9}, {3.6996694813303347`*^9, 
  3.699669485595111*^9}, {3.6996695200690327`*^9, 3.699669548766679*^9}, {
  3.699669629652073*^9, 3.699669643540037*^9}},
 CellLabel->
  "In[471]:=",ExpressionUUID->"a41ed415-3e18-4272-b239-741f53056a16"]
}, Open  ]],

Cell[CellGroupData[{

Cell["nHet", "Subsubsection",
 CellChangeTimes->{
  3.699676045440439*^9},ExpressionUUID->"0c7c9ecd-39ff-4a1f-8955-\
f06b32449f19"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"nHet", "::", "usage"}], "=", 
   "\"\<nHet[{{0,1,\[Ellipsis]},{1,1,\[Ellipsis]}}] gives the number of \
heterozygous loci\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.699672206513647*^9, 3.699672263856367*^9}, {
  3.699675967125762*^9, 3.699675974284465*^9}},
 CellLabel->
  "In[473]:=",ExpressionUUID->"0d902312-eaab-4e3d-bb05-9cedff5eabba"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"nHet", "[", 
    RowBox[{"g", ":", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"0", "|", "1"}], ")"}], "..."}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"0", "|", "1"}], ")"}], "..."}], "}"}]}], "}"}]}], "]"}], ":=", 
   RowBox[{"Count", "[", 
    RowBox[{
     RowBox[{"Transpose", "[", "g", "]"}], ",", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"0", ",", "1"}], "}"}], "|", 
      RowBox[{"{", 
       RowBox[{"1", ",", "0"}], "}"}]}]}], "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.699675980643021*^9, 3.6996760343535233`*^9}, 
   3.71040405293596*^9},
 CellLabel->
  "In[474]:=",ExpressionUUID->"1b1d8967-6600-4593-9bb6-dc2fc679a2b5"]
}, Closed]],

Cell[CellGroupData[{

Cell["neutPr", "Subsubsection",
 CellChangeTimes->{{3.700022828330923*^9, 
  3.700022830817541*^9}},ExpressionUUID->"b25dbb1e-ae50-4ceb-a907-\
bda5dfbdb91d"],

Cell["\<\
I altered this so that (like neutPr0) this gives the full distribution from 0\
\[Ellipsis]N copies. I also removed the PadRight step, since this seems \
unnecessary.\
\>", "Text",
 CellChangeTimes->{{3.700899027184205*^9, 3.700899042927575*^9}, {
  3.700899882090119*^9, 
  3.7008999286501207`*^9}},ExpressionUUID->"ed873c50-dcb4-453e-bd64-\
bed639f04862"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"neutPr", "::", "usage"}], "=", 
   "\"\<neutPr[{\!\(\*SubscriptBox[\(n\), \
\(1\)]\),\[Ellipsis],\!\(\*SubscriptBox[\(n\), \(k\)]\)}] gives the \
probability of seeing i=0\[Ellipsis]N copies, given that {\!\(\*SubscriptBox[\
\(n\), \(1\)]\),\[Ellipsis],\!\(\*SubscriptBox[\(n\), \(k\)]\)} ancestral \
genomes survive,and that their initial allelic state was sampled from \
\!\(\*SuperscriptBox[\(p\), \(-1\)]\)\!\(\*SuperscriptBox[\(q\), \(-1\)]\). \
neutPr[{\!\(\*SubscriptBox[\(n\), \(1\)]\),\[Ellipsis]},a] gives the full \
distribution for an initial distribution \!\(\*SuperscriptBox[\(p\), \(a - \
1\)]\)\!\(\*SuperscriptBox[\(q\), \(a - 1\)]\). These extend to multiple \
demes, by supplying the configurations on ancestry in j demes, \
{{\!\(\*SubsuperscriptBox[\(n\), \(1\), \
\(1\)]\),\[Ellipsis],\!\(\*SubsuperscriptBox[\(n\), \(k\), \(1\)]\)},\
\[Ellipsis],{\!\(\*SubsuperscriptBox[\(n\), \(1\), \(j\)]\),\[Ellipsis]}} \
neutPr[i,k] gives the probability that weights any of the \
\!\(\*SuperscriptBox[\(2\), \(k\)]\)-2 subsets of {\!\(\*SubscriptBox[\(n\), \
\(1\)]\),\[Ellipsis],\!\(\*SubscriptBox[\(n\), \(k - 1\)]\)}, in the limit a\
\[Rule]0. \>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.7000228411851387`*^9, 3.700023129258473*^9}, {
   3.7000541026353493`*^9, 3.70005416850426*^9}, 3.700054199741323*^9, {
   3.700898307268762*^9, 3.700898353800665*^9}, {3.7008989359472513`*^9, 
   3.700898941060692*^9}},
 CellLabel->
  "In[475]:=",ExpressionUUID->"2c1621ad-569a-420a-a13a-365b48dc1740"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"neutPr", "::", "badN"}], "=", 
   "\"\<The ancestry counts for the descendant populations `1` do not have \
the same length\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.700878245833498*^9, 3.70087829432654*^9}, 
   3.70089840732629*^9},
 CellLabel->
  "In[476]:=",ExpressionUUID->"d97961ca-e380-433e-946a-414f659518a9"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"neutPr", "[", 
    RowBox[{"i_Integer", ",", "k_Integer"}], "]"}], ":=", 
   RowBox[{"1", "/", 
    RowBox[{"(", 
     RowBox[{"2", "  ", 
      RowBox[{"HarmonicNumber", "[", 
       RowBox[{"k", "-", "1"}], "]"}], 
      RowBox[{"(", 
       RowBox[{"k", "-", "1"}], ")"}], 
      RowBox[{"Binomial", "[", 
       RowBox[{
        RowBox[{"k", "-", "2"}], ",", 
        RowBox[{"i", "-", "1"}]}], "]"}]}], ")"}]}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"neutPr", "[", 
    RowBox[{
     RowBox[{"n", ":", 
      RowBox[{"{", "__Integer", "}"}]}], ",", "a_"}], "]"}], ":=", 
   RowBox[{"neutPr", "[", 
    RowBox[{
     RowBox[{"{", "n", "}"}], ",", "a"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"neutPr", "[", 
    RowBox[{
     RowBox[{"n", ":", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", "__Integer", "}"}], "..."}], "}"}]}], ",", "a_"}], "]"}],
    ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"k", "=", 
        RowBox[{"Length", "[", 
         RowBox[{"n", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
         "]"}]}], ",", 
       RowBox[{"d", "=", 
        RowBox[{"Length", "[", "n", "]"}]}], ",", "z", ",", "zz"}], "}"}], 
     ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Min", "[", 
          RowBox[{"Length", "/@", "n"}], "]"}], "\[NotEqual]", 
         RowBox[{"Max", "[", 
          RowBox[{"Length", "/@", "n"}], "]"}]}], ",", 
        RowBox[{"Message", "[", 
         RowBox[{
          RowBox[{"neutPr", "::", "badN"}], ",", "n"}], "]"}]}], "]"}], ";", 
      RowBox[{"zz", "=", 
       RowBox[{"Array", "[", 
        RowBox[{"z", ",", "d"}], "]"}]}], ";", 
      RowBox[{"CoefficientList", "[", 
       RowBox[{
        RowBox[{"Total", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{"Pochhammer", "[", 
                 RowBox[{"a", ",", 
                  RowBox[{"k", "-", 
                   RowBox[{"Length", "[", "#", "]"}]}]}], "]"}], 
                RowBox[{"Pochhammer", "[", 
                 RowBox[{"a", ",", 
                  RowBox[{"Length", "[", "#", "]"}]}], "]"}]}], ")"}], "/", 
              RowBox[{"Pochhammer", "[", 
               RowBox[{
                RowBox[{"2", "a"}], ",", "k"}], "]"}]}], ")"}], 
            RowBox[{"(", 
             RowBox[{"Times", "@@", 
              SuperscriptBox["zz", 
               RowBox[{"Total", "/@", 
                RowBox[{"n", "\[LeftDoubleBracket]", 
                 RowBox[{"All", ",", "#"}], "\[RightDoubleBracket]"}]}]]}], 
             ")"}]}], "&"}], "/@", 
          RowBox[{"Subsets", "[", 
           RowBox[{"Range", "[", "k", "]"}], "]"}]}], "]"}], ",", "zz", ",", 
        RowBox[{"1", "+", 
         RowBox[{"Total", "/@", "n"}]}]}], "]"}]}]}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"neutPr", "[", 
    RowBox[{"n", ":", 
     RowBox[{"{", "__Integer", "}"}]}], "]"}], ":=", 
   RowBox[{"neutPr", "[", 
    RowBox[{"{", "n", "}"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"neutPr", "[", 
    RowBox[{"n", ":", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", "__Integer", "}"}], "..."}], "}"}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"k", "=", 
        RowBox[{"Length", "[", 
         RowBox[{"n", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
         "]"}]}], ",", 
       RowBox[{"d", "=", 
        RowBox[{"Length", "[", "n", "]"}]}], ",", "z", ",", "zz"}], "}"}], 
     ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Min", "[", 
          RowBox[{"Length", "/@", "n"}], "]"}], "\[NotEqual]", 
         RowBox[{"Max", "[", 
          RowBox[{"Length", "/@", "n"}], "]"}]}], ",", 
        RowBox[{"Message", "[", 
         RowBox[{
          RowBox[{"neutPr", "::", "badN"}], ",", "n"}], "]"}]}], "]"}], ";", 
      RowBox[{"zz", "=", 
       RowBox[{"Array", "[", 
        RowBox[{"z", ",", "d"}], "]"}]}], ";", 
      RowBox[{"CoefficientList", "[", 
       RowBox[{
        RowBox[{"Total", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"neutPr", "[", 
             RowBox[{
              RowBox[{"Length", "[", "#", "]"}], ",", "k"}], "]"}], 
            RowBox[{"(", 
             RowBox[{"Times", "@@", 
              SuperscriptBox["zz", 
               RowBox[{"Total", "/@", 
                RowBox[{"n", "\[LeftDoubleBracket]", 
                 RowBox[{"All", ",", "#"}], "\[RightDoubleBracket]"}]}]]}], 
             ")"}]}], "&"}], "/@", 
          RowBox[{"Subsets", "[", 
           RowBox[{
            RowBox[{"Range", "[", "k", "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"1", ",", 
              RowBox[{"k", "-", "1"}]}], "}"}]}], "]"}]}], "]"}], ",", "zz", 
        ",", 
        RowBox[{"1", "+", 
         RowBox[{"Total", "/@", "n"}]}]}], "]"}]}]}], "]"}]}], 
  ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.700021459707047*^9, 3.700021499160986*^9}, 
   3.7000215720200357`*^9, {3.700021964816148*^9, 3.700021967266685*^9}, {
   3.700022143522645*^9, 3.7000221474804907`*^9}, {3.700022185335001*^9, 
   3.7000221893139677`*^9}, {3.700022223868538*^9, 3.7000222282353*^9}, {
   3.700022322265665*^9, 3.7000223254077253`*^9}, {3.7000228348340273`*^9, 
   3.700022879625022*^9}, {3.700022991142129*^9, 3.700023036947019*^9}, {
   3.7000232708113117`*^9, 3.700023334746594*^9}, {3.700878033903018*^9, 
   3.700878052137212*^9}, {3.700898367677747*^9, 3.7008984287333*^9}, {
   3.700898490330991*^9, 3.700898497476795*^9}, {3.700898541153242*^9, 
   3.700898593303936*^9}, {3.7008987786674128`*^9, 3.700898786866149*^9}, 
   3.700898922676629*^9, 3.7008999061285563`*^9, {3.700899966870775*^9, 
   3.700900067629249*^9}},
 CellLabel->
  "In[477]:=",ExpressionUUID->"511eae7a-25fa-4867-b921-eace7773bd5e"]
}, Closed]],

Cell[CellGroupData[{

Cell["neutPr0", "Subsubsection",
 CellChangeTimes->{{3.700022828330923*^9, 3.700022830817541*^9}, {
  3.7000542071553373`*^9, 
  3.700054214093142*^9}},ExpressionUUID->"d3fe3bea-0a7c-479b-91d3-\
0875e753c6fc"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"neutPr0", "::", "usage"}], "=", 
   "\"\<neutPr0[{\!\(\*SubscriptBox[\(n\), \
\(1\)]\),\[Ellipsis],\!\(\*SubscriptBox[\(n\), \(k\)]\)},p] gives the \
probability of seeing i=1\[Ellipsis]N-1 copies, given that \
{\!\(\*SubscriptBox[\(n\), \(1\)]\),\[Ellipsis],\!\(\*SubscriptBox[\(n\), \(k\
\)]\)} ancestral genomes survive, and that their initial allelic state was \
sampled from p. neutPr0[{{\!\(\*SubsuperscriptBox[\(n\), \(1\), \(1\)]\),\
\[Ellipsis],\!\(\*SubsuperscriptBox[\(n\), \(k\), \(1\)]\)},\[Ellipsis],{\!\(\
\*SubsuperscriptBox[\(n\), \(1\), \(j\)]\),\[Ellipsis]}},p] allows for \
multiple descendant populations, labelled 1\[Ellipsis]j. Note that the output \
includes fixation in both demes as the two extreme points of the \
table.\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.7000228411851387`*^9, 3.700023129258473*^9}, {
  3.7000541026353493`*^9, 3.700054217859054*^9}, {3.700878106551334*^9, 
  3.7008781547678337`*^9}, {3.700884679159522*^9, 3.70088472951807*^9}},
 CellLabel->
  "In[482]:=",ExpressionUUID->"180064bd-d703-4d13-bbae-27a7f6cf29ac"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"neutPr0", "::", "badN"}], "=", 
   "\"\<The ancestry counts for the descendant populations `1` do not have \
the same length\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.700878245833498*^9, 3.70087829432654*^9}},
 CellLabel->
  "In[483]:=",ExpressionUUID->"a4c3aaed-7a87-4db8-b5a7-7d80e77ac4f5"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"neutPr0", "[", 
    RowBox[{
     RowBox[{"n", ":", 
      RowBox[{"{", "__Integer", "}"}]}], ",", "p_"}], "]"}], ":=", 
   RowBox[{"neutPr0", "[", 
    RowBox[{
     RowBox[{"{", "n", "}"}], ",", "p"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"neutPr0", "[", 
    RowBox[{
     RowBox[{"n", ":", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", "__Integer", "}"}], "..."}], "}"}]}], ",", "p_"}], "]"}],
    ":=", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"k", "=", 
        RowBox[{"Length", "[", 
         RowBox[{"n", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
         "]"}]}], ",", 
       RowBox[{"d", "=", 
        RowBox[{"Length", "[", "n", "]"}]}], ",", "z", ",", "zz"}], "}"}], 
     ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Min", "[", 
          RowBox[{"Length", "/@", "n"}], "]"}], "\[NotEqual]", 
         RowBox[{"Max", "[", 
          RowBox[{"Length", "/@", "n"}], "]"}]}], ",", 
        RowBox[{"Message", "[", 
         RowBox[{
          RowBox[{"neutPr0", "::", "badN"}], ",", "n"}], "]"}]}], "]"}], ";", 
      
      RowBox[{"zz", "=", 
       RowBox[{"Array", "[", 
        RowBox[{"z", ",", "d"}], "]"}]}], ";", 
      RowBox[{"CoefficientList", "[", 
       RowBox[{
        RowBox[{"Total", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            SuperscriptBox[
             RowBox[{"(", 
              RowBox[{"1", "-", "p"}], ")"}], 
             RowBox[{"k", "-", 
              RowBox[{"Length", "[", "#", "]"}]}]], 
            SuperscriptBox[
             RowBox[{"p", " "}], 
             RowBox[{"Length", "[", "#", "]"}]], 
            RowBox[{"(", 
             RowBox[{"Times", "@@", 
              SuperscriptBox["zz", 
               RowBox[{"Total", "/@", 
                RowBox[{"n", "\[LeftDoubleBracket]", 
                 RowBox[{"All", ",", "#"}], "\[RightDoubleBracket]"}]}]]}], 
             ")"}]}], "&"}], "/@", 
          RowBox[{"Subsets", "[", 
           RowBox[{"Range", "[", "k", "]"}], "]"}]}], "]"}], ",", "zz", ",", 
        RowBox[{"1", "+", 
         RowBox[{"Total", "/@", "n"}]}]}], "]"}]}]}], "]"}]}], 
  ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.700021459707047*^9, 3.700021499160986*^9}, 
   3.7000215720200357`*^9, {3.700021964816148*^9, 3.700021967266685*^9}, {
   3.700022143522645*^9, 3.7000221474804907`*^9}, {3.700022185335001*^9, 
   3.7000221893139677`*^9}, {3.700022223868538*^9, 3.7000222282353*^9}, {
   3.700022322265665*^9, 3.7000223254077253`*^9}, {3.7000228348340273`*^9, 
   3.700022879625022*^9}, {3.700022991142129*^9, 3.700023036947019*^9}, {
   3.7000232708113117`*^9, 3.700023334746594*^9}, {3.7000542215396442`*^9, 
   3.7000542365609407`*^9}, {3.700054344062738*^9, 3.700054361009852*^9}, 
   3.700878095663562*^9, {3.700878163524789*^9, 3.700878239776963*^9}, {
   3.700878303173635*^9, 3.700878342978869*^9}, 3.700884254270236*^9, {
   3.700884326580748*^9, 3.7008844668221817`*^9}, {3.7008845513001003`*^9, 
   3.700884558579648*^9}, {3.7008984479413023`*^9, 3.7008984481091547`*^9}, {
   3.700898740803439*^9, 3.700898758697208*^9}},
 CellLabel->
  "In[484]:=",ExpressionUUID->"97d0e224-0840-4985-b453-edba829fed4a"],

Cell[TextData[{
 "If the initial genomes are sampled from a population with known frequency \
",
 Cell[BoxData[
  FormBox["p", TraditionalForm]],ExpressionUUID->
  "92f42049-a4c8-4332-a295-db02b7eae4e9"],
 ", then the GF of the distribution is:\n\t",
 Cell[BoxData[
  FormBox[
   RowBox[{" ", 
    RowBox[{
     SubscriptBox["\[Sum]", 
      RowBox[{"S", "\[SubsetEqual]", "K"}]], 
     RowBox[{
      SuperscriptBox["q", 
       RowBox[{
        RowBox[{"k", "-"}], "|", "S", "|"}]], 
      SuperscriptBox["p", 
       RowBox[{"|", "S", "|"}]], 
      SuperscriptBox["\[ExponentialE]", 
       RowBox[{"\[Omega]", "\[VeryThinSpace]", 
        SubscriptBox["n", "S"]}]]}]}]}], TraditionalForm]],ExpressionUUID->
  "fa906e35-bf76-4a4f-8197-5edbf901f372"],
 ".  "
}], "Text",
 CellChangeTimes->{{3.7000542509992943`*^9, 3.700054312826507*^9}, {
  3.700881337967637*^9, 
  3.700881337967691*^9}},ExpressionUUID->"434c6de1-895b-4d46-b1a2-\
fdb05b7ddf38"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Analysing block ancestry", "Subsection",
 CellChangeTimes->{{3.700821161915125*^9, 
  3.700821166538969*^9}},ExpressionUUID->"c7160448-e602-4f23-bb27-\
6c6a4294d007"],

Cell[TextData[StyleBox["Other functions for analyzing block ancestry are \
defined in resetVariables",
 FontSlant->"Italic"]], "Text",
 CellChangeTimes->{{3.7033837953103437`*^9, 
  3.703383811790249*^9}},ExpressionUUID->"c27db9d3-5712-40fb-be55-\
d3751d87b7d2"],

Cell[CellGroupData[{

Cell["Notes", "Subsubsection",
 CellChangeTimes->{{3.703383787527426*^9, 
  3.703383788158841*^9}},ExpressionUUID->"57050684-7823-4685-b5b8-\
7fd2dd99ede8"],

Cell[TextData[{
 " I distinguish ",
 StyleBox["blocks",
  FontSlant->"Italic"],
 ", which are contiguous blocks with the same ancestry, from ",
 StyleBox["intervals",
  FontSlant->"Italic"],
 ", which are defined by the complete set of junctions in the whole \
population.  All material within the same interval has the same configuration \
of ancestry. Since we have only allele frequency data, all that is needed to \
reconstruct the marker genotype in an interval are the numbers of each \
ancestry (which will be carried on some larger number of blocks."
}], "Text",
 CellChangeTimes->{{3.700731132884975*^9, 3.700731171374054*^9}, {
   3.700731233642179*^9, 3.700731338552396*^9}, {3.700792407338849*^9, 
   3.700792420137431*^9}, {3.7007965421933804`*^9, 3.700796617589137*^9}, {
   3.7007968337743387`*^9, 3.7007969074502583`*^9}, {3.700796971753346*^9, 
   3.7007969739039993`*^9}, 
   3.700821240129426*^9},ExpressionUUID->"061e968e-07d1-4898-88a2-\
fde6da3e117a"],

Cell["\<\
The obvious solution is to use the spatial arrangement of junctions, and to \
exploit Nearest[], which is highly efficient:
\t- use NearestFunction to store a list of the junctions in-between the ends \
of each block.
\t- this immediately generates the intervals associated with each block
\t- generate the SparseArray that specifies which blocks are associated with \
each interval (?)
\t- transpose this, so as to find the blocks associated with every interval
\t- extract the counts on the vector of ancestries for these blocks, and sum \
to find the configuration\
\>", "Text",
 CellChangeTimes->{{3.700797074514708*^9, 3.7007970748516817`*^9}, {
   3.700797319505375*^9, 3.700797355705755*^9}, {3.700798755198431*^9, 
   3.7007988034521017`*^9}, {3.7007989010969152`*^9, 3.700799009332522*^9}, {
   3.700799041011795*^9, 3.7007990690750237`*^9}, {3.700799481587397*^9, 
   3.700799483003381*^9}, {3.700799792822302*^9, 3.700799887798616*^9}, 
   3.700801205197576*^9, {3.700821252558075*^9, 
   3.7008212533921223`*^9}},ExpressionUUID->"00d8a552-fc89-45b0-ae54-\
f4bae75ac342"]
}, Closed]],

Cell[CellGroupData[{

Cell["pedigreeF", "Subsubsection",
 CellChangeTimes->{
  3.70157119850893*^9},ExpressionUUID->"f320233c-be83-438e-900f-2746e3292cd3"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"pedigreeF", "::", "usage"}], "=", 
   "\"\<pedigreeF[\[ScriptCapitalP],t,{\!\(\*SubscriptBox[\(inds\), \(1\)]\),\
\[Ellipsis]}] returns a matrix of identity for the demes defined by \
{\!\(\*SubscriptBox[\(inds\), \(1\)]\),\[Ellipsis]}, calculated directly from \
the pedigree. \>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.701571190959484*^9, 3.7015712340846233`*^9}},
 CellLabel->
  "In[486]:=",ExpressionUUID->"0c4fb391-68c9-4b9b-8b0a-b330cd93e254"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"pedigreeF", "[", 
    RowBox[{"\[ScriptCapitalP]_", ",", "t_Integer", ",", "inds_List"}], "]"}],
    ":=", 
   RowBox[{"Outer", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"Mean", "[", 
       RowBox[{"N", "[", 
        RowBox[{"Flatten", "[", 
         RowBox[{
          RowBox[{"F", "[", "\[ScriptCapitalP]", "]"}], 
          "\[LeftDoubleBracket]", 
          RowBox[{
           RowBox[{"t", "+", "1"}], ",", "#1", ",", "#2"}], 
          "\[RightDoubleBracket]"}], "]"}], "]"}], "]"}], "&"}], ",", "inds", 
     ",", "inds", ",", "1"}], "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.70156745775482*^9, 3.701567462353323*^9}, {
   3.701568357280308*^9, 3.701568426989656*^9}, {3.701568529781884*^9, 
   3.701568534724874*^9}, 3.7015711475833817`*^9, 3.70157124721117*^9, {
   3.7015713185050983`*^9, 3.701571359610096*^9}},
 CellLabel->
  "In[487]:=",ExpressionUUID->"a9dbf90c-2577-475f-a5b2-51dadc962e76"]
}, Closed]],

Cell[CellGroupData[{

Cell["intervalWeight", "Subsubsection",
 CellChangeTimes->{{3.701572261736442*^9, 
  3.701572278399447*^9}},ExpressionUUID->"5f169ee5-2d20-4273-adb6-\
4488fbb1ece5"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"intervalWeight", "::", "usage"}], "=", 
   "\"\<intervalWeight is an option for intervalF that determines whether to \
weight by interval length\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.701572263851293*^9, 3.701572299119013*^9}},
 CellLabel->
  "In[488]:=",ExpressionUUID->"6249b4b5-4f21-424c-a7ea-eddf24e8688c"]
}, Closed]],

Cell[CellGroupData[{

Cell["intervalF", "Subsubsection",
 InitializationCell->True,
 CellChangeTimes->{
  3.701571183333329*^9},ExpressionUUID->"c589b96b-3735-4b57-b5e4-\
04148d750a20"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"intervalF", "::", "usage"}], "=", 
   "\"\<intervalF[\[ScriptCapitalP],t,{\!\(\*SubscriptBox[\(inds\), \(1\)]\),\
\[Ellipsis]}] returns a matrix of identity, <\!\(\*SubscriptBox[\(p\), \(i\)]\
\).\!\(\*SubscriptBox[\(p\), \(j\)]\)> for the demes defined by \
{\!\(\*SubscriptBox[\(inds\), \(1\)]\),\[Ellipsis]}. No correction is made \
for sampling. intervalWeight->False does not weight for \
intervallength.\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.701567269315559*^9, 3.701567380971652*^9}, {
   3.7015711434161243`*^9, 3.701571175398485*^9}, {3.701571992992256*^9, 
   3.7015720228386*^9}, 3.701572271489303*^9},
 CellLabel->
  "In[489]:=",ExpressionUUID->"62f1850e-ab02-4409-8f91-948432b508b5"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "intervalF", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{"intervalWeight", "\[Rule]", "True"}], "}"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.701572263851293*^9, 3.701572329125334*^9}},
 CellLabel->
  "In[490]:=",ExpressionUUID->"d1988138-6b1c-4dde-b52d-b0bf21f74b77"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"intervalF", "[", 
    RowBox[{
    "\[ScriptCapitalP]_", ",", "t_Integer", ",", "inds_List", ",", 
     "opts___Rule"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"cb", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"configIntervals", "[", 
           RowBox[{"\[ScriptCapitalP]", ",", "t", ",", "#"}], "]"}], "&"}], "/@",
          "inds"}]}], ",", "pb", ",", "xx", ",", "intLength"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"pb", "=", 
       RowBox[{
        RowBox[{
         RowBox[{
          FractionBox["#", 
           RowBox[{"Total", "[", 
            RowBox[{
            "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
            "]"}]], "&"}], "/@", "cb"}], "//", "N"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"intervalWeight", "/.", 
          RowBox[{"{", "opts", "}"}]}], "/.", 
         RowBox[{"Options", "[", "intervalF", "]"}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"xx", "=", 
          RowBox[{
           RowBox[{"locJ", "[", "\[ScriptCapitalP]", "]"}], "/@", 
           RowBox[{"allJunctions", "[", 
            RowBox[{"\[ScriptCapitalP]", ",", "t"}], "]"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"intLength", "=", 
          RowBox[{
           RowBox[{"Transpose", "[", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Drop", "[", 
               RowBox[{"xx", ",", 
                RowBox[{"-", "1"}]}], "]"}], ",", 
              RowBox[{"Drop", "[", 
               RowBox[{"xx", ",", "1"}], "]"}]}], "}"}], "]"}], ".", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"-", "1"}], ",", "1"}], "}"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Outer", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              FractionBox["intLength", 
               RowBox[{"mapLength", "[", "\[ScriptCapitalP]", "]"}]], ".", 
              RowBox[{"MapThread", "[", 
               RowBox[{"Dot", ",", 
                RowBox[{"{", "##", "}"}]}], "]"}]}], ")"}], "&"}], ",", "pb", 
           ",", "pb", ",", "1"}], "]"}]}], ",", "\[IndentingNewLine]", 
        RowBox[{"Outer", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Mean", "[", 
            RowBox[{"MapThread", "[", 
             RowBox[{"Dot", ",", 
              RowBox[{"{", "##", "}"}]}], "]"}], "]"}], "&"}], ",", "pb", ",",
           "pb", ",", "1"}], "]"}]}], "]"}]}]}], "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.70156745775482*^9, 3.701567462353323*^9}, {
   3.701568357280308*^9, 3.701568426989656*^9}, {3.701568529781884*^9, 
   3.701568534724874*^9}, 3.7015711475833817`*^9, {3.701571254581998*^9, 
   3.701571255909092*^9}, {3.70157233338345*^9, 3.7015725359973497`*^9}, {
   3.701572632645225*^9, 3.701572636577935*^9}},
 CellLabel->
  "In[491]:=",ExpressionUUID->"a41b8aa1-6227-4819-a520-ac879bf9642c"]
}, Closed]],

Cell[CellGroupData[{

Cell["blockValue", "Subsubsection",
 CellChangeTimes->{
  3.703384834297947*^9},ExpressionUUID->"c186ce80-3f4b-4c66-89c3-\
a613ffe50292"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"blockValue", "::", "usage"}], "=", 
    "\"\<blockValue[\[ScriptCapitalP],\[Alpha]][{\!\(\*SubscriptBox[\(j\), \
\(1\)]\),\!\(\*SubscriptBox[\(j\), \(2\)]\)}] gives the contribution to a \
trait with allelic effects \[Alpha] due to the block between junctions \
\!\(\*SubscriptBox[\(j\), \(1\)]\),\!\(\*SubscriptBox[\(j\), \(2\)]\). \
\>\""}], ";"}], " "}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.69356893673807*^9, 3.693569103495448*^9}, {
   3.693740504170759*^9, 3.6937405597204123`*^9}, {3.693740672547597*^9, 
   3.693740673244894*^9}, 3.703384827546644*^9},
 CellLabel->
  "In[492]:=",ExpressionUUID->"158ea2c7-b681-4c61-979d-c627bf5e8ce0"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"blockValue", "[", 
     RowBox[{"\[ScriptCapitalP]_", ",", "\[Alpha]_List"}], "]"}], "[", 
    RowBox[{"{", 
     RowBox[{"j0_Integer", ",", "j1_Integer"}], "}"}], "]"}], ":=", 
   RowBox[{
    RowBox[{"\[Alpha]", "\[LeftDoubleBracket]", 
     RowBox[{
      RowBox[{"blockLoci", "[", "\[ScriptCapitalP]", "]"}], "[", 
      RowBox[{"{", 
       RowBox[{"j0", ",", "j1"}], "}"}], "]"}], "\[RightDoubleBracket]"}], 
    ".", 
    RowBox[{
     RowBox[{"blockHap", "[", "\[ScriptCapitalP]", "]"}], "[", 
     RowBox[{"{", 
      RowBox[{"j0", ",", "j1"}], "}"}], "]"}]}]}], ";"}]], "Input",
 InitializationCell->True,
 CellLabel->
  "In[493]:=",ExpressionUUID->"051da367-a51f-4bdd-88de-b0eb0840876c"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Stored variables", "Subsection",
 CellChangeTimes->{{3.703383439604804*^9, 3.703383443930593*^9}, 
   3.703384245394773*^9},ExpressionUUID->"5fefc064-8c97-455c-b3e2-\
c0f76f7eb68b"],

Cell[CellGroupData[{

Cell["Note on loading simulations", "Subsubsection",
 CellChangeTimes->{{3.7033784657515783`*^9, 
  3.703378482161832*^9}},ExpressionUUID->"d2c42b6c-778b-4c5d-9818-\
e0746c770df9"],

Cell[TextData[{
 "Simulations are large, and it is not possible to keep multiple simulations \
in memory. However, it is not straightforward to save and restore results.  \
Each simulation, \[ScriptCapitalP], is labelled, and is held in a set of \
global variables, labelled ",
 Cell[BoxData[
  FormBox[
   RowBox[{"pop", "[", "\[ScriptCapitalP]", "]"}], TraditionalForm]],
  ExpressionUUID->"923e7883-6a02-4efe-8d1c-a8551f539f04"],
 ", etc.  One can clear all these, and replace them by loading in saved \
definitions. Results from multiple saved simulations can be combined by \
saving them in a new structure, constructed from the saved sets."
}], "Text",
 CellChangeTimes->{{3.7033805880381927`*^9, 3.7033806131961737`*^9}, {
  3.703382217066537*^9, 3.703382354568103*^9}, {3.703382409358869*^9, 
  3.703382590293392*^9}},ExpressionUUID->"5f8052e1-c95a-417d-8f6e-\
6a8033d98ac8"],

Cell["\<\
 It is hard to see how to combine simulation results that are held in \
different files.  If the simulations have different labels, then they will \
coexist in memory - but will also take more space. If they have the same \
label, then later files will overwrite earlier ones. In any case, memory \
limits mean that one cannot deal with multiple simulations (depending on \
their size).\
\>", "Text",
 CellChangeTimes->{{3.7033805880381927`*^9, 3.7033806131961737`*^9}, {
  3.703382217066537*^9, 3.703382354568103*^9}, {3.703382409358869*^9, 
  3.703382497775832*^9}, {3.703382592180944*^9, 
  3.70338269886272*^9}},ExpressionUUID->"d3a2fe52-3e19-4df7-aaee-\
3479e3742ffe"],

Cell[TextData[{
 "The list of global variables is in globalVariables[\[ScriptCapitalP]] - \
which is not actually a useful function. These can be cleared using \
clearGlobalVariables[]:\npedigreeList, pop, nLoci, mapLength, junctions, \
locJ, numJ, originJ, hapJ, mutations, locM, numM, originM, zInf, zEnv, \
zChrom, zKids, F\n\nIn addition, there are functions that calculate ",
 StyleBox["and store",
  FontSlant->"Italic"],
 " features of the simulations. These must be cleared and redefined using \
resetVariables[]:\nnumAllJunctions, allJunctions, nJunctions, intList, \
blockAnc, blockLoci, blockHap, allBlocks, numAllBlocks, findJunctions, \
overlapQ, countBlocks, ancBlocks, configIntervals"
}], "Text",
 CellChangeTimes->{{3.7033805880381927`*^9, 3.7033806131961737`*^9}, {
   3.703382217066537*^9, 3.703382354568103*^9}, {3.703382409358869*^9, 
   3.703382418949613*^9}, {3.7033827069355373`*^9, 3.703382771968161*^9}, {
   3.703382818272315*^9, 3.703382881412633*^9}, {3.703382935475897*^9, 
   3.703382991489197*^9}, 3.703383131743368*^9, {3.7033834151405563`*^9, 
   3.703383417540495*^9}},ExpressionUUID->"b04ee193-f4bc-4a0d-889d-\
fb7d376aa1a8"],

Cell[TextData[{
 "So, to save all current simulations, just use Save[",
 StyleBox["filename",
  FontSlant->"Italic"],
 ", {pedigreeList, pop, nLoci, mapLength, junctions, locJ, numJ, originJ, \
hapJ, mutations, locM, numM, originM, zInf, zEnv, zChrom, zKids, F}], or \
saveGlobalVariables[",
 StyleBox["filename",
  FontSlant->"Italic"],
 "]."
}], "Text",
 CellChangeTimes->{{3.703382998049322*^9, 
  3.703383074381435*^9}},ExpressionUUID->"4e46a0f5-7521-4c2a-894b-\
ec0418240ac9"],

Cell[TextData[{
 "To clear current simulations and replace them with a saved set, use:\n\t\
clearGlobalVariables[]; resetVariables; Get[",
 StyleBox["filename",
  FontSlant->"Italic"],
 "]."
}], "Text",
 CellChangeTimes->{{3.703383084093143*^9, 3.70338311798032*^9}, {
   3.703383151564547*^9, 3.7033831972810917`*^9}, 
   3.7033832323717623`*^9},ExpressionUUID->"c88fd027-9b3a-407d-ace1-\
ad856bf6638d"],

Cell[TextData[{
 "This is delicate, because one has to make sure that the definitions held in \
resetVariables are consistent with those in the original definitions. I have \
rewritten the code so that these functions are now all defined within one \
\[OpenCurlyDoubleQuote]wrapper\[CloseCurlyDoubleQuote].  One also needs to be \
sure that these are ",
 StyleBox["all",
  FontSlant->"Italic"],
 " the relevant functions, so that \[OpenCurlyDoubleQuote]ghosts\
\[CloseCurlyDoubleQuote] of previous simulations do not remain when new \
simulations are loaded. I have checked, and ",
 StyleBox["think",
  FontSlant->"Italic"],
 " that this is the case.  "
}], "Text",
 CellChangeTimes->{{3.703383182202032*^9, 
  3.703383394556615*^9}},ExpressionUUID->"37738e1e-aeb3-422d-a940-\
d7d270747e78"]
}, Closed]],

Cell[CellGroupData[{

Cell[TextData[StyleBox["resetVariables",
 Background->RGBColor[1, 1, 0.85]]], "Subsubsection",
 CellChangeTimes->{3.703300323364884*^9, 
  3.7033831461426277`*^9},ExpressionUUID->"f50de588-3891-466e-bcd8-\
7593f5cfc690"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"resetVariables", "::", "usage"}], "=", 
   "\"\<resetVariables[] clears nLoci, numAllJunctions, allJunctions, \
numAllMutations, allMutations, nJunctions, nMutations, intList, blockAnc, \
blockLoci, blockHap, allBlocks, numAllBlocks, findJunctions, overlapQ, \
countBlocks, ancBlocks, configIntervals, intSNP and then redefines them. \
Needs to be called when new data files are loaded in.\>\""}], ";"}]], "Input",\

 InitializationCell->True,
 CellChangeTimes->{{3.7033003242210093`*^9, 3.70330036503745*^9}, {
   3.703378039132716*^9, 3.703378042546014*^9}, 3.7033781211773643`*^9, {
   3.7033782015998077`*^9, 3.7033782088051977`*^9}, 3.703378447854488*^9, {
   3.703378719163838*^9, 3.703378733249408*^9}, {3.703379973225791*^9, 
   3.703379974430696*^9}, {3.7033801511620293`*^9, 3.7033801581285267`*^9}, {
   3.7033803047626743`*^9, 3.703380326601912*^9}, {3.703380392735182*^9, 
   3.7033803931437817`*^9}, {3.7033804715408792`*^9, 3.703380471996811*^9}, {
   3.703380507635826*^9, 3.7033805106111813`*^9}, {3.7033836019621267`*^9, 
   3.703383624735961*^9}, {3.703383855165284*^9, 3.703383856677164*^9}, {
   3.713951563065001*^9, 3.713951570749617*^9}, {3.7139520711256657`*^9, 
   3.713952074236395*^9}, {3.735373212683015*^9, 
   3.735373214439949*^9}},ExpressionUUID->"7074cf70-69cf-4b6b-832c-\
f6b23fa6ed8d"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"resetVariables", "[", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Clear", "[", 
       RowBox[{
       "nLoci", ",", " ", "numAllJunctions", ",", "allJunctions", ",", 
        "nJunctions", ",", "intList", ",", "blockAnc", ",", "blockLoci", ",", 
        "blockHap", ",", "allBlocks", ",", " ", "numAllBlocks", ",", " ", 
        "findJunctions", ",", "overlapQ", ",", " ", "countBlocks", ",", " ", 
        "ancBlocks", ",", "configIntervals", ",", "configIntervalsAnc", ",", 
        "intSNP"}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", "nLoci", " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"nLoci", "[", "\[ScriptCapitalP]_", "]"}], ":=", 
       RowBox[{
        RowBox[{"nLoci", "[", "\[ScriptCapitalP]", "]"}], "=", 
        RowBox[{"Length", "[", 
         RowBox[{
          RowBox[{"pop", "[", "\[ScriptCapitalP]", "]"}], 
          "\[LeftDoubleBracket]", 
          RowBox[{"1", ",", "1", ",", "1"}], "\[RightDoubleBracket]"}], 
         "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", "intList", "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"intList", "[", 
        RowBox[{"\[ScriptCapitalP]_", ",", "t_Integer", ",", "n_Integer"}], 
        "]"}], ":=", 
       RowBox[{
        RowBox[{"intList", "[", 
         RowBox[{"\[ScriptCapitalP]", ",", "t", ",", "n"}], "]"}], "=", 
        "\[IndentingNewLine]", 
        RowBox[{"Module", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"nf", ",", "jj", ",", "xx"}], "}"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"xx", "=", 
            RowBox[{
             RowBox[{"locJ", "[", "\[ScriptCapitalP]", "]"}], "/@", 
             RowBox[{"allJunctions", "[", 
              RowBox[{"\[ScriptCapitalP]", ",", "t"}], "]"}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"nf", "=", 
            RowBox[{"Nearest", "[", 
             RowBox[{"xx", "\[Rule]", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "xx", "]"}], "]"}]}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"jj", "=", 
            RowBox[{"Flatten", "[", 
             RowBox[{"nf", "/@", 
              RowBox[{"(", 
               RowBox[{
                FractionBox[
                 RowBox[{"mapLength", "[", "\[ScriptCapitalP]", "]"}], "n"], 
                " ", 
                RowBox[{"Range", "[", 
                 RowBox[{"0", ",", "n"}], "]"}]}], ")"}]}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"Span", "@@", "#"}], "&"}], "/@", 
            RowBox[{"Transpose", "[", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"Drop", "[", 
                RowBox[{"jj", ",", 
                 RowBox[{"-", "1"}]}], "]"}], ",", 
               RowBox[{
                RowBox[{"Drop", "[", 
                 RowBox[{"jj", ",", "1"}], "]"}], "-", "1"}]}], "}"}], 
             "]"}]}]}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"intList", "[", 
        RowBox[{"\[ScriptCapitalP]_", ",", "t_Integer", ",", "xl_List"}], 
        "]"}], ":=", 
       RowBox[{
        RowBox[{"intList", "[", 
         RowBox[{"\[ScriptCapitalP]", ",", "t", ",", "xl"}], "]"}], "=", 
        "\[IndentingNewLine]", 
        RowBox[{"Module", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"nf", ",", "jj", ",", "xx", ",", 
            RowBox[{"dxl", "=", 
             RowBox[{
              RowBox[{"xl", "\[LeftDoubleBracket]", 
               RowBox[{
                RowBox[{"-", "1"}], ",", 
                RowBox[{"-", "1"}]}], "\[RightDoubleBracket]"}], "-", 
              RowBox[{"xl", "\[LeftDoubleBracket]", 
               RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}]}]}]}], 
           "}"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"xx", "=", 
            RowBox[{
             RowBox[{"locJ", "[", "\[ScriptCapitalP]", "]"}], "/@", 
             RowBox[{"allJunctions", "[", 
              RowBox[{"\[ScriptCapitalP]", ",", "t"}], "]"}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"nf", "=", 
            RowBox[{"Nearest", "[", 
             RowBox[{"xx", "\[Rule]", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "xx", "]"}], "]"}]}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"jj", "=", 
            RowBox[{"Flatten", "/@", 
             RowBox[{"(", 
              RowBox[{"nf", "/@", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"mapLength", "[", "\[ScriptCapitalP]", "]"}], " ", 
                 RowBox[{"(", 
                  FractionBox[
                   RowBox[{"xl", "-", 
                    RowBox[{"xl", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}]}], 
                   RowBox[{
                    RowBox[{"xl", "\[LeftDoubleBracket]", 
                    RowBox[{
                    RowBox[{"-", "1"}], ",", 
                    RowBox[{"-", "1"}]}], "\[RightDoubleBracket]"}], "-", 
                    RowBox[{"xl", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}]}]], 
                  ")"}]}], ")"}]}], ")"}]}]}], ";", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"Span", "@@", "#"}], "&"}], "/@", "jj"}]}]}], "]"}]}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"(*", "numAllMutations", "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"numAllMutations", "[", 
        RowBox[{"\[ScriptCapitalP]_", ",", "t_Integer"}], "]"}], ":=", 
       RowBox[{
        RowBox[{"numAllJunctions", "[", 
         RowBox[{"\[ScriptCapitalP]", ",", "t"}], "]"}], "=", 
        "\[IndentingNewLine]", 
        RowBox[{"Length", "[", 
         RowBox[{"allMutations", "[", 
          RowBox[{"\[ScriptCapitalP]", ",", "t"}], "]"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", "allMutations", "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"allMutations", "[", 
        RowBox[{"\[ScriptCapitalP]_", ",", "t_Integer"}], "]"}], ":=", 
       RowBox[{
        RowBox[{"allMutations", "[", 
         RowBox[{"\[ScriptCapitalP]", ",", "t"}], "]"}], "=", 
        "\[IndentingNewLine]", 
        RowBox[{"Sort", "[", 
         RowBox[{
          RowBox[{"Union", "[", 
           RowBox[{"Flatten", "[", 
            RowBox[{
             RowBox[{"mutations", "[", "\[ScriptCapitalP]", "]"}], 
             "\[LeftDoubleBracket]", 
             RowBox[{"t", "+", "1"}], "\[RightDoubleBracket]"}], "]"}], "]"}],
           ",", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"locM", "[", "\[ScriptCapitalP]", "]"}], "[", "#1", 
             "]"}], "<", 
            RowBox[{
             RowBox[{"locM", "[", "\[ScriptCapitalP]", "]"}], "[", "#2", 
             "]"}]}], "&"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", "nMutations", "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"nMutations", "[", "\[ScriptCapitalP]_", "]"}], ":=", 
       RowBox[{
        RowBox[{"nMutations", "[", "\[ScriptCapitalP]", "]"}], "=", 
        "\[IndentingNewLine]", 
        RowBox[{"Module", "[", 
         RowBox[{
          RowBox[{"{", "j", "}"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"Count", "[", 
               RowBox[{
                RowBox[{"Flatten", "[", "#", "]"}], ",", "j"}], "]"}], "&"}], 
             "/@", 
             RowBox[{"mutations", "[", "\[ScriptCapitalP]", "]"}]}], ",", 
            RowBox[{"{", 
             RowBox[{"j", ",", 
              RowBox[{"numM", "[", "\[ScriptCapitalP]", "]"}]}], "}"}]}], 
           "]"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", "numAllJunctions", "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"numAllJunctions", "[", 
        RowBox[{"\[ScriptCapitalP]_", ",", "t_Integer", ",", "opts___Rule"}], 
        "]"}], ":=", 
       RowBox[{
        RowBox[{"numAllJunctions", "[", 
         RowBox[{"\[ScriptCapitalP]", ",", "t", ",", "opts"}], "]"}], "=", 
        "\[IndentingNewLine]", 
        RowBox[{"Length", "[", 
         RowBox[{"allJunctions", "[", 
          RowBox[{"\[ScriptCapitalP]", ",", "t", ",", "opts"}], "]"}], 
         "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", "allJunctions", "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"allJunctions", "[", 
        RowBox[{"\[ScriptCapitalP]_", ",", "t_Integer", ",", "opts___Rule"}], 
        "]"}], ":=", "\[IndentingNewLine]", 
       RowBox[{"Module", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"de", "=", 
            RowBox[{
             RowBox[{"DeleteEmpties", "/.", 
              RowBox[{"{", "opts", "}"}]}], "/.", 
             RowBox[{"Options", "[", "allJunctions", "]"}]}]}], ",", "sj", 
           ",", "nf"}], "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{"de", ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"sj", "=", 
             RowBox[{"allJunctions", "[", 
              RowBox[{"\[ScriptCapitalP]", ",", "t", ",", 
               RowBox[{"DeleteEmpties", "\[Rule]", "False"}]}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"nf", "=", 
             RowBox[{"Nearest", "[", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"locJ", "[", "\[ScriptCapitalP]", "]"}], "/@", 
                 "sj"}], ")"}], "\[Rule]", 
               RowBox[{"Range", "[", 
                RowBox[{"Length", "[", "sj", "]"}], "]"}]}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"allJunctions", "[", 
              RowBox[{"\[ScriptCapitalP]", ",", "t", ",", "opts"}], "]"}], 
             "=", 
             RowBox[{"Delete", "[", 
              RowBox[{"sj", ",", 
               RowBox[{"List", "/@", 
                RowBox[{"Join", "[", 
                 RowBox[{
                  RowBox[{"Drop", "[", 
                   RowBox[{
                    RowBox[{"nf", "[", "0", "]"}], ",", "1"}], "]"}], ",", 
                  RowBox[{"Drop", "[", 
                   RowBox[{
                    RowBox[{"nf", "[", 
                    RowBox[{"mapLength", "[", "\[ScriptCapitalP]", "]"}], 
                    "]"}], ",", 
                    RowBox[{"-", "1"}]}], "]"}]}], "]"}]}]}], "]"}]}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"Sort", "[", 
            RowBox[{
             RowBox[{"Union", "[", 
              RowBox[{"Flatten", "[", 
               RowBox[{
                RowBox[{"junctions", "[", "\[ScriptCapitalP]", "]"}], 
                "\[LeftDoubleBracket]", 
                RowBox[{"t", "+", "1"}], "\[RightDoubleBracket]"}], "]"}], 
              "]"}], ",", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"locJ", "[", "\[ScriptCapitalP]", "]"}], "[", "#1", 
                "]"}], "<", 
               RowBox[{
                RowBox[{"locJ", "[", "\[ScriptCapitalP]", "]"}], "[", "#2", 
                "]"}]}], "&"}]}], "]"}]}], "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", "nJunctions", "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"nJunctions", "[", "\[ScriptCapitalP]_", "]"}], ":=", 
       RowBox[{
        RowBox[{"nJunctions", "[", "\[ScriptCapitalP]", "]"}], "=", 
        "\[IndentingNewLine]", 
        RowBox[{"Module", "[", 
         RowBox[{
          RowBox[{"{", "j", "}"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"Count", "[", 
               RowBox[{
                RowBox[{"Flatten", "[", "#", "]"}], ",", "j"}], "]"}], "&"}], 
             "/@", 
             RowBox[{"junctions", "[", "\[ScriptCapitalP]", "]"}]}], ",", 
            RowBox[{"{", 
             RowBox[{"j", ",", 
              RowBox[{"numJ", "[", "\[ScriptCapitalP]", "]"}]}], "}"}]}], 
           "]"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", "blockLoci", "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"blockLoci", "[", "\[ScriptCapitalP]_", "]"}], "[", 
        RowBox[{"{", 
         RowBox[{"j0_Integer", ",", "j1_Integer"}], "}"}], "]"}], ":=", 
       RowBox[{
        RowBox[{
         RowBox[{"blockLoci", "[", "\[ScriptCapitalP]", "]"}], "[", 
         RowBox[{"{", 
          RowBox[{"j0", ",", "j1"}], "}"}], "]"}], "=", "\[IndentingNewLine]", 
        RowBox[{"Span", "@@", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"locPos", "[", 
            RowBox[{
             RowBox[{"nLoci", "[", "\[ScriptCapitalP]", "]"}], ",", 
             RowBox[{"mapLength", "[", "\[ScriptCapitalP]", "]"}]}], "]"}], 
           "[", 
           RowBox[{
            RowBox[{"locJ", "[", "\[ScriptCapitalP]", "]"}], "/@", 
            RowBox[{"{", 
             RowBox[{"j0", ",", "j1"}], "}"}]}], "]"}], ")"}]}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", "blockAnc", "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"blockAnc", "::", "badhap"}], "=", 
       "\"\<Haplotypes of junctions `1` are `2`,  which do not match\>\""}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"blockAnc", "[", "\[ScriptCapitalP]_", "]"}], "[", 
        RowBox[{"{", 
         RowBox[{"j0_Integer", ",", "j1_Integer"}], "}"}], "]"}], ":=", 
       RowBox[{
        RowBox[{
         RowBox[{"blockAnc", "[", "\[ScriptCapitalP]", "]"}], "[", 
         RowBox[{"{", 
          RowBox[{"j0", ",", "j1"}], "}"}], "]"}], "=", "\[IndentingNewLine]", 
        RowBox[{"Module", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"h", "=", 
            RowBox[{
             RowBox[{"hapJ", "[", "\[ScriptCapitalP]", "]"}], "/@", 
             RowBox[{"{", 
              RowBox[{"j0", ",", "j1"}], "}"}]}]}], "}"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"Not", "[", 
              RowBox[{
               RowBox[{"h", "\[LeftDoubleBracket]", 
                RowBox[{"1", ",", "2"}], "\[RightDoubleBracket]"}], 
               "\[Equal]", 
               RowBox[{"h", "\[LeftDoubleBracket]", 
                RowBox[{"2", ",", "1"}], "\[RightDoubleBracket]"}]}], "]"}], 
             ",", 
             RowBox[{"Message", "[", 
              RowBox[{
               RowBox[{"blockAnc", "::", "badhap"}], ",", 
               RowBox[{"{", 
                RowBox[{"j0", ",", "j1"}], "}"}], ",", "h"}], "]"}]}], "]"}], 
           ";", "\[IndentingNewLine]", 
           RowBox[{"h", "\[LeftDoubleBracket]", 
            RowBox[{"1", ",", "2"}], "\[RightDoubleBracket]"}]}]}], "]"}]}]}],
       ";", "\[IndentingNewLine]", 
      RowBox[{"(*", "blockHap", "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"blockHap", "[", "\[ScriptCapitalP]_", "]"}], "[", 
        RowBox[{"{", 
         RowBox[{"j0_Integer", ",", "j1_Integer"}], "}"}], "]"}], ":=", 
       RowBox[{
        RowBox[{
         RowBox[{"blockHap", "[", "\[ScriptCapitalP]", "]"}], "[", 
         RowBox[{"{", 
          RowBox[{"j0", ",", "j1"}], "}"}], "]"}], "=", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Flatten", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"pop", "[", "\[ScriptCapitalP]", "]"}], 
            "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], ",", 
           "1"}], "]"}], "\[LeftDoubleBracket]", 
         RowBox[{
          RowBox[{
           RowBox[{"blockAnc", "[", "\[ScriptCapitalP]", "]"}], "[", 
           RowBox[{"{", 
            RowBox[{"j0", ",", "j1"}], "}"}], "]"}], ",", 
          RowBox[{
           RowBox[{"blockLoci", "[", "\[ScriptCapitalP]", "]"}], "[", 
           RowBox[{"{", 
            RowBox[{"j0", ",", "j1"}], "}"}], "]"}]}], 
         "\[RightDoubleBracket]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", "allBlocks", "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"allBlocks", "[", 
        RowBox[{"\[ScriptCapitalP]_", ",", "t_Integer"}], "]"}], ":=", 
       RowBox[{
        RowBox[{"allBlocks", "[", 
         RowBox[{"\[ScriptCapitalP]", ",", "t"}], "]"}], "=", 
        "\[IndentingNewLine]", 
        RowBox[{"Union", "[", 
         RowBox[{"Flatten", "[", 
          RowBox[{
           RowBox[{"blocks", "/@", 
            RowBox[{"Flatten", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"junctions", "[", "\[ScriptCapitalP]", "]"}], 
               "\[LeftDoubleBracket]", 
               RowBox[{"t", "+", "1"}], "\[RightDoubleBracket]"}], ",", "1"}],
              "]"}]}], ",", "1"}], "]"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", "numAllBlocks", "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"numAllBlocks", "[", 
        RowBox[{"\[ScriptCapitalP]_", ",", "t_Integer"}], "]"}], ":=", 
       RowBox[{
        RowBox[{"numAllBlocks", "[", 
         RowBox[{"\[ScriptCapitalP]", ",", "t"}], "]"}], "=", 
        "\[IndentingNewLine]", 
        RowBox[{"Length", "[", 
         RowBox[{"allBlocks", "[", 
          RowBox[{"\[ScriptCapitalP]", ",", "t"}], "]"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", "findJunctions", "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"findJunctions", "[", 
        RowBox[{"\[ScriptCapitalP]_", ",", "t_Integer"}], "]"}], ":=", 
       RowBox[{
        RowBox[{"findJunctions", "[", 
         RowBox[{"\[ScriptCapitalP]", ",", "t"}], "]"}], "=", 
        "\[IndentingNewLine]", 
        RowBox[{"Nearest", "[", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"locJ", "[", "\[ScriptCapitalP]", "]"}], "/@", 
            RowBox[{"allJunctions", "[", 
             RowBox[{"\[ScriptCapitalP]", ",", "t"}], "]"}]}], ")"}], 
          "\[Rule]", 
          RowBox[{"Range", "[", 
           RowBox[{"Length", "[", 
            RowBox[{"allJunctions", "[", 
             RowBox[{"\[ScriptCapitalP]", ",", "t"}], "]"}], "]"}], "]"}]}], 
         "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", "overlapQ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"overlapQ", "[", 
        RowBox[{"\[ScriptCapitalP]_", ",", "t_Integer"}], "]"}], ":=", 
       RowBox[{
        RowBox[{"overlapQ", "[", 
         RowBox[{"\[ScriptCapitalP]", ",", "t"}], "]"}], "=", 
        "\[IndentingNewLine]", 
        RowBox[{"Module", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"k", ",", "fj"}], "}"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"fj", "=", 
            RowBox[{"findJunctions", "[", 
             RowBox[{"\[ScriptCapitalP]", ",", "t"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"Transpose", "[", 
            RowBox[{"SparseArray", "[", "\[IndentingNewLine]", 
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"SparseArray", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"List", "/@", 
                   RowBox[{"Drop", "[", 
                    RowBox[{
                    RowBox[{"Range", "@@", 
                    RowBox[{"Flatten", "[", 
                    RowBox[{"fj", "[", 
                    RowBox[{
                    RowBox[{"locJ", "[", "\[ScriptCapitalP]", "]"}], "/@", 
                    RowBox[{
                    RowBox[{"allBlocks", "[", 
                    RowBox[{"\[ScriptCapitalP]", ",", "t"}], "]"}], 
                    "\[LeftDoubleBracket]", "k", "\[RightDoubleBracket]"}]}], 
                    "]"}], "]"}]}], ",", 
                    RowBox[{"-", "1"}]}], "]"}]}], "\[Rule]", "True"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"numAllJunctions", "[", 
                    RowBox[{"\[ScriptCapitalP]", ",", "t"}], "]"}], "-", 
                   "1"}], "}"}], ",", "False"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"k", ",", 
                 RowBox[{"numAllBlocks", "[", 
                  RowBox[{"\[ScriptCapitalP]", ",", "t"}], "]"}]}], "}"}]}], 
              "]"}], "]"}], "]"}]}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      
      RowBox[{"(*", "countBlocks", "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"countBlocks", "[", 
        RowBox[{"\[ScriptCapitalP]_", ",", "t_Integer"}], "]"}], ":=", 
       RowBox[{"countBlocks", "[", 
        RowBox[{"\[ScriptCapitalP]", ",", "t", ",", "All"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"countBlocks", "[", 
        RowBox[{"\[ScriptCapitalP]_", ",", "t_Integer", ",", "inds_"}], "]"}],
        ":=", 
       RowBox[{
        RowBox[{"countBlocks", "[", 
         RowBox[{"\[ScriptCapitalP]", ",", "t", ",", "inds"}], "]"}], "=", 
        RowBox[{"Module", "[", 
         RowBox[{
          RowBox[{"{", "bjl", "}"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"bjl", "=", 
            RowBox[{"Flatten", "[", 
             RowBox[{
              RowBox[{"blocks", "/@", 
               RowBox[{"Flatten", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"junctions", "[", "\[ScriptCapitalP]", "]"}], 
                  "\[LeftDoubleBracket]", 
                  RowBox[{
                   RowBox[{"t", "+", "1"}], ",", "inds"}], 
                  "\[RightDoubleBracket]"}], ",", "1"}], "]"}]}], ",", "1"}], 
             "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"Count", "[", 
              RowBox[{"bjl", ",", "#"}], "]"}], "&"}], "/@", 
            RowBox[{"allBlocks", "[", 
             RowBox[{"\[ScriptCapitalP]", ",", "t"}], "]"}]}]}]}], "]"}]}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"(*", "ancBlocks", "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"ancBlocks", "[", 
        RowBox[{"\[ScriptCapitalP]_", ",", "t_Integer"}], "]"}], ":=", 
       RowBox[{
        RowBox[{"ancBlocks", "[", 
         RowBox[{"\[ScriptCapitalP]", ",", "t"}], "]"}], "=", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"blockAnc", "[", "\[ScriptCapitalP]", "]"}], "/@", 
         RowBox[{"allBlocks", "[", 
          RowBox[{"\[ScriptCapitalP]", ",", "t"}], "]"}]}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", "intSNP", " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"intSNP", "[", 
        RowBox[{
        "\[ScriptCapitalP]_", ",", "t_Integer", ",", "tl_", ",", "rl_", ",", 
         "c_Integer"}], "]"}], ":=", 
       RowBox[{
        RowBox[{"intSNP", "[", 
         RowBox[{
         "\[ScriptCapitalP]", ",", "t", ",", "tl", ",", "rl", ",", "c"}], 
         "]"}], "=", "\[IndentingNewLine]", 
        RowBox[{"Module", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"xx", "=", 
             RowBox[{
              RowBox[{"locJ", "[", "\[ScriptCapitalP]", "]"}], "/@", 
              RowBox[{"allJunctions", "[", 
               RowBox[{"\[ScriptCapitalP]", ",", "t"}], "]"}]}]}], ",", 
            RowBox[{"pL", "=", 
             RowBox[{"polLoci", "[", 
              RowBox[{"tl", ",", "rl", ",", "c"}], "]"}]}], ",", "ps"}], 
           "}"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"ps", "=", 
            RowBox[{
             RowBox[{"posSNPInd", "[", "c", "]"}], "\[LeftDoubleBracket]", 
             RowBox[{"pL", ",", "2"}], "\[RightDoubleBracket]"}]}], ";", 
           RowBox[{"ps", "=", 
            RowBox[{
             RowBox[{
              FractionBox[
               RowBox[{"(", 
                RowBox[{"ps", "+", "1", "-", 
                 RowBox[{
                 "ps", "\[LeftDoubleBracket]", "1", 
                  "\[RightDoubleBracket]"}]}], ")"}], 
               RowBox[{
                RowBox[{"ps", "\[LeftDoubleBracket]", 
                 RowBox[{"-", "1"}], "\[RightDoubleBracket]"}], "-", 
                RowBox[{
                "ps", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
                "+", "2"}]], 
              RowBox[{"mouseMap", "[", "c", "]"}]}], "//", "N"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"Span", "[", 
              RowBox[{
               RowBox[{
                RowBox[{
                "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
                "+", "1"}], ",", 
               RowBox[{
               "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}], 
              "]"}], "&"}], "/@", 
            RowBox[{"blocks", "[", 
             RowBox[{"findPosition", "[", 
              RowBox[{"ps", ",", "xx"}], "]"}], "]"}]}]}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", "configIntervals", "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"configIntervals", "[", 
        RowBox[{"\[ScriptCapitalP]_", ",", "t_Integer"}], "]"}], ":=", 
       RowBox[{"configIntervals", "[", 
        RowBox[{"\[ScriptCapitalP]", ",", "t", ",", "All"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"configIntervals", "[", 
        RowBox[{"\[ScriptCapitalP]_", ",", "t_Integer", ",", "inds_"}], "]"}],
        ":=", 
       RowBox[{
        RowBox[{"configIntervals", "[", 
         RowBox[{"\[ScriptCapitalP]", ",", "t", ",", "inds"}], "]"}], "=", 
        "\[IndentingNewLine]", 
        RowBox[{"Module", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"aa", ",", "cb", ",", "k"}], "}"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"(*", " ", 
           RowBox[{
            RowBox[{"for", " ", "each", " ", "interval"}], ",", " ", "k", ",",
             " ", 
            RowBox[{
            "pick", " ", "the", " ", "set", " ", "of", " ", "blocks", " ", 
             "that", " ", "it", " ", "covers"}], ",", " ", 
            RowBox[{
            "and", " ", "determine", " ", "the", " ", "ancestry", " ", "and", 
             " ", "the", " ", "number", " ", "of", " ", "those", " ", 
             RowBox[{"blocks", ".", " ", "Find"}], " ", "the", " ", "union", 
             " ", "of", " ", "the", " ", "ancestries", " ", "that", " ", 
             "are", " ", "represented"}], ",", " ", 
            RowBox[{"and", " ", "for", " ", "each", " ", "of", " ", "those"}],
             ",", " ", 
            RowBox[{
            "pick", " ", "the", " ", "number", " ", "of", " ", "blocks", " ", 
             "that", " ", "carry", " ", "it"}]}], " ", "*)"}], 
          "\[IndentingNewLine]", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"(", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"aa", "=", 
               RowBox[{"Pick", "[", 
                RowBox[{
                 RowBox[{"ancBlocks", "[", 
                  RowBox[{"\[ScriptCapitalP]", ",", "t"}], "]"}], ",", 
                 RowBox[{
                  RowBox[{"overlapQ", "[", 
                   RowBox[{"\[ScriptCapitalP]", ",", "t"}], "]"}], 
                  "\[LeftDoubleBracket]", "k", "\[RightDoubleBracket]"}]}], 
                "]"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"cb", "=", 
               RowBox[{"Pick", "[", 
                RowBox[{
                 RowBox[{"countBlocks", "[", 
                  RowBox[{"\[ScriptCapitalP]", ",", "t", ",", "inds"}], "]"}],
                  ",", 
                 RowBox[{
                  RowBox[{"overlapQ", "[", 
                   RowBox[{"\[ScriptCapitalP]", ",", "t"}], "]"}], 
                  "\[LeftDoubleBracket]", "k", "\[RightDoubleBracket]"}]}], 
                "]"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{
                RowBox[{"Total", "[", 
                 RowBox[{"Pick", "[", 
                  RowBox[{"cb", ",", "aa", ",", "#"}], "]"}], "]"}], "&"}], "/@", 
               RowBox[{"Union", "[", "aa", "]"}]}]}], ")"}], ",", 
            RowBox[{"{", 
             RowBox[{"k", ",", 
              RowBox[{
               RowBox[{"numAllJunctions", "[", 
                RowBox[{"\[ScriptCapitalP]", ",", "t"}], "]"}], "-", "1"}]}], 
             "}"}]}], "]"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"configIntervalsAnc", "[", 
        RowBox[{"\[ScriptCapitalP]_", ",", "t_Integer"}], "]"}], ":=", 
       RowBox[{"configIntervalsAnc", "[", 
        RowBox[{"\[ScriptCapitalP]", ",", "t", ",", "All"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"configIntervalsAnc", "[", 
        RowBox[{"\[ScriptCapitalP]_", ",", "t_Integer", ",", "inds_"}], "]"}],
        ":=", 
       RowBox[{
        RowBox[{"configIntervalsAnc", "[", 
         RowBox[{"\[ScriptCapitalP]", ",", "t", ",", "inds"}], "]"}], "=", 
        "\[IndentingNewLine]", 
        RowBox[{"Module", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"aa", ",", "cb", ",", "k", ",", "anc", ",", 
            RowBox[{"ninds", "=", 
             RowBox[{"Length", "[", 
              RowBox[{
               RowBox[{"junctions", "[", "\[ScriptCapitalP]", "]"}], 
               "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
              "]"}]}]}], "}"}], ",", "\[IndentingNewLine]", 
          RowBox[{"(*", " ", 
           RowBox[{
            RowBox[{"for", " ", "each", " ", "interval"}], ",", " ", "k", ",",
             " ", 
            RowBox[{
            "pick", " ", "the", " ", "set", " ", "of", " ", "blocks", " ", 
             "that", " ", "it", " ", "covers"}], ",", " ", 
            RowBox[{
            "and", " ", "determine", " ", "the", " ", "ancestry", " ", "and", 
             " ", "the", " ", "number", " ", "of", " ", "those", " ", 
             RowBox[{"blocks", ".", " ", "Count"}], " ", "the", " ", "number",
              " ", "of", " ", "blocks", " ", "that", " ", "carry", " ", 
             "each", " ", "of", " ", "the", " ", "original", " ", 
             "ancestries"}], ",", " ", 
            RowBox[{
            "determined", " ", "by", " ", "2", "*", "#", " ", "individuals", 
             " ", "in", " ", "the", " ", "first", " ", 
             RowBox[{"generation", "."}]}]}], " ", "*)"}], 
          "\[IndentingNewLine]", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"(", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"aa", "=", 
               RowBox[{"Pick", "[", 
                RowBox[{
                 RowBox[{"ancBlocks", "[", 
                  RowBox[{"\[ScriptCapitalP]", ",", "t"}], "]"}], ",", 
                 RowBox[{
                  RowBox[{"overlapQ", "[", 
                   RowBox[{"\[ScriptCapitalP]", ",", "t"}], "]"}], 
                  "\[LeftDoubleBracket]", "k", "\[RightDoubleBracket]"}]}], 
                "]"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"cb", "=", 
               RowBox[{"Pick", "[", 
                RowBox[{
                 RowBox[{"countBlocks", "[", 
                  RowBox[{"\[ScriptCapitalP]", ",", "t", ",", "inds"}], "]"}],
                  ",", 
                 RowBox[{
                  RowBox[{"overlapQ", "[", 
                   RowBox[{"\[ScriptCapitalP]", ",", "t"}], "]"}], 
                  "\[LeftDoubleBracket]", "k", "\[RightDoubleBracket]"}]}], 
                "]"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{
                RowBox[{"Total", "[", 
                 RowBox[{"Pick", "[", 
                  RowBox[{"cb", ",", "aa", ",", "#"}], "]"}], "]"}], "&"}], "/@", 
               RowBox[{"Range", "[", 
                RowBox[{"2", "ninds"}], "]"}]}]}], ")"}], ",", 
            RowBox[{"{", 
             RowBox[{"k", ",", 
              RowBox[{
               RowBox[{"numAllJunctions", "[", 
                RowBox[{"\[ScriptCapitalP]", ",", "t"}], "]"}], "-", "1"}]}], 
             "}"}]}], "]"}]}], "]"}]}]}], ";"}]}], "\[IndentingNewLine]", 
    "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.7033000041222467`*^9, 3.703300007608962*^9}, {
   3.703300127652326*^9, 3.703300178301092*^9}, {3.703378065511202*^9, 
   3.7033781113361197`*^9}, 3.703378410401093*^9, {3.703378634360016*^9, 
   3.703378709037169*^9}, {3.7033799978489437`*^9, 3.703380014918939*^9}, 
   3.703380054608474*^9, {3.703380145868043*^9, 3.703380179827187*^9}, {
   3.70338027984719*^9, 3.703380331468051*^9}, {3.703380377945836*^9, 
   3.7033803987675943`*^9}, {3.703380444944488*^9, 3.703380464527323*^9}, {
   3.7033805176785*^9, 3.703380527342407*^9}, 3.703383639379836*^9, {
   3.703383859312913*^9, 3.703383860681682*^9}, {3.7033844677766743`*^9, 
   3.703384808207651*^9}, {3.703384867732483*^9, 3.70338487085115*^9}, {
   3.70338891800874*^9, 3.7033889184641438`*^9}, {3.7077366193800993`*^9, 
   3.7077366307483387`*^9}, {3.707736982208145*^9, 3.7077370556622467`*^9}, {
   3.707737206626727*^9, 3.707737218569302*^9}, {3.707821925723462*^9, 
   3.707821969555654*^9}, {3.707991354697682*^9, 3.707991501596159*^9}, {
   3.7079915612219887`*^9, 3.7079915781335917`*^9}, {3.707996302511166*^9, 
   3.707996383909918*^9}, {3.707996488610901*^9, 3.707996506531348*^9}, {
   3.708050439046918*^9, 3.708050495344067*^9}, {3.713952739137171*^9, 
   3.7139528488272877`*^9}, {3.713952922332363*^9, 3.71395296466529*^9}, {
   3.7353731038971767`*^9, 3.735373105727837*^9}, {3.735373135895691*^9, 
   3.7353731437153053`*^9}, 3.7353731851379967`*^9},
 CellLabel->
  "In[807]:=",ExpressionUUID->"1269de1c-0c79-488d-85af-8c119d2de5a2"],

Cell["This defines variables the first time:", "Text",
 CellChangeTimes->{{3.703388892052129*^9, 
  3.7033889101306353`*^9}},ExpressionUUID->"cbcc7ff0-1675-473a-becc-\
27ba05631b96"],

Cell[BoxData[
 RowBox[{
  RowBox[{"resetVariables", "[", "]"}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{3.703388882963367*^9},
 CellLabel->
  "In[496]:=",ExpressionUUID->"ab20ccc4-20c8-42d4-94cd-6346601685c4"]
}, Closed]],

Cell[CellGroupData[{

Cell["nLoci", "Subsubsection",
 CellChangeTimes->{
  3.7033838723194036`*^9},ExpressionUUID->"73fd7a1f-183b-4880-a57a-\
fdc588397049"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"nLoci", "::", "usage"}], "=", 
   "\"\<nLoci[\[ScriptCapitalP]] gives the number of loci associated with the \
simulation \[ScriptCapitalP]\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.69356916142804*^9, 3.693569205179599*^9}, 
   3.693569393295013*^9},
 CellLabel->
  "In[497]:=",ExpressionUUID->"929bac54-c8fa-48b2-878d-f0d3ac64733c"]
}, Closed]],

Cell[CellGroupData[{

Cell["nJunctions", "Subsubsection",
 CellChangeTimes->{{3.693488938974558*^9, 
  3.693488948045936*^9}},ExpressionUUID->"02e08c06-0abd-49ba-ab79-\
61e8a19051e9"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"nJunctions", "::", "usage"}], "=", 
   "\"\<nJunctions[\[ScriptCapitalP]] stores a table of the numbers of each \
junction through time; dimensions {1\[Ellipsis]numJ[\[ScriptCapitalP]]}\
\[Times]{0\[Ellipsis]time[\[ScriptCapitalP]]}\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6934889569179497`*^9, 3.6934890127792673`*^9}},
 CellLabel->
  "In[498]:=",ExpressionUUID->"486e32d9-ba09-47ac-a101-ea82890048da"]
}, Closed]],

Cell[CellGroupData[{

Cell["nMutations", "Subsubsection",
 CellChangeTimes->{{3.693488938974558*^9, 3.693488948045936*^9}, {
  3.713952095532525*^9, 
  3.713952096809758*^9}},ExpressionUUID->"a8eb7092-833f-4315-8af5-\
7fd022dbf79a"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"nMutations", "::", "usage"}], "=", 
   "\"\<nMutations[\[ScriptCapitalP]] stores a table of the numbers of each \
mutation through time; dimensions {1\[Ellipsis]numM[\[ScriptCapitalP]]}\
\[Times]{0\[Ellipsis]time[\[ScriptCapitalP]]}\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6934889569179497`*^9, 3.6934890127792673`*^9}, {
  3.713952100750511*^9, 3.713952108275008*^9}},
 CellLabel->
  "In[499]:=",ExpressionUUID->"e38510f3-325a-4272-b3d1-40af93207acf"]
}, Closed]],

Cell[CellGroupData[{

Cell["blockHap, blockLoci, blockAnc", "Subsubsection",
 CellChangeTimes->{{3.693568931637048*^9, 3.693568933092132*^9}, {
  3.693569046400441*^9, 3.693569050567759*^9}, {3.693569087358735*^9, 
  3.693569091278646*^9}},ExpressionUUID->"2543b99a-b91d-423b-be3d-\
3ecd5c003145"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"blockHap", "::", "usage"}], "=", 
    "\"\<blockHap[\[ScriptCapitalP]][{\!\(\*SubscriptBox[\(j\), \(1\)]\),\!\(\
\*SubscriptBox[\(j\), \(2\)]\)}] stores the genotype carried between \
junctions \!\(\*SubscriptBox[\(j\), \(1\)]\),\!\(\*SubscriptBox[\(j\), \(2\)]\
\). \>\""}], ";"}], " "}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"blockLoci", "::", "usage"}], "=", 
    "\"\<blockLoci[\[ScriptCapitalP]][{\!\(\*SubscriptBox[\(j\), \
\(1\)]\),\!\(\*SubscriptBox[\(j\), \(2\)]\)}] stores the loci carried between \
junctions \!\(\*SubscriptBox[\(j\), \(1\)]\),\!\(\*SubscriptBox[\(j\), \(2\)]\
\). \>\""}], ";"}], " "}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"blockAnc", "::", "usage"}], "=", 
    "\"\<blockAnc[\[ScriptCapitalP]][{\!\(\*SubscriptBox[\(j\), \(1\)]\),\!\(\
\*SubscriptBox[\(j\), \(2\)]\)}] stores the ancestry carried between \
junctions \!\(\*SubscriptBox[\(j\), \(1\)]\),\!\(\*SubscriptBox[\(j\), \(2\)]\
\). \>\""}], ";"}], " "}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.69356893673807*^9, 3.693569103495448*^9}, {
   3.693740504170759*^9, 3.6937405597204123`*^9}, {3.693740672547597*^9, 
   3.693740673244894*^9}, 3.703384827546644*^9},
 CellLabel->
  "In[500]:=",ExpressionUUID->"f77a2c91-ba3c-4bd9-8604-6c73feb6044e"]
}, Closed]],

Cell[CellGroupData[{

Cell["allJunctions", "Subsubsection",
 CellChangeTimes->{
  3.700801013601693*^9},ExpressionUUID->"21240011-80d5-410b-a998-\
983bc7d17e0a"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"allJunctions", "::", "usage"}], "=", 
    "\"\<allJunctions[\[ScriptCapitalP],t] stores all the junctions from \
generation t (indexed 0\[Ellipsis]T), ordered by their location, and \
omittting junctions that coincide. By defalt, all but one terminal junctions \
are omitted, so that there are no empty intervals. DeleteEmpties->False \
leaves in all terminal junctions, and does not store the result.\>\""}], 
   ";"}], " "}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.700801005540987*^9, 3.7008011139834433`*^9}, {
  3.7008029085808287`*^9, 3.7008029231240873`*^9}, {3.7008038561546793`*^9, 
  3.700803903945187*^9}, {3.7008040328601522`*^9, 3.700804037228094*^9}},
 CellLabel->
  "In[503]:=",ExpressionUUID->"7ff70594-8aee-47ba-9e2a-b3c476db12f6"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "allJunctions", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{"DeleteEmpties", "\[Rule]", "True"}], "}"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.700803906614208*^9, 3.700803920241427*^9}},
 CellLabel->
  "In[504]:=",ExpressionUUID->"665b1a01-6755-4470-9218-7b6bb3014b77"]
}, Closed]],

Cell[CellGroupData[{

Cell["numAllJunctions", "Subsubsection",
 CellChangeTimes->{{3.700805167691122*^9, 3.700805169498827*^9}, {
  3.700805329045781*^9, 3.7008053296607513`*^9}, {3.700810038080019*^9, 
  3.700810039319481*^9}},ExpressionUUID->"045ed200-3711-4407-827c-\
37e8353c2d96"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"numAllJunctions", "::", "usage"}], "=", 
   "\"\<numAllJunctions[\[ScriptCapitalP],t] stores the number of junctions \
in the population at generation t (indexed 0\[Ellipsis]T). By defalt, all but \
one terminal junctions are omitted, so that there are no empty intervals. \
DeleteEmpties->False leaves in all terminal junctions, and does not store the \
result.\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.700805175732305*^9, 3.700805249881454*^9}, {
   3.700805332768695*^9, 3.700805342118935*^9}, {3.7008100432163877`*^9, 
   3.70081006461381*^9}, 3.700810113301959*^9},
 CellLabel->
  "In[505]:=",ExpressionUUID->"eb61efa2-fbf0-4e74-8200-0858affe7823"]
}, Closed]],

Cell[CellGroupData[{

Cell["allMutations", "Subsubsection",
 CellChangeTimes->{
  3.700801013601693*^9, {3.7139514504860764`*^9, 
   3.713951451893833*^9}},ExpressionUUID->"a8bf8621-bfac-43c6-a1fc-\
9ca387a35c1f"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"allMutations", "::", "usage"}], "=", 
    "\"\<allMutations[\[ScriptCapitalP],t] stores all the mutations from \
generation t (indexed 0\[Ellipsis]T), ordered by their location. \>\""}], 
   ";"}], " "}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.700801005540987*^9, 3.7008011139834433`*^9}, {
  3.7008029085808287`*^9, 3.7008029231240873`*^9}, {3.7008038561546793`*^9, 
  3.700803903945187*^9}, {3.7008040328601522`*^9, 3.700804037228094*^9}, {
  3.713951514863614*^9, 3.713951541610243*^9}},
 CellLabel->
  "In[506]:=",ExpressionUUID->"b68642d9-d805-4db2-824b-bdd7a7b3e1dd"]
}, Closed]],

Cell[CellGroupData[{

Cell["numAllMutations", "Subsubsection",
 CellChangeTimes->{{3.700805167691122*^9, 3.700805169498827*^9}, {
  3.700805329045781*^9, 3.7008053296607513`*^9}, {3.700810038080019*^9, 
  3.700810039319481*^9}, {3.71395145792035*^9, 
  3.713951464245119*^9}},ExpressionUUID->"264140a4-ba4d-427a-b8e9-\
8bc03ea47a9a"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"numAllMutations", "::", "usage"}], "=", 
   "\"\<numAllMutations[\[ScriptCapitalP],t] stores the number of mutations \
in the population at generation t (indexed 0\[Ellipsis]T).\>\""}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.700805175732305*^9, 3.700805249881454*^9}, {
   3.700805332768695*^9, 3.700805342118935*^9}, {3.7008100432163877`*^9, 
   3.70081006461381*^9}, 3.700810113301959*^9, {3.7139514773756123`*^9, 
   3.713951502219378*^9}},
 CellLabel->
  "In[507]:=",ExpressionUUID->"b5a32e53-5529-446f-a91c-3362de400dcd"]
}, Closed]],

Cell[CellGroupData[{

Cell["overlapQ", "Subsubsection",
 CellChangeTimes->{
  3.700810173258719*^9},ExpressionUUID->"4d703ce8-32af-4ef0-996c-\
e2551c031080"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"overlapQ", "::", "usage"}], "=", 
   "\"\<overlapQ[\[ScriptCapitalP],t] stores a Boolean sparse array \
{(numAllJunctions[\[ScriptCapitalP],t]-1) \[Times] numAllBlocks[\
\[ScriptCapitalP],t]} that specifies whether a block overlaps with an \
interval. Generations are indexed 0\[Ellipsis]T.\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.700810174869886*^9, 3.700810317557725*^9}},
 CellLabel->
  "In[508]:=",ExpressionUUID->"6ce4e31b-05d0-472e-8dcb-45677adf54cf"]
}, Closed]],

Cell[CellGroupData[{

Cell["ancBlocks", "Subsubsection",
 CellChangeTimes->{{3.700815479212977*^9, 3.70081548130891*^9}, {
  3.700816183796269*^9, 
  3.7008161845339823`*^9}},ExpressionUUID->"bffe4a49-4f9f-4bfc-a2a5-\
5657e1910541"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"ancBlocks", "::", "usage"}], "=", 
   "\"\<ancBlocks[\[ScriptCapitalP],t] stores the ancestry of each of the \
blocks in the population at time t. \>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.700815485155686*^9, 3.7008155445391073`*^9}, {
  3.700816187667882*^9, 3.700816196099812*^9}},
 CellLabel->
  "In[509]:=",ExpressionUUID->"25196203-46af-4c0f-beaa-b2ce3ebc9b20"]
}, Closed]],

Cell[CellGroupData[{

Cell["configIntervals", "Subsubsection",
 CellChangeTimes->{{3.700816534894928*^9, 
  3.700816548941704*^9}},ExpressionUUID->"a83b0fe5-15bc-4079-8b6a-\
5e65750ccaf5"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"configIntervals", "::", "usage"}], "=", 
   "\"\<configIntervals[\[ScriptCapitalP],t] stores the configuration of all \
intervals, as defined by allJunctions[\[ScriptCapitalP],t]. configIntervals[\
\[ScriptCapitalP],t,inds] counts over the specified individuals.  \>\""}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.7008165528033247`*^9, 3.700816560491542*^9}, {
  3.700816707264884*^9, 3.700816758775313*^9}, {3.70081884623917*^9, 
  3.70081885806991*^9}, {3.701337597479889*^9, 3.70133763570107*^9}, {
  3.7079919938576803`*^9, 3.707991994904739*^9}},
 CellLabel->
  "In[510]:=",ExpressionUUID->"666b4193-21ba-4701-887e-c6c5f10aa7fc"],

Cell[TextData[{
 StyleBox["Note",
  FontWeight->"Bold"],
 ": I had previously sorted the configuration. However, that meant that it \
could not be compared between different choices of individuals. Now, the \
count is over all blocks represented in the individual, which is determined \
by the entire population."
}], "Text",
 CellChangeTimes->{{3.701337639533634*^9, 3.70133769739502*^9}, 
   3.701421932385474*^9},ExpressionUUID->"5285eafe-e062-4959-b1a9-\
705720bdac74"]
}, Closed]],

Cell[CellGroupData[{

Cell["configIntervalsAnc", "Subsubsection",
 CellChangeTimes->{{3.700816534894928*^9, 3.700816548941704*^9}, {
  3.707992180832075*^9, 
  3.707992181439107*^9}},ExpressionUUID->"40f62642-95d9-441d-9a5a-\
fc1f4ce65ec8"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"configIntervalsAnc", "::", "usage"}], "=", 
   "\"\<configIntervalsAnc[\[ScriptCapitalP],t] stores the number of copies \
of each ancestry in all intervals, as defined by allJunctions[\
\[ScriptCapitalP],t]. configIntervalsAnc[\[ScriptCapitalP],t,inds] counts the \
number over the specified individuals in the current population. Each row is \
a list 1\[Ellipsis]2N, since there were 2N original ancestries. The number of \
ancestries is twice the number of individuals in the \!\(\*StyleBox[\"initial\
\",FontSlant->\"Italic\"]\) population, 2\[Times]Length[junctions[\
\[ScriptCapitalP]]\[LeftDoubleBracket]1\[RightDoubleBracket]]\>\""}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.7008165528033247`*^9, 3.700816560491542*^9}, {
  3.700816707264884*^9, 3.700816758775313*^9}, {3.70081884623917*^9, 
  3.70081885806991*^9}, {3.701337597479889*^9, 3.70133763570107*^9}, {
  3.707991950258882*^9, 3.707991957334498*^9}, {3.7079919971280527`*^9, 
  3.707992072904812*^9}, {3.708050643927802*^9, 3.708050712693244*^9}},
 CellLabel->
  "In[511]:=",ExpressionUUID->"729a3fbc-a045-416b-b0f1-6b9d46638365"]
}, Closed]],

Cell[CellGroupData[{

Cell["intList", "Subsubsection",
 CellChangeTimes->{{3.701421541648098*^9, 
  3.7014215428391027`*^9}},ExpressionUUID->"bffe447b-9351-4cbb-a583-\
19bd4974c7ee"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"intList", "::", "usage"}], "=", 
    "\"\<intList[\[ScriptCapitalP],t,n] stores a list {1;;\!\(\*SubscriptBox[\
\(j\), \(1\)]\),\[Ellipsis],\!\(\*SubscriptBox[\(j\), \(n - \
1\)]\);;\!\(\*SubscriptBox[\(j\), \(n\)]\)} that defines which intervals fall \
within n equal-sized windows. \
intList[\[ScriptCapitalP],t,{{\!\(\*SubscriptBox[\(x\), \
\(1\)]\),\!\(\*SubscriptBox[\(x\), \(2\)]\)},\[Ellipsis]}] lists intervals \
that fall within a set of (possibly overlapping) windows, defined by the {{\!\
\(\*SubscriptBox[\(x\), \(1\)]\),\!\(\*SubscriptBox[\(x\), \(2\)]\)},\
\[Ellipsis]}.\>\""}], ";"}], " "}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.701421546709248*^9, 3.701421570118881*^9}, {
  3.7014216562687674`*^9, 3.701421700086528*^9}, {3.701421734702599*^9, 
  3.70142177735874*^9}, {3.701421942201771*^9, 3.70142197441521*^9}, {
  3.70773647407485*^9, 3.70773652729725*^9}, {3.7077960197321367`*^9, 
  3.7077960310169897`*^9}, {3.7079662692906837`*^9, 3.707966278552533*^9}},
 CellLabel->
  "In[512]:=",ExpressionUUID->"97d2ee09-24af-4d5f-b4b5-b6e5d709d5c9"]
}, Closed]],

Cell[CellGroupData[{

Cell["allBlocks", "Subsubsection",
 CellChangeTimes->{{3.700805167691122*^9, 
  3.700805169498827*^9}},ExpressionUUID->"cf0e2709-645f-42e4-b082-\
eef1dce8805a"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"allBlocks", "::", "usage"}], "=", 
   "\"\<allBlocks[\[ScriptCapitalP],t] stores all the blocks in the \
population at generation t (indexed 0\[Ellipsis]T). \>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.700805175732305*^9, 3.700805249881454*^9}},
 CellLabel->
  "In[513]:=",ExpressionUUID->"dbf310cc-89b8-4270-a3df-f152e380efdf"]
}, Closed]],

Cell[CellGroupData[{

Cell["numAllBlocks", "Subsubsection",
 CellChangeTimes->{{3.700805167691122*^9, 3.700805169498827*^9}, {
  3.700805329045781*^9, 
  3.7008053296607513`*^9}},ExpressionUUID->"6f16e77b-c3de-4b06-8c24-\
2c2caf55d9c1"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"numAllBlocks", "::", "usage"}], "=", 
   "\"\<numAllBlocks[\[ScriptCapitalP],t] stores the number of blocks in the \
population at generation t (indexed 0\[Ellipsis]T). \>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.700805175732305*^9, 3.700805249881454*^9}, {
  3.700805332768695*^9, 3.700805342118935*^9}},
 CellLabel->
  "In[514]:=",ExpressionUUID->"11a39ae8-e5a8-4b39-b345-dc402c4b20f5"]
}, Closed]],

Cell[CellGroupData[{

Cell["findJunctions", "Subsubsection",
 CellChangeTimes->{{3.70080016161806*^9, 3.700800176401363*^9}, 
   3.700800378913906*^9, {3.700804754144888*^9, 
   3.700804754609632*^9}},ExpressionUUID->"04120d88-9a48-4d9f-8c52-\
ef187bc23c29"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"findJunctions", "::", "usage"}], "=", 
   "\"\<findJunctions[\[ScriptCapitalP],t] stores a function that finds the \
left and right junctions of each block. findJunctions[\[ScriptCapitalP],t][x] \
returns the \
\!\(\*StyleBox[\"index\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)of\!\(\*StyleBox[\" \",FontSlant->\"Plain\"]\)\!\(\
\*StyleBox[\"the\",FontSlant->\"Plain\"]\)\!\(\*StyleBox[\" \
\",FontSlant->\"Plain\"]\)\!\(\*StyleBox[\"junction\",FontSlant->\"Plain\"]\)\
\!\(\*StyleBox[\" \",FontSlant->\"Plain\"]\)\!\(\*StyleBox[\"at\",FontSlant->\
\"Plain\"]\)\!\(\*StyleBox[\" \
\",FontSlant->\"Plain\"]\)\!\(\*StyleBox[\"x\",FontSlant->\"Plain\"]\)\!\(\*\
StyleBox[\";\",FontSlant->\"Plain\"]\)\!\(\*StyleBox[\" \",FontSlant->\"Plain\
\"]\)findJunctions[\[ScriptCapitalP],t][{\!\(\*SubscriptBox[\(x\), \
\(1\)]\),\!\(\*SubscriptBox[\(x\), \(2\)]\),\[Ellipsis]}] returns a list of \
the junctions, in the form {{\!\(\*SubscriptBox[\(i\), \
\(1\)]\)},{\!\(\*SubscriptBox[\(i\), \(2\)]\)},\[Ellipsis]}. t is numbered 0\
\[Ellipsis]T\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.700800180291156*^9, 3.7008003333560143`*^9}, {
  3.700800366771482*^9, 3.70080037989002*^9}, {3.7008044408442802`*^9, 
  3.700804490852265*^9}, {3.700804585329077*^9, 3.7008046228556957`*^9}, {
  3.7008047579342327`*^9, 3.700804764371003*^9}, {3.731989773107204*^9, 
  3.731989773846601*^9}},
 CellLabel->
  "In[515]:=",ExpressionUUID->"c532989c-519c-4ce3-9982-2f3005a1fca4"]
}, Closed]],

Cell[CellGroupData[{

Cell["countBlocks", "Subsubsection",
 CellChangeTimes->{{3.700815479212977*^9, 
  3.70081548130891*^9}},ExpressionUUID->"e31449ba-c145-4b08-87b0-\
f715e3d6b8f7"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"countBlocks", "::", "usage"}], "=", 
   "\"\<countBlocks[\[ScriptCapitalP],t] stores the numbers of copies of each \
of the blocks in the population at time t. \
countBlocks[\[ScriptCapitalP],t,1;;k] only counts over diploid individuals \
1;;k or{1,\[Ellipsis]}\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.700815485155686*^9, 3.7008155445391073`*^9}, {
  3.700818685059371*^9, 3.700818736099341*^9}, {3.700818805017042*^9, 
  3.7008188096487293`*^9}},
 CellLabel->
  "In[516]:=",ExpressionUUID->"80a8a0ca-e66f-4c8d-b716-39b718265a7f"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Global variables", "Subsection",
 CellChangeTimes->{{3.703383439604804*^9, 3.703383443930593*^9}, 
   3.703384240436857*^9},ExpressionUUID->"d6aaeb70-490f-4a75-bbca-\
257f92285ad2"],

Cell[CellGroupData[{

Cell["globalVariables", "Subsubsection",
 CellChangeTimes->{{3.700709008142619*^9, 
  3.7007090108507442`*^9}},ExpressionUUID->"143a55d5-31c9-4f89-9a63-\
cb337751d66c"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"globalVariables", "::", "usage"}], "=", 
   "\"\<globalVariables[] lists the global variables associated with \
simulation \[ScriptCapitalP]. Actually, this is not any use, except as \
documentation \[Ellipsis]\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.7007090146414957`*^9, 3.70070906886495*^9}, {
  3.700709654886117*^9, 3.7007096606923027`*^9}, {3.703379519463359*^9, 
  3.7033795260708942`*^9}, {3.703382797609044*^9, 3.703382802415752*^9}, {
  3.703383919060775*^9, 3.703383945497734*^9}},
 CellLabel->
  "In[517]:=",ExpressionUUID->"6f286f93-d55e-420b-bd93-0d00db721da3"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"globalVariables", "[", "]"}], ":=", 
   RowBox[{"{", 
    RowBox[{
    "time", ",", "pedigreeList", ",", "pop", ",", "mapLength", ",", 
     "junctions", ",", "locJ", ",", "numJ", ",", "originJ", ",", "hapJ", ",", 
     "mutations", ",", "locM", ",", "numM", ",", "originM", ",", "zInf", ",", 
     "zEnv", ",", "zChrom", ",", "zKids", ",", "F", ",", "allelicEffects", 
     ",", "intSNP"}], "}"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.700709248506345*^9, 3.700709292047057*^9}, {
   3.703383899901376*^9, 3.703383902835759*^9}, {3.703383949026023*^9, 
   3.703383987426103*^9}, 3.703384366832449*^9, {3.710235715803959*^9, 
   3.710235718609584*^9}, {3.735373075947139*^9, 3.73537307793716*^9}},
 CellLabel->
  "In[805]:=",ExpressionUUID->"ce3bbf20-b148-496d-9f8e-e76c98872927"]
}, Open  ]],

Cell[CellGroupData[{

Cell["clearGlobalVariables", "Subsubsection",
 CellChangeTimes->{{3.703378133502965*^9, 3.703378135695229*^9}, 
   3.703383137887472*^9},ExpressionUUID->"9d84c643-2a95-402c-98ad-\
54ef15bc299f"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"clearGlobalVariables", "::", "usage"}], "=", 
   "\"\<clearGlobalVariables[] clears {time, pedigreeList, pop,  mapLength, \
junctions, locJ, numJ, originJ, hapJ, mutations, locM, numM, originM, zInf,z \
Env, zChrom, zKids, F, allelicEffects,intSNP}. Needs to be called, with \
resetVariables[], when simulation data are loaded. \>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.7033781406656446`*^9, 3.703378169590314*^9}, {
   3.703378213943871*^9, 3.7033782656370707`*^9}, {3.7033801980709743`*^9, 
   3.7033802118120403`*^9}, {3.7033840143584003`*^9, 3.703384020639817*^9}, {
   3.7033841049209957`*^9, 3.703384106095785*^9}, 3.703384370831627*^9, {
   3.710415095523432*^9, 3.7104151003214607`*^9}, {3.735373065188096*^9, 
   3.735373066921879*^9}},ExpressionUUID->"7fe94f8a-38a7-41ac-af23-\
32b539f886c2"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"clearGlobalVariables", "[", "]"}], ":=", 
   RowBox[{"Clear", "@@", 
    RowBox[{"globalVariables", "[", "]"}]}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.7033782868490562`*^9, 3.703378295465322*^9}, 
   3.70337843203008*^9, {3.703384109083263*^9, 3.703384117489244*^9}},
 CellLabel->
  "In[806]:=",ExpressionUUID->"c52984f9-afe5-43e4-b4e0-31ad8f99e3e3"]
}, Open  ]],

Cell[CellGroupData[{

Cell["pedigreeList", "Subsubsection",
 CellChangeTimes->{{3.700709114096797*^9, 
  3.7007091169114447`*^9}},ExpressionUUID->"276b447a-f52e-4493-8577-\
488485199048"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"pedigreeList", "::", "usage"}], "=", 
   "\"\<pedigreeList[\[ScriptCapitalP]] is the list of pedigree matrices used \
by the simulation. It is defined when iterateDiploidNew is called to iterate \
the whole simulation\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.7007091215650578`*^9, 3.700709186649941*^9}},
 CellLabel->
  "In[521]:=",ExpressionUUID->"410af89d-3858-4253-b2be-82da087811c3"]
}, Closed]],

Cell[CellGroupData[{

Cell["time, numJ, mapLength", "Subsubsection",
 CellChangeTimes->{{3.69328166710133*^9, 3.693281687309017*^9}, {
   3.6933766434232883`*^9, 3.693376669725082*^9}, {3.693569156309729*^9, 
   3.693569168410956*^9}, {3.693569210362507*^9, 3.693569221249922*^9}, 
   3.7033838498219023`*^9},ExpressionUUID->"b62b63df-a7f4-4600-91e7-\
e066ca861011"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"time", "::", "usage"}], "=", 
   "\"\<time[\[ScriptCapitalP]] gives the time spanned by simulation \
\[ScriptCapitalP]; pop[\[ScriptCapitalP]], junctions[\[ScriptCapitalP]], \
zInf[\[ScriptCapitalP]], F[\[ScriptCapitalP]] run from 0,\[Ellipsis],time[\
\[ScriptCapitalP]]\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6932816930765543`*^9, 3.693281721044417*^9}, {
  3.693282650287306*^9, 3.693282705252562*^9}},
 CellLabel->
  "In[522]:=",ExpressionUUID->"dc5484bb-de3f-4240-862d-3fd9fe45a9bf"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"numJ", "::", "usage"}], "=", 
   "\"\<numJ[\[ScriptCapitalP]] lists the number of junctions.\>\""}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6932816930765543`*^9, 3.693281721044417*^9}, {
  3.693282650287306*^9, 3.693282705252562*^9}, {3.693376678273451*^9, 
  3.6933767012898006`*^9}, {3.693376769786002*^9, 3.693376770416347*^9}, {
  3.693461780609065*^9, 3.6934617835918293`*^9}},
 CellLabel->
  "In[523]:=",ExpressionUUID->"1f91250e-86f4-4934-b92b-8a91ea950948"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"mapLength", "::", "usage"}], "=", 
   "\"\<mapLength[\[ScriptCapitalP]] gives the number of loci associated with \
the simulation \[ScriptCapitalP]\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.69356916142804*^9, 3.693569237970098*^9}, 
   3.693569395765977*^9},
 CellLabel->
  "In[524]:=",ExpressionUUID->"ff46e2e6-47e2-4e81-8dbd-589ec635c48d"]
}, Closed]],

Cell[CellGroupData[{

Cell["\<\
pop,  junctions, zInf, zEnv, zChrom, F, zKids, numM, mutations, allelicEffects\
\>", "Subsubsection",
 CellChangeTimes->{{3.693282618639433*^9, 3.693282627478154*^9}, 
   3.6932833550309668`*^9, 3.6933733445613937`*^9, {3.6983114846892157`*^9, 
   3.698311487121583*^9}, {3.698386314082782*^9, 3.698386314908654*^9}, {
   3.698837274109086*^9, 3.69883727820487*^9}, {3.700632199819121*^9, 
   3.700632203771353*^9}, {3.700642501587432*^9, 3.70064251118528*^9}, 
   3.700642562865128*^9, 3.700705113531098*^9, {3.710235761369686*^9, 
   3.710235764192131*^9}},ExpressionUUID->"b8e9cfa3-0db9-47f0-8bc9-\
8ebb831c101f"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"pop", "::", "usage"}], "=", 
   "\"\<pop[\[ScriptCapitalP]] lists diploid genotypes, labelled 0 or 1, for \
simulation \[ScriptCapitalP], as an array with dimension \
{T+1,\!\(\*SubscriptBox[\(n\), \(Inds\)]\),2,\!\(\*SubscriptBox[\(n\), \(loci\
\)]\)}\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6932816930765543`*^9, 3.693281721044417*^9}, {
   3.693282634007905*^9, 3.693282636918333*^9}, {3.693282718166903*^9, 
   3.6932828474810953`*^9}, 3.6983863337330427`*^9},
 CellLabel->
  "In[525]:=",ExpressionUUID->"0551d313-b1cf-479a-8acb-6c1cddc52467"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"junctions", "::", "usage"}], "=", 
   "\"\<junctions[\[ScriptCapitalP]] represents continuous diploid genomes \
for simulation \[ScriptCapitalP], as an array with dimension \
{T+1,\!\(\*SubscriptBox[\(n\), \(Inds\)]\),2}. Each haploid genome is a list \
of junctions, whose properties are held in the functions locJ[\
\[ScriptCapitalP]], locJ[\[ScriptCapitalP]], hapJ[\[ScriptCapitalP]], \
originJ[\[ScriptCapitalP]]. Initially, there are dummy junctions at locations \
0,R with the initial haplotype. \>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6932816930765543`*^9, 3.693281721044417*^9}, {
  3.693282634007905*^9, 3.693282636918333*^9}, {3.693282718166903*^9, 
  3.6932829043036747`*^9}, {3.693283385019549*^9, 3.693283389627244*^9}, {
  3.693373377170763*^9, 3.6933734691694603`*^9}, {3.693395121486597*^9, 
  3.69339512360494*^9}},
 CellLabel->
  "In[526]:=",ExpressionUUID->"d7b4ef2e-cc64-4ef8-96a1-2ed94502076b"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"zInf", "::", "usage"}], "=", 
   "\"\<zInf[\[ScriptCapitalP]] lists the infinitesimal background of each \
diploid individual, in each generation.\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6932816930765543`*^9, 3.693281721044417*^9}, {
  3.693282634007905*^9, 3.693282636918333*^9}, {3.693282718166903*^9, 
  3.6932829043036747`*^9}, {3.693283385019549*^9, 3.693283389627244*^9}, {
  3.693373377170763*^9, 3.693373513096257*^9}},
 CellLabel->
  "In[527]:=",ExpressionUUID->"59fe7b68-0d56-4763-9ffa-319b68445208"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"zChrom", "::", "usage"}], "=", 
   "\"\<zChrom[\[ScriptCapitalP]] lists the chromosomal contribution to each \
diploid individual, in each generation; can be calculated from the discrete \
diploid genotype.\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6932816930765543`*^9, 3.693281721044417*^9}, {
  3.693282634007905*^9, 3.693282636918333*^9}, {3.693282718166903*^9, 
  3.6932829043036747`*^9}, {3.693283385019549*^9, 3.693283389627244*^9}, {
  3.693373377170763*^9, 3.693373513096257*^9}, {3.698833146076934*^9, 
  3.698833179370099*^9}},
 CellLabel->
  "In[528]:=",ExpressionUUID->"b81f2b0a-d7f8-4c65-8aee-3d93e12159d6"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"zEnv", "::", "usage"}], "=", 
   "\"\<zEnv[\[ScriptCapitalP]] lists the non-genetic component of each \
diploid individual, in each generation.\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6932816930765543`*^9, 3.693281721044417*^9}, {
  3.693282634007905*^9, 3.693282636918333*^9}, {3.693282718166903*^9, 
  3.6932829043036747`*^9}, {3.693283385019549*^9, 3.693283389627244*^9}, {
  3.693373377170763*^9, 3.693373513096257*^9}, {3.698386307815708*^9, 
  3.6983863261167192`*^9}},
 CellLabel->
  "In[529]:=",ExpressionUUID->"f90d6789-5125-490b-b147-c64680504ce9"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"F", "::", "usage"}], "=", 
   "\"\<F[\[ScriptCapitalP]] lists the identity between distinct genes within \
each diploid individual, in each generation of \[ScriptCapitalP].\>\""}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6932816930765543`*^9, 3.693281721044417*^9}, {
  3.693282634007905*^9, 3.693282636918333*^9}, {3.693282718166903*^9, 
  3.6932829043036747`*^9}, {3.693283385019549*^9, 3.693283389627244*^9}, {
  3.693373377170763*^9, 3.693373551395698*^9}},
 CellLabel->
  "In[530]:=",ExpressionUUID->"250ef114-ce7d-47c8-963c-21b8dd8fb041"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"zKids", "::", "usage"}], "=", 
   "\"\<zKids[\[ScriptCapitalP]] lists the phenotypes of all sons and \
daughters, for each distinct family.  Has the form \
{{{\!\(\*SubscriptBox[\(s\), \(1, 1\)]\),\[Ellipsis]},{\!\(\*SubscriptBox[\(d\
\), \(1, 1\)]\),\[Ellipsis]}},\[Ellipsis]}\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.698311493498413*^9, 3.698311586551663*^9}, {
  3.698833122231368*^9, 3.698833123196501*^9}},
 CellLabel->
  "In[531]:=",ExpressionUUID->"2a5a30db-7743-43dc-b5c2-b1d93e3a5b8c"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"mutations", "::", "usage"}], "=", 
   "\"\<mutations[\[ScriptCapitalP]] lists the mutations carried on each \
chromosome\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.700632212999292*^9, 3.700632237416781*^9}},
 CellLabel->
  "In[532]:=",ExpressionUUID->"2a6d51d6-2fb4-4510-8053-8aee8dd7a97f"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"numM", "::", "usage"}], "=", 
   "\"\<numM[\[ScriptCapitalP]] is the total number of mutations\>\""}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.7006425220106916`*^9, 3.700642539488428*^9}},
 CellLabel->
  "In[533]:=",ExpressionUUID->"95dab8f6-a4b1-4bb1-8038-c813feb387ac"],

Cell["\<\
Note that allelicEffects[\[ScriptCapitalP]] makes sense only as a parameter \
for a fitness function that is supplied to iterateDiploidNew. However, that \
fitness function might change from generation to generation, so I do not \
store it separately.\
\>", "Text",
 CellChangeTimes->{{3.7102357819925213`*^9, 3.710235823638064*^9}, {
  3.7102360544227343`*^9, 
  3.710236085500141*^9}},ExpressionUUID->"3dc504f8-ff1e-40a1-a871-\
33312d83e0ea"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"allelicEffects", "::", "usage"}], "=", 
   "\"\<allelicEffects[\[ScriptCapitalP]] gives the allelic effects for \
simulation \[ScriptCapitalP]\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.710232807912622*^9, 3.710232867101322*^9}},
 CellLabel->
  "In[534]:=",ExpressionUUID->"05721fb5-c06a-418b-bca3-c8c82e06a015"]
}, Closed]],

Cell[CellGroupData[{

Cell["locJ, hapJ, originJ", "Subsubsection",
 CellChangeTimes->{{3.69328113018575*^9, 3.693281136880308*^9}, {
   3.6932811773354807`*^9, 3.693281183951375*^9}, {3.6932832991185083`*^9, 
   3.693283309468834*^9}, 3.693283350854587*^9, {3.693367656848954*^9, 
   3.6933676585612507`*^9}},ExpressionUUID->"81a1ae01-2e5d-4971-82f5-\
05bcc2791be2"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"locJ", "::", "usage"}], "=", 
   "\"\<locJ[\[ScriptCapitalP]][j] stores the location of junction j;  \
\[ScriptCapitalP] labels the simulation.\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.693281186135442*^9, 3.6932812170388947`*^9}, {
  3.693281481939859*^9, 3.69328150736922*^9}, {3.693367550446739*^9, 
  3.693367555692169*^9}, {3.6933676663150177`*^9, 3.6933676818050747`*^9}},
 CellLabel->
  "In[535]:=",ExpressionUUID->"6d07918b-ae31-4f9e-b1c0-d596486359d7"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"hapJ", "::", "usage"}], "=", 
   "\"\<hapJ[\[ScriptCapitalP]][j] stores the haplotypes {\!\(\*SubscriptBox[\
\(h\), \(L\)]\),\!\(\*SubscriptBox[\(h\), \(R\)]\)} that flank junction j;  \
\[ScriptCapitalP] labels the simulation.\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.693281186135442*^9, 3.6932812170388947`*^9}, {
  3.693281481939859*^9, 3.69328150736922*^9}, {3.693367550446739*^9, 
  3.693367555692169*^9}},
 CellLabel->
  "In[536]:=",ExpressionUUID->"bed5e5b1-36ac-4b1b-8468-58280d2bc6d5"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"originJ", "::", "usage"}], "=", 
   "\"\<originJ[\[ScriptCapitalP]][j] stores the time of origin of junction \
x;  \[ScriptCapitalP] labels the simulation.\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.693281186135442*^9, 3.6932812170388947`*^9}, {
   3.693281481939859*^9, 3.6932815507365017`*^9}, 3.693367553244995*^9},
 CellLabel->
  "In[537]:=",ExpressionUUID->"05ae1e75-b5c2-4b72-a710-878ffdb70d30"]
}, Closed]],

Cell[CellGroupData[{

Cell["locM, originM", "Subsubsection",
 CellChangeTimes->{{3.69328113018575*^9, 3.693281136880308*^9}, {
   3.6932811773354807`*^9, 3.693281183951375*^9}, {3.6932832991185083`*^9, 
   3.693283309468834*^9}, 3.693283350854587*^9, {3.693367656848954*^9, 
   3.6933676585612507`*^9}, {3.700705150417035*^9, 3.700705154472094*^9}, 
   3.7007063877197647`*^9},ExpressionUUID->"b0965356-6834-4d11-bd6a-\
e29541f00141"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"locM", "::", "usage"}], "=", 
   "\"\<locM[\[ScriptCapitalP]][j] stores the location of mutation j;  \
\[ScriptCapitalP] labels the simulation.\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.693281186135442*^9, 3.6932812170388947`*^9}, {
  3.693281481939859*^9, 3.69328150736922*^9}, {3.693367550446739*^9, 
  3.693367555692169*^9}, {3.6933676663150177`*^9, 3.6933676818050747`*^9}, {
  3.700705141474703*^9, 3.700705147736989*^9}},
 CellLabel->
  "In[538]:=",ExpressionUUID->"64880ae9-65f5-42a6-9ef0-a17f78a2d4cf"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"originM", "::", "usage"}], "=", 
   "\"\<originM[\[ScriptCapitalP]][j] stores the time of origin of mutation \
j;  \[ScriptCapitalP] labels the simulation.\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.693281186135442*^9, 3.6932812170388947`*^9}, {
   3.693281481939859*^9, 3.6932815507365017`*^9}, 3.693367553244995*^9, {
   3.700705161937668*^9, 3.700705164729765*^9}, {3.700705686093261*^9, 
   3.7007056891720467`*^9}},
 CellLabel->
  "In[539]:=",ExpressionUUID->"a25ad287-d246-4c35-bd50-1a0a85ead914"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Problematic functions", "Subsection",
 CellChangeTimes->{{3.700806541177853*^9, 
  3.700806544401699*^9}},ExpressionUUID->"56a34f8b-daf3-4681-a8ac-\
2713c5286b30"],

Cell["\<\
These functions are used in the mouse project, and work - but they are too \
inefficient for the larger Antirrhinum simulations. I may also have broken \
them while trying to improve efficiency... \
\>", "Text",
 CellChangeTimes->{{3.700815261509098*^9, 
  3.700815313219533*^9}},ExpressionUUID->"a7b91c98-d060-46b0-a9f5-\
9ca076700e8d"],

Cell[CellGroupData[{

Cell["blockLociAll", "Subsubsection",
 CellChangeTimes->{{3.700037999076483*^9, 
  3.700038034811389*^9}},ExpressionUUID->"56c09d71-cfff-411d-a285-\
64b2991816ac"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"blockLociAll", "::", "usage"}], "=", 
   "\"\<blockLociAll[\[ScriptCapitalP],{{\!\(\*SubscriptBox[\(j\), \(1, \
1\)]\),\[Ellipsis]},\[Ellipsis]}] lists the locations of all the intervals in \
the population {{\!\(\*SubscriptBox[\(j\), \(1, 1\)]\),\[Ellipsis]},\
\[Ellipsis]}. DeleteEmpties->True excludes empty terminal intervals \
{0,0},{R,R}. blockLociAll[\[ScriptCapitalP],t] stores the ancestry for \
generation t, numbered 0\[Ellipsis]T. Interval->{\!\(\*SubscriptBox[\(x\), \
\(0\)]\),\!\(\*SubscriptBox[\(x\), \(1\)]\)} selects those intervals that \
fall into the interval\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.700032928042591*^9, 3.7000330221674337`*^9}, {
   3.700033102943591*^9, 3.700033115357913*^9}, {3.700033636785427*^9, 
   3.7000337284489393`*^9}, {3.700033999009716*^9, 3.7000340113853807`*^9}, {
   3.700035455387734*^9, 3.700035486291353*^9}, 3.7000378334032383`*^9, {
   3.700038045433783*^9, 3.700038080633823*^9}, {3.700043416695251*^9, 
   3.700043445112937*^9}, {3.70004367791538*^9, 3.7000437263599663`*^9}, {
   3.700044833277781*^9, 3.700044841488319*^9}, {3.700046381529064*^9, 
   3.700046386325472*^9}, {3.700731555283968*^9, 3.7007315771796837`*^9}, {
   3.7007316724779997`*^9, 3.7007316844524107`*^9}},
 CellLabel->
  "In[540]:=",ExpressionUUID->"a11183d3-9e67-4767-b1c9-92a82e94c53c"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"DeleteEmpties", "::", "usage"}], "=", 
   "\"\<DeleteEmpties is an option for blockLociAll and blockAncOverlap that \
deletes empty terminal intervals\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.700043758047785*^9, 3.700043782317841*^9}, {
  3.700044489816317*^9, 3.700044504158289*^9}},
 CellLabel->
  "In[541]:=",ExpressionUUID->"3fb5ed94-eeb0-4a9e-84ce-7037bde27f75"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "blockLociAll", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"DeleteEmpties", "\[Rule]", "False"}], ",", 
     RowBox[{"Interval", "\[Rule]", "All"}]}], "}"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.700043729177438*^9, 3.700043754238887*^9}, {
  3.700044714792095*^9, 3.700044715694508*^9}, {3.700732113447496*^9, 
  3.7007321166802187`*^9}},
 CellLabel->
  "In[542]:=",ExpressionUUID->"e9129431-b0bc-4c5e-918b-5375a25610e3"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"blockLociAll", "[", 
    RowBox[{"\[ScriptCapitalP]_", ",", 
     RowBox[{"jl", ":", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", "___Integer", "}"}], "..."}], "}"}]}], ",", 
     "opts___Rule"}], "]"}], ":=", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"bb", ",", "sjl", ",", 
       RowBox[{"fjl", "=", 
        RowBox[{"Union", "[", 
         RowBox[{"Flatten", "[", "jl", "]"}], "]"}]}], ",", 
       RowBox[{"int", "=", 
        RowBox[{
         RowBox[{"Interval", "/.", 
          RowBox[{"{", "opts", "}"}]}], "/.", 
         RowBox[{"Options", "[", "blockLociAll", "]"}]}]}]}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"Not", "[", 
         RowBox[{"int", "===", "All"}], "]"}], ",", 
        RowBox[{"fjl", "=", 
         RowBox[{"Select", "[", 
          RowBox[{"fjl", ",", 
           RowBox[{
            RowBox[{
             RowBox[{
             "int", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
             "<", 
             RowBox[{
              RowBox[{"locJ", "[", "\[ScriptCapitalP]", "]"}], "[", "#", 
              "]"}], "<", 
             RowBox[{
             "int", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}], 
            "&"}]}], "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"sjl", "=", 
       RowBox[{"SortBy", "[", 
        RowBox[{"fjl", ",", 
         RowBox[{
          RowBox[{"locJ", "[", "\[ScriptCapitalP]", "]"}], "/@", "fjl"}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"bb", "=", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{"locJ", "[", "\[ScriptCapitalP]", "]"}], ",", 
         RowBox[{"blocks", "[", "sjl", "]"}], ",", 
         RowBox[{"{", "2", "}"}]}], "]"}]}], ";", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"DeleteEmpties", "/.", 
          RowBox[{"{", "opts", "}"}]}], "/.", 
         RowBox[{"Options", "[", "blockLociAll", "]"}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"Select", "[", 
         RowBox[{"bb", ",", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"-", "1"}], ",", "1"}], "}"}], ".", "#"}], ")"}], ">",
             "0"}], "&"}]}], "]"}], ",", "bb"}], "]"}]}]}], "]"}]}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.7000330281045856`*^9, 3.700033066479506*^9}, {
   3.700033123453251*^9, 3.700033184379431*^9}, {3.700033274373722*^9, 
   3.70003331540722*^9}, {3.7000333464138927`*^9, 3.700033380046033*^9}, {
   3.700033732165288*^9, 3.700033857572879*^9}, {3.700033939924005*^9, 
   3.700033996081687*^9}, {3.700034143558783*^9, 3.70003414605272*^9}, {
   3.7000342465627737`*^9, 3.7000342585984173`*^9}, {3.70003538258239*^9, 
   3.7000354062291803`*^9}, 3.700037838418853*^9, {3.700038085054685*^9, 
   3.7000381243051443`*^9}, {3.700044514054331*^9, 3.7000445690119658`*^9}, {
   3.70004469052138*^9, 3.7000446924717207`*^9}, {3.700731624626048*^9, 
   3.7007316444341917`*^9}, {3.7007321792323647`*^9, 3.700732485430799*^9}, {
   3.7007325295239563`*^9, 3.700732530520875*^9}},
 CellLabel->
  "In[543]:=",ExpressionUUID->"f9df9d75-9086-4a97-a8bd-a884f926c52a"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"blockLociAll", "[", 
    RowBox[{"\[ScriptCapitalP]_", ",", "t_Integer", ",", "opts___Rule"}], 
    "]"}], ":=", 
   RowBox[{
    RowBox[{"blockLociAll", "[", 
     RowBox[{"\[ScriptCapitalP]", ",", "t", ",", "opts"}], "]"}], "=", 
    RowBox[{"blockLociAll", "[", 
     RowBox[{"\[ScriptCapitalP]", ",", 
      RowBox[{"Flatten", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"junctions", "[", "\[ScriptCapitalP]", "]"}], 
         "\[LeftDoubleBracket]", 
         RowBox[{"t", "+", "1"}], "\[RightDoubleBracket]"}], ",", "1"}], 
       "]"}], ",", "opts"}], "]"}]}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.7000330281045856`*^9, 3.700033066479506*^9}, {
   3.700033123453251*^9, 3.700033184379431*^9}, {3.700033274373722*^9, 
   3.70003331540722*^9}, {3.7000333464138927`*^9, 3.700033380046033*^9}, {
   3.700033732165288*^9, 3.700033857572879*^9}, {3.700033939924005*^9, 
   3.700033996081687*^9}, {3.700034143558783*^9, 3.70003414605272*^9}, {
   3.7000342465627737`*^9, 3.7000342585984173`*^9}, {3.70003538258239*^9, 
   3.7000354062291803`*^9}, 3.700037838418853*^9, {3.700038085054685*^9, 
   3.7000381243051443`*^9}, {3.700044514054331*^9, 3.7000445690119658`*^9}, {
   3.70004469052138*^9, 3.7000446924717207`*^9}, {3.7000464002228813`*^9, 
   3.700046432686895*^9}},
 CellLabel->
  "In[544]:=",ExpressionUUID->"2581494c-56b4-4b6f-bc0b-603575b259a8"]
}, Open  ]],

Cell[CellGroupData[{

Cell["blockAncOverlap", "Subsubsection",
 CellChangeTimes->{{3.700033403197433*^9, 
  3.700033407853539*^9}},ExpressionUUID->"3f770963-2621-4efd-9a50-\
4009ce616a54"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"blockAncOverlap", "::", "usage"}], "=", 
   "\"\<blockAncOverlap[\[ScriptCapitalP],{\!\(\*SubscriptBox[\(j\), \
\(0\)]\),\!\(\*SubscriptBox[\(j\), \(1\)]\)},{{\!\(\*SubscriptBox[\(j\), \(1, \
1\)]\),\[Ellipsis]},\[Ellipsis]}] lists the ancestry of the blocks in the \
population {{\!\(\*SubscriptBox[\(j\), \(1, 1\)]\),\[Ellipsis]},\[Ellipsis]} \
that overlap with the focal interval {\!\(\*SubscriptBox[\(j\), \(0\)]\),\!\(\
\*SubscriptBox[\(j\), \(1\)]\)}. The junctions {\!\(\*SubscriptBox[\(j\), \(0\
\)]\),\!\(\*SubscriptBox[\(j\), \(1\)]\)} must be adjacent. blockAncOverlap[\
\[ScriptCapitalP],{{\!\(\*SubscriptBox[\(j\), \(1, 1\)]\),\[Ellipsis]},\
\[Ellipsis]}] lists the ancestry for every distinct block. \
DeleteEmpties->True excludes empty terminal intervals {0,0},{R,R}. \
blockAncOverlap[\[ScriptCapitalP],t] stores the ancestry for generation t, \
numbered 0\[Ellipsis]T\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.700032928042591*^9, 3.7000330221674337`*^9}, {
   3.700033102943591*^9, 3.700033115357913*^9}, {3.700033636785427*^9, 
   3.7000337284489393`*^9}, {3.700033999009716*^9, 3.7000340113853807`*^9}, {
   3.700035455387734*^9, 3.700035486291353*^9}, 3.7000378334032383`*^9, {
   3.7000384441951637`*^9, 3.700038459544888*^9}, {3.700042158020664*^9, 
   3.700042173483223*^9}, {3.7000448502477503`*^9, 3.7000448871393623`*^9}, {
   3.7000460799435787`*^9, 3.70004611320887*^9}, {3.700046143849169*^9, 
   3.700046148488007*^9}},
 CellLabel->
  "In[545]:=",ExpressionUUID->"cef12bfa-8ba9-400b-ba05-8d085525e788"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "blockAncOverlap", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{"DeleteEmpties", "\[Rule]", "False"}], "}"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.700043729177438*^9, 3.700043754238887*^9}, {
   3.700044714792095*^9, 3.700044715694508*^9}, 3.7000448980058804`*^9},
 CellLabel->
  "In[546]:=",ExpressionUUID->"1108ef83-9f3c-4700-bf46-aecef792ea1f"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"blockAncOverlap", "::", "badAncestry"}], "=", 
   "\"\<Block `1` overlaps with more than one ancestry\>\""}], ";"}]], "Input",\

 InitializationCell->True,
 CellChangeTimes->{{3.700038184614986*^9, 3.7000381929415693`*^9}, {
  3.700038318803171*^9, 3.700038340878428*^9}},
 CellLabel->
  "In[547]:=",ExpressionUUID->"0372bbe1-4556-4b03-86eb-33ca3711749c"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"blockAncOverlap", "[", 
    RowBox[{"\[ScriptCapitalP]_", ",", 
     RowBox[{"{", 
      RowBox[{"j0_Integer", ",", "j1_Integer"}], "}"}], ",", 
     RowBox[{"jl", ":", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", "___Integer", "}"}], "..."}], "}"}]}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "bb", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"bb", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"blockAnc", "[", "\[ScriptCapitalP]", "]"}], "/@", 
           RowBox[{"Select", "[", 
            RowBox[{
             RowBox[{"blocks", "[", "#", "]"}], ",", 
             RowBox[{"blockOverlapQ", "[", 
              RowBox[{"\[ScriptCapitalP]", ",", 
               RowBox[{"{", 
                RowBox[{"j0", ",", "j1"}], "}"}]}], "]"}]}], "]"}]}], ")"}], 
         "&"}], "/@", "jl"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"Not", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"MinMax", "[", 
            RowBox[{"Length", "/@", "bb"}], "]"}], "\[Equal]", 
           RowBox[{"{", 
            RowBox[{"1", ",", "1"}], "}"}]}], "\[Or]", 
          RowBox[{
           RowBox[{"MinMax", "[", 
            RowBox[{"Length", "/@", "bb"}], "]"}], "\[Equal]", 
           RowBox[{"{", 
            RowBox[{"0", ",", "0"}], "}"}]}]}], "]"}], ",", 
        RowBox[{"Message", "[", 
         RowBox[{
          RowBox[{"blockAncOverlap", "::", "badAncestry"}], ",", 
          RowBox[{"{", 
           RowBox[{"j0", ",", "j1"}], "}"}]}], "]"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Flatten", "[", "bb", "]"}]}]}], "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.7000330281045856`*^9, 3.700033066479506*^9}, {
   3.700033123453251*^9, 3.700033184379431*^9}, {3.700033274373722*^9, 
   3.70003331540722*^9}, {3.7000333464138927`*^9, 3.700033380046033*^9}, {
   3.700033732165288*^9, 3.700033857572879*^9}, {3.700033939924005*^9, 
   3.700033996081687*^9}, {3.700034143558783*^9, 3.70003414605272*^9}, {
   3.7000342465627737`*^9, 3.7000342585984173`*^9}, {3.70003538258239*^9, 
   3.7000354062291803`*^9}, 3.700037838418853*^9, {3.7000382714436283`*^9, 
   3.7000383142237997`*^9}, {3.7000383526880283`*^9, 3.700038415395368*^9}, {
   3.7000385241642113`*^9, 3.700038534659116*^9}, {3.7000456541632433`*^9, 
   3.7000456611372013`*^9}},
 CellLabel->
  "In[548]:=",ExpressionUUID->"c40e3ed1-cb06-4b6f-b049-e01b3a84998b"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"blockAncOverlap", "[", 
    RowBox[{"\[ScriptCapitalP]_", ",", 
     RowBox[{"jl", ":", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", "___Integer", "}"}], "..."}], "}"}]}], ",", 
     "opts___Rule"}], "]"}], ":=", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"bsjl", "=", 
        RowBox[{"blocks", "[", 
         RowBox[{"Sort", "[", 
          RowBox[{
           RowBox[{"Union", "[", 
            RowBox[{"Flatten", "[", "jl", "]"}], "]"}], ",", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"locJ", "[", "\[ScriptCapitalP]", "]"}], "[", "#1", 
              "]"}], "<", 
             RowBox[{
              RowBox[{"locJ", "[", "\[ScriptCapitalP]", "]"}], "[", "#2", 
              "]"}]}], "&"}]}], "]"}], "]"}]}], ",", "xx"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"DeleteEmpties", "/.", 
          RowBox[{"{", "opts", "}"}]}], "/.", 
         RowBox[{"Options", "[", "blockAncOverlap", "]"}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"bsjl", "=", 
         RowBox[{"Select", "[", 
          RowBox[{"bsjl", ",", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{"xx", "=", 
                 RowBox[{
                  RowBox[{"locJ", "[", "\[ScriptCapitalP]", "]"}], "/@", 
                  "#"}]}], ";", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}], ".", "xx"}]}], 
               ")"}], ">", "0"}], ")"}], "&"}]}], "]"}]}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"blockAncOverlap", "[", 
         RowBox[{"\[ScriptCapitalP]", ",", "#", ",", "jl"}], "]"}], "&"}], "/@",
        "bsjl"}]}]}], "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.7000330281045856`*^9, 3.700033066479506*^9}, {
  3.700033123453251*^9, 3.700033184379431*^9}, {3.700033274373722*^9, 
  3.70003331540722*^9}, {3.7000333464138927`*^9, 3.700033380046033*^9}, {
  3.700033732165288*^9, 3.700033857572879*^9}, {3.700033939924005*^9, 
  3.700033996081687*^9}, {3.700034143558783*^9, 3.70003414605272*^9}, {
  3.7000342465627737`*^9, 3.7000342585984173`*^9}, {3.70003538258239*^9, 
  3.7000354062291803`*^9}, {3.700035494860632*^9, 3.700035635179538*^9}, {
  3.700037584046831*^9, 3.700037584422327*^9}, {3.7000378463546467`*^9, 
  3.700037848280644*^9}, {3.7000421824423122`*^9, 3.7000422195533867`*^9}, {
  3.700044908290188*^9, 3.700045081753324*^9}, {3.700045327272464*^9, 
  3.7000453274308033`*^9}},
 CellLabel->
  "In[549]:=",ExpressionUUID->"70c54b3e-6390-40a8-8352-2d460b8af7bf"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"blockAncOverlap", "[", 
    RowBox[{"\[ScriptCapitalP]_", ",", "t_Integer", ",", "opts___Rule"}], 
    "]"}], ":=", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"blockAncOverlap", "[", 
     RowBox[{"\[ScriptCapitalP]", ",", "t", ",", "opts"}], "]"}], "=", 
    RowBox[{"blockAncOverlap", "[", 
     RowBox[{"\[ScriptCapitalP]", ",", 
      RowBox[{"Flatten", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"junctions", "[", "\[ScriptCapitalP]", "]"}], 
         "\[LeftDoubleBracket]", 
         RowBox[{"t", "+", "1"}], "\[RightDoubleBracket]"}], ",", "1"}], 
       "]"}], ",", "opts"}], "]"}]}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.7000330281045856`*^9, 3.700033066479506*^9}, {
  3.700033123453251*^9, 3.700033184379431*^9}, {3.700033274373722*^9, 
  3.70003331540722*^9}, {3.7000333464138927`*^9, 3.700033380046033*^9}, {
  3.700033732165288*^9, 3.700033857572879*^9}, {3.700033939924005*^9, 
  3.700033996081687*^9}, {3.700034143558783*^9, 3.70003414605272*^9}, {
  3.7000342465627737`*^9, 3.7000342585984173`*^9}, {3.70003538258239*^9, 
  3.7000354062291803`*^9}, {3.700035494860632*^9, 3.700035635179538*^9}, {
  3.700037584046831*^9, 3.700037584422327*^9}, {3.7000378463546467`*^9, 
  3.700037848280644*^9}, {3.7000421824423122`*^9, 3.7000422195533867`*^9}, {
  3.700044908290188*^9, 3.700045081753324*^9}, {3.700045327272464*^9, 
  3.7000453274308033`*^9}, {3.7000461212983837`*^9, 3.700046206486866*^9}, {
  3.7000462990681343`*^9, 3.7000463041622553`*^9}},
 CellLabel->
  "In[550]:=",ExpressionUUID->"c74ff180-10d4-49c2-8b50-43557c3e286f"]
}, Open  ]],

Cell[CellGroupData[{

Cell["blockSFS", "Subsubsection",
 CellChangeTimes->{{3.700043272133906*^9, 
  3.700043273692807*^9}},ExpressionUUID->"f63c8e1f-4e9e-437a-adad-\
b2273a3191ea"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"blockSFS", "::", "usage"}], "=", 
   "\"\<blockSFS[\[ScriptCapitalP],{{\!\(\*SubscriptBox[\(j\), \(1\)]\),\
\[Ellipsis]}\[Ellipsis]}] gives the configurations for each distinct block. \
blockSFS[\[ScriptCapitalP],t] gives the result for generation t, numbered 0\
\[Ellipsis]T\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.700043279270748*^9, 3.700043321571679*^9}, {
  3.7000458169992657`*^9, 3.700045827637394*^9}, {3.700046486078678*^9, 
  3.700046502620718*^9}, {3.700716543448683*^9, 3.700716564108408*^9}},
 CellLabel->
  "In[551]:=",ExpressionUUID->"bea6fe2d-9323-44b1-8a6a-2f66f3bbb915"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"blockSFS", "[", 
    RowBox[{"\[ScriptCapitalP]_", ",", 
     RowBox[{"jl", ":", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", "___Integer", "}"}], "..."}], "}"}]}]}], "]"}], ":=", 
   RowBox[{
    RowBox[{
     RowBox[{"Sort", "[", 
      RowBox[{"Last", "/@", 
       RowBox[{"Tally", "[", "#", "]"}]}], "]"}], "&"}], "/@", 
    RowBox[{"blockAncOverlap", "[", 
     RowBox[{"\[ScriptCapitalP]", ",", "jl", ",", 
      RowBox[{"DeleteEmpties", "\[Rule]", "True"}]}], "]"}]}]}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.700045832446272*^9, 3.700045872773185*^9}, {
  3.7000459056142693`*^9, 3.700045921116473*^9}},
 CellLabel->
  "In[552]:=",ExpressionUUID->"d8f17086-f283-411d-9e51-fb964157e11c"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"blockSFS", "[", 
    RowBox[{"\[ScriptCapitalP]_", ",", "t_Integer"}], "]"}], ":=", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"blockSFS", "[", 
     RowBox[{"\[ScriptCapitalP]", ",", "t"}], "]"}], "=", 
    RowBox[{
     RowBox[{
      RowBox[{"Sort", "[", 
       RowBox[{"Last", "/@", 
        RowBox[{"Tally", "[", "#", "]"}]}], "]"}], "&"}], "/@", 
     RowBox[{"blockAncOverlap", "[", 
      RowBox[{"\[ScriptCapitalP]", ",", "t", ",", 
       RowBox[{"DeleteEmpties", "\[Rule]", "True"}]}], "]"}]}]}]}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->CompressedData["
1:eJxTTMoPSmViYGAQBmIQfSSi+YDDxNeOshH+R0E0R2PeGRDto8JzBUR3fPW+
D6I/sec+AdFz7HxfgGipysY3IJrLq1XCEUizhRppgOjiibVGIFpvbpMliO59
+NEbRD9a7+gDou2YLkWAaBu14CgQ/WHRpWcguij0+EsQ7dN1+wuIPrYvlc0J
SC+pZ/wForc084Jpl8jTUs5AmvM3hzSIzlE/Z+EKpCO2FtqCaAvPzl43IG0t
bbEYRLPteHEQRKucfAumY3o0Vd2BdMaU8/ogWkMvyRpEGxmy2oDoqAaPMBC9
f/XCcBB9zSU1GkRvC/GIA9EAQDaSfg==
  "],
 CellLabel->
  "In[553]:=",ExpressionUUID->"23454c28-4fb5-4330-8e9f-a5d8f6609c75"]
}, Closed]],

Cell[CellGroupData[{

Cell["blockOverlapQ", "Subsubsection",
 CellChangeTimes->{{3.7000331913195333`*^9, 
  3.7000331932189302`*^9}},ExpressionUUID->"e18d4d30-460e-47b7-8d79-\
628d09bb1cd9"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"blockOverlapQ", "::", "usage"}], "=", 
   "\"\<blockOverlapQ[\[ScriptCapitalP],{\!\(\*SubscriptBox[\(j\), \(0, \
0\)]\),\!\(\*SubscriptBox[\(j\), \(0, 1\)]\)}][{\!\(\*SubscriptBox[\(j\), \
\(1, 0\)]\),\!\(\*SubscriptBox[\(j\), \(1, 1\)]\)}] determines whether these \
intervals overlap\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.70003319779705*^9, 3.700033235433474*^9}, {
  3.7000339192303267`*^9, 3.70003392469388*^9}},
 CellLabel->
  "In[554]:=",ExpressionUUID->"13c549bc-cab1-4c61-a08e-d9d5770ceeac"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"blockOverlapQ", "[", 
     RowBox[{"\[ScriptCapitalP]_", ",", 
      RowBox[{"{", 
       RowBox[{"j00_", ",", "j01_"}], "}"}]}], "]"}], "[", 
    RowBox[{"{", 
     RowBox[{"j10_", ",", "j11_"}], "}"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"x0", "=", 
        RowBox[{"Sort", "[", 
         RowBox[{
          RowBox[{"locJ", "[", "\[ScriptCapitalP]", "]"}], "/@", 
          RowBox[{"{", 
           RowBox[{"j00", ",", "j01"}], "}"}]}], "]"}]}], ",", 
       RowBox[{"x1", "=", 
        RowBox[{"Sort", "[", 
         RowBox[{
          RowBox[{"locJ", "[", "\[ScriptCapitalP]", "]"}], "/@", 
          RowBox[{"{", 
           RowBox[{"j10", ",", "j11"}], "}"}]}], "]"}]}]}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"x1", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
       "<", 
       RowBox[{"x0", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}],
       "&&", 
      RowBox[{
       RowBox[{"x1", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
       ">", 
       RowBox[{
       "x0", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}]}]}], 
    "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.700031158951869*^9, 3.700031422050515*^9}, {
  3.700033928822069*^9, 3.7000339310137033`*^9}, {3.7000384742464123`*^9, 
  3.700038487421584*^9}, {3.700042550871415*^9, 3.700042553420884*^9}},
 CellLabel->
  "In[555]:=",ExpressionUUID->"084c2520-a86b-4d87-8d29-cf5b29b7e8aa"]
}, Closed]]
}, Closed]],

Cell[CellGroupData[{

Cell["New definitions July 30", "Subsection",
 CellChangeTimes->{{3.710403835992352*^9, 
  3.71040384203074*^9}},ExpressionUUID->"2b9c2780-f8fd-41ee-b0cf-\
1411fcba506a"],

Cell[CellGroupData[{

Cell["alleleFreqs", "Subsubsection",
 CellChangeTimes->{{3.710403847316284*^9, 
  3.710403860614071*^9}},ExpressionUUID->"32566706-43d3-4048-bb6c-\
7698b625beca"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"alleleFreqs", "::", "usage"}], "=", 
   "\"\<alleleFreqs[\[ScriptCapitalP]] stores allele frequencies for \
simulation \[ScriptCapitalP]\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"alleleFreqs", "[", "\[ScriptCapitalP]_", "]"}], ":=", 
   RowBox[{
    RowBox[{"alleleFreqs", "[", "\[ScriptCapitalP]", "]"}], "=", 
    RowBox[{
     RowBox[{
      RowBox[{"N", "[", 
       RowBox[{"Mean", "[", 
        RowBox[{"Flatten", "[", 
         RowBox[{"#", ",", "1"}], "]"}], "]"}], "]"}], "&"}], "/@", 
     RowBox[{"pop", "[", "\[ScriptCapitalP]", "]"}]}]}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.710403862931024*^9, 3.71040392745205*^9}},
 CellLabel->
  "In[556]:=",ExpressionUUID->"1556818a-fb06-4c10-9a1a-0d5bd9e0dc11"]
}, Closed]],

Cell[CellGroupData[{

Cell["hetP", "Subsubsection",
 CellChangeTimes->{{3.710403936219102*^9, 
  3.710403937395046*^9}},ExpressionUUID->"e7c45fc1-b1c4-4d98-894e-\
54432bf17daa"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"hetP", "::", "usage"}], "=", 
   "\"\<hetP[\[ScriptCapitalP]] gives pq for simulation \[ScriptCapitalP]. \>\
\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"hetP", "[", "\[ScriptCapitalP]_", "]"}], ":=", 
   RowBox[{
    RowBox[{
     RowBox[{"(", 
      RowBox[{"#", ".", 
       RowBox[{"(", 
        RowBox[{"1", "-", "#"}], ")"}]}], ")"}], "&"}], "/@", 
    RowBox[{"alleleFreqs", "[", "\[ScriptCapitalP]", "]"}]}]}], 
  ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.710129037580841*^9, 3.710129101203122*^9}, {
  3.710129145832161*^9, 3.710129279253435*^9}, {3.710403941212047*^9, 
  3.710403979490548*^9}},
 CellLabel->
  "In[558]:=",ExpressionUUID->"dc21b8aa-ac57-4989-ada5-daf64e0d93ac"]
}, Closed]],

Cell[CellGroupData[{

Cell["hetA", "Subsubsection",
 CellChangeTimes->{{3.710403988432979*^9, 
  3.710403989009141*^9}},ExpressionUUID->"0ee975dd-2c90-4b63-8dd1-\
511d0ad1b725"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"hetA", "::", "usage"}], "=", 
   "\"\<hetA[sim,k,r] stores the actual fraction of heterozygotes for \
simulation \[ScriptCapitalP].\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"hetA", "[", "\[ScriptCapitalP]_", "]"}], ":=", 
   RowBox[{
    RowBox[{"hetA", "[", "\[ScriptCapitalP]", "]"}], "=", 
    RowBox[{
     RowBox[{
      RowBox[{"N", "[", 
       RowBox[{"Mean", "[", 
        RowBox[{"nHet", "/@", "#"}], "]"}], "]"}], "&"}], "/@", 
     RowBox[{"pop", "[", "\[ScriptCapitalP]", "]"}]}]}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.710129037580841*^9, 3.710129101203122*^9}, {
   3.710129145832161*^9, 3.710129279253435*^9}, {3.710403941212047*^9, 
   3.7104040278958483`*^9}, 3.710404065487895*^9, {3.710404122136703*^9, 
   3.710404128669591*^9}},
 CellLabel->
  "In[560]:=",ExpressionUUID->"e38c3499-380c-4a37-8f55-3197d505fca8"]
}, Closed]]
}, Closed]],

Cell[CellGroupData[{

Cell["Making transition matrices Feb 2018", "Subsection",
 CellChangeTimes->{{3.727004473616805*^9, 3.727004479855165*^9}, {
  3.732186839375455*^9, 
  3.732186849501666*^9}},ExpressionUUID->"ce26b4c1-5382-4164-b993-\
09b7d87bd135"],

Cell[CellGroupData[{

Cell["makeTransitionMatrix", "Subsubsection",
 CellChangeTimes->{
  3.727003547540585*^9},ExpressionUUID->"e5cd4a9c-161d-45ed-b4b7-\
7d71a3cd005e"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"makeTransitionMatrix", "::", "usage"}], "=", 
   "\"\<makeTransitionMatrix[{\!\(\*SubscriptBox[\(P\), \(1\)]\),\[Ellipsis],\
\!\(\*SubscriptBox[\(P\), \(17\)]\)},k] estimates the transition matrix for \
the given pedigree, by dropping genes.  Uses k replicate loci for each of 1\
\[Ellipsis](n-1) initial allele numbers.\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.727003533960554*^9, 3.727003635756197*^9}, 
   3.727003874313196*^9},
 CellLabel->
  "In[562]:=",ExpressionUUID->"5345e9b7-b9a4-4089-948e-b97be2650448"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"makeTransitionMatrix", "[", 
    RowBox[{
     RowBox[{"P", ":", 
      RowBox[{"{", "__SparseArray", "}"}]}], ",", "n_Integer"}], "]"}], ":=", 
   "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"p0", ",", "p1", ",", "trans", ",", 
       RowBox[{"n0", "=", 
        RowBox[{
         RowBox[{"Dimensions", "[", 
          RowBox[{"P", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}],
           "]"}], "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}], 
       ",", 
       RowBox[{"n1", "=", 
        RowBox[{
         RowBox[{"Dimensions", "[", 
          RowBox[{"P", "\[LeftDoubleBracket]", 
           RowBox[{"-", "1"}], "\[RightDoubleBracket]"}], "]"}], 
         "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}]}], "}"}], 
     ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"p0", "=", 
       RowBox[{"Transpose", "[", 
        RowBox[{"Flatten", "[", 
         RowBox[{
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"Partition", "[", 
               RowBox[{
                RowBox[{"RandomSample", "[", "#", "]"}], ",", "2"}], "]"}], 
              "&"}], "/@", 
             RowBox[{"Transpose", "[", 
              RowBox[{"Join", "[", 
               RowBox[{
                RowBox[{"ConstantArray", "[", 
                 RowBox[{"0", ",", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"2", "n0"}], "-", "k"}], ",", "n"}], "}"}]}], 
                 "]"}], ",", 
                RowBox[{"ConstantArray", "[", 
                 RowBox[{"1", ",", 
                  RowBox[{"{", 
                   RowBox[{"k", ",", "n"}], "}"}]}], "]"}]}], "]"}], "]"}]}], 
            ",", 
            RowBox[{"{", 
             RowBox[{"k", ",", "1", ",", 
              RowBox[{
               RowBox[{"2", "n0"}], "-", "1"}]}], "}"}]}], "]"}], ",", "1"}], 
         "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"p1", "=", 
       RowBox[{"Fold", "[", 
        RowBox[{"dropDip", ",", "p0", ",", "P"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"trans", "=", 
       RowBox[{"Sort", "[", 
        RowBox[{"Tally", "[", 
         RowBox[{"Transpose", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Total", "/@", 
             RowBox[{"Transpose", "[", 
              RowBox[{"Flatten", "[", 
               RowBox[{
                RowBox[{"Transpose", "/@", "p0"}], ",", "1"}], "]"}], "]"}]}],
             ",", 
            RowBox[{"Total", "/@", 
             RowBox[{"Transpose", "[", 
              RowBox[{"Flatten", "[", 
               RowBox[{
                RowBox[{"Transpose", "/@", "p1"}], ",", "1"}], "]"}], 
              "]"}]}]}], "}"}], "]"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Append", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Prepend", "[", 
         RowBox[{
          RowBox[{"SparseArray", "[", 
           RowBox[{
            RowBox[{"trans", "/.", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"i_", ",", "j_"}], "}"}], ",", "k_"}], "}"}], 
              "\[RuleDelayed]", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"i", ",", 
                  RowBox[{"j", "+", "1"}]}], "}"}], "\[Rule]", "k"}], 
               ")"}]}]}], ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{
               RowBox[{"2", "n0"}], "-", "1"}], ",", 
              RowBox[{
               RowBox[{"2", "n1"}], "+", "1"}]}], "}"}]}], "]"}], ",", 
          RowBox[{"SparseArray", "[", 
           RowBox[{
            RowBox[{"1", "\[Rule]", "1"}], ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"2", "n1"}], "+", "1"}], "}"}]}], "]"}]}], "]"}], ",", 
        RowBox[{"SparseArray", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"-", "1"}], "\[Rule]", "1"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"2", "n1"}], "+", "1"}], "}"}]}], "]"}]}], "]"}]}]}], 
    "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.727003647284371*^9, 3.727003706073807*^9}, {
  3.727003809367251*^9, 3.7270038522985573`*^9}, {3.7270038863345537`*^9, 
  3.72700392919555*^9}, {3.7270041432721357`*^9, 3.727004163098241*^9}, {
  3.727004212860919*^9, 3.727004214716649*^9}},
 CellLabel->
  "In[563]:=",ExpressionUUID->"f49b9cfd-359f-4c1f-b9a3-90ec4f62ea47"]
}, Closed]]
}, Closed]],

Cell[CellGroupData[{

Cell["Definitions for throwing down haplotypes 6.4.18", "Subsection",
 CellChangeTimes->{{3.731743593237133*^9, 3.731743594700384*^9}, {
  3.732186743124526*^9, 
  3.732186780923253*^9}},ExpressionUUID->"cc40ba09-b7f2-4f1f-ac58-\
40dc1430665f"],

Cell["These combine Longshanks data with simulation", "Text",
 CellChangeTimes->{{3.732186761978662*^9, 
  3.7321867738835287`*^9}},ExpressionUUID->"d13d52b9-1726-41b1-ad28-\
32b5e8b41e29"],

Cell[CellGroupData[{

Cell["polLoci", "Subsubsection",
 CellChangeTimes->{
  3.731748788252363*^9},ExpressionUUID->"dbdcbc9d-0880-4d68-a13f-\
3c2fab570781"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"polLoci", "::", "usage"}], "=", 
   "\"\<polLoci[t,r,c] stores the set of loci that are polymorphic in line r, \
for chromosome c; this is a subset of numSNPInd[c]. polLoci[t,{1,2},c] gives \
the loci polymorphic in the combination of LS1, LS2. Similarly for \
polLoci[{0,17},{1,2},c]\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.731748651389954*^9, 3.731748782491755*^9}, {
  3.7317491646804047`*^9, 3.731749166735263*^9}, {3.731749304155348*^9, 
  3.7317493098422327`*^9}, {3.733990205706585*^9, 3.7339902159110403`*^9}},
 CellLabel->
  "In[564]:=",ExpressionUUID->"e00bfb68-bb1f-44c9-a709-6bee0737d293"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"polLoci", "[", 
    RowBox[{
     RowBox[{"t", ":", 
      RowBox[{"(", 
       RowBox[{"0", "|", "17"}], ")"}]}], ",", 
     RowBox[{"r", ":", 
      RowBox[{"(", 
       RowBox[{"0", "|", "1", "|", "2"}], ")"}]}], ",", "c_Integer"}], "]"}], 
   ":=", 
   RowBox[{"polLoci", "[", 
    RowBox[{
     RowBox[{"{", "t", "}"}], ",", 
     RowBox[{"{", "r", "}"}], ",", "c"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"polLoci", "[", 
    RowBox[{
     RowBox[{"t", ":", 
      RowBox[{"(", 
       RowBox[{"0", "|", "17"}], ")"}]}], ",", 
     RowBox[{"rl", ":", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"0", "|", "1", "|", "2"}], ")"}], "..."}], "}"}]}], ",", 
     "c_Integer"}], "]"}], ":=", 
   RowBox[{"polLoci", "[", 
    RowBox[{
     RowBox[{"{", "t", "}"}], ",", "rl", ",", "c"}], "]"}]}], ";", 
  RowBox[{
   RowBox[{"polLoci", "[", 
    RowBox[{
     RowBox[{"tl", ":", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"0", "|", "17"}], ")"}], "..."}], "}"}]}], ",", 
     RowBox[{"r", ":", 
      RowBox[{"(", 
       RowBox[{"0", "|", "1", "|", "2"}], ")"}]}], ",", "c_Integer"}], "]"}], 
   ":=", 
   RowBox[{"polLoci", "[", 
    RowBox[{"tl", ",", 
     RowBox[{"{", "r", "}"}], ",", "c"}], "]"}]}], ";", 
  RowBox[{
   RowBox[{"polLoci", "[", 
    RowBox[{
     RowBox[{"tl", ":", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"0", "|", "17"}], ")"}], "..."}], "}"}]}], ",", 
     RowBox[{"rl", ":", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"0", "|", "1", "|", "2"}], ")"}], "..."}], "}"}]}], ",", 
     "c_Integer"}], "]"}], ":=", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"polLoci", "[", 
     RowBox[{"tl", ",", "rl", ",", "c"}], "]"}], "=", "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"pp", "=", 
        RowBox[{"Transpose", "[", 
         RowBox[{"Flatten", "[", 
          RowBox[{
           RowBox[{"Outer", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"freqSNPInd", "[", 
               RowBox[{"#1", ",", "#2", ",", "c"}], "]"}], "&"}], ",", "tl", 
             ",", "rl"}], "]"}], ",", "1"}], "]"}], "]"}]}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"Pick", "[", 
       RowBox[{
        RowBox[{"Range", "[", 
         RowBox[{"numSNPInd", "[", "c", "]"}], "]"}], ",", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"Or", "@@", 
              RowBox[{"(", 
               RowBox[{"Positive", "/@", "#"}], ")"}]}], ")"}], "\[And]", 
            RowBox[{"(", 
             RowBox[{"Or", "@@", 
              RowBox[{"(", 
               RowBox[{"Positive", "/@", 
                RowBox[{"(", 
                 RowBox[{"1", "-", "#"}], ")"}]}], ")"}]}], ")"}]}], ")"}], 
          "&"}], "/@", "pp"}]}], "]"}]}], "]"}]}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.731749147997611*^9, 3.731749248235094*^9}, {
   3.7317493128812037`*^9, 3.7317493400566597`*^9}, {3.731749438206464*^9, 
   3.7317494724353037`*^9}, {3.731749787433118*^9, 3.731749796001999*^9}, 
   3.733706572267385*^9, {3.733990237041448*^9, 3.733990349393248*^9}, {
   3.7339905986646557`*^9, 3.733990613541604*^9}},
 CellLabel->
  "In[565]:=",ExpressionUUID->"2cc02bc7-057a-4ee0-9055-07150ecde5d9"]
}, Closed]],

Cell[CellGroupData[{

Cell["makeHaps", "Subsubsection",
 CellChangeTimes->{
  3.731923313677689*^9},ExpressionUUID->"9cf561b2-b99a-45f9-a868-\
9cb47cbf06dc"],

Cell[TextData[StyleBox["This needs to be extended, to allow for \
mis-assignment of heterozygotes with probability F",
 FontSlant->"Italic"]], "Text",
 CellChangeTimes->{{3.7342331814927*^9, 
  3.7342332440898457`*^9}},ExpressionUUID->"2c7351db-82e2-40d5-a4c8-\
7c97ca5bbf76"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"makeHaps", "::", "usage"}], "=", 
   "\"\<makeHaps[{{0,1,2,\[Ellipsis]},\[Ellipsis]}] generates haplotypes from \
diplotypes, assigning heterozygotes to all 0 or all 1. Method->LE shuffles \
the whole population, keeping frequencies the same.  Method->Random assigns \
heterozygotes at random. Method->LD (default) assigns heterozygotes in one \
haplotype to all 0, the other to all 1, thus maximising LD (wrt that \
labelling). For LD, Random one may also need to shuffle the whole population \
to get a random permutation of starting haplotypes. makeHaps[{{0,1,2,\
\[Ellipsis]},\[Ellipsis]},n] makes a different # of haplotypes than were \
originally present, by either taking a random sample (to get a smaller \
number) or randomly sampling extra haplotypes (to get a bigger number). Note \
that the results are ordered, and may need to be shuffled. \>\""}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.731749925641054*^9, 3.731749942663061*^9}, {
  3.7317502256410913`*^9, 3.731750317542087*^9}, {3.731751068501575*^9, 
  3.731751173896419*^9}, {3.731990224269376*^9, 3.7319902603387947`*^9}, {
  3.732078803169982*^9, 3.732078926975437*^9}, {3.732079051520701*^9, 
  3.7320790553915873`*^9}, {3.7320792240880337`*^9, 3.7320792366785192`*^9}},
 CellLabel->
  "In[567]:=",ExpressionUUID->"3a2dd7f2-6f5c-44df-81ee-d04d6f7708f0"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"LD", "::", "usage"}], "=", 
   "\"\<LD is an option for makeHaps that assigns heterozygotes to all 0 or \
all 1, thus maximising LD\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.731751260178713*^9, 3.731751289196405*^9}},
 CellLabel->
  "In[568]:=",ExpressionUUID->"52c232aa-045f-4b36-a916-1ad7accfdc91"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"LE", "::", "usage"}], "=", 
   "\"\<LEis an option for makeHaps that shuffles genotypes at a locus, \
yielding LE\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.731751260178713*^9, 3.731751289196405*^9}, {
   3.731923741753579*^9, 3.731923772798745*^9}, 3.731923854385654*^9},
 CellLabel->
  "In[569]:=",ExpressionUUID->"3558f631-9cf8-4c22-a30d-e50d0c4e5036"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"makeHaps", "::", "badMethod"}], "=", 
   "\"\<Inadmissible Method `1`: should be LE, Random or LD\>\""}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.7317513859243317`*^9, 3.731751424543572*^9}},
 CellLabel->
  "In[570]:=",ExpressionUUID->"1556231a-2369-4c55-8f98-fd3642c65dd9"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "makeHaps", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{"Method", "\[Rule]", "LD"}], "}"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.73175124983838*^9, 3.73175125675738*^9}},
 CellLabel->
  "In[571]:=",ExpressionUUID->"c03e58f1-a539-405e-81f8-1904a19ef8ea"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"makeHaps", "[", 
    RowBox[{
     RowBox[{"d", ":", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"0", "|", "1", "|", "2"}], ")"}], "..."}], "}"}], "..."}], 
       "}"}]}], ",", "opts___Rule"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"m", "=", 
       RowBox[{
        RowBox[{"Method", "/.", 
         RowBox[{"{", "opts", "}"}]}], "/.", 
        RowBox[{"Options", "[", "makeHaps", "]"}]}]}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"Switch", "[", 
      RowBox[{"m", ",", "LE", ",", 
       RowBox[{"Transpose", "[", 
        RowBox[{"RandomSample", "/@", 
         RowBox[{"Transpose", "[", 
          RowBox[{"makeHaps", "[", "d", "]"}], "]"}]}], "]"}], ",", 
       "\[IndentingNewLine]", "Random", ",", 
       RowBox[{"Flatten", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"Transpose", "[", 
            RowBox[{"#", "/.", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"0", "\[Rule]", 
                RowBox[{"{", 
                 RowBox[{"0", ",", "0"}], "}"}]}], ",", 
               RowBox[{"1", "\[RuleDelayed]", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"x", "=", 
                   RowBox[{"RandomInteger", "[", 
                    RowBox[{"{", 
                    RowBox[{"0", ",", "1"}], "}"}], "]"}]}], ";", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"1", "-", "x"}], ",", "x"}], "}"}]}], ")"}]}], 
               ",", 
               RowBox[{"2", "\[Rule]", 
                RowBox[{"{", 
                 RowBox[{"1", ",", "1"}], "}"}]}]}], "}"}]}], "]"}], "&"}], "/@",
           "d"}], ",", "1"}], "]"}], ",", "\[IndentingNewLine]", "LD", ",", 
       RowBox[{"Flatten", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"#", "/.", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"2", "\[Rule]", "1"}], ",", 
                RowBox[{"1", "\[Rule]", "0"}]}], "}"}]}], ",", 
             RowBox[{"#", "/.", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"2", "\[Rule]", "1"}], ",", 
                RowBox[{"1", "\[Rule]", "1"}]}], "}"}]}]}], "}"}], "&"}], "/@",
           "d"}], ",", "1"}], "]"}], ",", "\[IndentingNewLine]", "_", ",", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{
          RowBox[{"makeHaps", "::", "badMethod"}], ",", "m"}], "]"}], ";", 
        "$Failed"}]}], "]"}]}], "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.731923618056465*^9, 3.731923672951879*^9}, 
   3.731923724544652*^9, {3.7319237830008917`*^9, 3.731923796030282*^9}, 
   3.7319238385361147`*^9, {3.731925989786529*^9, 3.731926007808709*^9}},
 CellLabel->
  "In[572]:=",ExpressionUUID->"21e94257-146c-4890-b9d0-6511a1e33771"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"makeHaps", "[", 
    RowBox[{
     RowBox[{"d", ":", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"0", "|", "1", "|", "2"}], ")"}], "..."}], "}"}], "..."}], 
       "}"}]}], ",", "n_Integer", ",", "opts___Rule"}], "]"}], ":=", 
   "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"n0", "=", 
        RowBox[{"2", 
         RowBox[{"Length", "[", "d", "]"}]}]}], ",", 
       RowBox[{"haps", "=", 
        RowBox[{"makeHaps", "[", 
         RowBox[{"d", ",", "opts"}], "]"}]}], ",", "q"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"q", "=", 
       RowBox[{"Quotient", "[", 
        RowBox[{"n", ",", "n0"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Join", "@@", 
       RowBox[{"Append", "[", 
        RowBox[{
         RowBox[{"ConstantArray", "[", 
          RowBox[{"haps", ",", "q"}], "]"}], ",", 
         RowBox[{"RandomSample", "[", 
          RowBox[{"haps", ",", 
           RowBox[{"n", "-", 
            RowBox[{"q", "*", "n0"}]}]}], "]"}]}], "]"}]}]}]}], "]"}]}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.731923618056465*^9, 3.731923672951879*^9}, 
   3.731923724544652*^9, {3.7319237830008917`*^9, 3.731923796030282*^9}, 
   3.7319238385361147`*^9, {3.731925989786529*^9, 3.731926007808709*^9}, {
   3.732078936345398*^9, 3.7320790411843863`*^9}, {3.732079071363484*^9, 
   3.7320791529267178`*^9}, 3.732079194065213*^9},
 CellLabel->
  "In[573]:=",ExpressionUUID->"9e3a8cf2-eda4-4fcc-bb63-51089672f271"]
}, Closed]],

Cell[CellGroupData[{

Cell["Testing makeHaps", "Subsubsection",
 CellChangeTimes->{{3.7320787784323893`*^9, 
  3.732078782264574*^9}},ExpressionUUID->"0a801267-374f-4ddd-86ec-\
940cef8d84a8"],

Cell["\<\
This shows some diploid data, and then the three options (LE, Random, LD)\
\>", "Text",
 CellChangeTimes->{{3.7319239786051693`*^9, 3.731923979980104*^9}, {
  3.7319258663851233`*^9, 
  3.731925911594801*^9}},ExpressionUUID->"9bcf291e-1c01-4c45-a1dc-\
119821675c08"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"dd", "=", 
   RowBox[{
    RowBox[{"dipInd", "[", 
     RowBox[{"0", ",", "1", ",", "5"}], "]"}], "\[LeftDoubleBracket]", 
    RowBox[{"All", ",", 
     RowBox[{"pL", "\[LeftDoubleBracket]", 
      RowBox[{"1001", ";;", "2000"}], "\[RightDoubleBracket]"}]}], 
    "\[RightDoubleBracket]"}]}], ";"}], "\n", 
 RowBox[{"GraphicsColumn", "[", 
  RowBox[{"Prepend", "[", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"ArrayPlot", "[", 
       RowBox[{
        RowBox[{"makeHaps", "[", 
         RowBox[{
          RowBox[{"SortBy", "[", 
           RowBox[{"dd", ",", "Total"}], "]"}], ",", 
          RowBox[{"Method", "\[Rule]", "#"}]}], "]"}], ",", 
        RowBox[{"AspectRatio", "\[Rule]", "0.2"}]}], "]"}], "&"}], "/@", 
     RowBox[{"{", 
      RowBox[{"LE", ",", "Random", ",", "LD"}], "}"}]}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"ArrayPlot", "[", 
     RowBox[{
      RowBox[{"SortBy", "[", 
       RowBox[{"dd", ",", "Total"}], "]"}], ",", 
      RowBox[{"AspectRatio", "\[Rule]", "0.2"}]}], "]"}]}], "]"}], 
  "]"}]}], "Input",
 CellChangeTimes->{{3.731744625609489*^9, 3.7317446295358973`*^9}, 
   3.7317478246344023`*^9, {3.7317499027724733`*^9, 3.731749903029346*^9}, {
   3.73175020029239*^9, 3.731750202818117*^9}, {3.7317516062283993`*^9, 
   3.7317516091368093`*^9}, 3.731923970831787*^9, {3.731925951038068*^9, 
   3.731925956790416*^9}},
 CellLabel->
  "In[653]:=",ExpressionUUID->"eb378aa7-b1ea-4242-ab2d-e1b1567ddaf4"],

Cell[BoxData[
 GraphicsBox[{{}, {InsetBox[
     GraphicsBox[RasterBox[CompressedData["
1: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
       "], {{0, 0}, {
       1000, 26}}, {0, 2}],
      AspectRatio->0.2,
      Frame->Automatic,
      FrameLabel->{None, None},
      FrameTicks->{{None, None}, {None, None}},
      GridLinesStyle->Directive[
        GrayLevel[0.5, 0.4]],
      Method->{
       "DefaultBoundaryStyle" -> Automatic, "DefaultPlotStyle" -> 
        Automatic}], {189., -38.88}, 
     ImageScaled[{0.5, 0.5}], {360., 72.00000000000001}], InsetBox[
     GraphicsBox[RasterBox[CompressedData["
1:eJyNmoGBNE1qs6nfkTgHR/KH4ASctsOwfdugR4I5e+79dnq6q0AIQbGz96//
/h///9//X1X923//95//UvX++1X/+N/r6/q7+sfPqn6sJf1hVv7d/ds6n3C/
Cp/r+ZZZPKtf7WXwa/bdAHCPSUL6ED6sJGRaLt7EfoT2F1cbiNDBzwqlGoqw
z78PIKmt8Mu4D0rmdg2SgiOmGpxoCbDZtqdV9Oie/4B3FGICIhAzJoKIwejy
Z8bnnSi4/h/P21jE7JpyOM6w9DOWaiVoLBHsH6tkwaMaXJ5RRZY8IZFDMiAC
QjEuGph8LmEd2mT8gOUvW+36KVuGrOyENhdhHnBr6g4hVHav2QW+HUlWQune
XSmuXLfw6tWGXTJoXvVmoZ/FgNwmXxabxa4eMjemsyjObe/MrEGWvSfS2FX5
3rjqvGuWq/ROW1C63fzcV0emTAV/nvbBWxVYgkE5sEX9qeoV7e5Xy5IAGjdi
mNWW6d9WAVsFR9IMwi9TiN0kgT1iiihDn6oKxRgn+x++uYJ/3Gp5SlCkxZ0i
puoePBIzNqABeTqmGSfuZ8N4FsRBLWajslVeHe7RUzi6tMnJE6E2+XwNqiTs
T5JKjcxomYWh96+Doi/nyTGa9Hoqv5QKuFHTzrPNkZoKcKYb59UTTsOiOEDm
MqUjF0GXbBaunYG0NhvKDa9hKePYDyItB+IllpeZJXWlauScHFmTDPvTohlq
Y6qMJ48wg15WDb+PnD03SH21dpGD2Vwv9EtMlp/NX8aLSI6llDcnmatvOEMV
aLfrYHJJ1+JyF5EGNeyvG2g6BL9L2fis9atE6c7EVyqOjKGUlwl/eVqhLImn
NJgmnzd8/awsFxwWVawGs5bXvRNbjnSsZHtA6Pj56PemD5XJkOSsNOk6KseQ
Mim+cWVEnjM3XqDBCvyWPYwGZzPzwbmh/IV7xa5ELw4jzIaRptb4BlnAIhRZ
vxC1uTruL86oy47ZiqPKVdo/Sui8YHx3m9/SjjPKlGNwrWTO9TbETSgVXiOM
6vEkyQ8dNtUIxYcYGyzUpj4JfN2JR77l1eFl9MFduYYhPs5Nuvk6hPINtL1b
IReNFQ2B5mgl+O9DzdscZZwucRXIPNmM9vREVmDIttTeFTS3AT9iDpbf4jLP
htE2DqX5nAZtwRHy0PyNzsHMhTXiOk7EjjcUQ2WmXGkSYowRC9PrhiKz26Yj
U8JN6mKiXeYJ4TdlE/57L8gOvVus43Rh9awjrOLDFtWZnWAdfcPDMrmUSKkA
Bnkd/BdsteBGma4GLJvDU8ogpn9gKYLwCITFCX+tlpH2QKy3dM5qwG/soQwm
d4KV1gIGd+aTihhQwecGZXx6XPW1508KToKQyzkt4hetBdocFJ80r+DG+1bM
0jg/y46LEYmtx0i1BIjYg0ZaUlL35CxnOsotODKAiE0opne6fRKaZ7LRqZu9
oeOt60Uj7q9isocOHFNoPUNdoHO8VWxbfPT6DjgJhIEDI1Sn+FUAO1AmLZ88
AMduZNk1GyEOUCwJWS7uFpIFWtt8He4XgB8Mw7AVAavL+gCTlUcKhc5bEl8n
1Vhw4njk7HBrDQ7FCxeKn1aldYWaZsxeD54uL7OtkDV6zhbLf8be30AheJWO
H1DQM3F+qciArKQwhIRMT2srQD6HVJL9KqfWTHbpDAwbbnZVsePDa/s4IRYI
ifsh7qiaUc3g8VRF+ZhAecBYJwYXFf/trJniGNyPQXmkTpMuDhSuvcpghqQ3
s5ZjLV6/sWOn851viKqU3uRmkLuWpQ2/64HmRXCwK7n8Yfm+EAoMmjDwpzBE
9z2ajgRFzWL2iZqHcnGkZeH+8H6qgCQy/jPwgY1ZQVGFiyiHWKbRQqg39srb
gz3SmpLOXCv5kTWq7GF6OJRe+AdDF+QV7gsJ6LxlJEW/xcDiUICzeoJVgpbH
dd+UqvN5eyk6kXeeudFRVvg+aa38GQZHkexFGspYDb2DXylzvpHBaFHYAaQJ
mnsa3U2O1/MeEKUZJyeAlCEz0ujYlrVPyoNK277sSMNfkQEusQFhmqXVon+d
sWDxrhmf1yTiKsOK7RnwILRvayjxzw+kZCfzIaN9UvRuS3e9mTWkB88slGjR
zH78e7h/csXg+2NC94toJOaBks6WMaw5X0Urw3gvOQ5DqxnEPBVqj5FXE8w5
jkw6nE1HYAUgqaB6EqAcEvR0keqweczME48D7trKdva7so54KrbMzbJAw80a
8Dy2z56ljenGHz07za5X4jiLaTxN2el67nj2obi5n3HYEKEe03Uxny2ag4vy
+xjJPBtvfrv8UeWGsZZh1wVPBLdGWuaeirO4vx+yKMySzIe8DEuV0Ys2Yy1t
meYfOnRWKq4My5yAmPJNdurpK8KF+2MfcuzPl3d04/ZmZiM9BLYQm0Fg2aaY
/wwwOPcNLh2msPbqukKBKAKTwytXoTaM03Koc3IZenPQGS3tmYAlXLhfHMfo
83ynlnuVUQB4+3yPzH24gKm4CQNIHgr0Ug/x/ii9M1Pasc2eJiLAjzOrsCor
7vk6qXzj8Vqepb47GrZw9gV6ubxV1+JPKPQhR5SRHi+AKI1yGHV4PrRv0ygw
9s45EMHsmyH2GjKZZ0XE8CMKaXz6sXe5yrBVXtE8UVY/BF+Lk8LeCY7uuVys
2nNbmpuPN0E8eJmE2LPK3cQui7fu6T3VXpPlIdRHV+eqv7SVzvhJ1CMHQKRD
DJNWNH2TM/NVvXcex4xtQqs3q5PkVj6hJbf+0adC1JxLaRT0vVUkbsvDcGFN
aTYp/FNgr2076kpjLO6QjaXsIOBjPvo12sVYn3YABPSQNZacx3XcZgDUZTBg
HanCVXDQSn+jIcN+gQHkXWKp3ga0niolCW//ClW0gYhdgoFwCd7nbSHaZwmz
VeSi9P7qh4bXuIggblGYnfFZ2PXT3RA7wy7LQixMlwh8gRXzW5aw/fjMlN8C
+F2pOa+X7rvYEl61r4SNL8eXNuBVQFEUhuSP2tLyF9hP66959Y0RApAonmfG
VRxzV9qWRjhEGI6QFB1Zg3r+cgeWIncFCyJnBOPYl56SO7/YWMBArICqoB5u
5femCFw20emmxgh7s/RVXYlV0I25cFz1K6MDHTwrR8h5FsUlHi/y8JgtvBfj
MDKD9s6ZL9fM1hR4qlmia9p1OMNI/3QOmocHkeWBFCCacVSH0ag2Og1t/qPU
8PbrTw8/yMMNcA0YEKLz2mONdz0UXsitlhGsnxXHtyIuXm6iZPjbeXUtuSRh
4jxNkiGk2VrjwZGk0wuC7NHCg+eGOrLPVzl0HnxXaVmIHtPHyH4YMsKkayiN
XrN8w963zqrPXYcs95PpB1XJygFhCSerdeJ3QWyuQ9COTwusXQH6j+T9RYSQ
8lGoS6rMFqCDtWwjC6Zqw0fcRhuub1GFlmnfFsiH97CO+ZfltjgEWZV7bTRO
UJlhTMEhFZbaeTQNh/SFLOb24FNmRgNbkUd+BcFCKYUdqLljdRUx8RyEfSqD
7mJACYTb+cYg3HElZRTafWJpzGk9bFbajTQudZlPu+cHEtl5hsVMd5DjXKsZ
GkssXvVIzwDxqnoSNNhxbEtIhX8Q2wfZcuJlcOIUEksMTYyNwRaqntnENhcf
exAQ7Xio7RsmQT2yiIj5G3qEtnvrdZilbTDn2GKkW2O18W0xZ/RBmdcG8+tC
X0hpxxWzm/1A1r1aPsPFxVDhXII9Ff85H4cZywmc18JwYZqcYHCJiGm34vMr
FZwL3nZKeVw/mmfSLcniqO8feV/Eh/itJJzbc9s4WZMNUNM5Ifp5QUl2ANQ1
aRkRdjt3pF4Cpj189nJgiH69XhgpMAAYfK6TbJbagAeB1oMPAL8+mCqOpugK
60r0E7i8iecoUZtGaDQzPIkqaxT5yhb8DR86A5kia7W74CCrYuqSKqMmFtZ+
brk7LAxMS97YPo8x72JprgUFQMtq4KDcTnzii1/9gYKrBmUoDzstCH5rJ7z0
IO/9kzDcgHvZ0v8yMERj1R0RbmrXlyHMqIn4bqJ+yP64830oBzOqHVEwLIfb
AuLhfMQVcWtt8ktBTdidwqUzFb1N2s6sUe/HHAMvzY8bsNecVEdQ2E3L2VKb
3feOxGCv86nP6EKWTxXWEcJc1TAbd40t63QTRvHWbqBoH0cBTyZNA71awg64
0EByRG4/tRJKCoKJJ/0xXlRtX0mHIWXRzKFvz72DFSRAEc3G+3zlr7/IRaZB
JQsii29CFQWTeoMRJbQS3yJEIWQNNfU5z0wBzWjI6hE5bVyEnsYORNSJZ5xC
JDUWnRMHq8ZDNfukgZX5GaPqgkkfy/LV+pCzsyxCFuvqDDa/0Q4tv3x4YHcX
lXtc0pbS4uW3xlLENFGKZ7JiLbzCTQaVXRoPHJjuzZ7KfUEFasLQ5GbYmF5g
jiyaQw2jwQh/GFml24I13Vk3vg7oRBcZ3WEtquI0x+i5tcLhBwIJ06uubJEJ
yPLlv2EoIko80ld+UVh3gHc4Vjn+EJrzvjZp+cPF9Cis2KH6sUiEAwDwfdEm
kYrRyfNjBXP0g3GyQ/3C/hYcbfNTBPLcH/tEClr0uBsVydWGK+BjPJk3SQoT
ZfLFiKLgsKp8lSFQBT0VpI0viAiEjTaMv4yzkELGyxqkHDO2Q36qEBrJfYZ6
3P34JW/6Alc3OTYO9nJPYFw5cZvIyojmM7X+C2e+yt2wZJuma9JDqXSekI4I
DNKibrHMnHtpuN7m+sfQsQ4drxSzUb5IPL2RmYh1kUEo1FJiivI9Su4FEGCZ
wI16qgvUMUaUZMmCQ9tQdNerhzdTQTs2VFfxY8Qy1H4Ldi5nujETyy98EV+X
GniQuSyoHYyHnZVmZPhxt8wE+jQXynd7/jMz5uXFDLu38Xo+xjIvh6k8XhOp
CeLkkHv2vV2efphMsDUPjwAKgSVjjGUWVnt5T5USjP34/1phE/3Lx+ZFT5TH
0/SzB+ZwJ9oS6+nhOp7smgGafS8sNGiVqGOZ4lnl4GdGYGujICgNYPgvva+1
EWbkHcRYT/5L93nM++V6KbO1VxrCwv8w4njjEOHCKz+/XFhOAnQ7MksiYAUT
N3ahvK7BmVwsBDjysi0ueXPnLiKP3sQcgQ6zDhs6pKw2gz5oWQxpNbgwiHkT
tB8Ti8WwSO7snOkIFG0vOgOP9hpr5Vvk3PIrbWqTErIry/buFa63wkqDOZNh
rQiJUbmhW/gbhRBfqKCBfLyRHCzgrLoG3pr5xH0buK/cW3W0MT+yCMS4PfJw
ygptk7E1aTxej1smOk1h9Z86y1KEPWtP5Ut1k9xhu/m0yjVsUHpEy08Nrs9G
g7m1fIklQkSyo4fM4CrzXgpaR7A1ojNTWphTAVUTW1QF+v9qmV9Wdg3k+Tic
udeiD8s/OEVx5SvVzsDCrX42ttXBds6Pm/5cLq0po13nQgClEASwJO5JobBH
O3SpBxupj3zwU+w/bjlQcxBSWhmBPwOFFDg9HVP6GjuVcV8dLLnwtrqy3elj
Be5gKyJYJysqgERMM+ydh97oh5d7tpLz82Gh4HaB2BO7Jzn/hcpTFja1fgWg
5WRoLqeBcB9Huyv898rPry42frpVHI72FT6jIIVjldUsgXghmKP9w2Cfihsk
C1vZmdNzCXF/8DTjm/Rqq1AYkp6jTRMbxdRsdDTVm6Oj5/+vEI0KdD3wwPr1
NBq66KrEtCeumyIn21NW8y7daVREStLs/X3RfilatzPzpbFiYgIsopnwU+os
j8hOhx96GASje8Vp+QF04J1iz7p6tDI8SeOvlWph6wGBR+f1iXkgtiJt9EiC
YM8LfJWIeSipjbhsg/io2H5qlBIPselWWGkCuGkai8kdSfQxFR8qrcvClypk
TPIdmtneTQxCQaJX/JAOeuovWUcB1vEoU+2PepA1OVkPE6CaEJV7M2gas1Ae
UkLNLhJ0tLkOpy24LmqQqG2BhuiieP8qhrWHhkwWrBQsD0fw41URlCh+/pIX
q7O6FhQo0BeBQRNiZMyDBsHL3xGl2+VpomWRS6CXvv8+rYiOvXyYTdXhv6e8
frZw6uY2jxfwwDuyF2FOoN5cFp6X21gbaH6co7JGajuX4/AtBY95ZsTUkDoY
8IggdIezojD0MmdUldeWZDq28EubRdDW1UFtFGiSq5kAFyt5UYIiiLXi0GGU
an8b6zPv5seZpYYse5mVZ0NaBAZj1zhVA6cAjArTU8e4BNv7sjfpr35GDC+z
3bHr2RGewW8ENmhGmIPCqPZiuDywiH5sKxL23aQXeI1NNklISdK/EccHJju6
m3a5AjCFe8wS5yvlrLmjnHMUoWb2y8BbEr00bM+TBiagzNv18sYTMaJngh+k
C/KPGPFe8zcoTDMO3KPH9FU/KEImxQuzdQn26DdBj8Vhk00/cbawGCJkesuU
UAwPZxNFOCZ270m4xtjO9QxSfgy8dvbPreK/fAB+Ld+T4XzgJrdXFrVWli9a
L2TQ/lwLP5bqQC0Rjf9yzzuCfARDGJ09du6pAFPOSuvJ/3Y6MdqnZdFnt7nn
rK+NZYFb1HN8i19ra7PO64zjBuI7/qjUBWZ4KIUZlTrFngsGJfzZqGLu8Rj9
59WiUw+u+He9IuO4Xe5ntBdUmberDEqbQZJVhKNkWnoTnv46iLHURd0ZsWRX
7x4Lxey2FPkH0eTdQ9SjWsGZAvOp0ILT6ZOV0dw/45hqGuee6YqUYSTZlo3U
QQ5xIx5vqMDk00agAEkPBdWxH6p2zvqWFUMxiJUuKIfwwYmNRIPAbzGmcrv5
vu3r7hzciVZSfQPIxTQJfHYbbq0zd1xluxaB3oM3/Vx21EK71ag+gbiyT3sw
ITGoLhc5gFeUaWKj3sIIY6ahsr2+nl16mzUBkCYeCqmEMF5KVZORoouMxzhg
wRWujtnle1hrX/CjbxEUTMjaLF9AXACVWxAg5G2rWFduhxou2+5/oBCdoEvJ
MA9eJeFrvvMg6w549nTg0bmSCUZc/tGkuL4B8Ve9noQMnbWZxey3TXVb2PZs
wOnizEnPlOk/faLykqpYbUTsQUctdZUQs4XwfSArWakX1h2Er5B7LxptMsgx
hw5lD7kLBjCD2Nckn1xTaoc+dQjDaMC3EH3jUqeFr8IKwXObKI+UtoVncmAK
n2849ncyw+kWXEahEPOmbbHoOK6eCqYRWDP96GmzWaYhrOC6zyVziue6y87l
yVlsrOgr7iPs0+Mzjwd552RopceYpdGaXyNr7HSmgbYmB1ZE43GFhZmt30/y
rFyGAXlaGola8Sa4zq7ZD6vNSk0oY5H5YBCCVXSEhZomGV6Nwx0zI4B3kBzh
tYFkwJsapgRSs2Y/HYlFlhpKpe/YLKueoXmcB43tUmIimLwZpRoSos4BnPAt
Gy4zv9EaNUVA34fAI7Q1xnn9nWz+pLgxHG76ml2+CyyV9spdGJ15hjJtzN/K
cpxOYkMapNKLwJNcJJX8rRyM5d6zhLWYTnJTS5hRst7MfnCpmHqPUgKQKZGA
A0EtEexHf/1FFUsHpTPNFLoyCbSt1wncMLK/ZRt52G3m2zb0aerDAWxBWsIX
VTk0/ZYz9arN8cuV1ak2LPPYJF14kblvQ1x+59xBw15ZtnawdrIqggmD1A2D
gDLmuFhnAiHtl9hM47plDcsyW+DwQBUm/XM1bCpd4+zD+9MnS5n7jmPfJZNh
Q/NXWAbWhJRz64slH6U6nI0cmEks/tx5egnXI0TXCxfFRSfcQxct9ZwCVjJO
E6XM+rolSz6xWeaX6bnl38SVR/k4BLpys2SvRExLg/AnnfdfzA+08FEKrwTu
4mGoL0bz9mLc/wIeq9MHpJ0OK2QrMYQ2Hx7kn6PAWAEOtOayiwraDFm/+tgt
hTEOYkhwHP2WBTCtxfXiwVAEk+PhVEEkAx1alIWlzh9F7Oie5fjNITZX7H+K
TbdsAnLHtRzVCzUwkJvkZGK8lUziFDjlw6f4V7ZCs9HrZNIRc6vez5hDWQtN
J/m12C0q/7N54hGxZD5dGN1+yIHdfuxnd3WwcVi5OKqPm1uGRBFUWJpWLHOn
MoA7pdF3jIrS5qgemXA2rG23xeOLgwSD/a9QwQ1A/ywW0gpMsROB9XX3a+KU
BKeVYUx2uCUHhGFlZ9a92kZ0q3QuYkKanV5IwOLQhpPio73koomC0i1srsl0
bS9+cmOcekQotRorT8sUJmM/pq4dByrFgwEQlobhQhBWoDo0bdQIuAcK02Om
pqS9/y0fU0+TfcaQHqG59LYXfjkwq+n+t8ahaSnlUzsC65oCYzZUWceMsNlY
KmD2ESP+vOrGXOW64FmXGj48eVzrst5GLKgc4gQPN1nC6joULnWng/4KCJxb
vpOk2NVCmP2W8xTa2UOywF/tLWu4G18ji4fdHyH9TKZyrq+d3NLaTZb9nzL0
P2yyuGGiYVxqKiVXNTqhjGRk++BV4sUpRDKZyAlwZaocxVhMnOKCDY+bBpk+
WoHQUSUef9hFOMkzcxGblJ4F6B/Ltijy4SHryhuG1dLuKBZnN+GXL5Mr/tsb
yg5wEiqQ27y1BOPJIFTcoAxGUGahPHAUhhUE7THA//PLFBqkv0/3VCVzWG5m
YBQNQkDWKCzjynN9gkceajgkT6bRk4sItOJyZQtnzDI5+E10Hvpy6TZW5zX1
pQ1Vh7x5pPVjc9PVzdjXd0YgJisNqOtLxW7yz+aSvmr7S4Jj4Ih6K6nzMKs1
n0zWJXa7BzpqQimYRUVB4EOHklvtmfstxCNhvajgQRZCa3AUT1dexdTkSLsm
dBGh9XLy5Ywnlr8c5LLxuixXabn8lxSdrZkuHe3gczI8o6c/OqHf6coj3tL5
V3pWXlkQdEHz0FfZMuaqXizYPJct5snNKnwNOYKEhyuDhGCBBl804PZROSfs
9PdD3BjSKJiB1KlYYlQuvDqJboGZgzrzMwa6i3kf2nSaF6SmGsdRme08woif
Q0umeKKd1ZCtQJfx0NoEZSVNuT54GCuMGH+c1F+/+kZ1TuprPlkQfcnv1A7L
JWQBkyQpzFVoLZqoIKSRG6lwIO7AChbNjSdNDoj05QUQCU5dS0tJt2vpmuu3
J+Sk7IJ7T/nGEFLrfhfBl0Uut9/Vepv+gCr0pbWmjuRCElvlZKunjbBOH7h1
w4Dk2rFId3GxyrZssxwe9kwgEd2HO38prmbK82vyMoAwDQIYQfNViZzw7fTD
mOAslP3Ee2hnsmEMvhmIsLhE/KFKJ+Gzxx5b+ydLJo3AfSXsg5yfmKxjsoa8
TOPojnVWZdvadz++lR6kEEk5zn6cLKgnWCGZMzuKuGod0MraHeRgmAqwSI+1
tms+lYsDAwXArW0I7kjhD7B6YsUaTKhmgDfU1lD1bDi3FPvVkFoW7y/Kxm2p
sUW/XKXCzOuGHadlEogqMRsZBIU2d0BCwo9vCCfyTDlR7xy3On+sEUerJwRY
fch8ouDUfVR8XR1KcaOySnXNgobrU5lSjCJndKH3AqZIO5sWhb31SoSOCgYT
5ggwPaGYRmfgKToZjPhugXRgWic1RJTBNobyh5bZXPSkkDm41oQKrHGLRZXQ
thqbhR2VllRXB8wMnnVStTEd9bXM7Sz6VR7Bn05iS2C224wDu7aEb0Uhhqdi
e4PCW5lPe9t7QVGBGPXLcdA4mRwF1T889vyUkomdjIWB2jpSNWKZzR5oR7G9
eSlGsTPM7gV57miTh5sa+b0iRCaRsiysdgZRunHIL6KIT1PZliCj4UhSJnpF
p25+HDBlth2jF19yAxES7yq7qrD47R1kvInfKzA9jvTGy1GEMIl+5jkHKKlZ
/4aHsdeL0MMuDps+rwGvuVtxToi8MBdHCdB56lP+G0XhBhE+7FxQy+wqKsIy
3duylDpg0bup5Dy6IvNWUgh6szOnR2GZk2P4yiy6R5Mpjqp9Oz+tUzM8vHhS
8VB/vGCSM9Skvbic0wzlWnFt+Bh9m/Mc9i+13OEWjq8IGK/H8yWRB4fBjYAx
lpk+fyRhQ2NswHFNsSOP4qop0WvCie+aDH7xsva1jQtRpUhqmhSreO7cJIjK
zG+e40meIZ4lv9zLzEYhy2XLXtdcir1OuW1/VjEP1/Dj7U37NLk1DmygaWgV
SJJA4FuHt3etg+pjZ5yvWvWhY+VMoaZHoVIh61ZFkcITK9gy3rXLeDQ0TqZr
B+CW5OVhPQoDmbrq2viaDLvwfJGVFDJPSGn/VRGWBz3ed4Xu0BvmfwHdcJuq

       "], {{0, 0}, {1000, 52}}, {0, 1}],
      AspectRatio->0.2,
      Frame->Automatic,
      FrameLabel->{None, None},
      FrameTicks->{{None, None}, {None, None}},
      GridLinesStyle->Directive[
        GrayLevel[0.5, 0.4]],
      Method->{
       "DefaultBoundaryStyle" -> Automatic, "DefaultPlotStyle" -> 
        Automatic}], {189., -116.64000000000001}, 
     ImageScaled[{0.5, 0.5}], {360., 72.00000000000001}], InsetBox[
     GraphicsBox[RasterBox[CompressedData["
1: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
iRMnTpw48Uf8F1Osm6o=
       "], {{0, 0}, {1000, 52}}, {0, 1}],
      AspectRatio->0.2,
      Frame->Automatic,
      FrameLabel->{None, None},
      FrameTicks->{{None, None}, {None, None}},
      GridLinesStyle->Directive[
        GrayLevel[0.5, 0.4]],
      Method->{
       "DefaultBoundaryStyle" -> Automatic, "DefaultPlotStyle" -> 
        Automatic}], {189., -194.40000000000003}, 
     ImageScaled[{0.5, 0.5}], {360., 72.00000000000003}], InsetBox[
     GraphicsBox[RasterBox[CompressedData["
1:eJztW4mRHDcMJO1InIMjcQhKwGk7DNt1Q6AbaHBmn9Nq74AqSTMknsZDgHOS
/vjx918/fhtj/Pnfr39+H01Nz6D5S6t7O7rH/zeM2XxDzE+kh7x/Teg+45zP
/8vgLsVJ6N3q6TpePyo3y8yDjpXJx25tzsA9iWE9EIb/pYKeAMA4AXbiYoFg
6TItiYl6lipVKOTmpC3Yo2jMInZbnzg0oKp0g3kmUgg6aDSO6esC1kcBuK2l
IdkS0OgZhKG4lOcgGrEr9mg9a7eYZ+88Z4PjVzgilGiEk/WUMWIPkv9HimZ5
oA0zxQq9UkaP0oRytJwegQhVlGPNO96Vg6hVGWKxomLHoazGQuHGME+uNOBc
q5gCh+3qhGjMh3BCrrlRXEiaoQlGBjjDLJT9ovBIgixv0+iZWCEzICwXDK2j
vHBZIRR4AgLg5EJcZxHr+sAZwXwUz4klBLzlXUbtGXcgc1jrfrwmc5tnkG5l
UIL1QmAfRs5KKu9lfRDl5o+OkIvbRpv2qcxKES8WEJkohBsDwpYR5yBmPvHI
bRO7AMd+ksBaoPUJaGEb/MHkRsQUmBypwGMaoEdK8dQLzFmdGB8lrCY8KtnC
F5kQVS4izlGLALzEp1rwBCasUXsueaoGX5ogFjwoqz0qCaGCulCyubSTw8w/
Zoof9QpvIBRZssH8KbmEBgZUAL15IHm0uKBhaStJQzqgiQ8UgXPHMtHLqJGQ
QGKElohOZUwaJ1uxKCAAhxv+5EAo1qHjj4mwVG4He+gBPNrDoEBUtRjrAfeo
OUFjQYDTL2RVs7Cr6yR93luFYSx8XdlzxC0HrZu/xwer2dFgKiQmsTXAnyzD
I12cotxwqrZQUM1+o6JCyUnnlYPkRhOf/HMv77VX7RTdmUsTJwkX9nV0NH92
hZDUxNG1s1OlKN8J8KyD7A35WWWflzc5SFYv2hrD70HZZC2klpPHPhm3wtbF
zlIde0NuF3Po5SzH+nDMcNexAN1Fo3gOK6WBUqb00+AGB2uN3rXP3RRpuByb
2kke/LtAXbFczGHBosuq0mZRur8cbqEHjAwskx1fHMQ4vEfJ9jwq6041C78f
pYZQNYrUmUjNUc5RbdYXZMe6NcGS3SBB+KQX520EjBf0vR5WSOHQroSb5nXd
Cada4706GtBL4o9bQoLh1hnnbVRJxYHgTEntQYLu/QE3TRexBu+tqGu4dZHt
CvC8vKZ/vgj+VFDBWF0N+XjoGOIR8KjTmilKnUDPJ/GYFMCmXSWzKquwCV+U
IHxiPWIe4XWkjZH5rhHE3VXbH1oCJIUrJ+PXs6OxR28RKFqPLpR4QVgAlD5s
FNUWfDuCyQDXC1bDR6F4yVaXkSEqgv7kkHFCSRAxM3g70tH47jXt+LgCk3y8
kyCCQHVHdHiBeauO8vWoaqUPhmBuX4th9uXoiV7SJeOi4pMkFFqeA3pur4H3
2dhfhdj6NUtl1/mC9K2cbZLF/X1rIA06u1SPdYXErjHtUnqIh5YxXGy9x88r
v2bmz7QlctabQENqevhNExCKj7m1Q/oZEYELohHtJB/mnB7Tq8N9Bca/FmKO
lg0KhNthD/lLe7mwlNowmuvuF0MQkQ2/cqYNCgTvUCJ8wZPlF1q+oS+cqeAW
S1y1rx2wN0NQaiXiq8LYnNldmlADKSD+KTaB//Qyree5uM1DFmwTBC3RZrC6
/U8vqugjYcXIzEwiqGAxoQ8nRwgxNjITQeTeRIjofUmyVYEcUjJVXLxdAgJ2
0mSmbQ87f4sFHp05ODJ3dLLNYBASlhWGgqoFkE88i2g6Jz4AHPlvX3K6ypdg
kqHmk8GlqCsycWvYh12Hj+c8AbVjV/URKJ78M7BLWSRoKCjn5r6V4yvOjKhi
pf66hZ05lIReKqTy/eT0G6naz4nwxCMgKWU5OreTFJyyhuFxpp8UyuoalrPK
Gj0lp2rTda6rFK+teSEQ2uL1yMT7pGQWXq8FRHihqpEt1dax+uG/NwapYjrf
ki3OA4kUPcE6Ak49ZrvSXkhtIaSQbOBtjOvpulWFQzisXhuHIITjV9m4Ud0F
Bu3bJX/TGuxs0d/nzSFbFdO59ixxViNxIgp2Pwg3eSWZfZAPXngKbU3ads7q
FP0iNDi/dtHupnWRzvPxl3WtHpkRTmi4cF9c/UjBVorBHW+HkWNGAEfYhFpo
KWw8f/MUE8MtLP6jXa9r3lKmBVdXL/BtJ02ZGryOzMQRuPO9Z4qLyX62zxCs
oNguakVyQSYV9u5iQPkNMrKmqFrWUbuSU153TZTzgIk9yIoclDhGDlv0BoBm
v3uZziQH7mTPhPpLHW43ouKsmfGd0Z5yX4DD7MPvOnmbBoNuwMTu5VJPsWyN
8xm3pveErDymhYbd2qThNxIv18mxNXRgrThpFcfQ2WXh8GgsM7wXRcdQG4Yj
VulEt3N1DsooN3OV5xR4RFaDYyzlZhIeaRcYMOSyO5BDZTeMPTOiFRI+zoDT
DgfpwkFTKJzYFM2EQVtZyx/sjLnYra26KPKseB0RPrRRo64CY1EYEO8oY/Xj
iS6V0dvCRftRelVtCMGwImDpaIvCcFIFCTAwW0VA7Ur/lH6BxpQqNDM6t0Vp
Nsl5uqHBHIQrqQZV2ACdA3JeSrgFrxc4AxiulV3rXLotOzcwQcWxEProRgru
bC08qqVkcKyMsjGwPqyEuN3yBUo0fNCnh8/gc37IzCEE5tb/4B0NkGR+uQxV
D+MZCwEYJqWY7EgIiBnmVhUPEgGcsawKMxXDsPztOEsjgjVlzJUEXOv7Ka8D
x6nBgA+OIpxaO+dCfn8eBr+kbegMXupgd/qoSfVfNEkYoaArsLgw9EjCk594
btikStu50yN8Z1mFk/XnKSr8cPSuJEfk6lhDtB/6Qi4AEsKZlh7vXkJltqEW
8Bd+oYapNEeonJlM4Cnn0manJF5fh/OAUY4lGGo5aMv3DzcUV4IPA8rfuw15
yZbcz6XBzpxAKiHMGPZ4HdFVEQNAjZ0CBeHNNDJfZOBX+VLxBO1l79dQR95w
tUKn4PVYpQ2q1Hie+ZwLvBOzEhrNaUwzdFObWm4lO3KWi4NCXi6+1UuqqKFG
6YxcYxChbeDGqD3TlhySDm4xe+34EOi6Zga4AONBYxLGgoQf24g2yund9FQP
5KK15Xj5u3AtTwoo8nQetUmyR8LJ28TJ9jCEyxu8xabBFt3xY00GY3gClgFS
4Q4yUqCpulDlUNxr6Qh2vs3ErK7DMmB3ZSp5bvM2paaeQZATspo4CBnrx/OQ
ms4H+6os7ghkFoVOSjsP0ewx5jEBtY2ViJK4OLmmIoNtRfdDqdu2hWzEgGO4
U8yMBzFWwxIMpWVSCd5cVwGqKi+DNMQI6znI5hY6Qxw0ih1m2e2Kz6wJQV0m
uT949ExIVY4Zsu7Fe9mh2gftuPdEoVIMgIPFVQ4WAKvWULKOiHkkoOeDU8Fa
oc2CKwspyJuS8MNR7otE+Zk+8yCvKiEMbcReotyeRo3t5IyeidfcLKkDoM0E
SRHu++k2Jx42eau5x5y7g3S1juowfla1kOCN7LKq77X+iFFkuMTF7E+jT3b+
dssvgfNTz/m70vfzuKnpLenGo/rskfJUdb8iqQ9JX7lxrg29PdJDU9ND1JV0
P12N3d0/4bqJvm8m75gurx9Ir/vK+rXp50XlTRPwnqibmpo+g7ofPEbrL3he
DePVAJqamj6d+pw3PZPu+fj9BBhNP4Nef01pehF14r8R9TF/X9r/c9EvQjf7
99UD0tTU1NT0i1MPoqbZX9JNTU1NTU1N34/kf3r7+TCampqa3o8uN8vuqk1N
TU1NTU0PUl8nvhJ1Npuampqamj6fet42NX196nPe9BLqwmtqampqampqampq
ampqampqampq+ib0Ly6tm6o=
       "], {{0, 0}, {1000, 52}}, {0, 1}],
      AspectRatio->0.2,
      Frame->Automatic,
      FrameLabel->{None, None},
      FrameTicks->{{None, None}, {None, None}},
      GridLinesStyle->Directive[
        GrayLevel[0.5, 0.4]],
      Method->{
       "DefaultBoundaryStyle" -> Automatic, "DefaultPlotStyle" -> 
        Automatic}], {189., -272.16}, 
     ImageScaled[{0.5, 0.5}], {360., 72.}]}, {}},
  ContentSelectable->True,
  ImageSize->{828.0187499999998, Automatic},
  PlotRangePadding->{6, 5}]], "Output",
 CellChangeTimes->{{3.731923804171012*^9, 3.731923828638035*^9}, 
   3.731923864096692*^9, 3.731923955326779*^9, 3.731925957459621*^9, 
   3.731926010831687*^9},
 CellLabel->
  "Out[654]=",ExpressionUUID->"1f6182e9-b3d0-4ab4-bfe3-cf044b7bfdfb"]
}, Closed]]
}, Closed]],

Cell[CellGroupData[{

Cell["findPosition", "Subsubsection",
 CellChangeTimes->{
  3.73207116745399*^9},ExpressionUUID->"6be9209c-63fc-46da-8f63-6c481d6cb6bb"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"findPosition", "::", "usage"}], "=", 
   "\"\<findPosition[{\!\(\*SubscriptBox[\(x\), \
\(1\)]\),\!\(\*SubscriptBox[\(x\), \
\(2\)]\),\[Ellipsis],\!\(\*SubscriptBox[\(x\), \(n\)]\)},{\!\(\*SubscriptBox[\
\(y\), \(1\)]\),\!\(\*SubscriptBox[\(y\), \(2\)]\),\[Ellipsis]}] lists the \
position of the element of x immediately to the left of each \
\!\(\*SubscriptBox[\(y\), \(i\)]\). Both lists must be ordered, and all must \
be distinct. Note that if \!\(\*SubscriptBox[\(y\), \
\(1\)]\)<\!\(\*SubscriptBox[\(x\), \(1\)]\), returns 0.\>\""}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.7320674155287046`*^9, 3.732067539944591*^9}, {
  3.732070909335607*^9, 3.7320709307185583`*^9}, {3.732072690918604*^9, 
  3.7320726933636923`*^9}, {3.732072746343122*^9, 3.73207278715191*^9}},
 CellLabel->
  "In[574]:=",ExpressionUUID->"5983fda2-8ccb-4553-ba78-7c143737bf8e"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"findPosition", "[", 
    RowBox[{
     RowBox[{"x_", "?", "OrderedQ"}], ",", 
     RowBox[{"y_", "?", "OrderedQ"}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "pos", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"pos", "=", 
       RowBox[{"First", "/@", 
        RowBox[{"Nearest", "[", 
         RowBox[{
          RowBox[{"x", "\[Rule]", 
           RowBox[{"Range", "[", 
            RowBox[{"Length", "[", "x", "]"}], "]"}]}], ",", "y"}], "]"}]}]}],
       ";", "\[IndentingNewLine]", 
      RowBox[{"MapThread", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"#1", "+", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"#2", "\[GreaterEqual]", "#3"}], ",", 
             RowBox[{"-", "1"}], ",", "0"}], "]"}]}], ")"}], "&"}], ",", 
        RowBox[{"{", 
         RowBox[{"pos", ",", 
          RowBox[{
          "x", "\[LeftDoubleBracket]", "pos", "\[RightDoubleBracket]"}], ",", 
          "y"}], "}"}]}], "]"}]}]}], "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.732067551153592*^9, 3.732067604215117*^9}, {
  3.732070848398101*^9, 3.732070872243888*^9}, {3.73207183495374*^9, 
  3.732071836071888*^9}},
 CellLabel->
  "In[575]:=",ExpressionUUID->"f65d9370-5b6a-461e-a77d-4b98ea3bd809"],

Cell["\<\
This method is much faster than an alternative, based on sorting values. In \
this example, there are 351 junctions and >400000 SNP positions.\
\>", "Text",
 CellChangeTimes->{{3.732071106722493*^9, 
  3.732071159513294*^9}},ExpressionUUID->"44c9dd3f-add7-435c-960c-\
59f5a98123ff"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Timing", "[", 
  RowBox[{
   RowBox[{"fp", "=", 
    RowBox[{"findPosition", "[", 
     RowBox[{"ps", ",", "xx"}], "]"}]}], ";"}], "]"}]], "Input",
 CellChangeTimes->{{3.732070881102713*^9, 3.7320709039694843`*^9}, {
  3.732070938938013*^9, 3.732071000122571*^9}, {3.7320710323718567`*^9, 
  3.732071036737426*^9}},
 CellLabel->
  "In[735]:=",ExpressionUUID->"5f770bdb-dd4f-40ef-ad4a-6323e8acf2c3"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"0.061906`", ",", "Null"}], "}"}]], "Output",
 CellChangeTimes->{3.732070957014243*^9, 3.7320710378949327`*^9},
 CellLabel->
  "Out[735]=",ExpressionUUID->"02e74e8a-5f5f-4ac3-981f-555cc99d9ecb"]
}, Closed]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"xx", "=", 
   RowBox[{
    RowBox[{"locJ", "[", 
     RowBox[{"sim", "[", 
      RowBox[{"1", ",", "1"}], "]"}], "]"}], "/@", 
    RowBox[{"allJunctions", "[", 
     RowBox[{
      RowBox[{"sim", "[", 
       RowBox[{"1", ",", "1"}], "]"}], ",", "17"}], "]"}]}]}], ";", 
  RowBox[{"ps", "=", 
   RowBox[{
    RowBox[{"posSNPInd", "[", "5", "]"}], "\[LeftDoubleBracket]", 
    RowBox[{"pL", ",", "2"}], "\[RightDoubleBracket]"}]}], ";", 
  RowBox[{"ps", "=", 
   RowBox[{
    FractionBox[
     RowBox[{"(", 
      RowBox[{"ps", "+", "1", "-", 
       RowBox[{"ps", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}],
       ")"}], 
     RowBox[{
      RowBox[{"ps", "\[LeftDoubleBracket]", 
       RowBox[{"-", "1"}], "\[RightDoubleBracket]"}], "-", 
      RowBox[{"ps", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
      "+", "2"}]], "//", "N"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"Timing", "[", "\n", 
  RowBox[{
   RowBox[{"sxx", "=", 
    RowBox[{"Sort", "[", 
     RowBox[{"Join", "[", 
      RowBox[{"ps", ",", "xx"}], "]"}], "]"}]}], ";", "\n", 
   RowBox[{"px", "=", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Position", "[", 
          RowBox[{"sxx", ",", "#"}], "]"}], "\[LeftDoubleBracket]", 
         RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], "&"}], "/@", 
       "xx"}], ")"}], "-", 
     RowBox[{"Range", "[", 
      RowBox[{"Length", "[", "xx", "]"}], "]"}]}]}], ";"}], "]"}]}], "Input",
 CellChangeTimes->{{3.732003320824625*^9, 3.732003331697527*^9}, 
   3.732003369383988*^9, {3.732003554575897*^9, 3.732003560492856*^9}, {
   3.732010355713154*^9, 3.732010459453753*^9}, {3.7320113749399652`*^9, 
   3.732011375473284*^9}},
 CellLabel->
  "In[721]:=",ExpressionUUID->"f4d65d56-ef0a-430d-aa5e-7bbe8586b9e2"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"9.566387`", ",", "Null"}], "}"}]], "Output",
 CellChangeTimes->{3.732010420425342*^9, 3.7320104674963617`*^9, 
  3.732011385865631*^9},
 CellLabel->
  "Out[722]=",ExpressionUUID->"7c4d6dba-9dbe-4c2b-8dd7-127253bb1910"]
}, Closed]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"fp", "\[Equal]", "px"}]], "Input",
 CellChangeTimes->{{3.732071078915352*^9, 3.732071090643242*^9}},
 CellLabel->
  "In[738]:=",ExpressionUUID->"ecddcd43-ad1b-46d9-b223-9902dc51ca85"],

Cell[BoxData["True"], "Output",
 CellChangeTimes->{{3.732071084213183*^9, 3.7320710912820168`*^9}},
 CellLabel->
  "Out[738]=",ExpressionUUID->"6c110244-254d-433e-9c37-a2f31ec47963"]
}, Closed]]
}, Closed]],

Cell[CellGroupData[{

Cell["intSNP", "Subsubsection",
 CellChangeTimes->{{3.732072998282716*^9, 
  3.732072999915085*^9}},ExpressionUUID->"d10277af-f87f-4285-bf07-\
5651634dd4ca"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"intSNP", "::", "usage"}], "=", 
   "\"\<intSNP[\[ScriptCapitalP],t,\!\(\*SuperscriptBox[\(t\), \
\(*\)]\),\!\(\*SuperscriptBox[\(r\), \(*\)]\),c] stores the SNP that are \
present in each interval of the simulation \[ScriptCapitalP] at time t.  This \
is based on the polymorphic loci in the founders (from \
polLoci[\!\(\*SuperscriptBox[\(t\), \(*\)]\),\!\(\*SuperscriptBox[\(r\), \
\(*\)]\),c])\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.7320730029653893`*^9, 3.732073223170685*^9}, {
  3.735287553873713*^9, 3.735287567934527*^9}},
 CellLabel->
  "In[749]:=",ExpressionUUID->"8b699801-ef2f-43ae-8abb-6227bb0a1a05"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"intSNP", "[", 
    RowBox[{
    "\[ScriptCapitalP]_", ",", "t_Integer", ",", "tl_", ",", "rl_", ",", 
     "c_Integer"}], "]"}], ":=", 
   RowBox[{
    RowBox[{"intSNP", "[", 
     RowBox[{"\[ScriptCapitalP]", ",", "t", ",", "tl", ",", "rl", ",", "c"}], 
     "]"}], "=", "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"xx", "=", 
         RowBox[{
          RowBox[{"locJ", "[", "\[ScriptCapitalP]", "]"}], "/@", 
          RowBox[{"allJunctions", "[", 
           RowBox[{"\[ScriptCapitalP]", ",", "t"}], "]"}]}]}], ",", 
        RowBox[{"pL", "=", 
         RowBox[{"polLoci", "[", 
          RowBox[{"tl", ",", "rl", ",", "c"}], "]"}]}], ",", "ps"}], "}"}], 
      ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"ps", "=", 
        RowBox[{
         RowBox[{"posSNPInd", "[", "c", "]"}], "\[LeftDoubleBracket]", 
         RowBox[{"pL", ",", "2"}], "\[RightDoubleBracket]"}]}], ";", 
       RowBox[{"ps", "=", 
        RowBox[{
         RowBox[{
          FractionBox[
           RowBox[{"(", 
            RowBox[{"ps", "+", "1", "-", 
             RowBox[{
             "ps", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], 
            ")"}], 
           RowBox[{
            RowBox[{"ps", "\[LeftDoubleBracket]", 
             RowBox[{"-", "1"}], "\[RightDoubleBracket]"}], "-", 
            RowBox[{
            "ps", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], "+",
             "2"}]], 
          RowBox[{"mouseMap", "[", "c", "]"}]}], "//", "N"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"Span", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
            "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], "+", 
            "1"}], ",", 
           RowBox[{
           "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}], 
          "]"}], "&"}], "/@", 
        RowBox[{"blocks", "[", 
         RowBox[{"findPosition", "[", 
          RowBox[{"ps", ",", "xx"}], "]"}], "]"}]}]}]}], "]"}]}]}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.732073225786632*^9, 3.732073427125045*^9}, {
  3.734222577177393*^9, 3.734222584696735*^9}, {3.7352875719449463`*^9, 
  3.73528758647078*^9}},
 CellLabel->
  "In[750]:=",ExpressionUUID->"ce520556-a145-409a-8fbb-95d4cc738086"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Definitions from \[OpenCurlyDoubleQuote]Sections for a paper\
\[CloseCurlyDoubleQuote]", "Subsection",
 CellChangeTimes->{{3.710231718033658*^9, 3.7102317251296988`*^9}, {
  3.7333921425687017`*^9, 
  3.73339215583125*^9}},ExpressionUUID->"1a7ef4b2-be33-47a3-bd0d-\
006bb1281554"],

Cell[TextData[StyleBox["These definitions are local, meant for specific \
analyses in \[OpenCurlyDoubleQuote]Sections for a paper\
\[CloseCurlyDoubleQuote]",
 FontSlant->"Italic"]], "Text",
 CellChangeTimes->{{3.710231736457046*^9, 3.710231747823473*^9}, {
  3.733392158686653*^9, 
  3.73339216592807*^9}},ExpressionUUID->"6f5c221d-0d53-4964-a33a-\
f8fb6873cef4"],

Cell[CellGroupData[{

Cell["numInds", "Subsubsection",
 CellChangeTimes->{{3.7103866198779783`*^9, 
  3.710386621029148*^9}},ExpressionUUID->"f915e898-0d2d-4396-91c4-\
88a73e9940fb"],

Cell[TextData[StyleBox["Formerly nn[r]",
 FontSlant->"Italic"]], "Text",
 CellChangeTimes->{{3.710386963364781*^9, 
  3.7103869837162724`*^9}},ExpressionUUID->"3924cd91-766c-4986-8a2e-\
72a2bd33858c"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"numInds", "::", "usage"}], "=", 
   "\"\<numInds[r] lists the # of individuals over time\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"numInds", "[", 
    RowBox[{"r", ":", 
     RowBox[{"(", 
      RowBox[{"0", "|", "1", "|", "2"}], ")"}]}], "]"}], ":=", 
   RowBox[{
    RowBox[{
     RowBox[{"Length", "[", 
      RowBox[{"#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
      "]"}], "&"}], "/@", 
    RowBox[{"pedigree", "[", "r", "]"}]}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.710386627523193*^9, 3.710386648741619*^9}, {
  3.710386759940712*^9, 3.71038676250753*^9}},
 CellLabel->
  "In[578]:=",ExpressionUUID->"ebae49ed-6f34-410d-bf1e-047724013238"]
}, Closed]],

Cell[CellGroupData[{

Cell["Ftable", "Subsubsection",
 CellChangeTimes->{{3.710386785091469*^9, 
  3.710386794223123*^9}},ExpressionUUID->"ef0c3466-7666-47bb-8b48-\
2d2b0d2db7b3"],

Cell[TextData[StyleBox["Formerly ftbl[r]",
 FontSlant->"Italic"]], "Text",
 CellChangeTimes->{{3.710386963364781*^9, 
  3.71038697765263*^9}},ExpressionUUID->"a2cebfd4-978e-423c-9e48-\
4f577022c464"],

Cell[BoxData[
 RowBox[{"  ", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"Ftable", "::", "usage"}], "=", 
     "\"\<Ftable[\[ScriptCapitalP]] gives {{\!\(\*SubscriptBox[\(F\), \
\(w\)]\),\!\(\*SubscriptBox[\(F\), \(b\)]\),\!\(\*OverscriptBox[\(F\), \(_\)]\
\)}\[Ellipsis]} over time for simulation \[ScriptCapitalP]. Note that all \
simulations have the same F over time, if they share the same \
pedigree.\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Ftable", "[", "r_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"nfm", ",", "dfm", ",", "fw", ",", "fb"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"nfm", "=", 
            RowBox[{"Length", "[", "#", "]"}]}], ";", 
           RowBox[{"dfm", "=", 
            RowBox[{
             RowBox[{"Diagonal", "[", "#", "]"}], "//", "N"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"fw", "=", 
            RowBox[{"Mean", "[", "dfm", "]"}]}], ";", 
           RowBox[{"fb", "=", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{"Total", "[", 
                RowBox[{"#", ",", "2"}], "]"}], "-", 
               RowBox[{"Total", "[", "dfm", "]"}]}], ")"}], "/", 
             RowBox[{"(", 
              RowBox[{"nfm", 
               RowBox[{"(", 
                RowBox[{"nfm", "-", "1"}], ")"}]}], ")"}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{"fw", ",", "fb", ",", 
             FractionBox[
              RowBox[{"fw", "+", 
               RowBox[{"2", 
                RowBox[{"(", 
                 RowBox[{"nfm", "-", "1"}], ")"}], "fb"}]}], 
              RowBox[{
               RowBox[{"2", "nfm"}], "-", "1"}]]}], "}"}]}], ")"}], "&"}], "/@", 
        RowBox[{"F", "[", "\[ScriptCapitalP]", "]"}]}]}], "]"}]}], 
    ";"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.697139981583537*^9, 3.697140045303227*^9}, {
   3.699670496963524*^9, 3.699670499178138*^9}, 3.699671346343989*^9, {
   3.699671400526997*^9, 3.699671410542326*^9}, 3.699677412624406*^9, {
   3.699685173444654*^9, 3.699685202753044*^9}, {3.6996852435233793`*^9, 
   3.6996852545643*^9}, 3.710064593533008*^9, {3.710129327564211*^9, 
   3.710129421928112*^9}, {3.7101297050061827`*^9, 3.7101297454432*^9}, {
   3.710386797764409*^9, 3.7103868057370253`*^9}, {3.710386855075202*^9, 
   3.710386933744339*^9}},
 CellLabel->
  "In[580]:=",ExpressionUUID->"b7358717-dc8d-4797-9a6c-be6cf83b2559"]
}, Closed]],

Cell[CellGroupData[{

Cell["predF", "Subsubsection",
 CellChangeTimes->{{3.7103869557261868`*^9, 
  3.710386958493292*^9}},ExpressionUUID->"e2767d31-52b6-4b61-bf69-\
5ed42f7d6773"],

Cell[TextData[StyleBox["Formerly nnt[r]",
 FontSlant->"Italic"]], "Text",
 CellChangeTimes->{{3.710386963364781*^9, 
  3.710386966853204*^9}},ExpressionUUID->"fcc4186f-156c-457d-8969-\
aaadd7ced827"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"predF", "::", "usage"}], "=", 
   "\"\<predF[r] gives the predicted F based on the # of individuals over \
time\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"predF", "[", 
    RowBox[{"r", ":", 
     RowBox[{"(", 
      RowBox[{"0", "|", "1", "|", "2"}], ")"}]}], "]"}], ":=", 
   RowBox[{"1", "-", 
    RowBox[{"FoldList", "[", 
     RowBox[{"Times", ",", "1", ",", 
      RowBox[{"1.", "-", 
       FractionBox["1", 
        RowBox[{"2", 
         RowBox[{"numInds", "[", "r", "]"}]}]]}]}], "]"}]}]}], 
  ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.697139981583537*^9, 3.697140045303227*^9}, {
   3.699670496963524*^9, 3.699670499178138*^9}, 3.699671346343989*^9, {
   3.699671400526997*^9, 3.699671410542326*^9}, 3.699677412624406*^9, {
   3.699685173444654*^9, 3.699685202753044*^9}, {3.6996852435233793`*^9, 
   3.6996852545643*^9}, 3.710064593533008*^9, {3.710129327564211*^9, 
   3.710129401485786*^9}, {3.7101294455424147`*^9, 3.710129504908773*^9}, 
   3.710386587025879*^9, {3.7103879550657682`*^9, 3.710387991682886*^9}, 
   3.710399430490361*^9},
 CellLabel->
  "In[582]:=",ExpressionUUID->"5f887c80-b9cb-4cfe-9769-729846d347ab"]
}, Closed]],

Cell[CellGroupData[{

Cell["Fobs", "Subsubsection",
 CellChangeTimes->{{3.710388064885909*^9, 
  3.710388093836072*^9}},ExpressionUUID->"0ef333f6-db71-4890-bd8c-\
3fe280d905c9"],

Cell[TextData[StyleBox["Formerly fe[r,c]",
 FontSlant->"Italic"]], "Text",
 CellChangeTimes->{{3.710386963364781*^9, 3.710386966853204*^9}, {
  3.710388021245575*^9, 
  3.710388023900119*^9}},ExpressionUUID->"4e0cb910-227d-4f43-ac7e-\
d0a8e91758a2"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Fobs", "::", "usage"}], "=", 
   "\"\<Fobs[t,r,c] gives the actual loss of heterozygosity to generation t. \
Fobs[r] is the mean over chromosomes, weighted by kb.  Uses hetM, so \
getFreqData must be loaded first.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Fobs", "[", 
    RowBox[{"t_", ",", "r_", ",", "c_"}], "]"}], ":=", 
   RowBox[{"1", "-", 
    FractionBox[
     RowBox[{"hetM", "[", 
      RowBox[{"t", ",", "r", ",", "c"}], "]"}], 
     RowBox[{"hetM", "[", 
      RowBox[{"0", ",", "r", ",", "c"}], "]"}]]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Fobs", "[", 
    RowBox[{"t_", ",", "r_"}], "]"}], ":=", 
   FractionBox[
    RowBox[{"Sum", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"Fobs", "[", 
        RowBox[{"t", ",", "r", ",", "c"}], "]"}], 
       RowBox[{
        RowBox[{"mouseLength", "[", "c", "]"}], ".", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"-", "1"}], ",", "1"}], "}"}]}]}], ",", 
      RowBox[{"{", 
       RowBox[{"c", ",", "20"}], "}"}]}], "]"}], 
    RowBox[{"Total", "[", 
     RowBox[{
      RowBox[{"mouseLength", "[", "]"}], ".", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.710065533174048*^9, 3.710065568316065*^9}, {
  3.7100656226592207`*^9, 3.710065680880458*^9}, {3.710074442944726*^9, 
  3.7100744467695913`*^9}, {3.71012951002702*^9, 3.710129535691505*^9}, {
  3.710129575971477*^9, 3.7101296332881413`*^9}, {3.710129759882134*^9, 
  3.7101297868489513`*^9}, {3.710388097616877*^9, 3.710388158563448*^9}, {
  3.7103882205208683`*^9, 3.710388246222911*^9}, {3.710388284094648*^9, 
  3.7103883107597*^9}, {3.710389855618705*^9, 3.71038988028836*^9}},
 CellLabel->
  "In[584]:=",ExpressionUUID->"09729db0-6594-4433-88a0-ab0aa457c902"]
}, Closed]],

Cell[CellGroupData[{

Cell["Fsim", "Subsubsection",
 CellChangeTimes->{{3.7103898952798862`*^9, 
  3.7103898968946447`*^9}},ExpressionUUID->"cf2d1956-14e6-483d-9f1f-\
92b4a9bf6d0e"],

Cell[TextData[StyleBox["Formerly feSim[r,c]",
 FontSlant->"Italic"]], "Text",
 CellChangeTimes->{{3.710386963364781*^9, 3.710386966853204*^9}, {
  3.710388021245575*^9, 3.710388023900119*^9}, {3.710389909927617*^9, 
  3.710389910782185*^9}},ExpressionUUID->"04276c88-bee6-40b1-b794-\
becb9fc823de"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Fsim", "::", "usage"}], "=", 
   "\"\<Fsim[\[ScriptCapitalP],t] lists the loss of heterozygosity to \
generation t in simulation \[ScriptCapitalP]. \>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Fsim", "[", 
    RowBox[{"\[ScriptCapitalP]_", ",", "t_Integer"}], "]"}], ":=", 
   RowBox[{"1", "-", 
    FractionBox[
     RowBox[{
      RowBox[{"hetP", "[", "\[ScriptCapitalP]", "]"}], "\[LeftDoubleBracket]", 
      RowBox[{"t", "+", "1"}], "\[RightDoubleBracket]"}], 
     RowBox[{
      RowBox[{"hetP", "[", "\[ScriptCapitalP]", "]"}], "\[LeftDoubleBracket]",
       "1", "\[RightDoubleBracket]"}]]}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.710067012158984*^9, 3.71006704580731*^9}, {
  3.710074456926931*^9, 3.710074459800638*^9}, {3.710129173375598*^9, 
  3.710129174622253*^9}, {3.710129796736081*^9, 3.710129803705571*^9}, {
  3.710131028214047*^9, 3.710131112075301*^9}, {3.710131159513599*^9, 
  3.7101311797438726`*^9}, {3.710389916154625*^9, 3.710390021266511*^9}},
 CellLabel->
  "In[587]:=",ExpressionUUID->"64dc2df9-fd23-4575-b566-348e985a7af7"]
}, Closed]]
}, Closed]]
}, Open  ]]
},
WindowSize->{1266, 851},
WindowMargins->{{Automatic, 49}, {Automatic, 0}},
Magnification:>1.25 Inherited,
FrontEndVersion->"11.3 for Mac OS X x86 (32-bit, 64-bit Kernel) (March 5, \
2018)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 576, 11, 73, "Text",ExpressionUUID->"8a7ca42e-511d-4d3c-ade9-778608795b4c"],
Cell[1137, 33, 781, 21, 44, "Text",ExpressionUUID->"b47abb51-279c-4800-a6c6-3802cf6762b5"],
Cell[CellGroupData[{
Cell[1943, 58, 158, 3, 84, "Section",ExpressionUUID->"8fb88e3f-f138-42a0-8515-d28fba859f49"],
Cell[CellGroupData[{
Cell[2126, 65, 166, 3, 67, "Subsection",ExpressionUUID->"636c662a-1f2d-4596-bf76-95167ae48c43"],
Cell[CellGroupData[{
Cell[2317, 72, 166, 3, 210, "Subsubsection",ExpressionUUID->"96fcd260-2722-4550-b6cb-28bbd585e406"],
Cell[2486, 77, 1065, 23, 604, "Text",ExpressionUUID->"9742648d-3c67-4cb8-9480-4945d8e23807"],
Cell[3554, 102, 317, 7, 278, "Text",ExpressionUUID->"a51af8c5-7d03-4428-a09a-fae140cba70b"],
Cell[3874, 111, 585, 12, 278, "Text",ExpressionUUID->"c8dee827-29c7-4848-8a71-5343fc7b2b74"],
Cell[4462, 125, 264, 6, 165, "Text",ExpressionUUID->"0bddfc54-f40b-4c96-a192-b9cf5acba79d"]
}, Open  ]],
Cell[CellGroupData[{
Cell[4763, 136, 188, 4, 210, "Subsubsection",ExpressionUUID->"e9208884-2b91-4e8f-94ac-675e2ef7319a"],
Cell[4954, 142, 517, 12, 11571, "Input",ExpressionUUID->"fb073d54-2a39-47ab-a687-18457f2c00b2",
 InitializationCell->True],
Cell[5474, 156, 773, 20, 11571, "Input",ExpressionUUID->"f24c567e-912d-4fff-8b17-c8ff5d9e40bf",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[6284, 181, 137, 3, 170, "Subsubsection",ExpressionUUID->"c3d7257e-de10-4634-aa5d-3eff7415dc84"],
Cell[6424, 186, 466, 11, 11571, "Input",ExpressionUUID->"201590cf-1541-4b65-8f20-c040999df7ba",
 InitializationCell->True],
Cell[6893, 199, 2082, 53, 18639, "Input",ExpressionUUID->"57c96732-851a-4562-a67a-d6ad199af7c7",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[9012, 257, 152, 3, 170, "Subsubsection",ExpressionUUID->"1ecfbef7-6d91-4501-b6c7-dc4ae24139f3"],
Cell[9167, 262, 506, 11, 1695, "Input",ExpressionUUID->"b9915b31-14e4-41bc-8c8e-e227f002431f",
 InitializationCell->True],
Cell[9676, 275, 1470, 38, 3495, "Input",ExpressionUUID->"e7e106c9-ec3a-4e62-92d2-36e996de22b1",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[11183, 318, 177, 3, 170, "Subsubsection",ExpressionUUID->"5e010a89-839c-4a46-8ff2-ff1d28a78118"],
Cell[11363, 323, 538, 12, 1953, "Input",ExpressionUUID->"415dd9bd-6394-495b-b420-928b90e1f912",
 InitializationCell->True],
Cell[11904, 337, 1258, 31, 2571, "Input",ExpressionUUID->"b7e9f5a2-41ed-4133-9ded-e8d72d6f7d31",
 InitializationCell->True]
}, Closed]]
}, Closed]],
Cell[CellGroupData[{
Cell[13211, 374, 365, 6, 46, "Subsection",ExpressionUUID->"e74ae715-11c5-4600-998c-988f13e6afdf"],
Cell[CellGroupData[{
Cell[13601, 384, 152, 2, 501, "Subsubsection",ExpressionUUID->"423c3388-63aa-41ca-ba3b-f03febc43ee8"],
Cell[13756, 388, 412, 10, 800, "Input",ExpressionUUID->"58fb73a7-8697-4b63-9987-758e06938a33",
 InitializationCell->True],
Cell[14171, 400, 494, 14, 1159, "Input",ExpressionUUID->"82794268-8926-4f08-ab5f-7885c7dcf304",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[14702, 419, 134, 3, 395, "Subsubsection",ExpressionUUID->"a862e6f5-151d-412c-aba6-90bbae6d8c2b"],
Cell[14839, 424, 453, 10, 692, "Input",ExpressionUUID->"0025bf22-4b7e-4445-a66e-8925cdd2f190",
 InitializationCell->True],
Cell[15295, 436, 577, 16, 692, "Input",ExpressionUUID->"1936bb67-765f-44ec-95e9-f156f0bb69c0",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[15909, 457, 191, 4, 395, "Subsubsection",ExpressionUUID->"6e7288da-5241-4d7b-8f08-dc89d77d4591"],
Cell[16103, 463, 634, 12, 15153, "Input",ExpressionUUID->"b35ce805-388d-4129-ab8e-b2e81e5b54b8",
 InitializationCell->True],
Cell[16740, 477, 477, 11, 7982, "Input",ExpressionUUID->"f4f980d9-cb2b-42e4-9284-15ef15f21c96",
 InitializationCell->True],
Cell[17220, 490, 1880, 48, 25601, "Input",ExpressionUUID->"fbd6e01c-f5ae-4ea5-86b3-bc5a4b199fbf",
 InitializationCell->True],
Cell[19103, 540, 2334, 61, 25601, "Input",ExpressionUUID->"c78ddc12-250c-4d7e-a79f-7188d53944b7",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[21474, 606, 195, 4, 395, "Subsubsection",ExpressionUUID->"e76fd7d2-aec2-4925-acd1-07d758b30812"],
Cell[21672, 612, 517, 11, 7982, "Input",ExpressionUUID->"f3611b63-0394-4b41-9e5f-744e8f2b2b24",
 InitializationCell->True],
Cell[22192, 625, 858, 22, 7982, "Input",ExpressionUUID->"6d618a21-ea0b-4d25-a1ea-ef15597c6078",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[23087, 652, 220, 4, 395, "Subsubsection",ExpressionUUID->"8a3f81cb-4473-402a-8b38-6540e42a8d5a"],
Cell[23310, 658, 784, 15, 15153, "Input",ExpressionUUID->"b9ea185c-a59b-4fd6-a375-919858c3f2ed",
 InitializationCell->True],
Cell[24097, 675, 953, 21, 11571, "Input",ExpressionUUID->"af4d6ef1-ce34-45f4-9238-c3964d8f0f30",
 InitializationCell->True],
Cell[25053, 698, 1042, 23, 7982, "Input",ExpressionUUID->"e9aa32b1-cf1d-4fba-959a-46f8ea29f366",
 InitializationCell->True],
Cell[26098, 723, 1009, 21, 7982, "Input",ExpressionUUID->"feb8fc66-81c8-4e5b-b964-f45a1681d785",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[27144, 749, 158, 3, 395, "Subsubsection",ExpressionUUID->"70aa070b-c55a-47a9-8909-054f4cc4d49d"],
Cell[27305, 754, 430, 10, 11571, "Input",ExpressionUUID->"f1baebc0-a9de-44de-9772-38d0d85b9b35",
 InitializationCell->True],
Cell[27738, 766, 943, 28, 10714, "Input",ExpressionUUID->"e9aadbd6-6b8e-495d-b85c-f7e85fdfed22",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[28718, 799, 155, 3, 395, "Subsubsection",ExpressionUUID->"7be8227e-2816-414b-8520-f86a815c3a19"],
Cell[28876, 804, 503, 11, 15153, "Input",ExpressionUUID->"1bf003ac-5d31-48e1-8031-85a222d7c81e",
 InitializationCell->True],
Cell[29382, 817, 2327, 66, 29123, "Input",ExpressionUUID->"92c606d4-abea-4952-9181-01193dfd4ae6",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[31746, 888, 152, 3, 395, "Subsubsection",ExpressionUUID->"5dbb1edc-2523-4b16-834a-564c9f3ed5b6"],
Cell[31901, 893, 614, 12, 15267, "Input",ExpressionUUID->"6ab0ce66-f404-44b6-bdb6-2f58549c700b",
 InitializationCell->True],
Cell[32518, 907, 1167, 31, 12621, "Input",ExpressionUUID->"0f95182e-433d-4525-9150-a59e077ea3c7",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[33722, 943, 203, 4, 395, "Subsubsection",ExpressionUUID->"c0bd9bf3-d6fd-4893-859d-d9ada2809f5d"],
Cell[33928, 949, 682, 14, 15267, "Input",ExpressionUUID->"27be2adf-0a43-4851-8fcb-faa4f0470205",
 InitializationCell->True],
Cell[34613, 965, 1371, 36, 12621, "Input",ExpressionUUID->"cf849edb-c77f-48f2-82f3-bd94b39d85ef",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[36021, 1006, 207, 4, 395, "Subsubsection",ExpressionUUID->"f0dcceb2-acb1-4f97-9e36-cec439e33f87"],
Cell[36231, 1012, 403, 10, 7982, "Input",ExpressionUUID->"5ff64f17-b7b0-497b-8cd1-9d2d48ad0e12",
 InitializationCell->True],
Cell[36637, 1024, 427, 12, 7982, "Input",ExpressionUUID->"5b628e63-3b61-4680-8918-9311a8b9fcee",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[37101, 1041, 206, 4, 395, "Subsubsection",ExpressionUUID->"b7c75e27-194b-4e65-be4e-ea93d71ea3c0"],
Cell[37310, 1047, 476, 11, 7982, "Input",ExpressionUUID->"ca423c9c-bc21-4d39-99a7-4602b4bfad85",
 InitializationCell->True],
Cell[37789, 1060, 430, 12, 7982, "Input",ExpressionUUID->"b38be96d-b2e8-4286-a8fc-a71339ec9343",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[38256, 1077, 252, 4, 395, "Subsubsection",ExpressionUUID->"0597a735-ee84-484d-ac1a-c8ddd3836a35"],
Cell[38511, 1083, 539, 12, 8078, "Input",ExpressionUUID->"f0c2adaa-22a8-48fc-b816-41e101189930",
 InitializationCell->True],
Cell[39053, 1097, 698, 21, 8573, "Input",ExpressionUUID->"e5094dc6-3432-4190-9cfa-8dda80733bb4",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[39788, 1123, 258, 4, 395, "Subsubsection",ExpressionUUID->"1f6ff4e6-5c21-4db9-9768-0ffb5bb8ddf0"],
Cell[40049, 1129, 472, 11, 7982, "Input",ExpressionUUID->"b0bbbb63-834a-4dac-b76e-beba63d0e628",
 InitializationCell->True],
Cell[40524, 1142, 481, 13, 7982, "Input",ExpressionUUID->"92bb77fc-d0fc-4cc3-b692-4b880405f1fb",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[41042, 1160, 233, 4, 395, "Subsubsection",ExpressionUUID->"5142824a-4a98-4c2d-a89f-9b3f6fb8b7a1"],
Cell[41278, 1166, 544, 11, 7982, "Input",ExpressionUUID->"18063771-675e-479e-9b83-0c9dce88ac39",
 InitializationCell->True],
Cell[41825, 1179, 487, 13, 7982, "Input",ExpressionUUID->"56e21eb3-59be-4281-8f16-ccdad8b4ba0f",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[42349, 1197, 285, 5, 395, "Subsubsection",ExpressionUUID->"7cf32b6d-4567-4c8f-b462-64816521eed8"],
Cell[42637, 1204, 606, 12, 8078, "Input",ExpressionUUID->"f79f5026-3257-4718-9dbe-d93763fe356e",
 InitializationCell->True],
Cell[43246, 1218, 898, 26, 8573, "Input",ExpressionUUID->"4770ba2b-346c-40c4-bf4e-36ce2bef9611",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[44181, 1249, 128, 3, 395, "Subsubsection",ExpressionUUID->"10d10d21-6f7e-4e94-b4d1-a1024b397504"],
Cell[44312, 1254, 545, 11, 15153, "Input",ExpressionUUID->"90f21dc4-1ab0-4458-80f1-005f0e8f77a9",
 InitializationCell->True],
Cell[44860, 1267, 902, 27, 11571, "Input",ExpressionUUID->"362fbf8a-ae2a-4f6c-96a3-70f3776db8b1",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[45799, 1299, 155, 3, 395, "Subsubsection",ExpressionUUID->"4fb3eab0-c291-4607-aa8b-2a461a0c8335"],
Cell[45957, 1304, 803, 15, 15153, "Input",ExpressionUUID->"e03f3667-215e-41cf-87cc-b2e407baf010",
 InitializationCell->True],
Cell[46763, 1321, 1596, 48, 28048, "Input",ExpressionUUID->"3511c9e4-9262-4169-8415-f90b62f0b857",
 InitializationCell->True]
}, Closed]]
}, Closed]],
Cell[CellGroupData[{
Cell[48408, 1375, 346, 6, 46, "Subsection",ExpressionUUID->"0bd9dff6-3de8-4a11-9a6c-1befebd69bde"],
Cell[48757, 1383, 475, 11, 178, "Text",ExpressionUUID->"561f0436-3938-4f58-9adb-9b77f11c1c5f"],
Cell[CellGroupData[{
Cell[49257, 1398, 169, 3, 135, "Subsubsection",ExpressionUUID->"71c2379c-429d-4118-b751-bc2328b24a0b"],
Cell[49429, 1403, 781, 14, 1539, "Text",ExpressionUUID->"05872cb2-2887-4cca-a89d-5a801020c469"]
}, Closed]],
Cell[CellGroupData[{
Cell[50247, 1422, 106, 0, 109, "Subsubsection",ExpressionUUID->"da6f2180-8017-43f4-aaee-57ab0760e791"],
Cell[50356, 1424, 333, 10, 7704, "Input",ExpressionUUID->"5a5f5cab-4770-4a99-bfc7-8f9314100e6b",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[50726, 1439, 130, 2, 109, "Subsubsection",ExpressionUUID->"01f84648-b86a-40a3-b5c0-6b2b21e5c0d5",
 InitializationCell->True],
Cell[50859, 1443, 1532, 25, 2735, "Input",ExpressionUUID->"55e3ba3d-f3ba-4f77-a3f3-46416a56537c",
 InitializationCell->True],
Cell[52394, 1470, 392, 10, 551, "Input",ExpressionUUID->"27a0e7a9-ac10-434d-833f-a4ac91d5b10f",
 InitializationCell->True],
Cell[52789, 1482, 1840, 53, 1290, "Input",ExpressionUUID->"d84173f7-6496-40ff-ac98-ffaed2f4070b",
 InitializationCell->True],
Cell[54632, 1537, 3269, 87, 1507, "Input",ExpressionUUID->"d5c831df-4666-4350-baf1-8d18e69d72ec",
 InitializationCell->True],
Cell[57904, 1626, 3509, 92, 1771, "Input",ExpressionUUID->"ad17fc9b-26ce-4474-b2b5-188064fb8883",
 InitializationCell->True],
Cell[61416, 1720, 4570, 115, 2735, "Input",ExpressionUUID->"b2485ad6-d87e-432f-b719-8c547392a5e4",
 InitializationCell->True],
Cell[65989, 1837, 192, 3, 348, "Text",ExpressionUUID->"684ef792-e802-44d2-a2a7-bac36fbddae3"],
Cell[CellGroupData[{
Cell[66206, 1844, 835, 25, 860, "Input",ExpressionUUID->"fdb4df7a-84f0-456b-bac3-e1d6ab383e33"],
Cell[67044, 1871, 241, 7, 365, "Output",ExpressionUUID->"0959bbb3-820a-40be-b41f-c9c08d3c7f85"]
}, Open  ]],
Cell[CellGroupData[{
Cell[67322, 1883, 360, 10, 365, "Input",ExpressionUUID->"2692719b-70ce-444c-b3ac-bbe676565dcd"],
Cell[67685, 1895, 240, 7, 365, "Output",ExpressionUUID->"a276c91d-acd3-4cfc-85b5-7fa4ca1ca932"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[67974, 1908, 86, 0, 109, "Subsubsection",ExpressionUUID->"23168383-d4ea-4822-8b8c-b45a147e9c4c"],
Cell[68063, 1910, 1458, 24, 3921, "Input",ExpressionUUID->"fe33782e-eab2-4a59-b850-dcdda02abdd8",
 InitializationCell->True],
Cell[69524, 1936, 1045, 30, 1634, "Input",ExpressionUUID->"0544453a-817c-4261-b5b5-784a7f80f860",
 InitializationCell->True],
Cell[70572, 1968, 2093, 60, 2387, "Input",ExpressionUUID->"09ee8678-781e-43ef-a902-b572ef6f53c9",
 InitializationCell->True],
Cell[72668, 2030, 2167, 57, 2978, "Input",ExpressionUUID->"30a9d593-17f1-424e-8a62-3bf969c10c93",
 InitializationCell->True],
Cell[74838, 2089, 680, 19, 860, "Input",ExpressionUUID->"1601dc02-c86a-45b1-8673-a1ad8ffcb558",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[75555, 2113, 131, 2, 109, "Subsubsection",ExpressionUUID->"b656c9bb-db23-41ac-98f8-41a311a862f8"],
Cell[75689, 2117, 2018, 32, 3729, "Input",ExpressionUUID->"4b5f18b5-e71f-4671-8733-27c87125c542",
 InitializationCell->True],
Cell[77710, 2151, 374, 10, 692, "Input",ExpressionUUID->"4a6d01d2-81a2-4de8-83e3-8cb9cf02ce45",
 InitializationCell->True],
Cell[78087, 2163, 10931, 266, 11060, "Input",ExpressionUUID->"fe5c95aa-2e76-4d12-8efb-033a0858681c",
 InitializationCell->True],
Cell[89021, 2431, 1490, 25, 30803, "Text",ExpressionUUID->"5af375ba-4ba5-4ff2-a673-0613b01899aa"],
Cell[90514, 2458, 671, 14, 17762, "Text",ExpressionUUID->"9058a04c-1cad-4258-a4b2-500d21f893ac"]
}, Closed]],
Cell[CellGroupData[{
Cell[91222, 2477, 152, 2, 109, "Subsubsection",ExpressionUUID->"a8bd9170-fbf2-4ea6-8dba-b3b8a59afb74"],
Cell[91377, 2481, 1828, 30, 22189, "Input",ExpressionUUID->"6d8d3d46-ecda-438a-8722-adab0a9c03d0",
 InitializationCell->True],
Cell[93208, 2513, 398, 10, 7982, "Input",ExpressionUUID->"97beaf86-de6c-46f8-8ff5-46732b1558c0",
 InitializationCell->True],
Cell[93609, 2525, 5946, 140, 54709, "Input",ExpressionUUID->"d1affc55-c19b-41c5-b265-8aa9bc32a7b8",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[99592, 2670, 166, 3, 109, "Subsubsection",ExpressionUUID->"b8c8c688-b675-45eb-b91b-577693967959"],
Cell[99761, 2675, 470, 10, 15153, "Input",ExpressionUUID->"5262f2c0-53e7-49fd-896e-92e9f9b3b396",
 InitializationCell->True],
Cell[100234, 2687, 633, 19, 7982, "Input",ExpressionUUID->"9698022b-9147-44fc-9c28-2f7c7b860005",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[100904, 2711, 138, 3, 109, "Subsubsection",ExpressionUUID->"7b2fb9d3-20f9-4c31-8f52-0be933be227f"],
Cell[101045, 2716, 424, 10, 11571, "Input",ExpressionUUID->"780bed91-f967-4b43-85bc-c133e32eacc2",
 InitializationCell->True],
Cell[101472, 2728, 1628, 47, 18639, "Input",ExpressionUUID->"18d2847b-e532-4407-b2c6-f0a8f57c2a60",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[103137, 2780, 135, 3, 109, "Subsubsection",ExpressionUUID->"0eb8473a-2205-438f-b980-9143cd291394"],
Cell[103275, 2785, 684, 14, 4889, "Input",ExpressionUUID->"46bd84be-e717-44fc-b261-40b78b24e32b",
 InitializationCell->True],
Cell[103962, 2801, 1253, 30, 3034, "Input",ExpressionUUID->"ba081eb0-5369-4360-b4f7-9b93621971de",
 InitializationCell->True],
Cell[105218, 2833, 2311, 61, 5170, "Input",ExpressionUUID->"bf97437a-4fc9-4d9c-95f8-9dbc0181c6a8",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[107566, 2899, 119, 2, 109, "Subsubsection",ExpressionUUID->"949054c4-32e6-4bfa-93a7-df1e563500b6",
 InitializationCell->True],
Cell[107688, 2903, 611, 13, 18639, "Input",ExpressionUUID->"164f041a-ab1f-477a-9b1f-267ce34317ea",
 InitializationCell->True],
Cell[108302, 2918, 455, 11, 7982, "Input",ExpressionUUID->"4882819d-423d-4aaa-88f5-8eb3135176a5",
 InitializationCell->True],
Cell[108760, 2931, 1049, 30, 11571, "Input",ExpressionUUID->"00fcf2d7-10df-448b-acc4-a0ddc0cafde8",
 InitializationCell->True],
Cell[109812, 2963, 698, 20, 7982, "Input",ExpressionUUID->"6de8c097-bfb2-4f78-b68d-e8b5c86f18d7",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[110547, 2988, 269, 5, 109, "Subsubsection",ExpressionUUID->"8242773b-6ae0-4bb3-aa2b-af0c452c7f22",
 InitializationCell->True],
Cell[110819, 2995, 2857, 44, 9240, "Input",ExpressionUUID->"e79108bb-9701-4f9f-b5e0-451957d34045",
 InitializationCell->True],
Cell[113679, 3041, 486, 11, 1073, "Input",ExpressionUUID->"9c99a9d3-c547-4483-845b-b03f8d591e90",
 InitializationCell->True],
Cell[114168, 3054, 1572, 42, 2037, "Input",ExpressionUUID->"8b163894-122c-4aa1-a520-b7588dfca165",
 InitializationCell->True],
Cell[115743, 3098, 4371, 108, 5826, "Input",ExpressionUUID->"e9703639-bcf8-43ae-b1bf-eae174efbe82",
 InitializationCell->True],
Cell[120117, 3208, 11937, 269, 18109, "Input",ExpressionUUID->"599dda00-cc05-4e90-a27b-c9c5aa49531f",
 InitializationCell->True],
Cell[132057, 3479, 13652, 228, 3264, "Input",ExpressionUUID->"40a5bee7-78d2-47f3-b6b3-a6f00d4b5054"],
Cell[145712, 3709, 763, 21, 1559, "Input",ExpressionUUID->"a43ff084-ea14-4615-a5ec-afaa3b61e5b2",
 InitializationCell->True],
Cell[146478, 3732, 973, 25, 1559, "Input",ExpressionUUID->"c33b7fef-3d73-403a-92a3-f8f6064fc6c3",
 InitializationCell->True],
Cell[147454, 3759, 1392, 37, 2054, "Input",ExpressionUUID->"cc755fe5-3613-416c-8439-cbaa5333f618",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[148883, 3801, 421, 7, 109, "Subsubsection",ExpressionUUID->"03c8e6d6-3fb4-400f-b000-2a84ddf73058",
 InitializationCell->True],
Cell[149307, 3810, 6254, 89, 8309, "Input",ExpressionUUID->"f6903759-f947-4d8f-8191-2d7e626b1ec5",
 InitializationCell->True],
Cell[155564, 3901, 360, 9, 692, "Input",ExpressionUUID->"0acef82c-2af5-4e29-9667-dd0dbeb3b9dc",
 InitializationCell->True],
Cell[155927, 3912, 27667, 588, 20231, "Input",ExpressionUUID->"7b551446-4d6e-436f-a250-7fe1710b8003",
 InitializationCell->True],
Cell[183597, 4502, 2457, 50, 1304, "Input",ExpressionUUID->"f4d0eaa8-e4e7-4eb9-a11f-d3e442d7a711",
 InitializationCell->True],
Cell[186057, 4554, 748, 19, 765, "Text",ExpressionUUID->"a629617d-a5cb-4500-a319-b7a80186f630"],
Cell[186808, 4575, 749, 14, 1820, "Text",ExpressionUUID->"bbb1f434-ebcd-4f2d-a26b-9f19776466fd"],
Cell[187560, 4591, 1040, 21, 1295, "Text",ExpressionUUID->"aa6ce812-9b4e-4a1a-9ecd-64091d2cd3c1"],
Cell[188603, 4614, 478, 8, 712, "Text",ExpressionUUID->"1bab784d-8209-49f6-979e-a564ca7dd91a"],
Cell[189084, 4624, 7802, 120, 1073, "Text",ExpressionUUID->"4708018b-2c7e-4ff7-ab06-8b056b86f33c"],
Cell[196889, 4746, 25754, 536, 18300, "Input",ExpressionUUID->"73387dba-904f-418b-98b3-602c0febb0af",
 InitializationCell->True],
Cell[222646, 5284, 2224, 44, 1304, "Input",ExpressionUUID->"18f31a6e-4126-4605-a0d2-9259bcf77baa",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[224907, 5333, 163, 3, 109, "Subsubsection",ExpressionUUID->"b3cc47f6-a635-4692-abc7-daeedc416d6b"],
Cell[225073, 5338, 437, 10, 15153, "Input",ExpressionUUID->"bc8a9808-c4d7-424d-8272-3cc69cbee6e0",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[225547, 5353, 139, 3, 109, "Subsubsection",ExpressionUUID->"b34a201c-eabd-4c82-b22e-2841599ad0e0"],
Cell[225689, 5358, 1348, 24, 22203, "Input",ExpressionUUID->"9bc5612a-1f5b-44ca-9550-dc94bc75b639",
 InitializationCell->True],
Cell[227040, 5384, 410, 10, 7982, "Input",ExpressionUUID->"aa53de80-bde2-4b73-8522-233d615117ab",
 InitializationCell->True],
Cell[227453, 5396, 422, 10, 7982, "Input",ExpressionUUID->"677d9dd4-6b28-44e3-8be3-3561c0492d87",
 InitializationCell->True],
Cell[227878, 5408, 3498, 92, 39781, "Input",ExpressionUUID->"eefcd97f-3699-48af-9ffd-6505aa00728c",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[231413, 5505, 366, 6, 109, "Subsubsection",ExpressionUUID->"1e06bff0-28cc-498d-bc1f-7e24640a1871",
 InitializationCell->True],
Cell[231782, 5513, 4195, 61, 64489, "Input",ExpressionUUID->"c79fbb0d-e09e-4d82-b00d-80c6305ca619",
 InitializationCell->True],
Cell[235980, 5576, 18818, 401, 172901, "Input",ExpressionUUID->"1e2f05f8-ee29-4ab4-a666-9edbf5b4346d",
 InitializationCell->True],
Cell[254801, 5979, 748, 19, 13807, "Text",ExpressionUUID->"3f11e49e-6f2a-4b92-9535-f513190eceeb"],
Cell[255552, 6000, 337, 7, 12831, "Text",ExpressionUUID->"85ded258-0a04-4013-b634-44ffed430c49"],
Cell[255892, 6009, 749, 14, 33018, "Text",ExpressionUUID->"1711ea31-cc83-470c-82ce-cfbba7739580"],
Cell[256644, 6025, 1040, 21, 28231, "Text",ExpressionUUID->"30ef9b4a-b090-4ca2-ac59-e960b3f76543"],
Cell[257687, 6048, 783, 18, 13382, "Text",ExpressionUUID->"a1a33404-9dc4-476d-99bc-6d42ae3717e8"],
Cell[258473, 6068, 1296, 27, 18068, "Input",ExpressionUUID->"d706bec7-798a-4b54-835c-d3d5e73198e6",
 InitializationCell->True],
Cell[259772, 6097, 319, 8, 22931, "Text",ExpressionUUID->"b396b315-4a75-4e85-88f7-c6ab73d9e3e1"]
}, Closed]],
Cell[CellGroupData[{
Cell[260128, 6110, 189, 3, 109, "Subsubsection",ExpressionUUID->"41a7f342-015d-4e24-a9cd-30b83b160175"],
Cell[260320, 6115, 549, 12, 2553, "Input",ExpressionUUID->"1e135051-0991-48aa-b64a-c889a4e2e103",
 InitializationCell->True],
Cell[260872, 6129, 521, 12, 1343, "Input",ExpressionUUID->"d9d46c52-d730-45dd-8704-46537da73746",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[261430, 6146, 170, 3, 109, "Subsubsection",ExpressionUUID->"bea02d65-ac4e-4d54-8e60-755c2b3a8498"],
Cell[261603, 6151, 514, 11, 7982, "Input",ExpressionUUID->"564a9567-02fa-4156-b874-70a2563087d7",
 InitializationCell->True],
Cell[262120, 6164, 1059, 27, 14210, "Input",ExpressionUUID->"1c4b203b-cc6b-4ea8-9a22-1d18c3b3b7de",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[263216, 6196, 166, 3, 109, "Subsubsection",ExpressionUUID->"c973a4ee-b3f8-48b7-9c37-31f90052140f"],
Cell[263385, 6201, 1005, 20, 18945, "Input",ExpressionUUID->"446dff93-a513-451a-b705-65a0c29341c0",
 InitializationCell->True],
Cell[264393, 6223, 359, 9, 7982, "Input",ExpressionUUID->"78957941-bb31-43c5-a93d-645d24ec0b3d",
 InitializationCell->True],
Cell[264755, 6234, 1986, 56, 25601, "Input",ExpressionUUID->"6a3fc562-907a-4351-8605-2a6b98b7ea4f",
 InitializationCell->True],
Cell[266744, 6292, 1421, 41, 18639, "Input",ExpressionUUID->"2c1e7f32-e549-4442-b6b5-90f362ab1104",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[268202, 6338, 158, 3, 109, "Subsubsection",ExpressionUUID->"5ff7df1d-0ab2-4853-842f-3cc3845b48a2"],
Cell[268363, 6343, 618, 13, 2553, "Input",ExpressionUUID->"7fd251c2-2f1e-4243-a3ac-39e13ccb5a51",
 InitializationCell->True],
Cell[268984, 6358, 321, 8, 1343, "Input",ExpressionUUID->"7848d8ef-e59c-468a-b643-043dbfdefed2",
 InitializationCell->True],
Cell[269308, 6368, 1980, 52, 4354, "Input",ExpressionUUID->"b7b92fb6-1097-4b6f-b2cb-1aaff448769e",
 InitializationCell->True],
Cell[271291, 6422, 567, 17, 1390, "Input",ExpressionUUID->"0c61b3e4-5513-443d-b6cd-51af63f083ed",
 InitializationCell->True],
Cell[271861, 6441, 462, 11, 1343, "Input",ExpressionUUID->"89841355-82e9-4abb-a1b4-29d9d15e4e06",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[272360, 6457, 207, 4, 109, "Subsubsection",ExpressionUUID->"953e5164-7775-4bbf-8c5a-514539aee5b7"],
Cell[272570, 6463, 585, 13, 1953, "Input",ExpressionUUID->"d801b8aa-10de-4788-b08d-1c186d879d69",
 InitializationCell->True],
Cell[273158, 6478, 766, 19, 1390, "Input",ExpressionUUID->"2686b2f7-15f1-42ee-985e-31955d488e8a",
 InitializationCell->True],
Cell[273927, 6499, 698, 19, 1390, "Input",ExpressionUUID->"8dc22be5-1e37-46a9-af19-11a929997b72",
 InitializationCell->True],
Cell[274628, 6520, 508, 11, 1343, "Input",ExpressionUUID->"c25c2f1d-d20a-40ee-8563-f30739546dbb",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[275173, 6536, 161, 3, 109, "Subsubsection",ExpressionUUID->"24198bc4-cfc9-4d00-ad26-0d1ba6e0b166"],
Cell[275337, 6541, 2958, 44, 970, "Input",ExpressionUUID->"2fc380a9-1d38-4a3b-8811-dcd7a1b0bc9f",
 InitializationCell->True],
Cell[278298, 6587, 1889, 34, 204, "Input",ExpressionUUID->"74b06022-0e85-4135-ae21-41006fb7a0a2",
 InitializationCell->True],
Cell[280190, 6623, 7354, 180, 1243, "Input",ExpressionUUID->"958f0106-9220-4c46-990e-03d00b15549d",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[287581, 6808, 166, 3, 109, "Subsubsection",ExpressionUUID->"1f9a8f51-d700-41da-8a9d-6dbf3b1853aa"],
Cell[287750, 6813, 384, 9, 7982, "Input",ExpressionUUID->"498ce0af-e35f-4b0d-8cbe-a17b58cf3da1",
 InitializationCell->True],
Cell[288137, 6824, 1679, 47, 25601, "Input",ExpressionUUID->"4cc95104-80ac-416d-9630-553a45f5f195",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[289853, 6876, 165, 3, 109, "Subsubsection",ExpressionUUID->"99628abd-dec7-4334-bcbb-9c65b3488494"],
Cell[290021, 6881, 1446, 25, 29818, "Input",ExpressionUUID->"25ccddcd-2b21-4bdf-9639-dc3b53351fb5",
 InitializationCell->True],
Cell[291470, 6908, 1120, 30, 11571, "Input",ExpressionUUID->"4d8707fe-018e-47c6-91e5-30953063147e",
 InitializationCell->True],
Cell[292593, 6940, 977, 27, 11571, "Input",ExpressionUUID->"e85018e1-b96f-4996-b456-33ed805f5eb0",
 InitializationCell->True],
Cell[293573, 6969, 3394, 88, 32667, "Input",ExpressionUUID->"a8025232-2527-4c27-8fca-b48a32ad8ab8",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[297004, 7062, 115, 2, 109, "Subsubsection",ExpressionUUID->"1244779b-be37-46e0-9fd8-6c8a60d4edc8",
 InitializationCell->True],
Cell[297122, 7066, 429, 10, 2037, "Input",ExpressionUUID->"58cc022b-55b1-45a6-b6e6-aef28706422d",
 InitializationCell->True],
Cell[297554, 7078, 1083, 30, 2340, "Input",ExpressionUUID->"784779d3-6636-4149-88af-e16a8666ff78",
 InitializationCell->True],
Cell[298640, 7110, 516, 16, 1559, "Input",ExpressionUUID->"05f61333-8cc7-47d1-b5f7-21fb48468f37",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[299193, 7131, 87, 0, 109, "Subsubsection",ExpressionUUID->"1d3fa83e-5641-4942-b958-7b2997ea0d91"],
Cell[299283, 7133, 317, 8, 1953, "Input",ExpressionUUID->"3f29b3bf-dbed-4f35-bc84-7bc39c64d998",
 InitializationCell->True],
Cell[299603, 7143, 899, 25, 1953, "Input",ExpressionUUID->"1b108211-56ce-496a-b824-8dc693621ce5",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[300539, 7173, 184, 4, 109, "Subsubsection",ExpressionUUID->"3a7576dc-8075-471b-9337-8e207f61eebd",
 InitializationCell->True],
Cell[300726, 7179, 395, 9, 11571, "Input",ExpressionUUID->"e056ea3b-193b-44d6-a89f-86a9afd45c37",
 InitializationCell->True],
Cell[301124, 7190, 930, 28, 11571, "Input",ExpressionUUID->"145ddcea-2485-4b76-924a-d670a2117181",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[302091, 7223, 153, 3, 109, "Subsubsection",ExpressionUUID->"dd1cc427-de7e-498e-8a38-5e508295be50"],
Cell[302247, 7228, 369, 9, 7982, "Input",ExpressionUUID->"b3b8d0d1-3261-47e6-8ea8-ee6e15be34aa",
 InitializationCell->True],
Cell[302619, 7239, 374, 10, 7982, "Input",ExpressionUUID->"ad4f731f-d857-4129-9230-71b0bc87739f",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[303030, 7254, 160, 3, 109, "Subsubsection",ExpressionUUID->"8dd224d9-42e8-4d8b-95b1-347c914e2d8b"],
Cell[303193, 7259, 585, 11, 11373, "Text",ExpressionUUID->"a079da0a-a054-4471-a67d-3c08d5302ab2"],
Cell[303781, 7272, 607, 12, 17762, "Input",ExpressionUUID->"fc4d2a5e-1d0a-442a-b57a-8194178f6240",
 InitializationCell->True],
Cell[304391, 7286, 551, 16, 10479, "Input",ExpressionUUID->"321c9ced-0ab5-4944-b389-430c74240466",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[304979, 7307, 158, 3, 109, "Subsubsection",ExpressionUUID->"29375def-28c7-4839-be67-ae6dda3ab036"],
Cell[305140, 7312, 964, 17, 18945, "Input",ExpressionUUID->"ffac52e3-4537-487b-bfd0-7e3998fae4e7",
 InitializationCell->True],
Cell[306107, 7331, 2746, 70, 18639, "Input",ExpressionUUID->"2df516b1-b79b-45ba-a454-66e806ff0778",
 InitializationCell->True]
}, Closed]]
}, Closed]],
Cell[CellGroupData[{
Cell[308902, 7407, 165, 3, 46, "Subsection",ExpressionUUID->"7fc763a1-f6b9-4e4f-b127-cc311e3fcf9d"],
Cell[CellGroupData[{
Cell[309092, 7414, 169, 3, 135, "Subsubsection",ExpressionUUID->"1c1624fb-91f3-486b-9916-39e1bbbb9cbc"],
Cell[309264, 7419, 802, 15, 1603, "Input",ExpressionUUID->"1aa4c713-ba4e-41d4-85df-fb3ce84e350d",
 InitializationCell->True],
Cell[310069, 7436, 2346, 56, 2135, "Input",ExpressionUUID->"c9bc1ded-1901-4b3f-8a8d-b46b4938ec21",
 InitializationCell->True],
Cell[312418, 7494, 309, 8, 501, "Input",ExpressionUUID->"ed35992d-4eca-41b2-b912-0896f182be4a"],
Cell[CellGroupData[{
Cell[312752, 7506, 645, 18, 501, "Input",ExpressionUUID->"367c0278-783b-455e-95c3-b639826979b2"],
Cell[313400, 7526, 287, 7, 460, "Output",ExpressionUUID->"c739baa9-c408-49ad-b2ee-e875a84de186"]
}, Open  ]],
Cell[313702, 7536, 1108, 35, 1073, "Input",ExpressionUUID->"74e357a8-5ee9-4ed6-9b6b-1cb02a38cd78"]
}, Closed]],
Cell[CellGroupData[{
Cell[314847, 7576, 222, 4, 109, "Subsubsection",ExpressionUUID->"e098dc96-8cdc-4637-8d63-1536401919eb"],
Cell[315072, 7582, 1307, 22, 1907, "Input",ExpressionUUID->"6b6d75ca-d13a-4f45-99b0-e50b48da28fb",
 InitializationCell->True],
Cell[316382, 7606, 3404, 78, 2831, "Input",ExpressionUUID->"1c6e6661-bbfc-4d4b-9bb2-0982173c6fb0",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[319823, 7689, 138, 3, 109, "Subsubsection",ExpressionUUID->"c3fd0086-f72e-432b-8b9b-ccc7e42d5841"],
Cell[319964, 7694, 1725, 59, 10714, "Text",ExpressionUUID->"8d656cf2-f705-48cb-b85d-ad3648e56772"],
Cell[321692, 7755, 675, 14, 12037, "Input",ExpressionUUID->"ecdec3bb-55f9-4338-a6dd-11e5a8b13ab4",
 InitializationCell->True],
Cell[322370, 7771, 3082, 79, 35287, "Input",ExpressionUUID->"1a22e445-bc15-4b35-a478-f99105780eab",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[325489, 7855, 214, 4, 109, "Subsubsection",ExpressionUUID->"78552497-8de2-4120-9da6-91e638a247ce"],
Cell[325706, 7861, 596, 12, 15153, "Input",ExpressionUUID->"557ff3d9-b0b0-4f9d-95dc-9f63a089229a",
 InitializationCell->True],
Cell[326305, 7875, 1102, 29, 19140, "Input",ExpressionUUID->"12e5d148-1be3-4696-a32f-228595623745",
 InitializationCell->True],
Cell[327410, 7906, 1245, 31, 19140, "Input",ExpressionUUID->"164d7184-ec46-4dab-995a-0b5fa123aecc",
 InitializationCell->True]
}, Closed]]
}, Closed]],
Cell[CellGroupData[{
Cell[328704, 7943, 166, 3, 46, "Subsection",ExpressionUUID->"a5dc54ba-92b5-40fb-a8c4-8855760bdb3c"],
Cell[CellGroupData[{
Cell[328895, 7950, 155, 4, 501, "Subsubsection",ExpressionUUID->"92e293bc-3e28-4cd6-bbb0-ccbaa39d45e3",
 InitializationCell->True],
Cell[329053, 7956, 552, 11, 10362, "Input",ExpressionUUID->"ca32b954-8515-4401-ab46-e1645aa2268d",
 InitializationCell->True],
Cell[329608, 7969, 1113, 33, 8573, "Input",ExpressionUUID->"afb2a216-4a22-4cd1-9827-21713aac36a1",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[330758, 8007, 208, 5, 395, "Subsubsection",ExpressionUUID->"8d17f8e3-180e-45af-b49d-e2c2e9be0327",
 InitializationCell->True],
Cell[330969, 8014, 543, 11, 10362, "Input",ExpressionUUID->"490de6db-fb1e-4771-97eb-ae70d0562daf",
 InitializationCell->True],
Cell[331515, 8027, 1320, 37, 11840, "Input",ExpressionUUID->"ddf5580f-976f-4fda-bb35-1f499d9dd8aa",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[332872, 8069, 231, 5, 395, "Subsubsection",ExpressionUUID->"a36b77bb-7e97-4671-a092-bd6033fbee6d",
 InitializationCell->True],
Cell[333106, 8076, 616, 13, 10362, "Input",ExpressionUUID->"18750f96-a1f8-4ef3-b07e-52e6c8355752",
 InitializationCell->True],
Cell[333725, 8091, 1333, 37, 11840, "Input",ExpressionUUID->"1f143773-a9be-45c4-8eb9-cef548203f56",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[335095, 8133, 204, 4, 395, "Subsubsection",ExpressionUUID->"00c4c972-4e88-4ffd-85e1-9de70f3c4207"],
Cell[335302, 8139, 474, 12, 11571, "Input",ExpressionUUID->"9f132e29-3ed8-45de-8337-92f700aa96ef",
 InitializationCell->True],
Cell[335779, 8153, 980, 29, 12501, "Input",ExpressionUUID->"54d889d6-6ad8-408f-8d50-755caabcf269",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[336796, 8187, 185, 4, 395, "Subsubsection",ExpressionUUID->"5ebbf6b5-6f23-4e9d-93e5-2c8132f802b5",
 InitializationCell->True],
Cell[336984, 8193, 536, 13, 2553, "Input",ExpressionUUID->"3e692f0e-8963-4204-855d-53bdf246c450",
 InitializationCell->True],
Cell[337523, 8208, 1221, 37, 2118, "Input",ExpressionUUID->"51eeaaf8-1c2e-4885-a31a-a518cc6af819",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[338781, 8250, 235, 5, 395, "Subsubsection",ExpressionUUID->"7bcb3426-4752-42c2-9f17-2b0955315841",
 InitializationCell->True],
Cell[339019, 8257, 547, 12, 1343, "Input",ExpressionUUID->"e5f2405b-7877-47cf-9882-3c1efecbd887",
 InitializationCell->True],
Cell[339569, 8271, 907, 27, 2118, "Input",ExpressionUUID->"e3ba3460-ec13-4229-be82-ca55583b5a69",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[340513, 8303, 183, 4, 395, "Subsubsection",ExpressionUUID->"46d74f0f-ce53-467f-9c01-049289379c8d",
 InitializationCell->True],
Cell[340699, 8309, 747, 14, 3634, "Input",ExpressionUUID->"51eb8ab0-770d-40e5-b0bc-742237253ee6",
 InitializationCell->True],
Cell[341449, 8325, 641, 19, 1343, "Input",ExpressionUUID->"7b0f912f-9477-4422-a937-47416b0c3387",
 InitializationCell->True],
Cell[342093, 8346, 855, 26, 1343, "Input",ExpressionUUID->"2f9285af-aab0-419c-91c5-d841d83270c8",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[342973, 8376, 606, 18, 890, "Input",ExpressionUUID->"1ed00e15-2b21-4418-bc86-8ef0d68c2857"],
Cell[343582, 8396, 625, 12, 1165, "Message",ExpressionUUID->"f0eba94e-a0a4-4cc4-ad1f-f4bce6b540a8"],
Cell[344210, 8410, 908, 17, 1676, "Message",ExpressionUUID->"f3d8c603-153e-4816-b7ff-99c947284d81"],
Cell[345121, 8429, 236, 6, 890, "Output",ExpressionUUID->"f754cb40-ac0f-4d45-aea1-a2fb5087c52d"]
}, Open  ]],
Cell[CellGroupData[{
Cell[345394, 8440, 325, 8, 1295, "Input",ExpressionUUID->"0a1550ee-789f-4c64-9979-9c46159efc2a"],
Cell[345722, 8450, 1420, 44, 2037, "Output",ExpressionUUID->"3df68017-8d36-4610-9ab2-5ff8354608a9"]
}, Open  ]]
}, Closed]]
}, Closed]],
Cell[CellGroupData[{
Cell[347203, 8501, 156, 3, 46, "Subsection",ExpressionUUID->"580df034-70a3-40d4-9e2e-5fcff82eccfa"],
Cell[CellGroupData[{
Cell[347384, 8508, 171, 3, 56, "Subsubsection",ExpressionUUID->"abefc359-3832-4c45-8cea-2a8528164b49"],
Cell[347558, 8513, 544, 11, 3214, "Input",ExpressionUUID->"61b74f60-0b41-44d5-892f-869cda3eb5c0",
 InitializationCell->True],
Cell[348105, 8526, 1341, 39, 3146, "Input",ExpressionUUID->"8de5a225-5660-4263-a92a-f08ba11be7d6",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[349483, 8570, 136, 3, 45, "Subsubsection",ExpressionUUID->"29dc85c5-f92a-4f33-9c09-f7f6b287bbef"],
Cell[349622, 8575, 503, 11, 15153, "Input",ExpressionUUID->"48652528-709c-4471-a698-4633cb04cc42",
 InitializationCell->True],
Cell[350128, 8588, 629, 19, 11373, "Input",ExpressionUUID->"ca368961-5a7d-4ee5-a5b4-2ddb4e8f0fb6",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[350782, 8611, 215, 5, 5265, "Input",ExpressionUUID->"74ef48c6-51ad-4f88-b8a2-cbf7da2493fc"],
Cell[351000, 8618, 204, 4, 5265, "Output",ExpressionUUID->"6942e863-dd6e-4a21-8ee4-1b99f8c2d72d"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[351253, 8628, 214, 4, 45, "Subsubsection",ExpressionUUID->"e8b894b4-8bdb-4abb-9b5b-ad217ee00b37"],
Cell[351470, 8634, 673, 13, 15153, "Input",ExpressionUUID->"2c9db652-e761-45a9-92e9-521fca50469c",
 InitializationCell->True],
Cell[352146, 8649, 949, 32, 12037, "Input",ExpressionUUID->"a487f5b3-1e71-4ca7-86b9-66127f5cb521",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[353132, 8686, 131, 3, 45, "Subsubsection",ExpressionUUID->"da1ed2ae-00a2-4f96-8c65-4d07faecf62b"],
Cell[353266, 8691, 750, 14, 15153, "Input",ExpressionUUID->"89b6d497-3ee8-41df-833f-98135018aff8",
 InitializationCell->True],
Cell[354019, 8707, 917, 28, 12831, "Input",ExpressionUUID->"2aa85267-1c8c-46e6-8575-7142073f9538",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[354973, 8740, 164, 3, 45, "Subsubsection",ExpressionUUID->"3dba8a32-6422-4158-aa96-f2aad6c049b6"],
Cell[355140, 8745, 559, 12, 171, "Input",ExpressionUUID->"1f970488-432a-42cd-b9b1-da7d31b3313b",
 InitializationCell->True],
Cell[355702, 8759, 3935, 97, 407, "Input",ExpressionUUID->"db63978c-5bcb-4c8c-aa9d-d777d40875a1",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[359674, 8861, 158, 3, 45, "Subsubsection",ExpressionUUID->"486f28ed-9da8-425f-84bc-d21753afaa44"],
Cell[359835, 8866, 560, 12, 417, "Input",ExpressionUUID->"e9a67d71-55d4-407f-bf2b-87596286d53e",
 InitializationCell->True],
Cell[360398, 8880, 654, 19, 217, "Input",ExpressionUUID->"7e74ee68-d254-4562-9b78-b0a04a86cc4d",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[361089, 8904, 135, 3, 45, "Subsubsection",ExpressionUUID->"419630e7-3d25-4804-9016-886dd5b42514"],
Cell[361227, 8909, 710, 15, 110, "Input",ExpressionUUID->"72c1004e-6836-4c49-ba54-c0f40de11010",
 InitializationCell->True],
Cell[361940, 8926, 1403, 41, 110, "Input",ExpressionUUID->"56f1fd47-71c7-4bc2-b09f-fbde641a6e49",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[363368, 8971, 600, 16, 37, "Input",ExpressionUUID->"367d2f06-85f9-4ed2-96dc-df0ea7d24bd7"],
Cell[363971, 8989, 483, 13, 42, "Output",ExpressionUUID->"f560c720-2b33-46ba-b10f-444b1d7bed20"]
}, Open  ]],
Cell[CellGroupData[{
Cell[364491, 9007, 445, 11, 37, "Input",ExpressionUUID->"68024995-41e3-4ab4-a69f-f94c888534c2"],
Cell[364939, 9020, 805, 20, 61, "Output",ExpressionUUID->"6ce2d00d-6ad0-43be-8569-aa607aae0928"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[365793, 9046, 157, 3, 56, "Subsubsection",ExpressionUUID->"89e7d65e-4cc1-4a92-830a-77f7b4e022d6"],
Cell[365953, 9051, 558, 12, 1046, "Input",ExpressionUUID->"07c86814-e509-495a-bc12-09bf5b48295b",
 InitializationCell->True],
Cell[366514, 9065, 1010, 29, 800, "Input",ExpressionUUID->"0332e0ee-a087-417c-aea8-282974575b31",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[367561, 9099, 233, 4, 45, "Subsubsection",ExpressionUUID->"b69e56ca-df12-4156-a23e-2d1439881b4f"],
Cell[367797, 9105, 295, 5, 44, "Text",ExpressionUUID->"a90c73f3-faf7-44a3-b992-9f64d4f27c72"],
Cell[368095, 9112, 283, 5, 44, "Text",ExpressionUUID->"c2b7ae63-77fe-4bce-9681-5a18edada4f9"],
Cell[368381, 9119, 403, 9, 57, "Input",ExpressionUUID->"44592c3b-e6ac-4c55-8876-a6c915da279c",
 InitializationCell->True],
Cell[368787, 9130, 801, 16, 110, "Input",ExpressionUUID->"2d4c8e80-f2e3-4d57-bb8f-d6906f4ceef0",
 InitializationCell->True],
Cell[369591, 9148, 1618, 43, 84, "Input",ExpressionUUID->"c0c567f0-5225-4bbc-bd0b-a98bbf66a63d",
 InitializationCell->True],
Cell[371212, 9193, 1256, 34, 84, "Input",ExpressionUUID->"41e3301a-ac07-4f40-b84d-3a84fa93ff6d",
 InitializationCell->True],
Cell[372471, 9229, 351, 9, 57, "Input",ExpressionUUID->"2880efef-a798-4b60-9d20-b7815d0b76f8",
 InitializationCell->True],
Cell[372825, 9240, 435, 10, 57, "Input",ExpressionUUID->"4c79a275-91ea-4123-b82e-1edd4bfbcd46",
 InitializationCell->True],
Cell[373263, 9252, 979, 26, 84, "Input",ExpressionUUID->"a41ed415-3e18-4272-b239-741f53056a16",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[374279, 9283, 131, 3, 56, "Subsubsection",ExpressionUUID->"0c7c9ecd-39ff-4a1f-8955-f06b32449f19"],
Cell[374413, 9288, 418, 10, 1343, "Input",ExpressionUUID->"0d902312-eaab-4e3d-bb05-9cedff5eabba",
 InitializationCell->True],
Cell[374834, 9300, 844, 27, 1359, "Input",ExpressionUUID->"1b1d8967-6600-4593-9bb6-dc2fc679a2b5",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[375715, 9332, 157, 3, 45, "Subsubsection",ExpressionUUID->"b25dbb1e-ae50-4ceb-a907-bda5dfbdb91d"],
Cell[375875, 9337, 366, 8, 4937, "Text",ExpressionUUID->"ed873c50-dcb4-453e-bd64-bed639f04862"],
Cell[376244, 9347, 1585, 27, 26132, "Input",ExpressionUUID->"2c1621ad-569a-420a-a13a-365b48dc1740",
 InitializationCell->True],
Cell[377832, 9376, 395, 10, 7982, "Input",ExpressionUUID->"d97961ca-e380-433e-946a-414f659518a9",
 InitializationCell->True],
Cell[378230, 9388, 6202, 170, 57687, "Input",ExpressionUUID->"511eae7a-25fa-4867-b921-eace7773bd5e",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[384469, 9563, 209, 4, 45, "Subsubsection",ExpressionUUID->"d3fe3bea-0a7c-479b-91d3-0875e753c6fc"],
Cell[384681, 9569, 1144, 20, 22718, "Input",ExpressionUUID->"180064bd-d703-4d13-bbae-27a7f6cf29ac",
 InitializationCell->True],
Cell[385828, 9591, 371, 9, 7982, "Input",ExpressionUUID->"a4c3aaed-7a87-4db8-b5a7-7d80e77ac4f5",
 InitializationCell->True],
Cell[386202, 9602, 3413, 87, 26415, "Input",ExpressionUUID->"97d0e224-0840-4985-b453-edba829fed4a",
 InitializationCell->True],
Cell[389618, 9691, 950, 28, 9093, "Text",ExpressionUUID->"434c6de1-895b-4d46-b1a2-fdb05b7ddf38"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[390617, 9725, 172, 3, 67, "Subsection",ExpressionUUID->"c7160448-e602-4f23-bb27-6c6a4294d007"],
Cell[390792, 9730, 262, 5, 44, "Text",ExpressionUUID->"c27db9d3-5712-40fb-be55-d3751d87b7d2"],
Cell[CellGroupData[{
Cell[391079, 9739, 156, 3, 56, "Subsubsection",ExpressionUUID->"57050684-7823-4685-b5b8-7fd2dd99ede8"],
Cell[391238, 9744, 973, 19, 496, "Text",ExpressionUUID->"061e968e-07d1-4898-88a2-fde6da3e117a"],
Cell[392214, 9765, 1092, 19, 714, "Text",ExpressionUUID->"00d8a552-fc89-45b0-ae54-f4bae75ac342"]
}, Closed]],
Cell[CellGroupData[{
Cell[393343, 9789, 133, 2, 45, "Subsubsection",ExpressionUUID->"f320233c-be83-438e-900f-2746e3292cd3"],
Cell[393479, 9793, 528, 11, 15153, "Input",ExpressionUUID->"0c4fb391-68c9-4b9b-8b0a-b330cd93e254",
 InitializationCell->True],
Cell[394010, 9806, 991, 25, 7982, "Input",ExpressionUUID->"a9dbf90c-2577-475f-a5b2-51dadc962e76",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[395038, 9836, 165, 3, 45, "Subsubsection",ExpressionUUID->"5f169ee5-2d20-4273-adb6-4488fbb1ece5"],
Cell[395206, 9841, 392, 9, 651, "Input",ExpressionUUID->"6249b4b5-4f21-424c-a7ea-eddf24e8688c",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[395635, 9855, 163, 4, 45, "Subsubsection",ExpressionUUID->"c589b96b-3735-4b57-b5e4-04148d750a20",
 InitializationCell->True],
Cell[395801, 9861, 779, 15, 817, "Input",ExpressionUUID->"62f1850e-ab02-4409-8f91-948432b508b5",
 InitializationCell->True],
Cell[396583, 9878, 357, 9, 339, "Input",ExpressionUUID->"d1988138-6b1c-4dde-b52d-b0bf21f74b77",
 InitializationCell->True],
Cell[396943, 9889, 3152, 83, 1885, "Input",ExpressionUUID->"a41b8aa1-6227-4819-a520-ac879bf9642c",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[400132, 9977, 137, 3, 45, "Subsubsection",ExpressionUUID->"c186ce80-3f4b-4c66-89c3-a613ffe50292"],
Cell[400272, 9982, 726, 15, 651, "Input",ExpressionUUID->"158ea2c7-b681-4c61-979d-c627bf5e8ce0",
 InitializationCell->True],
Cell[401001, 9999, 758, 21, 496, "Input",ExpressionUUID->"051da367-a51f-4bdd-88de-b0eb0840876c",
 InitializationCell->True]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[401808, 10026, 187, 3, 67, "Subsection",ExpressionUUID->"5fefc064-8c97-455c-b3e2-c0f76f7eb68b"],
Cell[CellGroupData[{
Cell[402020, 10033, 180, 3, 56, "Subsubsection",ExpressionUUID->"d2c42b6c-778b-4c5d-9818-e0746c770df9"],
Cell[402203, 10038, 883, 16, 131, "Text",ExpressionUUID->"5f8052e1-c95a-417d-8f6e-6a8033d98ac8"],
Cell[403089, 10056, 683, 12, 102, "Text",ExpressionUUID->"d3a2fe52-3e19-4df7-aaee-3479e3742ffe"],
Cell[403775, 10070, 1161, 19, 188, "Text",ExpressionUUID->"b04ee193-f4bc-4a0d-889d-fb7d376aa1a8"],
Cell[404939, 10091, 481, 13, 73, "Text",ExpressionUUID->"4e46a0f5-7521-4c2a-894b-ec0418240ac9"],
Cell[405423, 10106, 404, 10, 73, "Text",ExpressionUUID->"c88fd027-9b3a-407d-ace1-ad856bf6638d"],
Cell[405830, 10118, 791, 17, 131, "Text",ExpressionUUID->"37738e1e-aeb3-422d-a940-d7d270747e78"]
}, Closed]],
Cell[CellGroupData[{
Cell[406658, 10140, 220, 4, 45, "Subsubsection",ExpressionUUID->"f50de588-3891-466e-bcd8-7593f5cfc690"],
Cell[406881, 10146, 1368, 23, 162, "Input",ExpressionUUID->"7074cf70-69cf-4b6b-832c-f6b23fa6ed8d",
 InitializationCell->True],
Cell[408252, 10171, 34262, 790, 2962, "Input",ExpressionUUID->"1269de1c-0c79-488d-85af-8c119d2de5a2",
 InitializationCell->True],
Cell[442517, 10963, 182, 3, 44, "Text",ExpressionUUID->"cbcc7ff0-1675-473a-becc-27ba05631b96"],
Cell[442702, 10968, 232, 6, 57, "Input",ExpressionUUID->"ab20ccc4-20c8-42d4-94cd-6346601685c4",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[442971, 10979, 134, 3, 45, "Subsubsection",ExpressionUUID->"73fd7a1f-183b-4880-a57a-fdc588397049"],
Cell[443108, 10984, 412, 10, 339, "Input",ExpressionUUID->"929bac54-c8fa-48b2-878d-f0d3ac64733c",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[443557, 10999, 161, 3, 45, "Subsubsection",ExpressionUUID->"02e08c06-0abd-49ba-ab79-61e8a19051e9"],
Cell[443721, 11004, 484, 10, 651, "Input",ExpressionUUID->"486e32d9-ba09-47ac-a101-ea82890048da",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[444242, 11019, 210, 4, 45, "Subsubsection",ExpressionUUID->"a8eb7092-833f-4315-8af5-7fd022dbf79a"],
Cell[444455, 11025, 533, 11, 651, "Input",ExpressionUUID->"e38510f3-325a-4272-b3d1-40af93207acf",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[445025, 11041, 275, 4, 45, "Subsubsection",ExpressionUUID->"2543b99a-b91d-423b-be3d-3ecd5c003145"],
Cell[445303, 11047, 1378, 30, 1115, "Input",ExpressionUUID->"f77a2c91-ba3c-4bd9-8604-6c73feb6044e",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[446718, 11082, 139, 3, 45, "Subsubsection",ExpressionUUID->"21240011-80d5-410b-a998-983bc7d17e0a"],
Cell[446860, 11087, 827, 16, 1115, "Input",ExpressionUUID->"7ff70594-8aee-47ba-9e2a-b3c476db12f6",
 InitializationCell->True],
Cell[447690, 11105, 359, 9, 339, "Input",ExpressionUUID->"665b1a01-6755-4470-9218-7b6bb3014b77",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[448086, 11119, 263, 4, 45, "Subsubsection",ExpressionUUID->"045ed200-3711-4407-827c-37e8353c2d96"],
Cell[448352, 11125, 733, 14, 964, "Input",ExpressionUUID->"eb61efa2-fbf0-4e74-8200-0858affe7823",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[449122, 11144, 191, 4, 45, "Subsubsection",ExpressionUUID->"a8bf8621-bfac-43c6-a1fc-9ca387a35c1f"],
Cell[449316, 11150, 653, 14, 651, "Input",ExpressionUUID->"b68642d9-d805-4db2-824b-bdd7a7b3e1dd",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[450006, 11169, 311, 5, 45, "Subsubsection",ExpressionUUID->"264140a4-ba4d-427a-b8e9-8bc03ea47a9a"],
Cell[450320, 11176, 603, 13, 651, "Input",ExpressionUUID->"b5a32e53-5529-446f-a91c-3362de400dcd",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[450960, 11194, 135, 3, 45, "Subsubsection",ExpressionUUID->"4d703ce8-32af-4ef0-996c-e2551c031080"],
Cell[451098, 11199, 538, 11, 651, "Input",ExpressionUUID->"6ce4e31b-05d0-472e-8dcb-45677adf54cf",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[451673, 11215, 210, 4, 45, "Subsubsection",ExpressionUUID->"bffe4a49-4f9f-4bfc-a2a5-5657e1910541"],
Cell[451886, 11221, 446, 10, 204, "Input",ExpressionUUID->"25196203-46af-4c0f-beaa-b2ce3ebc9b20",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[452369, 11236, 166, 3, 45, "Subsubsection",ExpressionUUID->"a83b0fe5-15bc-4079-8b6a-5e65750ccaf5"],
Cell[452538, 11241, 709, 14, 267, "Input",ExpressionUUID->"666b4193-21ba-4701-887e-c6c5f10aa7fc",
 InitializationCell->True],
Cell[453250, 11257, 473, 10, 178, "Text",ExpressionUUID->"5285eafe-e062-4959-b1a9-705720bdac74"]
}, Closed]],
Cell[CellGroupData[{
Cell[453760, 11272, 218, 4, 45, "Subsubsection",ExpressionUUID->"40f62642-95d9-441d-9a5a-fc1f4ce65ec8"],
Cell[453981, 11278, 1173, 20, 457, "Input",ExpressionUUID->"729a3fbc-a045-416b-b0f1-6b9d46638365",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[455191, 11303, 160, 3, 45, "Subsubsection",ExpressionUUID->"bffe447b-9351-4cbb-a583-19bd4974c7ee"],
Cell[455354, 11308, 1144, 21, 212, "Input",ExpressionUUID->"97d2ee09-24af-4d5f-b4b5-b6e5d709d5c9",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[456535, 11334, 160, 3, 45, "Subsubsection",ExpressionUUID->"cf0e2709-645f-42e4-b082-eef1dce8805a"],
Cell[456698, 11339, 405, 9, 204, "Input",ExpressionUUID->"dbf310cc-89b8-4270-a3df-f152e380efdf",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[457140, 11353, 214, 4, 45, "Subsubsection",ExpressionUUID->"6f16e77b-c3de-4b06-8c24-2c2caf55d9c1"],
Cell[457357, 11359, 466, 10, 204, "Input",ExpressionUUID->"11a39ae8-e5a8-4b39-b345-dc402c4b20f5",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[457860, 11374, 236, 4, 45, "Subsubsection",ExpressionUUID->"04120d88-9a48-4d9f-8c52-ef187bc23c29"],
Cell[458099, 11380, 1559, 27, 964, "Input",ExpressionUUID->"c532989c-519c-4ce3-9982-2f3005a1fca4",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[459695, 11412, 161, 3, 45, "Subsubsection",ExpressionUUID->"e31449ba-c145-4b08-87b0-f715e3d6b8f7"],
Cell[459859, 11417, 611, 13, 267, "Input",ExpressionUUID->"80a8a0ca-e66f-4c8d-b716-39b718265a7f",
 InitializationCell->True]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[460519, 11436, 187, 3, 67, "Subsection",ExpressionUUID->"d6aaeb70-490f-4a75-bbca-257f92285ad2"],
Cell[CellGroupData[{
Cell[460731, 11443, 168, 3, 56, "Subsubsection",ExpressionUUID->"143a55d5-31c9-4f89-9a63-cb337751d66c"],
Cell[460902, 11448, 656, 13, 110, "Input",ExpressionUUID->"6f286f93-d55e-420b-bd93-0d00db721da3",
 InitializationCell->True],
Cell[461561, 11463, 857, 17, 84, "Input",ExpressionUUID->"ce3bbf20-b148-496d-9f8e-e76c98872927",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[462455, 11485, 194, 3, 56, "Subsubsection",ExpressionUUID->"9d84c643-2a95-402c-98ad-54ef15bc299f"],
Cell[462652, 11490, 882, 15, 136, "Input",ExpressionUUID->"7fe94f8a-38a7-41ac-af23-32b539f886c2",
 InitializationCell->True],
Cell[463537, 11507, 428, 10, 57, "Input",ExpressionUUID->"c52984f9-afe5-43e4-b4e0-31ad8f99e3e3",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[464002, 11522, 165, 3, 56, "Subsubsection",ExpressionUUID->"276b447a-f52e-4493-8577-488485199048"],
Cell[464170, 11527, 467, 10, 15153, "Input",ExpressionUUID->"410af89d-3858-4253-b2be-82da087811c3",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[464674, 11542, 344, 5, 45, "Subsubsection",ExpressionUUID->"b62b63df-a7f4-4600-91e7-e066ca861011"],
Cell[465021, 11549, 569, 12, 11571, "Input",ExpressionUUID->"dc5484bb-de3f-4240-862d-3fd9fe45a9bf",
 InitializationCell->True],
Cell[465593, 11563, 542, 12, 7982, "Input",ExpressionUUID->"1f91250e-86f4-4934-b92b-8a91ea950948",
 InitializationCell->True],
Cell[466138, 11577, 420, 10, 7982, "Input",ExpressionUUID->"ff46e2e6-47e2-4e81-8dbd-589ec635c48d",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[466595, 11592, 626, 10, 45, "Subsubsection",ExpressionUUID->"b8e9cfa3-0db9-47f0-8bc9-8ebb831c101f"],
Cell[467224, 11604, 628, 13, 2553, "Input",ExpressionUUID->"0551d313-b1cf-479a-8acb-6c1cddc52467",
 InitializationCell->True],
Cell[467855, 11619, 997, 18, 4306, "Input",ExpressionUUID->"d7b4ef2e-cc64-4ef8-96a1-2ed94502076b",
 InitializationCell->True],
Cell[468855, 11639, 591, 12, 2553, "Input",ExpressionUUID->"59fe7b68-0d56-4763-9ffa-319b68445208",
 InitializationCell->True],
Cell[469449, 11653, 700, 14, 3129, "Input",ExpressionUUID->"b81f2b0a-d7f8-4c65-8aee-3d93e12159d6",
 InitializationCell->True],
Cell[470152, 11669, 639, 13, 2553, "Input",ExpressionUUID->"f90d6789-5125-490b-b147-c64680504ce9",
 InitializationCell->True],
Cell[470794, 11684, 620, 13, 2553, "Input",ExpressionUUID->"250ef114-ce7d-47c8-963c-21b8dd8fb041",
 InitializationCell->True],
Cell[471417, 11699, 574, 12, 2571, "Input",ExpressionUUID->"2a5a30db-7743-43dc-b5c2-b1d93e3a5b8c",
 InitializationCell->True],
Cell[471994, 11713, 368, 9, 1953, "Input",ExpressionUUID->"2a6d51d6-2fb4-4510-8053-8aee8dd7a97f",
 InitializationCell->True],
Cell[472365, 11724, 347, 9, 1343, "Input",ExpressionUUID->"95dab8f6-a4b1-4bb1-8038-c813feb387ac",
 InitializationCell->True],
Cell[472715, 11735, 454, 9, 1920, "Text",ExpressionUUID->"3dc504f8-ff1e-40a1-a871-33312d83e0ea"],
Cell[473172, 11746, 390, 9, 1953, "Input",ExpressionUUID->"05721fb5-c06a-418b-bca3-c8c82e06a015",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[473599, 11760, 344, 5, 45, "Subsubsection",ExpressionUUID->"81a1ae01-2e5d-4971-82f5-05bcc2791be2"],
Cell[473946, 11767, 540, 11, 7982, "Input",ExpressionUUID->"6d07918b-ae31-4f9e-b1c0-d596486359d7",
 InitializationCell->True],
Cell[474489, 11780, 574, 12, 7982, "Input",ExpressionUUID->"bed5e5b1-36ac-4b1b-8468-58280d2bc6d5",
 InitializationCell->True],
Cell[475066, 11794, 479, 10, 7982, "Input",ExpressionUUID->"05ae1e75-b5c2-4b72-a710-878ffdb70d30",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[475582, 11809, 412, 6, 45, "Subsubsection",ExpressionUUID->"b0965356-6834-4d11-bd6a-e29541f00141"],
Cell[475997, 11817, 589, 12, 7982, "Input",ExpressionUUID->"64880ae9-65f5-42a6-9ef0-a17f78a2d4cf",
 InitializationCell->True],
Cell[476589, 11831, 581, 12, 7982, "Input",ExpressionUUID->"a25ad287-d246-4c35-bd50-1a0a85ead914",
 InitializationCell->True]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[477219, 11849, 169, 3, 67, "Subsection",ExpressionUUID->"56a34f8b-daf3-4681-a8ac-2713c5286b30"],
Cell[477391, 11854, 347, 7, 278, "Text",ExpressionUUID->"a7b91c98-d060-46b0-a9f5-9ca076700e8d"],
Cell[CellGroupData[{
Cell[477763, 11865, 163, 3, 210, "Subsubsection",ExpressionUUID->"56c09d71-cfff-411d-a285-64b2991816ac"],
Cell[477929, 11870, 1403, 23, 631, "Input",ExpressionUUID->"a11183d3-9e67-4767-b1c9-92a82e94c53c",
 InitializationCell->True],
Cell[479335, 11895, 447, 10, 417, "Input",ExpressionUUID->"3fb5ed94-eeb0-4a9e-84ce-7037bde27f75",
 InitializationCell->True],
Cell[479785, 11907, 527, 13, 217, "Input",ExpressionUUID->"e9129431-b0bc-4c5e-918b-5375a25610e3",
 InitializationCell->True],
Cell[480315, 11922, 3401, 85, 814, "Input",ExpressionUUID->"f9df9d75-9086-4a97-a8bd-a884f926c52a",
 InitializationCell->True],
Cell[483719, 12009, 1445, 30, 318, "Input",ExpressionUUID->"2581494c-56b4-4b6f-bc0b-603575b259a8",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[485201, 12044, 166, 3, 210, "Subsubsection",ExpressionUUID->"3f770963-2621-4efd-9a50-4009ce616a54"],
Cell[485370, 12049, 1612, 26, 739, "Input",ExpressionUUID->"cef12bfa-8ba9-400b-ba05-8d085525e788",
 InitializationCell->True],
Cell[486985, 12077, 437, 10, 217, "Input",ExpressionUUID->"1108ef83-9f3c-4700-bf46-aecef792ea1f",
 InitializationCell->True],
Cell[487425, 12089, 402, 10, 217, "Input",ExpressionUUID->"0372bbe1-4556-4b03-86eb-33ca3711749c",
 InitializationCell->True],
Cell[487830, 12101, 2595, 62, 617, "Input",ExpressionUUID->"c40e3ed1-cb06-4b6f-b049-e01b3a84998b",
 InitializationCell->True],
Cell[490428, 12165, 2913, 73, 617, "Input",ExpressionUUID->"70c54b3e-6390-40a8-8352-2d460b8af7bf",
 InitializationCell->True],
Cell[493344, 12240, 1643, 32, 318, "Input",ExpressionUUID->"c74ff180-10d4-49c2-8b50-43557c3e286f",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[495024, 12277, 159, 3, 210, "Subsubsection",ExpressionUUID->"f63c8e1f-4e9e-437a-adad-b2273a3191ea"],
Cell[495186, 12282, 669, 13, 15153, "Input",ExpressionUUID->"bea6fe2d-9323-44b1-8a6a-2f66f3bbb915",
 InitializationCell->True],
Cell[495858, 12297, 785, 22, 7982, "Input",ExpressionUUID->"d8f17086-f283-411d-9e51-fb964157e11c",
 InitializationCell->True],
Cell[496646, 12321, 1077, 28, 11571, "Input",ExpressionUUID->"23454c28-4fb5-4330-8e9f-a5d8f6609c75",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[497760, 12354, 168, 3, 170, "Subsubsection",ExpressionUUID->"e18d4d30-460e-47b7-8d79-628d09bb1cd9"],
Cell[497931, 12359, 582, 12, 8295, "Input",ExpressionUUID->"13c549bc-cab1-4c61-a08e-d9d5770ceeac",
 InitializationCell->True],
Cell[498516, 12373, 1612, 44, 15153, "Input",ExpressionUUID->"084c2520-a86b-4d87-8d29-cf5b29b7e8aa",
 InitializationCell->True]
}, Closed]]
}, Closed]],
Cell[CellGroupData[{
Cell[500177, 12423, 170, 3, 46, "Subsection",ExpressionUUID->"2b9c2780-f8fd-41ee-b0cf-1411fcba506a"],
Cell[CellGroupData[{
Cell[500372, 12430, 162, 3, 135, "Subsubsection",ExpressionUUID->"32566706-43d3-4048-bb6c-7698b625beca"],
Cell[500537, 12435, 824, 21, 496, "Input",ExpressionUUID->"1556818a-fb06-4c10-9a1a-0d5bd9e0dc11",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[501398, 12461, 155, 3, 109, "Subsubsection",ExpressionUUID->"e7c45fc1-b1c4-4d98-894e-54432bf17daa"],
Cell[501556, 12466, 787, 22, 318, "Input",ExpressionUUID->"dc21b8aa-ac57-4989-ada5-daf64e0d93ac",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[502380, 12493, 155, 3, 109, "Subsubsection",ExpressionUUID->"0ee975dd-2c90-4b63-8dd1-511d0ad1b725"],
Cell[502538, 12498, 943, 23, 318, "Input",ExpressionUUID->"e38c3499-380c-4a37-8f55-3197d505fca8",
 InitializationCell->True]
}, Closed]]
}, Closed]],
Cell[CellGroupData[{
Cell[503530, 12527, 232, 4, 46, "Subsection",ExpressionUUID->"ce26b4c1-5382-4164-b993-09b7d87bd135"],
Cell[CellGroupData[{
Cell[503787, 12535, 147, 3, 135, "Subsubsection",ExpressionUUID->"e5cd4a9c-161d-45ed-b4b7-7d71a3cd005e"],
Cell[503937, 12540, 594, 12, 517, "Input",ExpressionUUID->"5345e9b7-b9a4-4089-948e-b97be2650448",
 InitializationCell->True],
Cell[504534, 12554, 4696, 126, 1507, "Input",ExpressionUUID->"f49b9cfd-359f-4c1f-b9a3-90ec4f62ea47",
 InitializationCell->True]
}, Closed]]
}, Closed]],
Cell[CellGroupData[{
Cell[509279, 12686, 244, 4, 46, "Subsection",ExpressionUUID->"cc40ba09-b7f2-4f1f-ac58-40dc1430665f"],
Cell[509526, 12692, 189, 3, 44, "Text",ExpressionUUID->"d13d52b9-1726-41b1-ad28-32b5e8b41e29"],
Cell[CellGroupData[{
Cell[509740, 12699, 134, 3, 56, "Subsubsection",ExpressionUUID->"dbdcbc9d-0880-4d68-a13f-3c2fab570781"],
Cell[509877, 12704, 682, 13, 331, "Input",ExpressionUUID->"e00bfb68-bb1f-44c9-a709-6bee0737d293",
 InitializationCell->True],
Cell[510562, 12719, 3511, 105, 531, "Input",ExpressionUUID->"2cc02bc7-057a-4ee0-9055-07150ecde5d9",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[514110, 12829, 135, 3, 45, "Subsubsection",ExpressionUUID->"9cf561b2-b99a-45f9-a868-9cb47cbf06dc"],
Cell[514248, 12834, 276, 5, 106, "Text",ExpressionUUID->"2c7351db-82e2-40d5-a4c8-7c97ca5bbf76"],
Cell[514527, 12841, 1402, 23, 712, "Input",ExpressionUUID->"3a2dd7f2-6f5c-44df-81ee-d04d6f7708f0",
 InitializationCell->True],
Cell[515932, 12866, 379, 9, 204, "Input",ExpressionUUID->"52c232aa-045f-4b36-a916-1ad7accfdc91",
 InitializationCell->True],
Cell[516314, 12877, 433, 10, 139, "Input",ExpressionUUID->"3558f631-9cf8-4c22-a30d-e50d0c4e5036",
 InitializationCell->True],
Cell[516750, 12889, 350, 9, 139, "Input",ExpressionUUID->"1556231a-2369-4c55-8f98-fd3642c65dd9",
 InitializationCell->True],
Cell[517103, 12900, 344, 9, 139, "Input",ExpressionUUID->"c03e58f1-a539-405e-81f8-1904a19ef8ea",
 InitializationCell->True],
Cell[517450, 12911, 3059, 82, 523, "Input",ExpressionUUID->"21e94257-146c-4890-b9d0-6511a1e33771",
 InitializationCell->True],
Cell[520512, 12995, 1672, 46, 334, "Input",ExpressionUUID->"9e3a8cf2-eda4-4fcc-bb63-51089672f271",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[522221, 13046, 169, 3, 45, "Subsubsection",ExpressionUUID->"0a801267-374f-4ddd-86ec-940cef8d84a8"],
Cell[522393, 13051, 276, 6, 106, "Text",ExpressionUUID->"9bcf291e-1c01-4c45-a1dc-119821675c08"],
Cell[CellGroupData[{
Cell[522694, 13061, 1490, 38, 282, "Input",ExpressionUUID->"eb378aa7-b1ea-4242-ab2d-e1b1567ddaf4"],
Cell[524187, 13101, 25263, 437, 2028, "Output",ExpressionUUID->"1f6182e9-b3d0-4ab4-bfe3-cf044b7bfdfb"]
}, Closed]]
}, Closed]],
Cell[CellGroupData[{
Cell[549499, 13544, 136, 2, 45, "Subsubsection",ExpressionUUID->"6be9209c-63fc-46da-8f63-6c481d6cb6bb"],
Cell[549638, 13548, 932, 18, 651, "Input",ExpressionUUID->"5983fda2-8ccb-4553-ba78-7c143737bf8e",
 InitializationCell->True],
Cell[550573, 13568, 1377, 38, 651, "Input",ExpressionUUID->"f65d9370-5b6a-461e-a77d-4b98ea3bd809",
 InitializationCell->True],
Cell[551953, 13608, 292, 6, 257, "Text",ExpressionUUID->"44c9dd3f-add7-435c-960c-59f5a98123ff"],
Cell[CellGroupData[{
Cell[552270, 13618, 422, 10, 217, "Input",ExpressionUUID->"5f770bdb-dd4f-40ef-ad4a-6323e8acf2c3"],
Cell[552695, 13630, 233, 5, 245, "Output",ExpressionUUID->"02e74e8a-5f5f-4ac3-981f-555cc99d9ecb"]
}, Closed]],
Cell[CellGroupData[{
Cell[552965, 13640, 1852, 50, 835, "Input",ExpressionUUID->"f4d65d56-ef0a-430d-aa5e-7bbe8586b9e2"],
Cell[554820, 13692, 258, 6, 245, "Output",ExpressionUUID->"7c4d6dba-9dbe-4c2b-8dd7-127253bb1910"]
}, Closed]],
Cell[CellGroupData[{
Cell[555115, 13703, 207, 4, 217, "Input",ExpressionUUID->"ecddcd43-ad1b-46d9-b223-9902dc51ca85"],
Cell[555325, 13709, 182, 3, 245, "Output",ExpressionUUID->"6c110244-254d-433e-9c37-a2f31ec47963"]
}, Closed]]
}, Closed]],
Cell[CellGroupData[{
Cell[555556, 13718, 157, 3, 45, "Subsubsection",ExpressionUUID->"d10277af-f87f-4285-bf07-5651634dd4ca"],
Cell[555716, 13723, 695, 14, 110, "Input",ExpressionUUID->"8b699801-ef2f-43ae-8abb-6227bb0a1a05",
 InitializationCell->True],
Cell[556414, 13739, 2436, 66, 179, "Input",ExpressionUUID->"ce520556-a145-409a-8fbb-95d4cc738086",
 InitializationCell->True]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[558899, 13811, 286, 5, 67, "Subsection",ExpressionUUID->"1a7ef4b2-be33-47a3-bd0d-006bb1281554"],
Cell[559188, 13818, 363, 7, 106, "Text",ExpressionUUID->"6f5c221d-0d53-4964-a33a-f8fb6873cef4"],
Cell[CellGroupData[{
Cell[559576, 13829, 160, 3, 135, "Subsubsection",ExpressionUUID->"f915e898-0d2d-4396-91c4-88a73e9940fb"],
Cell[559739, 13834, 200, 4, 106, "Text",ExpressionUUID->"3924cd91-766c-4986-8a2e-72a2bd33858c"],
Cell[559942, 13840, 777, 22, 204, "Input",ExpressionUUID->"ebae49ed-6f34-410d-bf1e-047724013238",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[560756, 13867, 157, 3, 135, "Subsubsection",ExpressionUUID->"ef0c3466-7666-47bb-8b48-2d2b0d2db7b3"],
Cell[560916, 13872, 199, 4, 106, "Text",ExpressionUUID->"a2cebfd4-978e-423c-9e48-4f577022c464"],
Cell[561118, 13878, 2636, 64, 640, "Input",ExpressionUUID->"b7358717-dc8d-4797-9a6c-be6cf83b2559",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[563791, 13947, 158, 3, 135, "Subsubsection",ExpressionUUID->"e2767d31-52b6-4b61-bf69-5ed42f7d6773"],
Cell[563952, 13952, 199, 4, 106, "Text",ExpressionUUID->"fcc4186f-156c-457d-8969-aaadd7ced827"],
Cell[564154, 13958, 1238, 30, 260, "Input",ExpressionUUID->"5f887c80-b9cb-4cfe-9769-729846d347ab",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[565429, 13993, 155, 3, 135, "Subsubsection",ExpressionUUID->"0ef333f6-db71-4890-bd8c-3fe280d905c9"],
Cell[565587, 13998, 249, 5, 106, "Text",ExpressionUUID->"4e0cb910-227d-4f43-ac7e-d0a8e91758a2"],
Cell[565839, 14005, 1926, 50, 523, "Input",ExpressionUUID->"09729db0-6594-4433-88a0-ab0aa457c902",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[567802, 14060, 159, 3, 135, "Subsubsection",ExpressionUUID->"cf2d1956-14e6-483d-9f1f-92b4a9bf6d0e"],
Cell[567964, 14065, 298, 5, 106, "Text",ExpressionUUID->"04276c88-bee6-40b1-b794-becb9fc823de"],
Cell[568265, 14072, 1164, 26, 262, "Input",ExpressionUUID->"64dc2df9-fd23-4575-b566-348e985a7af7",
 InitializationCell->True]
}, Closed]]
}, Closed]]
}, Open  ]]
}
]
*)

